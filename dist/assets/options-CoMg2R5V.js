var em=Object.defineProperty;var Hu=h=>{throw TypeError(h)};var sm=(h,e,t)=>e in h?em(h,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):h[e]=t;var U=(h,e,t)=>sm(h,typeof e!="symbol"?e+"":e,t),Vh=(h,e,t)=>e.has(h)||Hu("Cannot "+t);var r=(h,e,t)=>(Vh(h,e,"read from private field"),t?t.call(h):e.get(h)),A=(h,e,t)=>e.has(h)?Hu("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(h):e.set(h,t),p=(h,e,t,s)=>(Vh(h,e,"write to private field"),s?s.call(h,t):e.set(h,t),t),v=(h,e,t)=>(Vh(h,e,"access private method"),t);var de=(h,e,t,s)=>({set _(i){p(h,e,i,t)},get _(){return r(h,e,s)}});import{c as qt,M as Xe,f as Po,g as Lo,h as eo,r as V,s as ue,j as b,F as Uu,a as Cc,d as Mi,U as nh,S as kc,B as im,G as nm,A as rm,b as Gu,C as pu,e as am,R as om}from"./index-Cfa0ii_D.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gu=qt("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lm=qt("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cm=qt("Github",[["path",{d:"M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4",key:"tonef"}],["path",{d:"M9 18c-4.51 2-5-2-7-2",key:"9comsn"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hm=qt("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dm=qt("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const um=qt("Linkedin",[["path",{d:"M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z",key:"c2jq9f"}],["rect",{width:"4",height:"12",x:"2",y:"9",key:"mk3on5"}],["circle",{cx:"4",cy:"4",r:"2",key:"bt5ra8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wu=qt("Loader",[["line",{x1:"12",x2:"12",y1:"2",y2:"6",key:"gza1u7"}],["line",{x1:"12",x2:"12",y1:"18",y2:"22",key:"1qhbu9"}],["line",{x1:"4.93",x2:"7.76",y1:"4.93",y2:"7.76",key:"xae44r"}],["line",{x1:"16.24",x2:"19.07",y1:"16.24",y2:"19.07",key:"bxnmvf"}],["line",{x1:"2",x2:"6",y1:"12",y2:"12",key:"89khin"}],["line",{x1:"18",x2:"22",y1:"12",y2:"12",key:"pb8tfm"}],["line",{x1:"4.93",x2:"7.76",y1:"19.07",y2:"16.24",key:"1uxjnu"}],["line",{x1:"16.24",x2:"19.07",y1:"7.76",y2:"4.93",key:"6duxfx"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fm=qt("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pm=qt("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gm=qt("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mm=qt("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ws=qt("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bm=qt("Presentation",[["path",{d:"M2 3h20",key:"91anmk"}],["path",{d:"M21 3v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V3",key:"2k9sn8"}],["path",{d:"m7 21 5-5 5 5",key:"bip4we"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ym=qt("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z",key:"1lpok0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uo=qt("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wc=qt("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Am=qt("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mu=qt("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);var Mo={};Mo.d=(h,e)=>{for(var t in e)Mo.o(e,t)&&!Mo.o(h,t)&&Object.defineProperty(h,t,{enumerable:!0,get:e[t]})};Mo.o=(h,e)=>Object.prototype.hasOwnProperty.call(h,e);var W=globalThis.pdfjsLib={};Mo.d(W,{AbortException:()=>dn,AnnotationEditorLayer:()=>lu,AnnotationEditorParamsType:()=>et,AnnotationEditorType:()=>X,AnnotationEditorUIManager:()=>Mr,AnnotationLayer:()=>py,AnnotationMode:()=>Ri,ColorPicker:()=>hh,DOMSVGFactory:()=>Eu,DrawLayer:()=>du,FeatureTest:()=>ye,GlobalWorkerOptions:()=>Si,ImageKind:()=>Tc,InvalidPDFException:()=>ed,MissingPDFException:()=>Io,OPS:()=>os,OutputScale:()=>id,PDFDataRangeTransport:()=>xp,PDFDateString:()=>wu,PDFWorker:()=>Yr,PasswordResponses:()=>Sm,PermissionFlag:()=>xm,PixelsPerInch:()=>un,RenderingCancelledException:()=>Au,TextLayer:()=>Do,TouchManager:()=>lh,UnexpectedResponseException:()=>rh,Util:()=>$,VerbosityLevel:()=>Rh,XfaLayer:()=>_p,build:()=>Xb,createValidAbsoluteUrl:()=>km,fetchData:()=>Fh,getDocument:()=>zb,getFilenameFromUrl:()=>Fm,getPdfFilenameFromUrl:()=>jm,getXfaPageViewport:()=>Om,isDataScheme:()=>jh,isPdfFile:()=>vu,noContextMenu:()=>xs,normalizeUnicode:()=>Im,setLayerDimensions:()=>Lr,shadow:()=>tt,stopEvent:()=>Ge,version:()=>qb});const ce=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),wf=[1,0,0,1,0,0],td=[.001,0,0,.001,0,0],vm=1e7,qh=1.35,He={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},Ri={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},wm="pdfjs_internal_editor_",X={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15},et={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_DEFAULT_COLOR:32,HIGHLIGHT_THICKNESS:33,HIGHLIGHT_FREE:34,HIGHLIGHT_SHOW_ALL:35,DRAW_STEP:41},xm={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},ee={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},Tc={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},Ft={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,WIDGET:20},oo={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},Rh={ERRORS:0,WARNINGS:1,INFOS:5},os={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93},Sm={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let Ih=Rh.WARNINGS;function _m(h){Number.isInteger(h)&&(Ih=h)}function Em(){return Ih}function Dh(h){Ih>=Rh.INFOS&&console.log(`Info: ${h}`)}function Y(h){Ih>=Rh.WARNINGS&&console.log(`Warning: ${h}`)}function pt(h){throw new Error(h)}function It(h,e){h||pt(e)}function Cm(h){switch(h==null?void 0:h.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function km(h,e=null,t=null){if(!h)return null;try{if(t&&typeof h=="string"){if(t.addDefaultProtocol&&h.startsWith("www.")){const i=h.match(/\./g);(i==null?void 0:i.length)>=2&&(h=`http://${h}`)}if(t.tryConvertEncoding)try{h=Rm(h)}catch{}}const s=e?new URL(h,e):new URL(h);if(Cm(s))return s}catch{}return null}function tt(h,e,t,s=!1){return Object.defineProperty(h,e,{value:t,enumerable:!s,configurable:!0,writable:!1}),t}const pn=function(){function e(t,s){this.message=t,this.name=s}return e.prototype=new Error,e.constructor=e,e}();class Vu extends pn{constructor(e,t){super(e,"PasswordException"),this.code=t}}class Xh extends pn{constructor(e,t){super(e,"UnknownErrorException"),this.details=t}}class ed extends pn{constructor(e){super(e,"InvalidPDFException")}}class Io extends pn{constructor(e){super(e,"MissingPDFException")}}class rh extends pn{constructor(e,t){super(e,"UnexpectedResponseException"),this.status=t}}class Tm extends pn{constructor(e){super(e,"FormatError")}}class dn extends pn{constructor(e){super(e,"AbortException")}}function xf(h){(typeof h!="object"||(h==null?void 0:h.length)===void 0)&&pt("Invalid argument for bytesToString");const e=h.length,t=8192;if(e<t)return String.fromCharCode.apply(null,h);const s=[];for(let i=0;i<e;i+=t){const n=Math.min(i+t,e),a=h.subarray(i,n);s.push(String.fromCharCode.apply(null,a))}return s.join("")}function Nh(h){typeof h!="string"&&pt("Invalid argument for stringToBytes");const e=h.length,t=new Uint8Array(e);for(let s=0;s<e;++s)t[s]=h.charCodeAt(s)&255;return t}function Pm(h){return String.fromCharCode(h>>24&255,h>>16&255,h>>8&255,h&255)}function bu(h){const e=Object.create(null);for(const[t,s]of h)e[t]=s;return e}function Lm(){const h=new Uint8Array(4);return h[0]=1,new Uint32Array(h.buffer,0,1)[0]===1}function Mm(){try{return new Function(""),!0}catch{return!1}}class ye{static get isLittleEndian(){return tt(this,"isLittleEndian",Lm())}static get isEvalSupported(){return tt(this,"isEvalSupported",Mm())}static get isOffscreenCanvasSupported(){return tt(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return tt(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get platform(){return typeof navigator<"u"&&typeof(navigator==null?void 0:navigator.platform)=="string"?tt(this,"platform",{isMac:navigator.platform.includes("Mac"),isWindows:navigator.platform.includes("Win"),isFirefox:typeof(navigator==null?void 0:navigator.userAgent)=="string"&&navigator.userAgent.includes("Firefox")}):tt(this,"platform",{isMac:!1,isWindows:!1,isFirefox:!1})}static get isCSSRoundSupported(){var e,t;return tt(this,"isCSSRoundSupported",(t=(e=globalThis.CSS)==null?void 0:e.supports)==null?void 0:t.call(e,"width: round(1.5px, 1px)"))}}const Yh=Array.from(Array(256).keys(),h=>h.toString(16).padStart(2,"0"));var _i,Pc,sd;class ${static makeHexColor(e,t,s){return`#${Yh[e]}${Yh[t]}${Yh[s]}`}static scaleMinMax(e,t){let s;e[0]?(e[0]<0&&(s=t[0],t[0]=t[2],t[2]=s),t[0]*=e[0],t[2]*=e[0],e[3]<0&&(s=t[1],t[1]=t[3],t[3]=s),t[1]*=e[3],t[3]*=e[3]):(s=t[0],t[0]=t[1],t[1]=s,s=t[2],t[2]=t[3],t[3]=s,e[1]<0&&(s=t[1],t[1]=t[3],t[3]=s),t[1]*=e[1],t[3]*=e[1],e[2]<0&&(s=t[0],t[0]=t[2],t[2]=s),t[0]*=e[2],t[2]*=e[2]),t[0]+=e[4],t[1]+=e[5],t[2]+=e[4],t[3]+=e[5]}static transform(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}static applyTransform(e,t){const s=e[0]*t[0]+e[1]*t[2]+t[4],i=e[0]*t[1]+e[1]*t[3]+t[5];return[s,i]}static applyInverseTransform(e,t){const s=t[0]*t[3]-t[1]*t[2],i=(e[0]*t[3]-e[1]*t[2]+t[2]*t[5]-t[4]*t[3])/s,n=(-e[0]*t[1]+e[1]*t[0]+t[4]*t[1]-t[5]*t[0])/s;return[i,n]}static getAxialAlignedBoundingBox(e,t){const s=this.applyTransform(e,t),i=this.applyTransform(e.slice(2,4),t),n=this.applyTransform([e[0],e[3]],t),a=this.applyTransform([e[2],e[1]],t);return[Math.min(s[0],i[0],n[0],a[0]),Math.min(s[1],i[1],n[1],a[1]),Math.max(s[0],i[0],n[0],a[0]),Math.max(s[1],i[1],n[1],a[1])]}static inverseTransform(e){const t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]}static singularValueDecompose2dScale(e){const t=[e[0],e[2],e[1],e[3]],s=e[0]*t[0]+e[1]*t[2],i=e[0]*t[1]+e[1]*t[3],n=e[2]*t[0]+e[3]*t[2],a=e[2]*t[1]+e[3]*t[3],o=(s+a)/2,l=Math.sqrt((s+a)**2-4*(s*a-n*i))/2,c=o+l||1,d=o-l||1;return[Math.sqrt(c),Math.sqrt(d)]}static normalizeRect(e){const t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t}static intersect(e,t){const s=Math.max(Math.min(e[0],e[2]),Math.min(t[0],t[2])),i=Math.min(Math.max(e[0],e[2]),Math.max(t[0],t[2]));if(s>i)return null;const n=Math.max(Math.min(e[1],e[3]),Math.min(t[1],t[3])),a=Math.min(Math.max(e[1],e[3]),Math.max(t[1],t[3]));return n>a?null:[s,n,i,a]}static bezierBoundingBox(e,t,s,i,n,a,o,l,c){return c?(c[0]=Math.min(c[0],e,o),c[1]=Math.min(c[1],t,l),c[2]=Math.max(c[2],e,o),c[3]=Math.max(c[3],t,l)):c=[Math.min(e,o),Math.min(t,l),Math.max(e,o),Math.max(t,l)],v(this,_i,sd).call(this,e,s,n,o,t,i,a,l,3*(-e+3*(s-n)+o),6*(e-2*s+n),3*(s-e),c),v(this,_i,sd).call(this,e,s,n,o,t,i,a,l,3*(-t+3*(i-a)+l),6*(t-2*i+a),3*(i-t),c),c}}_i=new WeakSet,Pc=function(e,t,s,i,n,a,o,l,c,d){if(c<=0||c>=1)return;const u=1-c,f=c*c,g=f*c,m=u*(u*(u*e+3*c*t)+3*f*s)+g*i,y=u*(u*(u*n+3*c*a)+3*f*o)+g*l;d[0]=Math.min(d[0],m),d[1]=Math.min(d[1],y),d[2]=Math.max(d[2],m),d[3]=Math.max(d[3],y)},sd=function(e,t,s,i,n,a,o,l,c,d,u,f){if(Math.abs(c)<1e-12){Math.abs(d)>=1e-12&&v(this,_i,Pc).call(this,e,t,s,i,n,a,o,l,-u/d,f);return}const g=d**2-4*u*c;if(g<0)return;const m=Math.sqrt(g),y=2*c;v(this,_i,Pc).call(this,e,t,s,i,n,a,o,l,(-d+m)/y,f),v(this,_i,Pc).call(this,e,t,s,i,n,a,o,l,(-d-m)/y,f)},A($,_i);function Rm(h){return decodeURIComponent(escape(h))}let Kh=null,qu=null;function Im(h){return Kh||(Kh=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,qu=new Map([["ﬅ","ſt"]])),h.replaceAll(Kh,(e,t,s)=>t?t.normalize("NFKC"):qu.get(s))}function Dm(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();const h=new Uint8Array(32);return crypto.getRandomValues(h),xf(h)}const yu="pdfjs_internal_id_";function Nm(h){return Uint8Array.prototype.toBase64?h.toBase64():btoa(xf(h))}typeof Promise.try!="function"&&(Promise.try=function(h,...e){return new Promise(t=>{t(h(...e))})});const qs="http://www.w3.org/2000/svg",_n=class _n{};U(_n,"CSS",96),U(_n,"PDF",72),U(_n,"PDF_TO_CSS_UNITS",_n.CSS/_n.PDF);let un=_n;async function Fh(h,e="text"){if(fo(h,document.baseURI)){const t=await fetch(h);if(!t.ok)throw new Error(t.statusText);switch(e){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"json":return t.json()}return t.text()}return new Promise((t,s)=>{const i=new XMLHttpRequest;i.open("GET",h,!0),i.responseType=e,i.onreadystatechange=()=>{if(i.readyState===XMLHttpRequest.DONE){if(i.status===200||i.status===0){switch(e){case"arraybuffer":case"blob":case"json":t(i.response);return}t(i.responseText);return}s(new Error(i.statusText))}},i.send(null)})}class cc{constructor({viewBox:e,userUnit:t,scale:s,rotation:i,offsetX:n=0,offsetY:a=0,dontFlip:o=!1}){this.viewBox=e,this.userUnit=t,this.scale=s,this.rotation=i,this.offsetX=n,this.offsetY=a,s*=t;const l=(e[2]+e[0])/2,c=(e[3]+e[1])/2;let d,u,f,g;switch(i%=360,i<0&&(i+=360),i){case 180:d=-1,u=0,f=0,g=1;break;case 90:d=0,u=1,f=1,g=0;break;case 270:d=0,u=-1,f=-1,g=0;break;case 0:d=1,u=0,f=0,g=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}o&&(f=-f,g=-g);let m,y,w,x;d===0?(m=Math.abs(c-e[1])*s+n,y=Math.abs(l-e[0])*s+a,w=(e[3]-e[1])*s,x=(e[2]-e[0])*s):(m=Math.abs(l-e[0])*s+n,y=Math.abs(c-e[1])*s+a,w=(e[2]-e[0])*s,x=(e[3]-e[1])*s),this.transform=[d*s,u*s,f*s,g*s,m-d*s*l-f*s*c,y-u*s*l-g*s*c],this.width=w,this.height=x}get rawDims(){const{userUnit:e,viewBox:t}=this,s=t.map(i=>i*e);return tt(this,"rawDims",{pageWidth:s[2]-s[0],pageHeight:s[3]-s[1],pageX:s[0],pageY:s[1]})}clone({scale:e=this.scale,rotation:t=this.rotation,offsetX:s=this.offsetX,offsetY:i=this.offsetY,dontFlip:n=!1}={}){return new cc({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:e,rotation:t,offsetX:s,offsetY:i,dontFlip:n})}convertToViewportPoint(e,t){return $.applyTransform([e,t],this.transform)}convertToViewportRectangle(e){const t=$.applyTransform([e[0],e[1]],this.transform),s=$.applyTransform([e[2],e[3]],this.transform);return[t[0],t[1],s[0],s[1]]}convertToPdfPoint(e,t){return $.applyInverseTransform([e,t],this.transform)}}class Au extends pn{constructor(e,t=0){super(e,"RenderingCancelledException"),this.extraDelay=t}}function jh(h){const e=h.length;let t=0;for(;t<e&&h[t].trim()==="";)t++;return h.substring(t,t+5).toLowerCase()==="data:"}function vu(h){return typeof h=="string"&&/\.pdf$/i.test(h)}function Fm(h){return[h]=h.split(/[#?]/,1),h.substring(h.lastIndexOf("/")+1)}function jm(h,e="document.pdf"){if(typeof h!="string")return e;if(jh(h))return Y('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),e;const t=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,s=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,i=t.exec(h);let n=s.exec(i[1])||s.exec(i[2])||s.exec(i[3]);if(n&&(n=n[0],n.includes("%")))try{n=s.exec(decodeURIComponent(n))[0]}catch{}return n||e}class Xu{constructor(){U(this,"started",Object.create(null));U(this,"times",[])}time(e){e in this.started&&Y(`Timer is already running for ${e}`),this.started[e]=Date.now()}timeEnd(e){e in this.started||Y(`Timer has not been started for ${e}`),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e]}toString(){const e=[];let t=0;for(const{name:s}of this.times)t=Math.max(s.length,t);for(const{name:s,start:i,end:n}of this.times)e.push(`${s.padEnd(t)} ${n-i}ms
`);return e.join("")}}function fo(h,e){try{const{protocol:t}=e?new URL(h,e):new URL(h);return t==="http:"||t==="https:"}catch{return!1}}function xs(h){h.preventDefault()}function Ge(h){h.preventDefault(),h.stopPropagation()}var Oo;class wu{static toDateObject(e){if(!e||typeof e!="string")return null;r(this,Oo)||p(this,Oo,new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const t=r(this,Oo).exec(e);if(!t)return null;const s=parseInt(t[1],10);let i=parseInt(t[2],10);i=i>=1&&i<=12?i-1:0;let n=parseInt(t[3],10);n=n>=1&&n<=31?n:1;let a=parseInt(t[4],10);a=a>=0&&a<=23?a:0;let o=parseInt(t[5],10);o=o>=0&&o<=59?o:0;let l=parseInt(t[6],10);l=l>=0&&l<=59?l:0;const c=t[7]||"Z";let d=parseInt(t[8],10);d=d>=0&&d<=23?d:0;let u=parseInt(t[9],10)||0;return u=u>=0&&u<=59?u:0,c==="-"?(a+=d,o+=u):c==="+"&&(a-=d,o-=u),new Date(Date.UTC(s,i,n,a,o,l))}}Oo=new WeakMap,A(wu,Oo);function Om(h,{scale:e=1,rotation:t=0}){const{width:s,height:i}=h.attributes.style,n=[0,0,parseInt(s),parseInt(i)];return new cc({viewBox:n,userUnit:1,scale:e,rotation:t})}function xu(h){if(h.startsWith("#")){const e=parseInt(h.slice(1),16);return[(e&16711680)>>16,(e&65280)>>8,e&255]}return h.startsWith("rgb(")?h.slice(4,-1).split(",").map(e=>parseInt(e)):h.startsWith("rgba(")?h.slice(5,-1).split(",").map(e=>parseInt(e)).slice(0,3):(Y(`Not a valid color format: "${h}"`),[0,0,0])}function zm(h){const e=document.createElement("span");e.style.visibility="hidden",document.body.append(e);for(const t of h.keys()){e.style.color=t;const s=window.getComputedStyle(e).color;h.set(t,xu(s))}e.remove()}function vt(h){const{a:e,b:t,c:s,d:i,e:n,f:a}=h.getTransform();return[e,t,s,i,n,a]}function Cs(h){const{a:e,b:t,c:s,d:i,e:n,f:a}=h.getTransform().invertSelf();return[e,t,s,i,n,a]}function Lr(h,e,t=!1,s=!0){if(e instanceof cc){const{pageWidth:i,pageHeight:n}=e.rawDims,{style:a}=h,o=ye.isCSSRoundSupported,l=`var(--scale-factor) * ${i}px`,c=`var(--scale-factor) * ${n}px`,d=o?`round(down, ${l}, var(--scale-round-x, 1px))`:`calc(${l})`,u=o?`round(down, ${c}, var(--scale-round-y, 1px))`:`calc(${c})`;!t||e.rotation%180===0?(a.width=d,a.height=u):(a.width=u,a.height=d)}s&&h.setAttribute("data-main-rotation",e.rotation)}class id{constructor(){const e=window.devicePixelRatio||1;this.sx=e,this.sy=e}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}}var Ii,Cn,ls,kn,zo,$o,fh,Sf,Ae,_f,Ef,Lc,Cf,rd;const Ks=class Ks{constructor(e){A(this,Ae);A(this,Ii,null);A(this,Cn,null);A(this,ls);A(this,kn,null);A(this,zo,null);p(this,ls,e),r(Ks,$o)||p(Ks,$o,Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button"}))}render(){const e=p(this,Ii,document.createElement("div"));e.classList.add("editToolbar","hidden"),e.setAttribute("role","toolbar");const t=r(this,ls)._uiManager._signal;e.addEventListener("contextmenu",xs,{signal:t}),e.addEventListener("pointerdown",v(Ks,fh,Sf),{signal:t});const s=p(this,kn,document.createElement("div"));s.className="buttons",e.append(s);const i=r(this,ls).toolbarPosition;if(i){const{style:n}=e,a=r(this,ls)._uiManager.direction==="ltr"?1-i[0]:i[0];n.insetInlineEnd=`${100*a}%`,n.top=`calc(${100*i[1]}% + var(--editor-toolbar-vert-offset))`}return v(this,Ae,Cf).call(this),e}get div(){return r(this,Ii)}hide(){var e;r(this,Ii).classList.add("hidden"),(e=r(this,Cn))==null||e.hideDropdown()}show(){var e;r(this,Ii).classList.remove("hidden"),(e=r(this,zo))==null||e.shown()}async addAltText(e){const t=await e.render();v(this,Ae,Lc).call(this,t),r(this,kn).prepend(t,r(this,Ae,rd)),p(this,zo,e)}addColorPicker(e){p(this,Cn,e);const t=e.renderButton();v(this,Ae,Lc).call(this,t),r(this,kn).prepend(t,r(this,Ae,rd))}remove(){var e;r(this,Ii).remove(),(e=r(this,Cn))==null||e.destroy(),p(this,Cn,null)}};Ii=new WeakMap,Cn=new WeakMap,ls=new WeakMap,kn=new WeakMap,zo=new WeakMap,$o=new WeakMap,fh=new WeakSet,Sf=function(e){e.stopPropagation()},Ae=new WeakSet,_f=function(e){r(this,ls)._focusEventsAllowed=!1,Ge(e)},Ef=function(e){r(this,ls)._focusEventsAllowed=!0,Ge(e)},Lc=function(e){const t=r(this,ls)._uiManager._signal;e.addEventListener("focusin",v(this,Ae,_f).bind(this),{capture:!0,signal:t}),e.addEventListener("focusout",v(this,Ae,Ef).bind(this),{capture:!0,signal:t}),e.addEventListener("contextmenu",xs,{signal:t})},Cf=function(){const{editorType:e,_uiManager:t}=r(this,ls),s=document.createElement("button");s.className="delete",s.tabIndex=0,s.setAttribute("data-l10n-id",r(Ks,$o)[e]),v(this,Ae,Lc).call(this,s),s.addEventListener("click",i=>{t.delete()},{signal:t._signal}),r(this,kn).append(s)},rd=function(){const e=document.createElement("div");return e.className="divider",e},A(Ks,fh),A(Ks,$o,null);let nd=Ks;var Bo,Tn,Pn,fn,kf,Tf,Pf;class $m{constructor(e){A(this,fn);A(this,Bo,null);A(this,Tn,null);A(this,Pn);p(this,Pn,e)}show(e,t,s){const[i,n]=v(this,fn,Tf).call(this,t,s),{style:a}=r(this,Tn)||p(this,Tn,v(this,fn,kf).call(this));e.append(r(this,Tn)),a.insetInlineEnd=`${100*i}%`,a.top=`calc(${100*n}% + var(--editor-toolbar-vert-offset))`}hide(){r(this,Tn).remove()}}Bo=new WeakMap,Tn=new WeakMap,Pn=new WeakMap,fn=new WeakSet,kf=function(){const e=p(this,Tn,document.createElement("div"));e.className="editToolbar",e.setAttribute("role","toolbar"),e.addEventListener("contextmenu",xs,{signal:r(this,Pn)._signal});const t=p(this,Bo,document.createElement("div"));return t.className="buttons",e.append(t),v(this,fn,Pf).call(this),e},Tf=function(e,t){let s=0,i=0;for(const n of e){const a=n.y+n.height;if(a<s)continue;const o=n.x+(t?n.width:0);if(a>s){i=o,s=a;continue}t?o>i&&(i=o):o<i&&(i=o)}return[t?1-i:i,s]},Pf=function(){const e=document.createElement("button");e.className="highlightButton",e.tabIndex=0,e.setAttribute("data-l10n-id","pdfjs-highlight-floating-button1");const t=document.createElement("span");e.append(t),t.className="visuallyHidden",t.setAttribute("data-l10n-id","pdfjs-highlight-floating-button-label");const s=r(this,Pn)._signal;e.addEventListener("contextmenu",xs,{signal:s}),e.addEventListener("click",()=>{r(this,Pn).highlightSelection("floating_button")},{signal:s}),r(this,Bo).append(e)};function ah(h,e,t){for(const s of t)e.addEventListener(s,h[s].bind(h))}var ph;class Bm{constructor(){A(this,ph,0)}get id(){return`${wm}${de(this,ph)._++}`}}ph=new WeakMap;var Kr,Ho,ne,Zr,Mc;const Tu=class Tu{constructor(){A(this,Zr);A(this,Kr,Dm());A(this,Ho,0);A(this,ne,null)}static get _isSVGFittingCanvas(){const e='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',s=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),i=new Image;i.src=e;const n=i.decode().then(()=>(s.drawImage(i,0,0,1,1,0,0,1,3),new Uint32Array(s.getImageData(0,0,1,1).data.buffer)[0]===0));return tt(this,"_isSVGFittingCanvas",n)}async getFromFile(e){const{lastModified:t,name:s,size:i,type:n}=e;return v(this,Zr,Mc).call(this,`${t}_${s}_${i}_${n}`,e)}async getFromUrl(e){return v(this,Zr,Mc).call(this,e,e)}async getFromBlob(e,t){const s=await t;return v(this,Zr,Mc).call(this,e,s)}async getFromId(e){r(this,ne)||p(this,ne,new Map);const t=r(this,ne).get(e);if(!t)return null;if(t.bitmap)return t.refCounter+=1,t;if(t.file)return this.getFromFile(t.file);if(t.blobPromise){const{blobPromise:s}=t;return delete t.blobPromise,this.getFromBlob(t.id,s)}return this.getFromUrl(t.url)}getFromCanvas(e,t){r(this,ne)||p(this,ne,new Map);let s=r(this,ne).get(e);if(s!=null&&s.bitmap)return s.refCounter+=1,s;const i=new OffscreenCanvas(t.width,t.height);return i.getContext("2d").drawImage(t,0,0),s={bitmap:i.transferToImageBitmap(),id:`image_${r(this,Kr)}_${de(this,Ho)._++}`,refCounter:1,isSvg:!1},r(this,ne).set(e,s),r(this,ne).set(s.id,s),s}getSvgUrl(e){const t=r(this,ne).get(e);return t!=null&&t.isSvg?t.svgUrl:null}deleteId(e){var i;r(this,ne)||p(this,ne,new Map);const t=r(this,ne).get(e);if(!t||(t.refCounter-=1,t.refCounter!==0))return;const{bitmap:s}=t;if(!t.url&&!t.file){const n=new OffscreenCanvas(s.width,s.height);n.getContext("bitmaprenderer").transferFromImageBitmap(s),t.blobPromise=n.convertToBlob()}(i=s.close)==null||i.call(s),t.bitmap=null}isValidId(e){return e.startsWith(`image_${r(this,Kr)}_`)}};Kr=new WeakMap,Ho=new WeakMap,ne=new WeakMap,Zr=new WeakSet,Mc=async function(e,t){r(this,ne)||p(this,ne,new Map);let s=r(this,ne).get(e);if(s===null)return null;if(s!=null&&s.bitmap)return s.refCounter+=1,s;try{s||(s={bitmap:null,id:`image_${r(this,Kr)}_${de(this,Ho)._++}`,refCounter:0,isSvg:!1});let i;if(typeof t=="string"?(s.url=t,i=await Fh(t,"blob")):t instanceof File?i=s.file=t:t instanceof Blob&&(i=t),i.type==="image/svg+xml"){const n=Tu._isSVGFittingCanvas,a=new FileReader,o=new Image,l=new Promise((c,d)=>{o.onload=()=>{s.bitmap=o,s.isSvg=!0,c()},a.onload=async()=>{const u=s.svgUrl=a.result;o.src=await n?`${u}#svgView(preserveAspectRatio(none))`:u},o.onerror=a.onerror=d});a.readAsDataURL(i),await l}else s.bitmap=await createImageBitmap(i);s.refCounter=1}catch(i){Y(i),s=null}return r(this,ne).set(e,s),s&&r(this,ne).set(s.id,s),s};let ad=Tu;var Tt,Di,Uo,St;class Hm{constructor(e=128){A(this,Tt,[]);A(this,Di,!1);A(this,Uo);A(this,St,-1);p(this,Uo,e)}add({cmd:e,undo:t,post:s,mustExec:i,type:n=NaN,overwriteIfSameType:a=!1,keepUndo:o=!1}){if(i&&e(),r(this,Di))return;const l={cmd:e,undo:t,post:s,type:n};if(r(this,St)===-1){r(this,Tt).length>0&&(r(this,Tt).length=0),p(this,St,0),r(this,Tt).push(l);return}if(a&&r(this,Tt)[r(this,St)].type===n){o&&(l.undo=r(this,Tt)[r(this,St)].undo),r(this,Tt)[r(this,St)]=l;return}const c=r(this,St)+1;c===r(this,Uo)?r(this,Tt).splice(0,1):(p(this,St,c),c<r(this,Tt).length&&r(this,Tt).splice(c)),r(this,Tt).push(l)}undo(){if(r(this,St)===-1)return;p(this,Di,!0);const{undo:e,post:t}=r(this,Tt)[r(this,St)];e(),t==null||t(),p(this,Di,!1),p(this,St,r(this,St)-1)}redo(){if(r(this,St)<r(this,Tt).length-1){p(this,St,r(this,St)+1),p(this,Di,!0);const{cmd:e,post:t}=r(this,Tt)[r(this,St)];e(),t==null||t(),p(this,Di,!1)}}hasSomethingToUndo(){return r(this,St)!==-1}hasSomethingToRedo(){return r(this,St)<r(this,Tt).length-1}cleanType(e){if(r(this,St)!==-1){for(let t=r(this,St);t>=0;t--)if(r(this,Tt)[t].type!==e){r(this,Tt).splice(t+1,r(this,St)-t),p(this,St,t);return}r(this,Tt).length=0,p(this,St,-1)}}destroy(){p(this,Tt,null)}}Tt=new WeakMap,Di=new WeakMap,Uo=new WeakMap,St=new WeakMap;var gh,Lf;class hc{constructor(e){A(this,gh);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:t}=ye.platform;for(const[s,i,n={}]of e)for(const a of s){const o=a.startsWith("mac+");t&&o?(this.callbacks.set(a.slice(4),{callback:i,options:n}),this.allKeys.add(a.split("+").at(-1))):!t&&!o&&(this.callbacks.set(a,{callback:i,options:n}),this.allKeys.add(a.split("+").at(-1)))}}exec(e,t){if(!this.allKeys.has(t.key))return;const s=this.callbacks.get(v(this,gh,Lf).call(this,t));if(!s)return;const{callback:i,options:{bubbles:n=!1,args:a=[],checker:o=null}}=s;o&&!o(e,t)||(i.bind(e,...a,t)(),n||Ge(t))}}gh=new WeakSet,Lf=function(e){e.altKey&&this.buffer.push("alt"),e.ctrlKey&&this.buffer.push("ctrl"),e.metaKey&&this.buffer.push("meta"),e.shiftKey&&this.buffer.push("shift"),this.buffer.push(e.key);const t=this.buffer.join("+");return this.buffer.length=0,t};const mh=class mh{get _colors(){const e=new Map([["CanvasText",null],["Canvas",null]]);return zm(e),tt(this,"_colors",e)}convert(e){const t=xu(e);if(!window.matchMedia("(forced-colors: active)").matches)return t;for(const[s,i]of this._colors)if(i.every((n,a)=>n===t[a]))return mh._colorsMapping.get(s);return t}getHexCode(e){const t=this._colors.get(e);return t?$.makeHexColor(...t):e}};U(mh,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));let od=mh;var Jr,Le,Ot,Xt,Qr,Js,ta,Ye,Ni,Ln,ea,Mn,Ps,cs,Rn,Go,Wo,sa,Vo,Ls,Fi,ia,ji,Ms,bh,Oi,qo,zi,In,Xo,Yo,Bt,ct,Qs,Dn,Ko,Zo,$i,Rs,ti,Jo,Ke,M,Rc,ld,Mf,Rf,Ic,If,Df,Nf,cd,Ff,hd,dd,jf,fe,Xs,Of,zf,ud,$f,po,fd;const Vr=class Vr{constructor(e,t,s,i,n,a,o,l,c,d,u,f,g){A(this,M);A(this,Jr,new AbortController);A(this,Le,null);A(this,Ot,new Map);A(this,Xt,new Map);A(this,Qr,null);A(this,Js,null);A(this,ta,null);A(this,Ye,new Hm);A(this,Ni,null);A(this,Ln,null);A(this,ea,0);A(this,Mn,new Set);A(this,Ps,null);A(this,cs,null);A(this,Rn,new Set);U(this,"_editorUndoBar",null);A(this,Go,!1);A(this,Wo,!1);A(this,sa,!1);A(this,Vo,null);A(this,Ls,null);A(this,Fi,null);A(this,ia,null);A(this,ji,!1);A(this,Ms,null);A(this,bh,new Bm);A(this,Oi,!1);A(this,qo,!1);A(this,zi,null);A(this,In,null);A(this,Xo,null);A(this,Yo,null);A(this,Bt,X.NONE);A(this,ct,new Set);A(this,Qs,null);A(this,Dn,null);A(this,Ko,null);A(this,Zo,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1});A(this,$i,[0,0]);A(this,Rs,null);A(this,ti,null);A(this,Jo,null);A(this,Ke,null);const m=this._signal=r(this,Jr).signal;p(this,ti,e),p(this,Jo,t),p(this,Qr,s),this._eventBus=i,i._on("editingaction",this.onEditingAction.bind(this),{signal:m}),i._on("pagechanging",this.onPageChanging.bind(this),{signal:m}),i._on("scalechanging",this.onScaleChanging.bind(this),{signal:m}),i._on("rotationchanging",this.onRotationChanging.bind(this),{signal:m}),i._on("setpreference",this.onSetPreference.bind(this),{signal:m}),i._on("switchannotationeditorparams",y=>this.updateParams(y.type,y.value),{signal:m}),v(this,M,If).call(this),v(this,M,jf).call(this),v(this,M,cd).call(this),p(this,Js,n.annotationStorage),p(this,Vo,n.filterFactory),p(this,Dn,a),p(this,ia,o||null),p(this,Go,l),p(this,Wo,c),p(this,sa,d),p(this,Yo,u||null),this.viewParameters={realScale:un.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=f||null,this._supportsPinchToZoom=g!==!1}static get _keyboardManager(){const e=Vr.prototype,t=a=>r(a,ti).contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&a.hasSomethingToControl(),s=(a,{target:o})=>{if(o instanceof HTMLInputElement){const{type:l}=o;return l!=="text"&&l!=="number"}return!0},i=this.TRANSLATE_SMALL,n=this.TRANSLATE_BIG;return tt(this,"_keyboardManager",new hc([[["ctrl+a","mac+meta+a"],e.selectAll,{checker:s}],[["ctrl+z","mac+meta+z"],e.undo,{checker:s}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],e.redo,{checker:s}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],e.delete,{checker:s}],[["Enter","mac+Enter"],e.addNewEditorFromKeyboard,{checker:(a,{target:o})=>!(o instanceof HTMLButtonElement)&&r(a,ti).contains(o)&&!a.isEnterHandled}],[[" ","mac+ "],e.addNewEditorFromKeyboard,{checker:(a,{target:o})=>!(o instanceof HTMLButtonElement)&&r(a,ti).contains(document.activeElement)}],[["Escape","mac+Escape"],e.unselectAll],[["ArrowLeft","mac+ArrowLeft"],e.translateSelectedEditors,{args:[-i,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e.translateSelectedEditors,{args:[-n,0],checker:t}],[["ArrowRight","mac+ArrowRight"],e.translateSelectedEditors,{args:[i,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e.translateSelectedEditors,{args:[n,0],checker:t}],[["ArrowUp","mac+ArrowUp"],e.translateSelectedEditors,{args:[0,-i],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e.translateSelectedEditors,{args:[0,-n],checker:t}],[["ArrowDown","mac+ArrowDown"],e.translateSelectedEditors,{args:[0,i],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e.translateSelectedEditors,{args:[0,n],checker:t}]]))}destroy(){var e,t,s,i,n;(e=r(this,Ke))==null||e.resolve(),p(this,Ke,null),(t=r(this,Jr))==null||t.abort(),p(this,Jr,null),this._signal=null;for(const a of r(this,Xt).values())a.destroy();r(this,Xt).clear(),r(this,Ot).clear(),r(this,Rn).clear(),p(this,Le,null),r(this,ct).clear(),r(this,Ye).destroy(),(s=r(this,Qr))==null||s.destroy(),(i=r(this,Ms))==null||i.hide(),p(this,Ms,null),r(this,Ls)&&(clearTimeout(r(this,Ls)),p(this,Ls,null)),r(this,Rs)&&(clearTimeout(r(this,Rs)),p(this,Rs,null)),(n=this._editorUndoBar)==null||n.destroy()}combinedSignal(e){return AbortSignal.any([this._signal,e.signal])}get mlManager(){return r(this,Yo)}get useNewAltTextFlow(){return r(this,Wo)}get useNewAltTextWhenAddingImage(){return r(this,sa)}get hcmFilter(){return tt(this,"hcmFilter",r(this,Dn)?r(this,Vo).addHCMFilter(r(this,Dn).foreground,r(this,Dn).background):"none")}get direction(){return tt(this,"direction",getComputedStyle(r(this,ti)).direction)}get highlightColors(){return tt(this,"highlightColors",r(this,ia)?new Map(r(this,ia).split(",").map(e=>e.split("=").map(t=>t.trim()))):null)}get highlightColorNames(){return tt(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,e=>e.reverse())):null)}setCurrentDrawingSession(e){e?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),p(this,Ln,e)}setMainHighlightColorPicker(e){p(this,Xo,e)}editAltText(e,t=!1){var s;(s=r(this,Qr))==null||s.editAltText(this,e,t)}switchToMode(e,t){this._eventBus.on("annotationeditormodechanged",t,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:e})}setPreference(e,t){this._eventBus.dispatch("setpreference",{source:this,name:e,value:t})}onSetPreference({name:e,value:t}){switch(e){case"enableNewAltTextWhenAddingImage":p(this,sa,t);break}}onPageChanging({pageNumber:e}){p(this,ea,e-1)}focusMainContainer(){r(this,ti).focus()}findParent(e,t){for(const s of r(this,Xt).values()){const{x:i,y:n,width:a,height:o}=s.div.getBoundingClientRect();if(e>=i&&e<=i+a&&t>=n&&t<=n+o)return s}return null}disableUserSelect(e=!1){r(this,Jo).classList.toggle("noUserSelect",e)}addShouldRescale(e){r(this,Rn).add(e)}removeShouldRescale(e){r(this,Rn).delete(e)}onScaleChanging({scale:e}){var t;this.commitOrRemove(),this.viewParameters.realScale=e*un.PDF_TO_CSS_UNITS;for(const s of r(this,Rn))s.onScaleChanging();(t=r(this,Ln))==null||t.onScaleChanging()}onRotationChanging({pagesRotation:e}){this.commitOrRemove(),this.viewParameters.rotation=e}highlightSelection(e=""){const t=document.getSelection();if(!t||t.isCollapsed)return;const{anchorNode:s,anchorOffset:i,focusNode:n,focusOffset:a}=t,o=t.toString(),c=v(this,M,Rc).call(this,t).closest(".textLayer"),d=this.getSelectionBoxes(c);if(!d)return;t.empty();const u=v(this,M,ld).call(this,c),f=r(this,Bt)===X.NONE,g=()=>{u==null||u.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:e,boxes:d,anchorNode:s,anchorOffset:i,focusNode:n,focusOffset:a,text:o}),f&&this.showAllEditors("highlight",!0,!0)};if(f){this.switchToMode(X.HIGHLIGHT,g);return}g()}addToAnnotationStorage(e){!e.isEmpty()&&r(this,Js)&&!r(this,Js).has(e.id)&&r(this,Js).setValue(e.id,e)}blur(){if(this.isShiftKeyDown=!1,r(this,ji)&&(p(this,ji,!1),v(this,M,Ic).call(this,"main_toolbar")),!this.hasSelection)return;const{activeElement:e}=document;for(const t of r(this,ct))if(t.div.contains(e)){p(this,In,[t,e]),t._focusEventsAllowed=!1;break}}focus(){if(!r(this,In))return;const[e,t]=r(this,In);p(this,In,null),t.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:this._signal}),t.focus()}addEditListeners(){v(this,M,cd).call(this),v(this,M,hd).call(this)}removeEditListeners(){v(this,M,Ff).call(this),v(this,M,dd).call(this)}dragOver(e){for(const{type:t}of e.dataTransfer.items)for(const s of r(this,cs))if(s.isHandlingMimeForPasting(t)){e.dataTransfer.dropEffect="copy",e.preventDefault();return}}drop(e){for(const t of e.dataTransfer.items)for(const s of r(this,cs))if(s.isHandlingMimeForPasting(t.type)){s.paste(t,this.currentLayer),e.preventDefault();return}}copy(e){var s;if(e.preventDefault(),(s=r(this,Le))==null||s.commitOrRemove(),!this.hasSelection)return;const t=[];for(const i of r(this,ct)){const n=i.serialize(!0);n&&t.push(n)}t.length!==0&&e.clipboardData.setData("application/pdfjs",JSON.stringify(t))}cut(e){this.copy(e),this.delete()}async paste(e){e.preventDefault();const{clipboardData:t}=e;for(const n of t.items)for(const a of r(this,cs))if(a.isHandlingMimeForPasting(n.type)){a.paste(n,this.currentLayer);return}let s=t.getData("application/pdfjs");if(!s)return;try{s=JSON.parse(s)}catch(n){Y(`paste: "${n.message}".`);return}if(!Array.isArray(s))return;this.unselectAll();const i=this.currentLayer;try{const n=[];for(const l of s){const c=await i.deserialize(l);if(!c)return;n.push(c)}const a=()=>{for(const l of n)v(this,M,ud).call(this,l);v(this,M,fd).call(this,n)},o=()=>{for(const l of n)l.remove()};this.addCommands({cmd:a,undo:o,mustExec:!0})}catch(n){Y(`paste: "${n.message}".`)}}keydown(e){!this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!0),r(this,Bt)!==X.NONE&&!this.isEditorHandlingKeyboard&&Vr._keyboardManager.exec(this,e)}keyup(e){this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!1,r(this,ji)&&(p(this,ji,!1),v(this,M,Ic).call(this,"main_toolbar")))}onEditingAction({name:e}){switch(e){case"undo":case"redo":case"delete":case"selectAll":this[e]();break;case"highlightSelection":this.highlightSelection("context_menu");break}}setEditingState(e){e?(v(this,M,Df).call(this),v(this,M,hd).call(this),v(this,M,fe).call(this,{isEditing:r(this,Bt)!==X.NONE,isEmpty:v(this,M,po).call(this),hasSomethingToUndo:r(this,Ye).hasSomethingToUndo(),hasSomethingToRedo:r(this,Ye).hasSomethingToRedo(),hasSelectedEditor:!1})):(v(this,M,Nf).call(this),v(this,M,dd).call(this),v(this,M,fe).call(this,{isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(e){if(!r(this,cs)){p(this,cs,e);for(const t of r(this,cs))v(this,M,Xs).call(this,t.defaultPropertiesToUpdate)}}getId(){return r(this,bh).id}get currentLayer(){return r(this,Xt).get(r(this,ea))}getLayer(e){return r(this,Xt).get(e)}get currentPageIndex(){return r(this,ea)}addLayer(e){r(this,Xt).set(e.pageIndex,e),r(this,Oi)?e.enable():e.disable()}removeLayer(e){r(this,Xt).delete(e.pageIndex)}async updateMode(e,t=null,s=!1){var i;if(r(this,Bt)!==e&&!(r(this,Ke)&&(await r(this,Ke).promise,!r(this,Ke)))){if(p(this,Ke,Promise.withResolvers()),p(this,Bt,e),e===X.NONE){this.setEditingState(!1),v(this,M,zf).call(this),(i=this._editorUndoBar)==null||i.hide(),r(this,Ke).resolve();return}this.setEditingState(!0),await v(this,M,Of).call(this),this.unselectAll();for(const n of r(this,Xt).values())n.updateMode(e);if(!t){s&&this.addNewEditorFromKeyboard(),r(this,Ke).resolve();return}for(const n of r(this,Ot).values())n.annotationElementId===t?(this.setSelected(n),n.enterInEditMode()):n.unselect();r(this,Ke).resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(e){e!==r(this,Bt)&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:e})}updateParams(e,t){var s;if(r(this,cs)){switch(e){case et.CREATE:this.currentLayer.addNewEditor();return;case et.HIGHLIGHT_DEFAULT_COLOR:(s=r(this,Xo))==null||s.updateColor(t);break;case et.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(r(this,Ko)||p(this,Ko,new Map)).set(e,t),this.showAllEditors("highlight",t);break}for(const i of r(this,ct))i.updateParams(e,t);for(const i of r(this,cs))i.updateDefaultParams(e,t)}}showAllEditors(e,t,s=!1){var n;for(const a of r(this,Ot).values())a.editorType===e&&a.show(t);(((n=r(this,Ko))==null?void 0:n.get(et.HIGHLIGHT_SHOW_ALL))??!0)!==t&&v(this,M,Xs).call(this,[[et.HIGHLIGHT_SHOW_ALL,t]])}enableWaiting(e=!1){if(r(this,qo)!==e){p(this,qo,e);for(const t of r(this,Xt).values())e?t.disableClick():t.enableClick(),t.div.classList.toggle("waiting",e)}}getEditors(e){const t=[];for(const s of r(this,Ot).values())s.pageIndex===e&&t.push(s);return t}getEditor(e){return r(this,Ot).get(e)}addEditor(e){r(this,Ot).set(e.id,e)}removeEditor(e){var t;e.div.contains(document.activeElement)&&(r(this,Ls)&&clearTimeout(r(this,Ls)),p(this,Ls,setTimeout(()=>{this.focusMainContainer(),p(this,Ls,null)},0))),r(this,Ot).delete(e.id),this.unselect(e),(!e.annotationElementId||!r(this,Mn).has(e.annotationElementId))&&((t=r(this,Js))==null||t.remove(e.id))}addDeletedAnnotationElement(e){r(this,Mn).add(e.annotationElementId),this.addChangedExistingAnnotation(e),e.deleted=!0}isDeletedAnnotationElement(e){return r(this,Mn).has(e)}removeDeletedAnnotationElement(e){r(this,Mn).delete(e.annotationElementId),this.removeChangedExistingAnnotation(e),e.deleted=!1}setActiveEditor(e){r(this,Le)!==e&&(p(this,Le,e),e&&v(this,M,Xs).call(this,e.propertiesToUpdate))}updateUI(e){r(this,M,$f)===e&&v(this,M,Xs).call(this,e.propertiesToUpdate)}updateUIForDefaultProperties(e){v(this,M,Xs).call(this,e.defaultPropertiesToUpdate)}toggleSelected(e){if(r(this,ct).has(e)){r(this,ct).delete(e),e.unselect(),v(this,M,fe).call(this,{hasSelectedEditor:this.hasSelection});return}r(this,ct).add(e),e.select(),v(this,M,Xs).call(this,e.propertiesToUpdate),v(this,M,fe).call(this,{hasSelectedEditor:!0})}setSelected(e){var t;(t=r(this,Ln))==null||t.commitOrRemove();for(const s of r(this,ct))s!==e&&s.unselect();r(this,ct).clear(),r(this,ct).add(e),e.select(),v(this,M,Xs).call(this,e.propertiesToUpdate),v(this,M,fe).call(this,{hasSelectedEditor:!0})}isSelected(e){return r(this,ct).has(e)}get firstSelectedEditor(){return r(this,ct).values().next().value}unselect(e){e.unselect(),r(this,ct).delete(e),v(this,M,fe).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return r(this,ct).size!==0}get isEnterHandled(){return r(this,ct).size===1&&this.firstSelectedEditor.isEnterHandled}undo(){var e;r(this,Ye).undo(),v(this,M,fe).call(this,{hasSomethingToUndo:r(this,Ye).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:v(this,M,po).call(this)}),(e=this._editorUndoBar)==null||e.hide()}redo(){r(this,Ye).redo(),v(this,M,fe).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:r(this,Ye).hasSomethingToRedo(),isEmpty:v(this,M,po).call(this)})}addCommands(e){r(this,Ye).add(e),v(this,M,fe).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:v(this,M,po).call(this)})}cleanUndoStack(e){r(this,Ye).cleanType(e)}delete(){var n;this.commitOrRemove();const e=(n=this.currentLayer)==null?void 0:n.endDrawingSession(!0);if(!this.hasSelection&&!e)return;const t=e?[e]:[...r(this,ct)],s=()=>{var a;(a=this._editorUndoBar)==null||a.show(i,t.length===1?t[0].editorType:t.length);for(const o of t)o.remove()},i=()=>{for(const a of t)v(this,M,ud).call(this,a)};this.addCommands({cmd:s,undo:i,mustExec:!0})}commitOrRemove(){var e;(e=r(this,Le))==null||e.commitOrRemove()}hasSomethingToControl(){return r(this,Le)||this.hasSelection}selectAll(){for(const e of r(this,ct))e.commit();v(this,M,fd).call(this,r(this,Ot).values())}unselectAll(){var e;if(!(r(this,Le)&&(r(this,Le).commitOrRemove(),r(this,Bt)!==X.NONE))&&!((e=r(this,Ln))!=null&&e.commitOrRemove())&&this.hasSelection){for(const t of r(this,ct))t.unselect();r(this,ct).clear(),v(this,M,fe).call(this,{hasSelectedEditor:!1})}}translateSelectedEditors(e,t,s=!1){if(s||this.commitOrRemove(),!this.hasSelection)return;r(this,$i)[0]+=e,r(this,$i)[1]+=t;const[i,n]=r(this,$i),a=[...r(this,ct)],o=1e3;r(this,Rs)&&clearTimeout(r(this,Rs)),p(this,Rs,setTimeout(()=>{p(this,Rs,null),r(this,$i)[0]=r(this,$i)[1]=0,this.addCommands({cmd:()=>{for(const l of a)r(this,Ot).has(l.id)&&l.translateInPage(i,n)},undo:()=>{for(const l of a)r(this,Ot).has(l.id)&&l.translateInPage(-i,-n)},mustExec:!1})},o));for(const l of a)l.translateInPage(e,t)}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),p(this,Ps,new Map);for(const e of r(this,ct))r(this,Ps).set(e,{savedX:e.x,savedY:e.y,savedPageIndex:e.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!r(this,Ps))return!1;this.disableUserSelect(!1);const e=r(this,Ps);p(this,Ps,null);let t=!1;for(const[{x:i,y:n,pageIndex:a},o]of e)o.newX=i,o.newY=n,o.newPageIndex=a,t||(t=i!==o.savedX||n!==o.savedY||a!==o.savedPageIndex);if(!t)return!1;const s=(i,n,a,o)=>{if(r(this,Ot).has(i.id)){const l=r(this,Xt).get(o);l?i._setParentAndPosition(l,n,a):(i.pageIndex=o,i.x=n,i.y=a)}};return this.addCommands({cmd:()=>{for(const[i,{newX:n,newY:a,newPageIndex:o}]of e)s(i,n,a,o)},undo:()=>{for(const[i,{savedX:n,savedY:a,savedPageIndex:o}]of e)s(i,n,a,o)},mustExec:!0}),!0}dragSelectedEditors(e,t){if(r(this,Ps))for(const s of r(this,Ps).keys())s.drag(e,t)}rebuild(e){if(e.parent===null){const t=this.getLayer(e.pageIndex);t?(t.changeParent(e),t.addOrRebuild(e)):(this.addEditor(e),this.addToAnnotationStorage(e),e.rebuild())}else e.parent.addOrRebuild(e)}get isEditorHandlingKeyboard(){var e;return((e=this.getActive())==null?void 0:e.shouldGetKeyboardEvents())||r(this,ct).size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(e){return r(this,Le)===e}getActive(){return r(this,Le)}getMode(){return r(this,Bt)}get imageManager(){return tt(this,"imageManager",new ad)}getSelectionBoxes(e){if(!e)return null;const t=document.getSelection();for(let c=0,d=t.rangeCount;c<d;c++)if(!e.contains(t.getRangeAt(c).commonAncestorContainer))return null;const{x:s,y:i,width:n,height:a}=e.getBoundingClientRect();let o;switch(e.getAttribute("data-main-rotation")){case"90":o=(c,d,u,f)=>({x:(d-i)/a,y:1-(c+u-s)/n,width:f/a,height:u/n});break;case"180":o=(c,d,u,f)=>({x:1-(c+u-s)/n,y:1-(d+f-i)/a,width:u/n,height:f/a});break;case"270":o=(c,d,u,f)=>({x:1-(d+f-i)/a,y:(c-s)/n,width:f/a,height:u/n});break;default:o=(c,d,u,f)=>({x:(c-s)/n,y:(d-i)/a,width:u/n,height:f/a});break}const l=[];for(let c=0,d=t.rangeCount;c<d;c++){const u=t.getRangeAt(c);if(!u.collapsed)for(const{x:f,y:g,width:m,height:y}of u.getClientRects())m===0||y===0||l.push(o(f,g,m,y))}return l.length===0?null:l}addChangedExistingAnnotation({annotationElementId:e,id:t}){(r(this,ta)||p(this,ta,new Map)).set(e,t)}removeChangedExistingAnnotation({annotationElementId:e}){var t;(t=r(this,ta))==null||t.delete(e)}renderAnnotationElement(e){var i;const t=(i=r(this,ta))==null?void 0:i.get(e.data.id);if(!t)return;const s=r(this,Js).getRawValue(t);s&&(r(this,Bt)===X.NONE&&!s.hasBeenModified||s.renderAnnotationElement(e))}};Jr=new WeakMap,Le=new WeakMap,Ot=new WeakMap,Xt=new WeakMap,Qr=new WeakMap,Js=new WeakMap,ta=new WeakMap,Ye=new WeakMap,Ni=new WeakMap,Ln=new WeakMap,ea=new WeakMap,Mn=new WeakMap,Ps=new WeakMap,cs=new WeakMap,Rn=new WeakMap,Go=new WeakMap,Wo=new WeakMap,sa=new WeakMap,Vo=new WeakMap,Ls=new WeakMap,Fi=new WeakMap,ia=new WeakMap,ji=new WeakMap,Ms=new WeakMap,bh=new WeakMap,Oi=new WeakMap,qo=new WeakMap,zi=new WeakMap,In=new WeakMap,Xo=new WeakMap,Yo=new WeakMap,Bt=new WeakMap,ct=new WeakMap,Qs=new WeakMap,Dn=new WeakMap,Ko=new WeakMap,Zo=new WeakMap,$i=new WeakMap,Rs=new WeakMap,ti=new WeakMap,Jo=new WeakMap,Ke=new WeakMap,M=new WeakSet,Rc=function({anchorNode:e}){return e.nodeType===Node.TEXT_NODE?e.parentElement:e},ld=function(e){const{currentLayer:t}=this;if(t.hasTextLayer(e))return t;for(const s of r(this,Xt).values())if(s.hasTextLayer(e))return s;return null},Mf=function(){const e=document.getSelection();if(!e||e.isCollapsed)return;const s=v(this,M,Rc).call(this,e).closest(".textLayer"),i=this.getSelectionBoxes(s);i&&(r(this,Ms)||p(this,Ms,new $m(this)),r(this,Ms).show(s,i,this.direction==="ltr"))},Rf=function(){var n,a,o;const e=document.getSelection();if(!e||e.isCollapsed){r(this,Qs)&&((n=r(this,Ms))==null||n.hide(),p(this,Qs,null),v(this,M,fe).call(this,{hasSelectedText:!1}));return}const{anchorNode:t}=e;if(t===r(this,Qs))return;const i=v(this,M,Rc).call(this,e).closest(".textLayer");if(!i){r(this,Qs)&&((a=r(this,Ms))==null||a.hide(),p(this,Qs,null),v(this,M,fe).call(this,{hasSelectedText:!1}));return}if((o=r(this,Ms))==null||o.hide(),p(this,Qs,t),v(this,M,fe).call(this,{hasSelectedText:!0}),!(r(this,Bt)!==X.HIGHLIGHT&&r(this,Bt)!==X.NONE)&&(r(this,Bt)===X.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),p(this,ji,this.isShiftKeyDown),!this.isShiftKeyDown)){const l=r(this,Bt)===X.HIGHLIGHT?v(this,M,ld).call(this,i):null;l==null||l.toggleDrawing();const c=new AbortController,d=this.combinedSignal(c),u=f=>{f.type==="pointerup"&&f.button!==0||(c.abort(),l==null||l.toggleDrawing(!0),f.type==="pointerup"&&v(this,M,Ic).call(this,"main_toolbar"))};window.addEventListener("pointerup",u,{signal:d}),window.addEventListener("blur",u,{signal:d})}},Ic=function(e=""){r(this,Bt)===X.HIGHLIGHT?this.highlightSelection(e):r(this,Go)&&v(this,M,Mf).call(this)},If=function(){document.addEventListener("selectionchange",v(this,M,Rf).bind(this),{signal:this._signal})},Df=function(){if(r(this,Fi))return;p(this,Fi,new AbortController);const e=this.combinedSignal(r(this,Fi));window.addEventListener("focus",this.focus.bind(this),{signal:e}),window.addEventListener("blur",this.blur.bind(this),{signal:e})},Nf=function(){var e;(e=r(this,Fi))==null||e.abort(),p(this,Fi,null)},cd=function(){if(r(this,zi))return;p(this,zi,new AbortController);const e=this.combinedSignal(r(this,zi));window.addEventListener("keydown",this.keydown.bind(this),{signal:e}),window.addEventListener("keyup",this.keyup.bind(this),{signal:e})},Ff=function(){var e;(e=r(this,zi))==null||e.abort(),p(this,zi,null)},hd=function(){if(r(this,Ni))return;p(this,Ni,new AbortController);const e=this.combinedSignal(r(this,Ni));document.addEventListener("copy",this.copy.bind(this),{signal:e}),document.addEventListener("cut",this.cut.bind(this),{signal:e}),document.addEventListener("paste",this.paste.bind(this),{signal:e})},dd=function(){var e;(e=r(this,Ni))==null||e.abort(),p(this,Ni,null)},jf=function(){const e=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:e}),document.addEventListener("drop",this.drop.bind(this),{signal:e})},fe=function(e){Object.entries(e).some(([s,i])=>r(this,Zo)[s]!==i)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(r(this,Zo),e)}),r(this,Bt)===X.HIGHLIGHT&&e.hasSelectedEditor===!1&&v(this,M,Xs).call(this,[[et.HIGHLIGHT_FREE,!0]]))},Xs=function(e){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:e})},Of=async function(){if(!r(this,Oi)){p(this,Oi,!0);const e=[];for(const t of r(this,Xt).values())e.push(t.enable());await Promise.all(e);for(const t of r(this,Ot).values())t.enable()}},zf=function(){if(this.unselectAll(),r(this,Oi)){p(this,Oi,!1);for(const e of r(this,Xt).values())e.disable();for(const e of r(this,Ot).values())e.disable()}},ud=function(e){const t=r(this,Xt).get(e.pageIndex);t?t.addOrRebuild(e):(this.addEditor(e),this.addToAnnotationStorage(e))},$f=function(){let e=null;for(e of r(this,ct));return e},po=function(){if(r(this,Ot).size===0)return!0;if(r(this,Ot).size===1)for(const e of r(this,Ot).values())return e.isEmpty();return!1},fd=function(e){for(const t of r(this,ct))t.unselect();r(this,ct).clear();for(const t of e)t.isEmpty()||(r(this,ct).add(t),t.select());v(this,M,fe).call(this,{hasSelectedEditor:this.hasSelection})},U(Vr,"TRANSLATE_SMALL",1),U(Vr,"TRANSLATE_BIG",10);let Mr=Vr;var Ht,Is,hs,na,Ds,Me,ra,Ns,_e,ei,Nn,Fs,Bi,vs,go,Dc;const pe=class pe{constructor(e){A(this,vs);A(this,Ht,null);A(this,Is,!1);A(this,hs,null);A(this,na,null);A(this,Ds,null);A(this,Me,null);A(this,ra,!1);A(this,Ns,null);A(this,_e,null);A(this,ei,null);A(this,Nn,null);A(this,Fs,!1);p(this,_e,e),p(this,Fs,e._uiManager.useNewAltTextFlow),r(pe,Bi)||p(pe,Bi,Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"}))}static initialize(e){pe._l10n??(pe._l10n=e)}async render(){const e=p(this,hs,document.createElement("button"));e.className="altText",e.tabIndex="0";const t=p(this,na,document.createElement("span"));e.append(t),r(this,Fs)?(e.classList.add("new"),e.setAttribute("data-l10n-id",r(pe,Bi).missing),t.setAttribute("data-l10n-id",r(pe,Bi)["missing-label"])):(e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const s=r(this,_e)._uiManager._signal;e.addEventListener("contextmenu",xs,{signal:s}),e.addEventListener("pointerdown",n=>n.stopPropagation(),{signal:s});const i=n=>{n.preventDefault(),r(this,_e)._uiManager.editAltText(r(this,_e)),r(this,Fs)&&r(this,_e)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:r(this,vs,go)}})};return e.addEventListener("click",i,{capture:!0,signal:s}),e.addEventListener("keydown",n=>{n.target===e&&n.key==="Enter"&&(p(this,ra,!0),i(n))},{signal:s}),await v(this,vs,Dc).call(this),e}finish(){r(this,hs)&&(r(this,hs).focus({focusVisible:r(this,ra)}),p(this,ra,!1))}isEmpty(){return r(this,Fs)?r(this,Ht)===null:!r(this,Ht)&&!r(this,Is)}hasData(){return r(this,Fs)?r(this,Ht)!==null||!!r(this,ei):this.isEmpty()}get guessedText(){return r(this,ei)}async setGuessedText(e){r(this,Ht)===null&&(p(this,ei,e),p(this,Nn,await pe._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:e})),v(this,vs,Dc).call(this))}toggleAltTextBadge(e=!1){var t;if(!r(this,Fs)||r(this,Ht)){(t=r(this,Ns))==null||t.remove(),p(this,Ns,null);return}if(!r(this,Ns)){const s=p(this,Ns,document.createElement("div"));s.className="noAltTextBadge",r(this,_e).div.append(s)}r(this,Ns).classList.toggle("hidden",!e)}serialize(e){let t=r(this,Ht);return!e&&r(this,ei)===t&&(t=r(this,Nn)),{altText:t,decorative:r(this,Is),guessedText:r(this,ei),textWithDisclaimer:r(this,Nn)}}get data(){return{altText:r(this,Ht),decorative:r(this,Is)}}set data({altText:e,decorative:t,guessedText:s,textWithDisclaimer:i,cancel:n=!1}){s&&(p(this,ei,s),p(this,Nn,i)),!(r(this,Ht)===e&&r(this,Is)===t)&&(n||(p(this,Ht,e),p(this,Is,t)),v(this,vs,Dc).call(this))}toggle(e=!1){r(this,hs)&&(!e&&r(this,Me)&&(clearTimeout(r(this,Me)),p(this,Me,null)),r(this,hs).disabled=!e)}shown(){r(this,_e)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:r(this,vs,go)}})}destroy(){var e,t;(e=r(this,hs))==null||e.remove(),p(this,hs,null),p(this,na,null),p(this,Ds,null),(t=r(this,Ns))==null||t.remove(),p(this,Ns,null)}};Ht=new WeakMap,Is=new WeakMap,hs=new WeakMap,na=new WeakMap,Ds=new WeakMap,Me=new WeakMap,ra=new WeakMap,Ns=new WeakMap,_e=new WeakMap,ei=new WeakMap,Nn=new WeakMap,Fs=new WeakMap,Bi=new WeakMap,vs=new WeakSet,go=function(){return r(this,Ht)&&"added"||r(this,Ht)===null&&this.guessedText&&"review"||"missing"},Dc=async function(){var i,n,a;const e=r(this,hs);if(!e)return;if(r(this,Fs)){if(e.classList.toggle("done",!!r(this,Ht)),e.setAttribute("data-l10n-id",r(pe,Bi)[r(this,vs,go)]),(i=r(this,na))==null||i.setAttribute("data-l10n-id",r(pe,Bi)[`${r(this,vs,go)}-label`]),!r(this,Ht)){(n=r(this,Ds))==null||n.remove();return}}else{if(!r(this,Ht)&&!r(this,Is)){e.classList.remove("done"),(a=r(this,Ds))==null||a.remove();return}e.classList.add("done"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let t=r(this,Ds);if(!t){p(this,Ds,t=document.createElement("span")),t.className="tooltip",t.setAttribute("role","tooltip"),t.id=`alt-text-tooltip-${r(this,_e).id}`;const o=100,l=r(this,_e)._uiManager._signal;l.addEventListener("abort",()=>{clearTimeout(r(this,Me)),p(this,Me,null)},{once:!0}),e.addEventListener("mouseenter",()=>{p(this,Me,setTimeout(()=>{p(this,Me,null),r(this,Ds).classList.add("show"),r(this,_e)._reportTelemetry({action:"alt_text_tooltip"})},o))},{signal:l}),e.addEventListener("mouseleave",()=>{var c;r(this,Me)&&(clearTimeout(r(this,Me)),p(this,Me,null)),(c=r(this,Ds))==null||c.classList.remove("show")},{signal:l})}r(this,Is)?t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(t.removeAttribute("data-l10n-id"),t.textContent=r(this,Ht)),t.parentNode||e.append(t);const s=r(this,_e).getImageForAltText();s==null||s.setAttribute("aria-describedby",t.id)},A(pe,Bi,null),U(pe,"_l10n",null);let oh=pe;var Qo,Fn,tl,el,sl,il,nl,aa,si,jn,Hi,ki,Bf,Hf,pd;const Pu=class Pu{constructor({container:e,isPinchingDisabled:t=null,isPinchingStopped:s=null,onPinchStart:i=null,onPinching:n=null,onPinchEnd:a=null,signal:o}){A(this,ki);A(this,Qo);A(this,Fn,!1);A(this,tl,null);A(this,el);A(this,sl);A(this,il);A(this,nl);A(this,aa);A(this,si,null);A(this,jn);A(this,Hi,null);p(this,Qo,e),p(this,tl,s),p(this,el,t),p(this,sl,i),p(this,il,n),p(this,nl,a),p(this,jn,new AbortController),p(this,aa,AbortSignal.any([o,r(this,jn).signal])),e.addEventListener("touchstart",v(this,ki,Bf).bind(this),{passive:!1,signal:r(this,aa)})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return tt(this,"MIN_TOUCH_DISTANCE_TO_PINCH",35/(window.devicePixelRatio||1))}destroy(){var e;(e=r(this,jn))==null||e.abort(),p(this,jn,null)}};Qo=new WeakMap,Fn=new WeakMap,tl=new WeakMap,el=new WeakMap,sl=new WeakMap,il=new WeakMap,nl=new WeakMap,aa=new WeakMap,si=new WeakMap,jn=new WeakMap,Hi=new WeakMap,ki=new WeakSet,Bf=function(e){var i,n,a;if((i=r(this,el))!=null&&i.call(this)||e.touches.length<2)return;if(!r(this,Hi)){p(this,Hi,new AbortController);const o=AbortSignal.any([r(this,aa),r(this,Hi).signal]),l=r(this,Qo),c={signal:o,passive:!1};l.addEventListener("touchmove",v(this,ki,Hf).bind(this),c),l.addEventListener("touchend",v(this,ki,pd).bind(this),c),l.addEventListener("touchcancel",v(this,ki,pd).bind(this),c),(n=r(this,sl))==null||n.call(this)}if(Ge(e),e.touches.length!==2||(a=r(this,tl))!=null&&a.call(this)){p(this,si,null);return}let[t,s]=e.touches;t.identifier>s.identifier&&([t,s]=[s,t]),p(this,si,{touch0X:t.screenX,touch0Y:t.screenY,touch1X:s.screenX,touch1Y:s.screenY})},Hf=function(e){var C;if(!r(this,si)||e.touches.length!==2)return;let[t,s]=e.touches;t.identifier>s.identifier&&([t,s]=[s,t]);const{screenX:i,screenY:n}=t,{screenX:a,screenY:o}=s,l=r(this,si),{touch0X:c,touch0Y:d,touch1X:u,touch1Y:f}=l,g=u-c,m=f-d,y=a-i,w=o-n,x=Math.hypot(y,w)||1,S=Math.hypot(g,m)||1;if(!r(this,Fn)&&Math.abs(S-x)<=Pu.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(l.touch0X=i,l.touch0Y=n,l.touch1X=a,l.touch1Y=o,e.preventDefault(),!r(this,Fn)){p(this,Fn,!0);return}const _=[(i+a)/2,(n+o)/2];(C=r(this,il))==null||C.call(this,_,S,x)},pd=function(e){var t;r(this,Hi).abort(),p(this,Hi,null),(t=r(this,nl))==null||t.call(this),r(this,si)&&(e.preventDefault(),p(this,si,null),p(this,Fn,!1))};let lh=Pu;var On,ds,yt,oa,Ui,rl,zn,Yt,$n,ii,Gi,al,Bn,Re,ol,Hn,ni,js,la,ca,Ze,Un,ll,yh,G,gd,cl,md,Nc,Uf,Gf,bd,Fc,yd,Wf,Vf,qf,Ad,Xf,vd,Yf,Kf,Zf,wd,mo;const Z=class Z{constructor(e){A(this,G);A(this,On,null);A(this,ds,null);A(this,yt,null);A(this,oa,!1);A(this,Ui,null);A(this,rl,"");A(this,zn,!1);A(this,Yt,null);A(this,$n,null);A(this,ii,null);A(this,Gi,null);A(this,al,"");A(this,Bn,!1);A(this,Re,null);A(this,ol,!1);A(this,Hn,!1);A(this,ni,!1);A(this,js,null);A(this,la,0);A(this,ca,0);A(this,Ze,null);A(this,Un,null);U(this,"_editToolbar",null);U(this,"_initialOptions",Object.create(null));U(this,"_initialData",null);U(this,"_isVisible",!0);U(this,"_uiManager",null);U(this,"_focusEventsAllowed",!0);A(this,ll,!1);A(this,yh,Z._zIndex++);this.parent=e.parent,this.id=e.id,this.width=this.height=null,this.pageIndex=e.parent.pageIndex,this.name=e.name,this.div=null,this._uiManager=e.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=e.isCentered,this._structTreeParentId=null;const{rotation:t,rawDims:{pageWidth:s,pageHeight:i,pageX:n,pageY:a}}=this.parent.viewport;this.rotation=t,this.pageRotation=(360+t-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[s,i],this.pageTranslation=[n,a];const[o,l]=this.parentDimensions;this.x=e.x/o,this.y=e.y/l,this.isAttachedToDOM=!1,this.deleted=!1}static get _resizerKeyboardManager(){const e=Z.prototype._resizeWithKeyboard,t=Mr.TRANSLATE_SMALL,s=Mr.TRANSLATE_BIG;return tt(this,"_resizerKeyboardManager",new hc([[["ArrowLeft","mac+ArrowLeft"],e,{args:[-t,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e,{args:[-s,0]}],[["ArrowRight","mac+ArrowRight"],e,{args:[t,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e,{args:[s,0]}],[["ArrowUp","mac+ArrowUp"],e,{args:[0,-t]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e,{args:[0,-s]}],[["ArrowDown","mac+ArrowDown"],e,{args:[0,t]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e,{args:[0,s]}],[["Escape","mac+Escape"],Z.prototype._stopResizingWithKeyboard]]))}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get isDrawer(){return!1}static get _defaultLineColor(){return tt(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(e){const t=new Um({id:e.parent.getNextId(),parent:e.parent,uiManager:e._uiManager});t.annotationElementId=e.annotationElementId,t.deleted=!0,t._uiManager.addToAnnotationStorage(t)}static initialize(e,t){if(Z._l10n??(Z._l10n=e),Z._l10nResizer||(Z._l10nResizer=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"})),Z._borderLineWidth!==-1)return;const s=getComputedStyle(document.documentElement);Z._borderLineWidth=parseFloat(s.getPropertyValue("--outline-width"))||0}static updateDefaultParams(e,t){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(e){return!1}static paste(e,t){pt("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return r(this,ll)}set _isDraggable(e){var t;p(this,ll,e),(t=this.div)==null||t.classList.toggle("draggable",e)}get isEnterHandled(){return!0}center(){const[e,t]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*t/(e*2),this.y+=this.width*e/(t*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*t/(e*2),this.y-=this.width*e/(t*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(e){this._uiManager.addCommands(e)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=r(this,yh)}setParent(e){e!==null?(this.pageIndex=e.pageIndex,this.pageDimensions=e.pageDimensions):v(this,G,mo).call(this),this.parent=e}focusin(e){this._focusEventsAllowed&&(r(this,Bn)?p(this,Bn,!1):this.parent.setSelected(this))}focusout(e){var s;if(!this._focusEventsAllowed||!this.isAttachedToDOM)return;const t=e.relatedTarget;t!=null&&t.closest(`#${this.id}`)||(e.preventDefault(),(s=this.parent)!=null&&s.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(e,t,s,i){const[n,a]=this.parentDimensions;[s,i]=this.screenToPageTranslation(s,i),this.x=(e+s)/n,this.y=(t+i)/a,this.fixAndSetPosition()}translate(e,t){v(this,G,gd).call(this,this.parentDimensions,e,t)}translateInPage(e,t){r(this,Re)||p(this,Re,[this.x,this.y,this.width,this.height]),v(this,G,gd).call(this,this.pageDimensions,e,t),this.div.scrollIntoView({block:"nearest"})}drag(e,t){r(this,Re)||p(this,Re,[this.x,this.y,this.width,this.height]);const{div:s,parentDimensions:[i,n]}=this;if(this.x+=e/i,this.y+=t/n,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:u,y:f}=this.div.getBoundingClientRect();this.parent.findNewParent(this,u,f)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:a,y:o}=this;const[l,c]=this.getBaseTranslation();a+=l,o+=c;const{style:d}=s;d.left=`${(100*a).toFixed(2)}%`,d.top=`${(100*o).toFixed(2)}%`,this._onTranslating(a,o),s.scrollIntoView({block:"nearest"})}_onTranslating(e,t){}_onTranslated(e,t){}get _hasBeenMoved(){return!!r(this,Re)&&(r(this,Re)[0]!==this.x||r(this,Re)[1]!==this.y)}get _hasBeenResized(){return!!r(this,Re)&&(r(this,Re)[2]!==this.width||r(this,Re)[3]!==this.height)}getBaseTranslation(){const[e,t]=this.parentDimensions,{_borderLineWidth:s}=Z,i=s/e,n=s/t;switch(this.rotation){case 90:return[-i,n];case 180:return[i,n];case 270:return[i,-n];default:return[-i,-n]}}get _mustFixPosition(){return!0}fixAndSetPosition(e=this.rotation){const{div:{style:t},pageDimensions:[s,i]}=this;let{x:n,y:a,width:o,height:l}=this;if(o*=s,l*=i,n*=s,a*=i,this._mustFixPosition)switch(e){case 0:n=Math.max(0,Math.min(s-o,n)),a=Math.max(0,Math.min(i-l,a));break;case 90:n=Math.max(0,Math.min(s-l,n)),a=Math.min(i,Math.max(o,a));break;case 180:n=Math.min(s,Math.max(o,n)),a=Math.min(i,Math.max(l,a));break;case 270:n=Math.min(s,Math.max(l,n)),a=Math.max(0,Math.min(i-o,a));break}this.x=n/=s,this.y=a/=i;const[c,d]=this.getBaseTranslation();n+=c,a+=d,t.left=`${(100*n).toFixed(2)}%`,t.top=`${(100*a).toFixed(2)}%`,this.moveInDOM()}screenToPageTranslation(e,t){var s;return v(s=Z,cl,md).call(s,e,t,this.parentRotation)}pageTranslationToScreen(e,t){var s;return v(s=Z,cl,md).call(s,e,t,360-this.parentRotation)}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:e,pageDimensions:[t,s]}=this;return[t*e,s*e]}setDims(e,t){const[s,i]=this.parentDimensions,{style:n}=this.div;n.width=`${(100*e/s).toFixed(2)}%`,r(this,zn)||(n.height=`${(100*t/i).toFixed(2)}%`)}fixDims(){const{style:e}=this.div,{height:t,width:s}=e,i=s.endsWith("%"),n=!r(this,zn)&&t.endsWith("%");if(i&&n)return;const[a,o]=this.parentDimensions;i||(e.width=`${(100*parseFloat(s)/a).toFixed(2)}%`),!r(this,zn)&&!n&&(e.height=`${(100*parseFloat(t)/o).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}_onResized(){}static _round(e){return Math.round(e*1e4)/1e4}_onResizing(){}altTextFinish(){var e;(e=r(this,yt))==null||e.finish()}async addEditToolbar(){return this._editToolbar||r(this,Hn)?this._editToolbar:(this._editToolbar=new nd(this),this.div.append(this._editToolbar.render()),r(this,yt)&&await this._editToolbar.addAltText(r(this,yt)),this._editToolbar)}removeEditToolbar(){var e;this._editToolbar&&(this._editToolbar.remove(),this._editToolbar=null,(e=r(this,yt))==null||e.destroy())}addContainer(e){var s;const t=(s=this._editToolbar)==null?void 0:s.div;t?t.before(e):this.div.append(e)}getClientDimensions(){return this.div.getBoundingClientRect()}async addAltTextButton(){r(this,yt)||(oh.initialize(Z._l10n),p(this,yt,new oh(this)),r(this,On)&&(r(this,yt).data=r(this,On),p(this,On,null)),await this.addEditToolbar())}get altTextData(){var e;return(e=r(this,yt))==null?void 0:e.data}set altTextData(e){r(this,yt)&&(r(this,yt).data=e)}get guessedAltText(){var e;return(e=r(this,yt))==null?void 0:e.guessedText}async setGuessedAltText(e){var t;await((t=r(this,yt))==null?void 0:t.setGuessedText(e))}serializeAltText(e){var t;return(t=r(this,yt))==null?void 0:t.serialize(e)}hasAltText(){return!!r(this,yt)&&!r(this,yt).isEmpty()}hasAltTextData(){var e;return((e=r(this,yt))==null?void 0:e.hasData())??!1}render(){var n;this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.tabIndex=r(this,oa)?-1:0,this._isVisible||this.div.classList.add("hidden"),this.setInForeground(),v(this,G,vd).call(this);const[e,t]=this.parentDimensions;this.parentRotation%180!==0&&(this.div.style.maxWidth=`${(100*t/e).toFixed(2)}%`,this.div.style.maxHeight=`${(100*e/t).toFixed(2)}%`);const[s,i]=this.getInitialTranslation();return this.translate(s,i),ah(this,this.div,["pointerdown"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(r(this,Un)||p(this,Un,new lh({container:this.div,isPinchingDisabled:()=>!this.isSelected,onPinchStart:v(this,G,Wf).bind(this),onPinching:v(this,G,Vf).bind(this),onPinchEnd:v(this,G,qf).bind(this),signal:this._uiManager._signal}))),(n=this._uiManager._editorUndoBar)==null||n.hide(),this.div}pointerdown(e){const{isMac:t}=ye.platform;if(e.button!==0||e.ctrlKey&&t){e.preventDefault();return}if(p(this,Bn,!0),this._isDraggable){v(this,G,Xf).call(this,e);return}v(this,G,Ad).call(this,e)}get isSelected(){return this._uiManager.isSelected(this)}_onStartDragging(){}_onStopDragging(){}moveInDOM(){r(this,js)&&clearTimeout(r(this,js)),p(this,js,setTimeout(()=>{var e;p(this,js,null),(e=this.parent)==null||e.moveEditorInDOM(this)},0))}_setParentAndPosition(e,t,s){e.changeParent(this),this.x=t,this.y=s,this.fixAndSetPosition(),this._onTranslated()}getRect(e,t,s=this.rotation){const i=this.parentScale,[n,a]=this.pageDimensions,[o,l]=this.pageTranslation,c=e/i,d=t/i,u=this.x*n,f=this.y*a,g=this.width*n,m=this.height*a;switch(s){case 0:return[u+c+o,a-f-d-m+l,u+c+g+o,a-f-d+l];case 90:return[u+d+o,a-f+c+l,u+d+m+o,a-f+c+g+l];case 180:return[u-c-g+o,a-f+d+l,u-c+o,a-f+d+m+l];case 270:return[u-d-m+o,a-f-c-g+l,u-d+o,a-f-c+l];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(e,t){const[s,i,n,a]=e,o=n-s,l=a-i;switch(this.rotation){case 0:return[s,t-a,o,l];case 90:return[s,t-i,l,o];case 180:return[n,t-i,o,l];case 270:return[n,t-a,l,o];default:throw new Error("Invalid rotation")}}onceAdded(e){}isEmpty(){return!1}enableEditMode(){p(this,Hn,!0)}disableEditMode(){p(this,Hn,!1)}isInEditMode(){return r(this,Hn)}shouldGetKeyboardEvents(){return r(this,ni)}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){const{top:e,left:t,bottom:s,right:i}=this.getClientDimensions(),{innerHeight:n,innerWidth:a}=window;return t<a&&i>0&&e<n&&s>0}rebuild(){v(this,G,vd).call(this)}rotate(e){}resize(){}serializeDeleted(){var e;return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:((e=this._initialData)==null?void 0:e.popupRef)||""}}serialize(e=!1,t=null){pt("An editor must be serializable")}static async deserialize(e,t,s){const i=new this.prototype.constructor({parent:t,id:t.getNextId(),uiManager:s});i.rotation=e.rotation,p(i,On,e.accessibilityData);const[n,a]=i.pageDimensions,[o,l,c,d]=i.getRectInCurrentCoords(e.rect,a);return i.x=o/n,i.y=l/a,i.width=c/n,i.height=d/a,i}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){var e,t;if((e=r(this,Gi))==null||e.abort(),p(this,Gi,null),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),r(this,js)&&(clearTimeout(r(this,js)),p(this,js,null)),v(this,G,mo).call(this),this.removeEditToolbar(),r(this,Ze)){for(const s of r(this,Ze).values())clearTimeout(s);p(this,Ze,null)}this.parent=null,(t=r(this,Un))==null||t.destroy(),p(this,Un,null)}get isResizable(){return!1}makeResizable(){this.isResizable&&(v(this,G,Uf).call(this),r(this,Yt).classList.remove("hidden"),ah(this,this.div,["keydown"]))}get toolbarPosition(){return null}keydown(e){if(!this.isResizable||e.target!==this.div||e.key!=="Enter")return;this._uiManager.setSelected(this),p(this,ii,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const t=r(this,Yt).children;if(!r(this,ds)){p(this,ds,Array.from(t));const a=v(this,G,Yf).bind(this),o=v(this,G,Kf).bind(this),l=this._uiManager._signal;for(const c of r(this,ds)){const d=c.getAttribute("data-resizer-name");c.setAttribute("role","spinbutton"),c.addEventListener("keydown",a,{signal:l}),c.addEventListener("blur",o,{signal:l}),c.addEventListener("focus",v(this,G,Zf).bind(this,d),{signal:l}),c.setAttribute("data-l10n-id",Z._l10nResizer[d])}}const s=r(this,ds)[0];let i=0;for(const a of t){if(a===s)break;i++}const n=(360-this.rotation+this.parentRotation)%360/90*(r(this,ds).length/4);if(n!==i){if(n<i)for(let o=0;o<i-n;o++)r(this,Yt).append(r(this,Yt).firstChild);else if(n>i)for(let o=0;o<n-i;o++)r(this,Yt).firstChild.before(r(this,Yt).lastChild);let a=0;for(const o of t){const c=r(this,ds)[a++].getAttribute("data-resizer-name");o.setAttribute("data-l10n-id",Z._l10nResizer[c])}}v(this,G,wd).call(this,0),p(this,ni,!0),r(this,Yt).firstChild.focus({focusVisible:!0}),e.preventDefault(),e.stopImmediatePropagation()}_resizeWithKeyboard(e,t){r(this,ni)&&v(this,G,yd).call(this,r(this,al),{deltaX:e,deltaY:t,fromKeyboard:!0})}_stopResizingWithKeyboard(){v(this,G,mo).call(this),this.div.focus()}select(){var e,t,s;if(this.makeResizable(),(e=this.div)==null||e.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{var i,n;(i=this.div)!=null&&i.classList.contains("selectedEditor")&&((n=this._editToolbar)==null||n.show())});return}(t=this._editToolbar)==null||t.show(),(s=r(this,yt))==null||s.toggleAltTextBadge(!1)}unselect(){var e,t,s,i,n;(e=r(this,Yt))==null||e.classList.add("hidden"),(t=this.div)==null||t.classList.remove("selectedEditor"),(s=this.div)!=null&&s.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),(i=this._editToolbar)==null||i.hide(),(n=r(this,yt))==null||n.toggleAltTextBadge(!0)}updateParams(e,t){}disableEditing(){}enableEditing(){}enterInEditMode(){}getImageForAltText(){return null}get contentDiv(){return this.div}get isEditing(){return r(this,ol)}set isEditing(e){p(this,ol,e),this.parent&&(e?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(e,t){p(this,zn,!0);const s=e/t,{style:i}=this.div;i.aspectRatio=s,i.height="auto"}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(e,t=!1){if(t){r(this,Ze)||p(this,Ze,new Map);const{action:s}=e;let i=r(this,Ze).get(s);i&&clearTimeout(i),i=setTimeout(()=>{this._reportTelemetry(e),r(this,Ze).delete(s),r(this,Ze).size===0&&p(this,Ze,null)},Z._telemetryTimeout),r(this,Ze).set(s,i);return}e.type||(e.type=this.editorType),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:e}})}show(e=this._isVisible){this.div.classList.toggle("hidden",!e),this._isVisible=e}enable(){this.div&&(this.div.tabIndex=0),p(this,oa,!1)}disable(){this.div&&(this.div.tabIndex=-1),p(this,oa,!0)}renderAnnotationElement(e){let t=e.container.querySelector(".annotationContent");if(!t)t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),e.container.prepend(t);else if(t.nodeName==="CANVAS"){const s=t;t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),s.before(t)}return t}resetAnnotationElement(e){const{firstChild:t}=e.container;(t==null?void 0:t.nodeName)==="DIV"&&t.classList.contains("annotationContent")&&t.remove()}};On=new WeakMap,ds=new WeakMap,yt=new WeakMap,oa=new WeakMap,Ui=new WeakMap,rl=new WeakMap,zn=new WeakMap,Yt=new WeakMap,$n=new WeakMap,ii=new WeakMap,Gi=new WeakMap,al=new WeakMap,Bn=new WeakMap,Re=new WeakMap,ol=new WeakMap,Hn=new WeakMap,ni=new WeakMap,js=new WeakMap,la=new WeakMap,ca=new WeakMap,Ze=new WeakMap,Un=new WeakMap,ll=new WeakMap,yh=new WeakMap,G=new WeakSet,gd=function([e,t],s,i){[s,i]=this.screenToPageTranslation(s,i),this.x+=s/e,this.y+=i/t,this._onTranslating(this.x,this.y),this.fixAndSetPosition()},cl=new WeakSet,md=function(e,t,s){switch(s){case 90:return[t,-e];case 180:return[-e,-t];case 270:return[-t,e];default:return[e,t]}},Nc=function(e){switch(e){case 90:{const[t,s]=this.pageDimensions;return[0,-t/s,s/t,0]}case 180:return[-1,0,0,-1];case 270:{const[t,s]=this.pageDimensions;return[0,t/s,-s/t,0]}default:return[1,0,0,1]}},Uf=function(){if(r(this,Yt))return;p(this,Yt,document.createElement("div")),r(this,Yt).classList.add("resizers");const e=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],t=this._uiManager._signal;for(const s of e){const i=document.createElement("div");r(this,Yt).append(i),i.classList.add("resizer",s),i.setAttribute("data-resizer-name",s),i.addEventListener("pointerdown",v(this,G,Gf).bind(this,s),{signal:t}),i.addEventListener("contextmenu",xs,{signal:t}),i.tabIndex=-1}this.div.prepend(r(this,Yt))},Gf=function(e,t){var d;t.preventDefault();const{isMac:s}=ye.platform;if(t.button!==0||t.ctrlKey&&s)return;(d=r(this,yt))==null||d.toggle(!1);const i=this._isDraggable;this._isDraggable=!1,p(this,$n,[t.screenX,t.screenY]);const n=new AbortController,a=this._uiManager.combinedSignal(n);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",v(this,G,yd).bind(this,e),{passive:!0,capture:!0,signal:a}),window.addEventListener("touchmove",Ge,{passive:!1,signal:a}),window.addEventListener("contextmenu",xs,{signal:a}),p(this,ii,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const o=this.parent.div.style.cursor,l=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(t.target).cursor;const c=()=>{var u;n.abort(),this.parent.togglePointerEvents(!0),(u=r(this,yt))==null||u.toggle(!0),this._isDraggable=i,this.parent.div.style.cursor=o,this.div.style.cursor=l,v(this,G,Fc).call(this)};window.addEventListener("pointerup",c,{signal:a}),window.addEventListener("blur",c,{signal:a})},bd=function(e,t,s,i){this.width=s,this.height=i,this.x=e,this.y=t;const[n,a]=this.parentDimensions;this.setDims(n*s,a*i),this.fixAndSetPosition(),this._onResized()},Fc=function(){if(!r(this,ii))return;const{savedX:e,savedY:t,savedWidth:s,savedHeight:i}=r(this,ii);p(this,ii,null);const n=this.x,a=this.y,o=this.width,l=this.height;n===e&&a===t&&o===s&&l===i||this.addCommands({cmd:v(this,G,bd).bind(this,n,a,o,l),undo:v(this,G,bd).bind(this,e,t,s,i),mustExec:!0})},yd=function(e,t){const[s,i]=this.parentDimensions,n=this.x,a=this.y,o=this.width,l=this.height,c=Z.MIN_SIZE/s,d=Z.MIN_SIZE/i,u=v(this,G,Nc).call(this,this.rotation),f=(R,H)=>[u[0]*R+u[2]*H,u[1]*R+u[3]*H],g=v(this,G,Nc).call(this,360-this.rotation),m=(R,H)=>[g[0]*R+g[2]*H,g[1]*R+g[3]*H];let y,w,x=!1,S=!1;switch(e){case"topLeft":x=!0,y=(R,H)=>[0,0],w=(R,H)=>[R,H];break;case"topMiddle":y=(R,H)=>[R/2,0],w=(R,H)=>[R/2,H];break;case"topRight":x=!0,y=(R,H)=>[R,0],w=(R,H)=>[0,H];break;case"middleRight":S=!0,y=(R,H)=>[R,H/2],w=(R,H)=>[0,H/2];break;case"bottomRight":x=!0,y=(R,H)=>[R,H],w=(R,H)=>[0,0];break;case"bottomMiddle":y=(R,H)=>[R/2,H],w=(R,H)=>[R/2,0];break;case"bottomLeft":x=!0,y=(R,H)=>[0,H],w=(R,H)=>[R,0];break;case"middleLeft":S=!0,y=(R,H)=>[0,H/2],w=(R,H)=>[R,H/2];break}const _=y(o,l),C=w(o,l);let k=f(...C);const T=Z._round(n+k[0]),P=Z._round(a+k[1]);let D=1,O=1,K,B;if(t.fromKeyboard)({deltaX:K,deltaY:B}=t);else{const{screenX:R,screenY:H}=t,[te,Te]=r(this,$n);[K,B]=this.screenToPageTranslation(R-te,H-Te),r(this,$n)[0]=R,r(this,$n)[1]=H}if([K,B]=m(K/s,B/i),x){const R=Math.hypot(o,l);D=O=Math.max(Math.min(Math.hypot(C[0]-_[0]-K,C[1]-_[1]-B)/R,1/o,1/l),c/o,d/l)}else S?D=Math.max(c,Math.min(1,Math.abs(C[0]-_[0]-K)))/o:O=Math.max(d,Math.min(1,Math.abs(C[1]-_[1]-B)))/l;const lt=Z._round(o*D),gt=Z._round(l*O);k=f(...w(lt,gt));const it=T-k[0],xt=P-k[1];r(this,Re)||p(this,Re,[this.x,this.y,this.width,this.height]),this.width=lt,this.height=gt,this.x=it,this.y=xt,this.setDims(s*lt,i*gt),this.fixAndSetPosition(),this._onResizing()},Wf=function(){var e;p(this,ii,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height}),(e=r(this,yt))==null||e.toggle(!1),this.parent.togglePointerEvents(!1)},Vf=function(e,t,s){let n=.7*(s/t)+1-.7;if(n===1)return;const a=v(this,G,Nc).call(this,this.rotation),o=(T,P)=>[a[0]*T+a[2]*P,a[1]*T+a[3]*P],[l,c]=this.parentDimensions,d=this.x,u=this.y,f=this.width,g=this.height,m=Z.MIN_SIZE/l,y=Z.MIN_SIZE/c;n=Math.max(Math.min(n,1/f,1/g),m/f,y/g);const w=Z._round(f*n),x=Z._round(g*n);if(w===f&&x===g)return;r(this,Re)||p(this,Re,[d,u,f,g]);const S=o(f/2,g/2),_=Z._round(d+S[0]),C=Z._round(u+S[1]),k=o(w/2,x/2);this.x=_-k[0],this.y=C-k[1],this.width=w,this.height=x,this.setDims(l*w,c*x),this.fixAndSetPosition(),this._onResizing()},qf=function(){var e;(e=r(this,yt))==null||e.toggle(!0),this.parent.togglePointerEvents(!0),v(this,G,Fc).call(this)},Ad=function(e){const{isMac:t}=ye.platform;e.ctrlKey&&!t||e.shiftKey||e.metaKey&&t?this.parent.toggleSelected(this):this.parent.setSelected(this)},Xf=function(e){const{isSelected:t}=this;this._uiManager.setUpDragSession();let s=!1;const i=new AbortController,n=this._uiManager.combinedSignal(i),a={capture:!0,passive:!1,signal:n},o=c=>{i.abort(),p(this,Ui,null),p(this,Bn,!1),this._uiManager.endDragSession()||v(this,G,Ad).call(this,c),s&&this._onStopDragging()};t&&(p(this,la,e.clientX),p(this,ca,e.clientY),p(this,Ui,e.pointerId),p(this,rl,e.pointerType),window.addEventListener("pointermove",c=>{s||(s=!0,this._onStartDragging());const{clientX:d,clientY:u,pointerId:f}=c;if(f!==r(this,Ui)){Ge(c);return}const[g,m]=this.screenToPageTranslation(d-r(this,la),u-r(this,ca));p(this,la,d),p(this,ca,u),this._uiManager.dragSelectedEditors(g,m)},a),window.addEventListener("touchmove",Ge,a),window.addEventListener("pointerdown",c=>{c.pointerType===r(this,rl)&&(r(this,Un)||c.isPrimary)&&o(c),Ge(c)},a));const l=c=>{if(!r(this,Ui)||r(this,Ui)===c.pointerId){o(c);return}Ge(c)};window.addEventListener("pointerup",l,{signal:n}),window.addEventListener("blur",l,{signal:n})},vd=function(){if(r(this,Gi)||!this.div)return;p(this,Gi,new AbortController);const e=this._uiManager.combinedSignal(r(this,Gi));this.div.addEventListener("focusin",this.focusin.bind(this),{signal:e}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:e})},Yf=function(e){Z._resizerKeyboardManager.exec(this,e)},Kf=function(e){var t;r(this,ni)&&((t=e.relatedTarget)==null?void 0:t.parentNode)!==r(this,Yt)&&v(this,G,mo).call(this)},Zf=function(e){p(this,al,r(this,ni)?e:"")},wd=function(e){if(r(this,ds))for(const t of r(this,ds))t.tabIndex=e},mo=function(){p(this,ni,!1),v(this,G,wd).call(this,-1),v(this,G,Fc).call(this)},A(Z,cl),U(Z,"_l10n",null),U(Z,"_l10nResizer",null),U(Z,"_borderLineWidth",-1),U(Z,"_colorManager",new od),U(Z,"_zIndex",1),U(Z,"_telemetryTimeout",1e3);let Et=Z;class Um extends Et{constructor(e){super(e),this.annotationElementId=e.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}const Yu=3285377520,qe=4294901760,ks=65535;class Jf{constructor(e){this.h1=e?e&4294967295:Yu,this.h2=e?e&4294967295:Yu}update(e){let t,s;if(typeof e=="string"){t=new Uint8Array(e.length*2),s=0;for(let y=0,w=e.length;y<w;y++){const x=e.charCodeAt(y);x<=255?t[s++]=x:(t[s++]=x>>>8,t[s++]=x&255)}}else if(ArrayBuffer.isView(e))t=e.slice(),s=t.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const i=s>>2,n=s-i*4,a=new Uint32Array(t.buffer,0,i);let o=0,l=0,c=this.h1,d=this.h2;const u=3432918353,f=461845907,g=u&ks,m=f&ks;for(let y=0;y<i;y++)y&1?(o=a[y],o=o*u&qe|o*g&ks,o=o<<15|o>>>17,o=o*f&qe|o*m&ks,c^=o,c=c<<13|c>>>19,c=c*5+3864292196):(l=a[y],l=l*u&qe|l*g&ks,l=l<<15|l>>>17,l=l*f&qe|l*m&ks,d^=l,d=d<<13|d>>>19,d=d*5+3864292196);switch(o=0,n){case 3:o^=t[i*4+2]<<16;case 2:o^=t[i*4+1]<<8;case 1:o^=t[i*4],o=o*u&qe|o*g&ks,o=o<<15|o>>>17,o=o*f&qe|o*m&ks,i&1?c^=o:d^=o}this.h1=c,this.h2=d}hexdigest(){let e=this.h1,t=this.h2;return e^=t>>>1,e=e*3981806797&qe|e*36045&ks,t=t*4283543511&qe|((t<<16|e>>>16)*2950163797&qe)>>>16,e^=t>>>1,e=e*444984403&qe|e*60499&ks,t=t*3301882366&qe|((t<<16|e>>>16)*3120437893&qe)>>>16,e^=t>>>1,(e>>>0).toString(16).padStart(8,"0")+(t>>>0).toString(16).padStart(8,"0")}}const xd=Object.freeze({map:null,hash:"",transfer:void 0});var Gn,Wn,Ut,Ah,Qf;class Su{constructor(){A(this,Ah);A(this,Gn,!1);A(this,Wn,null);A(this,Ut,new Map);this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(e,t){const s=r(this,Ut).get(e);return s===void 0?t:Object.assign(t,s)}getRawValue(e){return r(this,Ut).get(e)}remove(e){if(r(this,Ut).delete(e),r(this,Ut).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const t of r(this,Ut).values())if(t instanceof Et)return;this.onAnnotationEditor(null)}}setValue(e,t){const s=r(this,Ut).get(e);let i=!1;if(s!==void 0)for(const[n,a]of Object.entries(t))s[n]!==a&&(i=!0,s[n]=a);else i=!0,r(this,Ut).set(e,t);i&&v(this,Ah,Qf).call(this),t instanceof Et&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(t.constructor._type)}has(e){return r(this,Ut).has(e)}getAll(){return r(this,Ut).size>0?bu(r(this,Ut)):null}setAll(e){for(const[t,s]of Object.entries(e))this.setValue(t,s)}get size(){return r(this,Ut).size}resetModified(){r(this,Gn)&&(p(this,Gn,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new tp(this)}get serializable(){if(r(this,Ut).size===0)return xd;const e=new Map,t=new Jf,s=[],i=Object.create(null);let n=!1;for(const[a,o]of r(this,Ut)){const l=o instanceof Et?o.serialize(!1,i):o;l&&(e.set(a,l),t.update(`${a}:${JSON.stringify(l)}`),n||(n=!!l.bitmap))}if(n)for(const a of e.values())a.bitmap&&s.push(a.bitmap);return e.size>0?{map:e,hash:t.hexdigest(),transfer:s}:xd}get editorStats(){let e=null;const t=new Map;for(const s of r(this,Ut).values()){if(!(s instanceof Et))continue;const i=s.telemetryFinalData;if(!i)continue;const{type:n}=i;t.has(n)||t.set(n,Object.getPrototypeOf(s).constructor),e||(e=Object.create(null));const a=e[n]||(e[n]=new Map);for(const[o,l]of Object.entries(i)){if(o==="type")continue;let c=a.get(o);c||(c=new Map,a.set(o,c));const d=c.get(l)??0;c.set(l,d+1)}}for(const[s,i]of t)e[s]=i.computeTelemetryFinalData(e[s]);return e}resetModifiedIds(){p(this,Wn,null)}get modifiedIds(){if(r(this,Wn))return r(this,Wn);const e=[];for(const t of r(this,Ut).values())!(t instanceof Et)||!t.annotationElementId||!t.serialize()||e.push(t.annotationElementId);return p(this,Wn,{ids:new Set(e),hash:e.join(",")})}}Gn=new WeakMap,Wn=new WeakMap,Ut=new WeakMap,Ah=new WeakSet,Qf=function(){r(this,Gn)||(p(this,Gn,!0),typeof this.onSetModified=="function"&&this.onSetModified())};var hl;class tp extends Su{constructor(t){super();A(this,hl);const{map:s,hash:i,transfer:n}=t.serializable,a=structuredClone(s,n?{transfer:n}:null);p(this,hl,{map:a,hash:i,transfer:n})}get print(){pt("Should not call PrintAnnotationStorage.print")}get serializable(){return r(this,hl)}get modifiedIds(){return tt(this,"modifiedIds",{ids:new Set,hash:""})}}hl=new WeakMap;var ha;class Gm{constructor({ownerDocument:e=globalThis.document,styleElement:t=null}){A(this,ha,new Set);this._document=e,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(e){this.nativeFontFaces.add(e),this._document.fonts.add(e)}removeNativeFontFace(e){this.nativeFontFaces.delete(e),this._document.fonts.delete(e)}insertRule(e){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const t=this.styleElement.sheet;t.insertRule(e,t.cssRules.length)}clear(){for(const e of this.nativeFontFaces)this._document.fonts.delete(e);this.nativeFontFaces.clear(),r(this,ha).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:e,_inspectFont:t}){if(!(!e||r(this,ha).has(e.loadedName))){if(It(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:s,src:i,style:n}=e,a=new FontFace(s,i,n);this.addNativeFontFace(a);try{await a.load(),r(this,ha).add(s),t==null||t(e)}catch{Y(`Cannot load system font: ${e.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(a)}return}pt("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(e){if(e.attached||e.missingFile&&!e.systemFontInfo)return;if(e.attached=!0,e.systemFontInfo){await this.loadSystemFont(e);return}if(this.isFontLoadingAPISupported){const s=e.createNativeFontFace();if(s){this.addNativeFontFace(s);try{await s.loaded}catch(i){throw Y(`Failed to load font '${s.family}': '${i}'.`),e.disableFontFace=!0,i}}return}const t=e.createFontFaceRule();if(t){if(this.insertRule(t),this.isSyncFontLoadingSupported)return;await new Promise(s=>{const i=this._queueLoadingCallback(s);this._prepareFontLoadEvent(e,i)})}}get isFontLoadingAPISupported(){var t;const e=!!((t=this._document)!=null&&t.fonts);return tt(this,"isFontLoadingAPISupported",e)}get isSyncFontLoadingSupported(){let e=!1;return(ce||typeof navigator<"u"&&typeof(navigator==null?void 0:navigator.userAgent)=="string"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(e=!0),tt(this,"isSyncFontLoadingSupported",e)}_queueLoadingCallback(e){function t(){for(It(!i.done,"completeRequest() cannot be called twice."),i.done=!0;s.length>0&&s[0].done;){const n=s.shift();setTimeout(n.callback,0)}}const{loadingRequests:s}=this,i={done:!1,complete:t,callback:e};return s.push(i),i}get _loadTestFont(){const e=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return tt(this,"_loadTestFont",e)}_prepareFontLoadEvent(e,t){function s(C,k){return C.charCodeAt(k)<<24|C.charCodeAt(k+1)<<16|C.charCodeAt(k+2)<<8|C.charCodeAt(k+3)&255}function i(C,k,T,P){const D=C.substring(0,k),O=C.substring(k+T);return D+P+O}let n,a;const o=this._document.createElement("canvas");o.width=1,o.height=1;const l=o.getContext("2d");let c=0;function d(C,k){if(++c>30){Y("Load test font never loaded."),k();return}if(l.font="30px "+C,l.fillText(".",0,20),l.getImageData(0,0,1,1).data[3]>0){k();return}setTimeout(d.bind(null,C,k))}const u=`lt${Date.now()}${this.loadTestFontId++}`;let f=this._loadTestFont;f=i(f,976,u.length,u);const m=16,y=1482184792;let w=s(f,m);for(n=0,a=u.length-3;n<a;n+=4)w=w-y+s(u,n)|0;n<u.length&&(w=w-y+s(u+"XXX",n)|0),f=i(f,m,4,Pm(w));const x=`url(data:font/opentype;base64,${btoa(f)});`,S=`@font-face {font-family:"${u}";src:${x}}`;this.insertRule(S);const _=this._document.createElement("div");_.style.visibility="hidden",_.style.width=_.style.height="10px",_.style.position="absolute",_.style.top=_.style.left="0px";for(const C of[e.loadedName,u]){const k=this._document.createElement("span");k.textContent="Hi",k.style.fontFamily=C,_.append(k)}this._document.body.append(_),d(u,()=>{_.remove(),t.complete()})}}ha=new WeakMap;class Wm{constructor(e,{disableFontFace:t=!1,fontExtraProperties:s=!1,inspectFont:i=null}){this.compiledGlyphs=Object.create(null);for(const n in e)this[n]=e[n];this.disableFontFace=t===!0,this.fontExtraProperties=s===!0,this._inspectFont=i}createNativeFontFace(){var t;if(!this.data||this.disableFontFace)return null;let e;if(!this.cssFontInfo)e=new FontFace(this.loadedName,this.data,{});else{const s={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(s.style=`oblique ${this.cssFontInfo.italicAngle}deg`),e=new FontFace(this.cssFontInfo.fontFamily,this.data,s)}return(t=this._inspectFont)==null||t.call(this,this),e}createFontFaceRule(){var s;if(!this.data||this.disableFontFace)return null;const e=`url(data:${this.mimetype};base64,${Nm(this.data)});`;let t;if(!this.cssFontInfo)t=`@font-face {font-family:"${this.loadedName}";src:${e}}`;else{let i=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(i+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),t=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${i}src:${e}}`}return(s=this._inspectFont)==null||s.call(this,this,e),t}getPathGenerator(e,t){if(this.compiledGlyphs[t]!==void 0)return this.compiledGlyphs[t];const s=this.loadedName+"_path_"+t;let i;try{i=e.get(s)}catch(a){Y(`getPathGenerator - ignoring character: "${a}".`)}const n=new Path2D(i||"");return this.fontExtraProperties||e.delete(s),this.compiledGlyphs[t]=n}}const xc={DATA:1,ERROR:2},Rt={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function Ku(){}function xe(h){if(h instanceof dn||h instanceof ed||h instanceof Io||h instanceof Vu||h instanceof rh||h instanceof Xh)return h;switch(h instanceof Error||typeof h=="object"&&h!==null||pt('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),h.name){case"AbortException":return new dn(h.message);case"InvalidPDFException":return new ed(h.message);case"MissingPDFException":return new Io(h.message);case"PasswordException":return new Vu(h.message,h.code);case"UnexpectedResponseException":return new rh(h.message,h.status);case"UnknownErrorException":return new Xh(h.message,h.details)}return new Xh(h.message,h.toString())}var da,ns,ep,sp,ip,jc;class bo{constructor(e,t,s){A(this,ns);A(this,da,new AbortController);this.sourceName=e,this.targetName=t,this.comObj=s,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),s.addEventListener("message",v(this,ns,ep).bind(this),{signal:r(this,da).signal})}on(e,t){const s=this.actionHandler;if(s[e])throw new Error(`There is already an actionName called "${e}"`);s[e]=t}send(e,t,s){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,data:t},s)}sendWithPromise(e,t,s){const i=this.callbackId++,n=Promise.withResolvers();this.callbackCapabilities[i]=n;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,callbackId:i,data:t},s)}catch(a){n.reject(a)}return n.promise}sendWithStream(e,t,s,i){const n=this.streamId++,a=this.sourceName,o=this.targetName,l=this.comObj;return new ReadableStream({start:c=>{const d=Promise.withResolvers();return this.streamControllers[n]={controller:c,startCall:d,pullCall:null,cancelCall:null,isClosed:!1},l.postMessage({sourceName:a,targetName:o,action:e,streamId:n,data:t,desiredSize:c.desiredSize},i),d.promise},pull:c=>{const d=Promise.withResolvers();return this.streamControllers[n].pullCall=d,l.postMessage({sourceName:a,targetName:o,stream:Rt.PULL,streamId:n,desiredSize:c.desiredSize}),d.promise},cancel:c=>{It(c instanceof Error,"cancel must have a valid reason");const d=Promise.withResolvers();return this.streamControllers[n].cancelCall=d,this.streamControllers[n].isClosed=!0,l.postMessage({sourceName:a,targetName:o,stream:Rt.CANCEL,streamId:n,reason:xe(c)}),d.promise}},s)}destroy(){var e;(e=r(this,da))==null||e.abort(),p(this,da,null)}}da=new WeakMap,ns=new WeakSet,ep=function({data:e}){if(e.targetName!==this.sourceName)return;if(e.stream){v(this,ns,ip).call(this,e);return}if(e.callback){const s=e.callbackId,i=this.callbackCapabilities[s];if(!i)throw new Error(`Cannot resolve callback ${s}`);if(delete this.callbackCapabilities[s],e.callback===xc.DATA)i.resolve(e.data);else if(e.callback===xc.ERROR)i.reject(xe(e.reason));else throw new Error("Unexpected callback case");return}const t=this.actionHandler[e.action];if(!t)throw new Error(`Unknown action from worker: ${e.action}`);if(e.callbackId){const s=this.sourceName,i=e.sourceName,n=this.comObj;Promise.try(t,e.data).then(function(a){n.postMessage({sourceName:s,targetName:i,callback:xc.DATA,callbackId:e.callbackId,data:a})},function(a){n.postMessage({sourceName:s,targetName:i,callback:xc.ERROR,callbackId:e.callbackId,reason:xe(a)})});return}if(e.streamId){v(this,ns,sp).call(this,e);return}t(e.data)},sp=function(e){const t=e.streamId,s=this.sourceName,i=e.sourceName,n=this.comObj,a=this,o=this.actionHandler[e.action],l={enqueue(c,d=1,u){if(this.isCancelled)return;const f=this.desiredSize;this.desiredSize-=d,f>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),n.postMessage({sourceName:s,targetName:i,stream:Rt.ENQUEUE,streamId:t,chunk:c},u)},close(){this.isCancelled||(this.isCancelled=!0,n.postMessage({sourceName:s,targetName:i,stream:Rt.CLOSE,streamId:t}),delete a.streamSinks[t])},error(c){It(c instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,n.postMessage({sourceName:s,targetName:i,stream:Rt.ERROR,streamId:t,reason:xe(c)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:e.desiredSize,ready:null};l.sinkCapability.resolve(),l.ready=l.sinkCapability.promise,this.streamSinks[t]=l,Promise.try(o,e.data,l).then(function(){n.postMessage({sourceName:s,targetName:i,stream:Rt.START_COMPLETE,streamId:t,success:!0})},function(c){n.postMessage({sourceName:s,targetName:i,stream:Rt.START_COMPLETE,streamId:t,reason:xe(c)})})},ip=function(e){const t=e.streamId,s=this.sourceName,i=e.sourceName,n=this.comObj,a=this.streamControllers[t],o=this.streamSinks[t];switch(e.stream){case Rt.START_COMPLETE:e.success?a.startCall.resolve():a.startCall.reject(xe(e.reason));break;case Rt.PULL_COMPLETE:e.success?a.pullCall.resolve():a.pullCall.reject(xe(e.reason));break;case Rt.PULL:if(!o){n.postMessage({sourceName:s,targetName:i,stream:Rt.PULL_COMPLETE,streamId:t,success:!0});break}o.desiredSize<=0&&e.desiredSize>0&&o.sinkCapability.resolve(),o.desiredSize=e.desiredSize,Promise.try(o.onPull||Ku).then(function(){n.postMessage({sourceName:s,targetName:i,stream:Rt.PULL_COMPLETE,streamId:t,success:!0})},function(c){n.postMessage({sourceName:s,targetName:i,stream:Rt.PULL_COMPLETE,streamId:t,reason:xe(c)})});break;case Rt.ENQUEUE:if(It(a,"enqueue should have stream controller"),a.isClosed)break;a.controller.enqueue(e.chunk);break;case Rt.CLOSE:if(It(a,"close should have stream controller"),a.isClosed)break;a.isClosed=!0,a.controller.close(),v(this,ns,jc).call(this,a,t);break;case Rt.ERROR:It(a,"error should have stream controller"),a.controller.error(xe(e.reason)),v(this,ns,jc).call(this,a,t);break;case Rt.CANCEL_COMPLETE:e.success?a.cancelCall.resolve():a.cancelCall.reject(xe(e.reason)),v(this,ns,jc).call(this,a,t);break;case Rt.CANCEL:if(!o)break;const l=xe(e.reason);Promise.try(o.onCancel||Ku,l).then(function(){n.postMessage({sourceName:s,targetName:i,stream:Rt.CANCEL_COMPLETE,streamId:t,success:!0})},function(c){n.postMessage({sourceName:s,targetName:i,stream:Rt.CANCEL_COMPLETE,streamId:t,reason:xe(c)})}),o.sinkCapability.reject(l),o.isCancelled=!0,delete this.streamSinks[t];break;default:throw new Error("Unexpected stream case")}},jc=async function(e,t){var s,i,n;await Promise.allSettled([(s=e.startCall)==null?void 0:s.promise,(i=e.pullCall)==null?void 0:i.promise,(n=e.cancelCall)==null?void 0:n.promise]),delete this.streamControllers[t]};var dl;class np{constructor({enableHWA:e=!1}){A(this,dl,!1);p(this,dl,e)}create(e,t){if(e<=0||t<=0)throw new Error("Invalid canvas size");const s=this._createCanvas(e,t);return{canvas:s,context:s.getContext("2d",{willReadFrequently:!r(this,dl)})}}reset(e,t,s){if(!e.canvas)throw new Error("Canvas is not specified");if(t<=0||s<=0)throw new Error("Invalid canvas size");e.canvas.width=t,e.canvas.height=s}destroy(e){if(!e.canvas)throw new Error("Canvas is not specified");e.canvas.width=0,e.canvas.height=0,e.canvas=null,e.context=null}_createCanvas(e,t){pt("Abstract method `_createCanvas` called.")}}dl=new WeakMap;class Vm extends np{constructor({ownerDocument:e=globalThis.document,enableHWA:t=!1}){super({enableHWA:t}),this._document=e}_createCanvas(e,t){const s=this._document.createElement("canvas");return s.width=e,s.height=t,s}}class rp{constructor({baseUrl:e=null,isCompressed:t=!0}){this.baseUrl=e,this.isCompressed=t}async fetch({name:e}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!e)throw new Error("CMap name must be specified.");const t=this.baseUrl+e+(this.isCompressed?".bcmap":"");return this._fetch(t).then(s=>({cMapData:s,isCompressed:this.isCompressed})).catch(s=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${t}`)})}async _fetch(e){pt("Abstract method `_fetch` called.")}}class ap extends rp{async _fetch(e){const t=await Fh(e,this.isCompressed?"arraybuffer":"text");return t instanceof ArrayBuffer?new Uint8Array(t):Nh(t)}}class op{addFilter(e){return"none"}addHCMFilter(e,t){return"none"}addAlphaFilter(e){return"none"}addLuminosityFilter(e){return"none"}addHighlightHCMFilter(e,t,s,i,n){return"none"}destroy(e=!1){}}var Vn,ua,ri,ai,re,qn,Xn,I,se,yo,zr,Oc,$r,lp,Sd,Br,Ao,vo,_d,wo;class qm extends op{constructor({docId:t,ownerDocument:s=globalThis.document}){super();A(this,I);A(this,Vn);A(this,ua);A(this,ri);A(this,ai);A(this,re);A(this,qn);A(this,Xn,0);p(this,ai,t),p(this,re,s)}addFilter(t){if(!t)return"none";let s=r(this,I,se).get(t);if(s)return s;const[i,n,a]=v(this,I,Oc).call(this,t),o=t.length===1?i:`${i}${n}${a}`;if(s=r(this,I,se).get(o),s)return r(this,I,se).set(t,s),s;const l=`g_${r(this,ai)}_transfer_map_${de(this,Xn)._++}`,c=v(this,I,$r).call(this,l);r(this,I,se).set(t,c),r(this,I,se).set(o,c);const d=v(this,I,Br).call(this,l);return v(this,I,vo).call(this,i,n,a,d),c}addHCMFilter(t,s){var m;const i=`${t}-${s}`,n="base";let a=r(this,I,yo).get(n);if((a==null?void 0:a.key)===i||(a?((m=a.filter)==null||m.remove(),a.key=i,a.url="none",a.filter=null):(a={key:i,url:"none",filter:null},r(this,I,yo).set(n,a)),!t||!s))return a.url;const o=v(this,I,wo).call(this,t);t=$.makeHexColor(...o);const l=v(this,I,wo).call(this,s);if(s=$.makeHexColor(...l),r(this,I,zr).style.color="",t==="#000000"&&s==="#ffffff"||t===s)return a.url;const c=new Array(256);for(let y=0;y<=255;y++){const w=y/255;c[y]=w<=.03928?w/12.92:((w+.055)/1.055)**2.4}const d=c.join(","),u=`g_${r(this,ai)}_hcm_filter`,f=a.filter=v(this,I,Br).call(this,u);v(this,I,vo).call(this,d,d,d,f),v(this,I,Sd).call(this,f);const g=(y,w)=>{const x=o[y]/255,S=l[y]/255,_=new Array(w+1);for(let C=0;C<=w;C++)_[C]=x+C/w*(S-x);return _.join(",")};return v(this,I,vo).call(this,g(0,5),g(1,5),g(2,5),f),a.url=v(this,I,$r).call(this,u),a.url}addAlphaFilter(t){let s=r(this,I,se).get(t);if(s)return s;const[i]=v(this,I,Oc).call(this,[t]),n=`alpha_${i}`;if(s=r(this,I,se).get(n),s)return r(this,I,se).set(t,s),s;const a=`g_${r(this,ai)}_alpha_map_${de(this,Xn)._++}`,o=v(this,I,$r).call(this,a);r(this,I,se).set(t,o),r(this,I,se).set(n,o);const l=v(this,I,Br).call(this,a);return v(this,I,_d).call(this,i,l),o}addLuminosityFilter(t){let s=r(this,I,se).get(t||"luminosity");if(s)return s;let i,n;if(t?([i]=v(this,I,Oc).call(this,[t]),n=`luminosity_${i}`):n="luminosity",s=r(this,I,se).get(n),s)return r(this,I,se).set(t,s),s;const a=`g_${r(this,ai)}_luminosity_map_${de(this,Xn)._++}`,o=v(this,I,$r).call(this,a);r(this,I,se).set(t,o),r(this,I,se).set(n,o);const l=v(this,I,Br).call(this,a);return v(this,I,lp).call(this,l),t&&v(this,I,_d).call(this,i,l),o}addHighlightHCMFilter(t,s,i,n,a){var S;const o=`${s}-${i}-${n}-${a}`;let l=r(this,I,yo).get(t);if((l==null?void 0:l.key)===o||(l?((S=l.filter)==null||S.remove(),l.key=o,l.url="none",l.filter=null):(l={key:o,url:"none",filter:null},r(this,I,yo).set(t,l)),!s||!i))return l.url;const[c,d]=[s,i].map(v(this,I,wo).bind(this));let u=Math.round(.2126*c[0]+.7152*c[1]+.0722*c[2]),f=Math.round(.2126*d[0]+.7152*d[1]+.0722*d[2]),[g,m]=[n,a].map(v(this,I,wo).bind(this));f<u&&([u,f,g,m]=[f,u,m,g]),r(this,I,zr).style.color="";const y=(_,C,k)=>{const T=new Array(256),P=(f-u)/k,D=_/255,O=(C-_)/(255*k);let K=0;for(let B=0;B<=k;B++){const lt=Math.round(u+B*P),gt=D+B*O;for(let it=K;it<=lt;it++)T[it]=gt;K=lt+1}for(let B=K;B<256;B++)T[B]=T[K-1];return T.join(",")},w=`g_${r(this,ai)}_hcm_${t}_filter`,x=l.filter=v(this,I,Br).call(this,w);return v(this,I,Sd).call(this,x),v(this,I,vo).call(this,y(g[0],m[0],5),y(g[1],m[1],5),y(g[2],m[2],5),x),l.url=v(this,I,$r).call(this,w),l.url}destroy(t=!1){var s,i,n,a;t&&((s=r(this,qn))!=null&&s.size)||((i=r(this,ri))==null||i.parentNode.parentNode.remove(),p(this,ri,null),(n=r(this,ua))==null||n.clear(),p(this,ua,null),(a=r(this,qn))==null||a.clear(),p(this,qn,null),p(this,Xn,0))}}Vn=new WeakMap,ua=new WeakMap,ri=new WeakMap,ai=new WeakMap,re=new WeakMap,qn=new WeakMap,Xn=new WeakMap,I=new WeakSet,se=function(){return r(this,ua)||p(this,ua,new Map)},yo=function(){return r(this,qn)||p(this,qn,new Map)},zr=function(){if(!r(this,ri)){const t=r(this,re).createElement("div"),{style:s}=t;s.visibility="hidden",s.contain="strict",s.width=s.height=0,s.position="absolute",s.top=s.left=0,s.zIndex=-1;const i=r(this,re).createElementNS(qs,"svg");i.setAttribute("width",0),i.setAttribute("height",0),p(this,ri,r(this,re).createElementNS(qs,"defs")),t.append(i),i.append(r(this,ri)),r(this,re).body.append(t)}return r(this,ri)},Oc=function(t){if(t.length===1){const c=t[0],d=new Array(256);for(let f=0;f<256;f++)d[f]=c[f]/255;const u=d.join(",");return[u,u,u]}const[s,i,n]=t,a=new Array(256),o=new Array(256),l=new Array(256);for(let c=0;c<256;c++)a[c]=s[c]/255,o[c]=i[c]/255,l[c]=n[c]/255;return[a.join(","),o.join(","),l.join(",")]},$r=function(t){if(r(this,Vn)===void 0){p(this,Vn,"");const s=r(this,re).URL;s!==r(this,re).baseURI&&(jh(s)?Y('#createUrl: ignore "data:"-URL for performance reasons.'):p(this,Vn,s.split("#",1)[0]))}return`url(${r(this,Vn)}#${t})`},lp=function(t){const s=r(this,re).createElementNS(qs,"feColorMatrix");s.setAttribute("type","matrix"),s.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),t.append(s)},Sd=function(t){const s=r(this,re).createElementNS(qs,"feColorMatrix");s.setAttribute("type","matrix"),s.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),t.append(s)},Br=function(t){const s=r(this,re).createElementNS(qs,"filter");return s.setAttribute("color-interpolation-filters","sRGB"),s.setAttribute("id",t),r(this,I,zr).append(s),s},Ao=function(t,s,i){const n=r(this,re).createElementNS(qs,s);n.setAttribute("type","discrete"),n.setAttribute("tableValues",i),t.append(n)},vo=function(t,s,i,n){const a=r(this,re).createElementNS(qs,"feComponentTransfer");n.append(a),v(this,I,Ao).call(this,a,"feFuncR",t),v(this,I,Ao).call(this,a,"feFuncG",s),v(this,I,Ao).call(this,a,"feFuncB",i)},_d=function(t,s){const i=r(this,re).createElementNS(qs,"feComponentTransfer");s.append(i),v(this,I,Ao).call(this,i,"feFuncA",t)},wo=function(t){return r(this,I,zr).style.color=t,xu(getComputedStyle(r(this,I,zr)).getPropertyValue("color"))};class cp{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!e)throw new Error("Font filename must be specified.");const t=`${this.baseUrl}${e}`;return this._fetch(t).catch(s=>{throw new Error(`Unable to load font data at: ${t}`)})}async _fetch(e){pt("Abstract method `_fetch` called.")}}class hp extends cp{async _fetch(e){const t=await Fh(e,"arraybuffer");return new Uint8Array(t)}}ce&&Y("Please use the `legacy` build in Node.js environments.");async function dp(h){const t=await process.getBuiltinModule("fs").promises.readFile(h);return new Uint8Array(t)}class Xm extends op{}class Ym extends np{_createCanvas(e,t){return process.getBuiltinModule("module").createRequire(import.meta.url)("@napi-rs/canvas").createCanvas(e,t)}}class Km extends rp{async _fetch(e){return dp(e)}}class Zm extends cp{async _fetch(e){return dp(e)}}const le={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function Ed(h,e){if(!e)return;const t=e[2]-e[0],s=e[3]-e[1],i=new Path2D;i.rect(e[0],e[1],t,s),h.clip(i)}class _u{getPattern(){pt("Abstract method `getPattern` called.")}}class Jm extends _u{constructor(e){super(),this._type=e[1],this._bbox=e[2],this._colorStops=e[3],this._p0=e[4],this._p1=e[5],this._r0=e[6],this._r1=e[7],this.matrix=null}_createGradient(e){let t;this._type==="axial"?t=e.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(t=e.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const s of this._colorStops)t.addColorStop(s[0],s[1]);return t}getPattern(e,t,s,i){let n;if(i===le.STROKE||i===le.FILL){const a=t.current.getClippedPathBoundingBox(i,vt(e))||[0,0,0,0],o=Math.ceil(a[2]-a[0])||1,l=Math.ceil(a[3]-a[1])||1,c=t.cachedCanvases.getCanvas("pattern",o,l),d=c.context;d.clearRect(0,0,d.canvas.width,d.canvas.height),d.beginPath(),d.rect(0,0,d.canvas.width,d.canvas.height),d.translate(-a[0],-a[1]),s=$.transform(s,[1,0,0,1,a[0],a[1]]),d.transform(...t.baseTransform),this.matrix&&d.transform(...this.matrix),Ed(d,this._bbox),d.fillStyle=this._createGradient(d),d.fill(),n=e.createPattern(c.canvas,"no-repeat");const u=new DOMMatrix(s);n.setTransform(u)}else Ed(e,this._bbox),n=this._createGradient(e);return n}}function Zh(h,e,t,s,i,n,a,o){const l=e.coords,c=e.colors,d=h.data,u=h.width*4;let f;l[t+1]>l[s+1]&&(f=t,t=s,s=f,f=n,n=a,a=f),l[s+1]>l[i+1]&&(f=s,s=i,i=f,f=a,a=o,o=f),l[t+1]>l[s+1]&&(f=t,t=s,s=f,f=n,n=a,a=f);const g=(l[t]+e.offsetX)*e.scaleX,m=(l[t+1]+e.offsetY)*e.scaleY,y=(l[s]+e.offsetX)*e.scaleX,w=(l[s+1]+e.offsetY)*e.scaleY,x=(l[i]+e.offsetX)*e.scaleX,S=(l[i+1]+e.offsetY)*e.scaleY;if(m>=S)return;const _=c[n],C=c[n+1],k=c[n+2],T=c[a],P=c[a+1],D=c[a+2],O=c[o],K=c[o+1],B=c[o+2],lt=Math.round(m),gt=Math.round(S);let it,xt,R,H,te,Te,Ve,he;for(let Nt=lt;Nt<=gt;Nt++){if(Nt<w){const dt=Nt<m?0:(m-Nt)/(m-w);it=g-(g-y)*dt,xt=_-(_-T)*dt,R=C-(C-P)*dt,H=k-(k-D)*dt}else{let dt;Nt>S?dt=1:w===S?dt=0:dt=(w-Nt)/(w-S),it=y-(y-x)*dt,xt=T-(T-O)*dt,R=P-(P-K)*dt,H=D-(D-B)*dt}let Ct;Nt<m?Ct=0:Nt>S?Ct=1:Ct=(m-Nt)/(m-S),te=g-(g-x)*Ct,Te=_-(_-O)*Ct,Ve=C-(C-K)*Ct,he=k-(k-B)*Ct;const mt=Math.round(Math.min(it,te)),Pi=Math.round(Math.max(it,te));let Mt=u*Nt+mt*4;for(let dt=mt;dt<=Pi;dt++)Ct=(it-dt)/(it-te),Ct<0?Ct=0:Ct>1&&(Ct=1),d[Mt++]=xt-(xt-Te)*Ct|0,d[Mt++]=R-(R-Ve)*Ct|0,d[Mt++]=H-(H-he)*Ct|0,d[Mt++]=255}}function Qm(h,e,t){const s=e.coords,i=e.colors;let n,a;switch(e.type){case"lattice":const o=e.verticesPerRow,l=Math.floor(s.length/o)-1,c=o-1;for(n=0;n<l;n++){let d=n*o;for(let u=0;u<c;u++,d++)Zh(h,t,s[d],s[d+1],s[d+o],i[d],i[d+1],i[d+o]),Zh(h,t,s[d+o+1],s[d+1],s[d+o],i[d+o+1],i[d+1],i[d+o])}break;case"triangles":for(n=0,a=s.length;n<a;n+=3)Zh(h,t,s[n],s[n+1],s[n+2],i[n],i[n+1],i[n+2]);break;default:throw new Error("illegal figure")}}class tb extends _u{constructor(e){super(),this._coords=e[2],this._colors=e[3],this._figures=e[4],this._bounds=e[5],this._bbox=e[7],this._background=e[8],this.matrix=null}_createMeshCanvas(e,t,s){const o=Math.floor(this._bounds[0]),l=Math.floor(this._bounds[1]),c=Math.ceil(this._bounds[2])-o,d=Math.ceil(this._bounds[3])-l,u=Math.min(Math.ceil(Math.abs(c*e[0]*1.1)),3e3),f=Math.min(Math.ceil(Math.abs(d*e[1]*1.1)),3e3),g=c/u,m=d/f,y={coords:this._coords,colors:this._colors,offsetX:-o,offsetY:-l,scaleX:1/g,scaleY:1/m},w=u+2*2,x=f+2*2,S=s.getCanvas("mesh",w,x),_=S.context,C=_.createImageData(u,f);if(t){const T=C.data;for(let P=0,D=T.length;P<D;P+=4)T[P]=t[0],T[P+1]=t[1],T[P+2]=t[2],T[P+3]=255}for(const T of this._figures)Qm(C,T,y);return _.putImageData(C,2,2),{canvas:S.canvas,offsetX:o-2*g,offsetY:l-2*m,scaleX:g,scaleY:m}}getPattern(e,t,s,i){Ed(e,this._bbox);let n;if(i===le.SHADING)n=$.singularValueDecompose2dScale(vt(e));else if(n=$.singularValueDecompose2dScale(t.baseTransform),this.matrix){const o=$.singularValueDecompose2dScale(this.matrix);n=[n[0]*o[0],n[1]*o[1]]}const a=this._createMeshCanvas(n,i===le.SHADING?null:this._background,t.cachedCanvases);return i!==le.SHADING&&(e.setTransform(...t.baseTransform),this.matrix&&e.transform(...this.matrix)),e.translate(a.offsetX,a.offsetY),e.scale(a.scaleX,a.scaleY),e.createPattern(a.canvas,"no-repeat")}}class eb extends _u{getPattern(){return"hotpink"}}function sb(h){switch(h[0]){case"RadialAxial":return new Jm(h);case"Mesh":return new tb(h);case"Dummy":return new eb}throw new Error(`Unknown IR type: ${h[0]}`)}const Zu={COLORED:1,UNCOLORED:2},vh=class vh{constructor(e,t,s,i,n){this.operatorList=e[2],this.matrix=e[3],this.bbox=e[4],this.xstep=e[5],this.ystep=e[6],this.paintType=e[7],this.tilingType=e[8],this.color=t,this.ctx=s,this.canvasGraphicsFactory=i,this.baseTransform=n}createPatternCanvas(e){const{bbox:t,operatorList:s,paintType:i,tilingType:n,color:a,canvasGraphicsFactory:o}=this;let{xstep:l,ystep:c}=this;l=Math.abs(l),c=Math.abs(c),Dh("TilingType: "+n);const d=t[0],u=t[1],f=t[2],g=t[3],m=f-d,y=g-u,w=$.singularValueDecompose2dScale(this.matrix),x=$.singularValueDecompose2dScale(this.baseTransform),S=w[0]*x[0],_=w[1]*x[1];let C=m,k=y,T=!1,P=!1;const D=Math.ceil(l*S),O=Math.ceil(c*_),K=Math.ceil(m*S),B=Math.ceil(y*_);D>=K?C=l:T=!0,O>=B?k=c:P=!0;const lt=this.getSizeAndScale(C,this.ctx.canvas.width,S),gt=this.getSizeAndScale(k,this.ctx.canvas.height,_),it=e.cachedCanvases.getCanvas("pattern",lt.size,gt.size),xt=it.context,R=o.createCanvasGraphics(xt);if(R.groupLevel=e.groupLevel,this.setFillAndStrokeStyleToContext(R,i,a),xt.translate(-lt.scale*d,-gt.scale*u),R.transform(lt.scale,0,0,gt.scale,0,0),xt.save(),this.clipBbox(R,d,u,f,g),R.baseTransform=vt(R.ctx),R.executeOperatorList(s),R.endDrawing(),xt.restore(),T||P){const H=it.canvas;T&&(C=l),P&&(k=c);const te=this.getSizeAndScale(C,this.ctx.canvas.width,S),Te=this.getSizeAndScale(k,this.ctx.canvas.height,_),Ve=te.size,he=Te.size,Nt=e.cachedCanvases.getCanvas("pattern-workaround",Ve,he),Ct=Nt.context,mt=T?Math.floor(m/l):0,Pi=P?Math.floor(y/c):0;for(let Mt=0;Mt<=mt;Mt++)for(let dt=0;dt<=Pi;dt++)Ct.drawImage(H,Ve*Mt,he*dt,Ve,he,0,0,Ve,he);return{canvas:Nt.canvas,scaleX:te.scale,scaleY:Te.scale,offsetX:d,offsetY:u}}return{canvas:it.canvas,scaleX:lt.scale,scaleY:gt.scale,offsetX:d,offsetY:u}}getSizeAndScale(e,t,s){const i=Math.max(vh.MAX_PATTERN_SIZE,t);let n=Math.ceil(e*s);return n>=i?n=i:s=n/e,{scale:s,size:n}}clipBbox(e,t,s,i,n){const a=i-t,o=n-s;e.ctx.rect(t,s,a,o),e.current.updateRectMinMax(vt(e.ctx),[t,s,i,n]),e.clip(),e.endPath()}setFillAndStrokeStyleToContext(e,t,s){const i=e.ctx,n=e.current;switch(t){case Zu.COLORED:const a=this.ctx;i.fillStyle=a.fillStyle,i.strokeStyle=a.strokeStyle,n.fillColor=a.fillStyle,n.strokeColor=a.strokeStyle;break;case Zu.UNCOLORED:const o=$.makeHexColor(s[0],s[1],s[2]);i.fillStyle=o,i.strokeStyle=o,n.fillColor=o,n.strokeColor=o;break;default:throw new Tm(`Unsupported paint type: ${t}`)}}getPattern(e,t,s,i){let n=s;i!==le.SHADING&&(n=$.transform(n,t.baseTransform),this.matrix&&(n=$.transform(n,this.matrix)));const a=this.createPatternCanvas(t);let o=new DOMMatrix(n);o=o.translate(a.offsetX,a.offsetY),o=o.scale(1/a.scaleX,1/a.scaleY);const l=e.createPattern(a.canvas,"repeat");return l.setTransform(o),l}};U(vh,"MAX_PATTERN_SIZE",3e3);let Cd=vh;function ib({src:h,srcPos:e=0,dest:t,width:s,height:i,nonBlackColor:n=4294967295,inverseDecode:a=!1}){const o=ye.isLittleEndian?4278190080:255,[l,c]=a?[n,o]:[o,n],d=s>>3,u=s&7,f=h.length;t=new Uint32Array(t.buffer);let g=0;for(let m=0;m<i;m++){for(const w=e+d;e<w;e++){const x=e<f?h[e]:255;t[g++]=x&128?c:l,t[g++]=x&64?c:l,t[g++]=x&32?c:l,t[g++]=x&16?c:l,t[g++]=x&8?c:l,t[g++]=x&4?c:l,t[g++]=x&2?c:l,t[g++]=x&1?c:l}if(u===0)continue;const y=e<f?h[e++]:255;for(let w=0;w<u;w++)t[g++]=y&1<<7-w?c:l}return{srcPos:e,destPos:g}}const Ju=16,Qu=100,nb=15,tf=10,ef=1e3,ke=16;function rb(h,e){if(h._removeMirroring)throw new Error("Context is already forwarding operations.");h.__originalSave=h.save,h.__originalRestore=h.restore,h.__originalRotate=h.rotate,h.__originalScale=h.scale,h.__originalTranslate=h.translate,h.__originalTransform=h.transform,h.__originalSetTransform=h.setTransform,h.__originalResetTransform=h.resetTransform,h.__originalClip=h.clip,h.__originalMoveTo=h.moveTo,h.__originalLineTo=h.lineTo,h.__originalBezierCurveTo=h.bezierCurveTo,h.__originalRect=h.rect,h.__originalClosePath=h.closePath,h.__originalBeginPath=h.beginPath,h._removeMirroring=()=>{h.save=h.__originalSave,h.restore=h.__originalRestore,h.rotate=h.__originalRotate,h.scale=h.__originalScale,h.translate=h.__originalTranslate,h.transform=h.__originalTransform,h.setTransform=h.__originalSetTransform,h.resetTransform=h.__originalResetTransform,h.clip=h.__originalClip,h.moveTo=h.__originalMoveTo,h.lineTo=h.__originalLineTo,h.bezierCurveTo=h.__originalBezierCurveTo,h.rect=h.__originalRect,h.closePath=h.__originalClosePath,h.beginPath=h.__originalBeginPath,delete h._removeMirroring},h.save=function(){e.save(),this.__originalSave()},h.restore=function(){e.restore(),this.__originalRestore()},h.translate=function(s,i){e.translate(s,i),this.__originalTranslate(s,i)},h.scale=function(s,i){e.scale(s,i),this.__originalScale(s,i)},h.transform=function(s,i,n,a,o,l){e.transform(s,i,n,a,o,l),this.__originalTransform(s,i,n,a,o,l)},h.setTransform=function(s,i,n,a,o,l){e.setTransform(s,i,n,a,o,l),this.__originalSetTransform(s,i,n,a,o,l)},h.resetTransform=function(){e.resetTransform(),this.__originalResetTransform()},h.rotate=function(s){e.rotate(s),this.__originalRotate(s)},h.clip=function(s){e.clip(s),this.__originalClip(s)},h.moveTo=function(t,s){e.moveTo(t,s),this.__originalMoveTo(t,s)},h.lineTo=function(t,s){e.lineTo(t,s),this.__originalLineTo(t,s)},h.bezierCurveTo=function(t,s,i,n,a,o){e.bezierCurveTo(t,s,i,n,a,o),this.__originalBezierCurveTo(t,s,i,n,a,o)},h.rect=function(t,s,i,n){e.rect(t,s,i,n),this.__originalRect(t,s,i,n)},h.closePath=function(){e.closePath(),this.__originalClosePath()},h.beginPath=function(){e.beginPath(),this.__originalBeginPath()}}class ab{constructor(e){this.canvasFactory=e,this.cache=Object.create(null)}getCanvas(e,t,s){let i;return this.cache[e]!==void 0?(i=this.cache[e],this.canvasFactory.reset(i,t,s)):(i=this.canvasFactory.create(t,s),this.cache[e]=i),i}delete(e){delete this.cache[e]}clear(){for(const e in this.cache){const t=this.cache[e];this.canvasFactory.destroy(t),delete this.cache[e]}}}function Sc(h,e,t,s,i,n,a,o,l,c){const[d,u,f,g,m,y]=vt(h);if(u===0&&f===0){const S=a*d+m,_=Math.round(S),C=o*g+y,k=Math.round(C),T=(a+l)*d+m,P=Math.abs(Math.round(T)-_)||1,D=(o+c)*g+y,O=Math.abs(Math.round(D)-k)||1;return h.setTransform(Math.sign(d),0,0,Math.sign(g),_,k),h.drawImage(e,t,s,i,n,0,0,P,O),h.setTransform(d,u,f,g,m,y),[P,O]}if(d===0&&g===0){const S=o*f+m,_=Math.round(S),C=a*u+y,k=Math.round(C),T=(o+c)*f+m,P=Math.abs(Math.round(T)-_)||1,D=(a+l)*u+y,O=Math.abs(Math.round(D)-k)||1;return h.setTransform(0,Math.sign(u),Math.sign(f),0,_,k),h.drawImage(e,t,s,i,n,0,0,O,P),h.setTransform(d,u,f,g,m,y),[O,P]}h.drawImage(e,t,s,i,n,a,o,l,c);const w=Math.hypot(d,u),x=Math.hypot(f,g);return[w*l,x*c]}function ob(h){const{width:e,height:t}=h;if(e>ef||t>ef)return null;const s=1e3,i=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),n=e+1;let a=new Uint8Array(n*(t+1)),o,l,c;const d=e+7&-8;let u=new Uint8Array(d*t),f=0;for(const x of h.data){let S=128;for(;S>0;)u[f++]=x&S?0:255,S>>=1}let g=0;for(f=0,u[f]!==0&&(a[0]=1,++g),l=1;l<e;l++)u[f]!==u[f+1]&&(a[l]=u[f]?2:1,++g),f++;for(u[f]!==0&&(a[l]=2,++g),o=1;o<t;o++){f=o*d,c=o*n,u[f-d]!==u[f]&&(a[c]=u[f]?1:8,++g);let x=(u[f]?4:0)+(u[f-d]?8:0);for(l=1;l<e;l++)x=(x>>2)+(u[f+1]?4:0)+(u[f-d+1]?8:0),i[x]&&(a[c+l]=i[x],++g),f++;if(u[f-d]!==u[f]&&(a[c+l]=u[f]?2:4,++g),g>s)return null}for(f=d*(t-1),c=o*n,u[f]!==0&&(a[c]=8,++g),l=1;l<e;l++)u[f]!==u[f+1]&&(a[c+l]=u[f]?4:8,++g),f++;if(u[f]!==0&&(a[c+l]=4,++g),g>s)return null;const m=new Int32Array([0,n,-1,0,-n,0,0,0,1]),y=new Path2D;for(o=0;g&&o<=t;o++){let x=o*n;const S=x+e;for(;x<S&&!a[x];)x++;if(x===S)continue;y.moveTo(x%n,o);const _=x;let C=a[x];do{const k=m[C];do x+=k;while(!a[x]);const T=a[x];T!==5&&T!==10?(C=T,a[x]=0):(C=T&51*C>>4,a[x]&=C>>2|C<<2),y.lineTo(x%n,x/n|0),a[x]||--g}while(_!==x);--o}return u=null,a=null,function(x){x.save(),x.scale(1/e,-1/t),x.translate(0,-t),x.fill(y),x.beginPath(),x.restore()}}class sf{constructor(e,t){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=wf,this.textMatrixScale=1,this.fontMatrix=td,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=ee.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.patternStroke=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,e,t])}clone(){const e=Object.create(this);return e.clipBox=this.clipBox.slice(),e}setCurrentPoint(e,t){this.x=e,this.y=t}updatePathMinMax(e,t,s){[t,s]=$.applyTransform([t,s],e),this.minX=Math.min(this.minX,t),this.minY=Math.min(this.minY,s),this.maxX=Math.max(this.maxX,t),this.maxY=Math.max(this.maxY,s)}updateRectMinMax(e,t){const s=$.applyTransform(t,e),i=$.applyTransform(t.slice(2),e),n=$.applyTransform([t[0],t[3]],e),a=$.applyTransform([t[2],t[1]],e);this.minX=Math.min(this.minX,s[0],i[0],n[0],a[0]),this.minY=Math.min(this.minY,s[1],i[1],n[1],a[1]),this.maxX=Math.max(this.maxX,s[0],i[0],n[0],a[0]),this.maxY=Math.max(this.maxY,s[1],i[1],n[1],a[1])}updateScalingPathMinMax(e,t){$.scaleMinMax(e,t),this.minX=Math.min(this.minX,t[0]),this.minY=Math.min(this.minY,t[1]),this.maxX=Math.max(this.maxX,t[2]),this.maxY=Math.max(this.maxY,t[3])}updateCurvePathMinMax(e,t,s,i,n,a,o,l,c,d){const u=$.bezierBoundingBox(t,s,i,n,a,o,l,c,d);d||this.updateRectMinMax(e,u)}getPathBoundingBox(e=le.FILL,t=null){const s=[this.minX,this.minY,this.maxX,this.maxY];if(e===le.STROKE){t||pt("Stroke bounding box must include transform.");const i=$.singularValueDecompose2dScale(t),n=i[0]*this.lineWidth/2,a=i[1]*this.lineWidth/2;s[0]-=n,s[1]-=a,s[2]+=n,s[3]+=a}return s}updateClipFromPath(){const e=$.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(e||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(e){this.clipBox=e,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(e=le.FILL,t=null){return $.intersect(this.clipBox,this.getPathBoundingBox(e,t))}}function nf(h,e){if(e instanceof ImageData){h.putImageData(e,0,0);return}const t=e.height,s=e.width,i=t%ke,n=(t-i)/ke,a=i===0?n:n+1,o=h.createImageData(s,ke);let l=0,c;const d=e.data,u=o.data;let f,g,m,y;if(e.kind===Tc.GRAYSCALE_1BPP){const w=d.byteLength,x=new Uint32Array(u.buffer,0,u.byteLength>>2),S=x.length,_=s+7>>3,C=4294967295,k=ye.isLittleEndian?4278190080:255;for(f=0;f<a;f++){for(m=f<n?ke:i,c=0,g=0;g<m;g++){const T=w-l;let P=0;const D=T>_?s:T*8-7,O=D&-8;let K=0,B=0;for(;P<O;P+=8)B=d[l++],x[c++]=B&128?C:k,x[c++]=B&64?C:k,x[c++]=B&32?C:k,x[c++]=B&16?C:k,x[c++]=B&8?C:k,x[c++]=B&4?C:k,x[c++]=B&2?C:k,x[c++]=B&1?C:k;for(;P<D;P++)K===0&&(B=d[l++],K=128),x[c++]=B&K?C:k,K>>=1}for(;c<S;)x[c++]=0;h.putImageData(o,0,f*ke)}}else if(e.kind===Tc.RGBA_32BPP){for(g=0,y=s*ke*4,f=0;f<n;f++)u.set(d.subarray(l,l+y)),l+=y,h.putImageData(o,0,g),g+=ke;f<a&&(y=s*i*4,u.set(d.subarray(l,l+y)),h.putImageData(o,0,g))}else if(e.kind===Tc.RGB_24BPP)for(m=ke,y=s*m,f=0;f<a;f++){for(f>=n&&(m=i,y=s*m),c=0,g=y;g--;)u[c++]=d[l++],u[c++]=d[l++],u[c++]=d[l++],u[c++]=255;h.putImageData(o,0,f*ke)}else throw new Error(`bad image kind: ${e.kind}`)}function rf(h,e){if(e.bitmap){h.drawImage(e.bitmap,0,0);return}const t=e.height,s=e.width,i=t%ke,n=(t-i)/ke,a=i===0?n:n+1,o=h.createImageData(s,ke);let l=0;const c=e.data,d=o.data;for(let u=0;u<a;u++){const f=u<n?ke:i;({srcPos:l}=ib({src:c,srcPos:l,dest:d,width:s,height:f,nonBlackColor:0})),h.putImageData(o,0,u*ke)}}function lo(h,e){const t=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const s of t)h[s]!==void 0&&(e[s]=h[s]);h.setLineDash!==void 0&&(e.setLineDash(h.getLineDash()),e.lineDashOffset=h.lineDashOffset)}function _c(h){if(h.strokeStyle=h.fillStyle="#000000",h.fillRule="nonzero",h.globalAlpha=1,h.lineWidth=1,h.lineCap="butt",h.lineJoin="miter",h.miterLimit=10,h.globalCompositeOperation="source-over",h.font="10px sans-serif",h.setLineDash!==void 0&&(h.setLineDash([]),h.lineDashOffset=0),!ce){const{filter:e}=h;e!=="none"&&e!==""&&(h.filter="none")}}function af(h,e){if(e)return!0;const t=$.singularValueDecompose2dScale(h);t[0]=Math.fround(t[0]),t[1]=Math.fround(t[1]);const s=Math.fround((globalThis.devicePixelRatio||1)*un.PDF_TO_CSS_UNITS);return t[0]<=s&&t[1]<=s}const lb=["butt","round","square"],cb=["miter","round","bevel"],hb={},of={};var Ss,kd,Td,Pd;const Lu=class Lu{constructor(e,t,s,i,n,{optionalContentConfig:a,markedContentStack:o=null},l,c){A(this,Ss);this.ctx=e,this.current=new sf(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=t,this.objs=s,this.canvasFactory=i,this.filterFactory=n,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=o||[],this.optionalContentConfig=a,this.cachedCanvases=new ab(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=l,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=c,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(e,t=null){return typeof e=="string"?e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e):t}beginDrawing({transform:e,viewport:t,transparency:s=!1,background:i=null}){const n=this.ctx.canvas.width,a=this.ctx.canvas.height,o=this.ctx.fillStyle;if(this.ctx.fillStyle=i||"#ffffff",this.ctx.fillRect(0,0,n,a),this.ctx.fillStyle=o,s){const l=this.cachedCanvases.getCanvas("transparent",n,a);this.compositeCtx=this.ctx,this.transparentCanvas=l.canvas,this.ctx=l.context,this.ctx.save(),this.ctx.transform(...vt(this.compositeCtx))}this.ctx.save(),_c(this.ctx),e&&(this.ctx.transform(...e),this.outputScaleX=e[0],this.outputScaleY=e[0]),this.ctx.transform(...t.transform),this.viewportScale=t.scale,this.baseTransform=vt(this.ctx)}executeOperatorList(e,t,s,i){const n=e.argsArray,a=e.fnArray;let o=t||0;const l=n.length;if(l===o)return o;const c=l-o>tf&&typeof s=="function",d=c?Date.now()+nb:0;let u=0;const f=this.commonObjs,g=this.objs;let m;for(;;){if(i!==void 0&&o===i.nextBreakPoint)return i.breakIt(o,s),o;if(m=a[o],m!==os.dependency)this[m].apply(this,n[o]);else for(const y of n[o]){const w=y.startsWith("g_")?f:g;if(!w.has(y))return w.get(y,s),o}if(o++,o===l)return o;if(c&&++u>tf){if(Date.now()>d)return s(),o;u=0}}}endDrawing(){v(this,Ss,kd).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const e of this._cachedBitmapsMap.values()){for(const t of e.values())typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement&&(t.width=t.height=0);e.clear()}this._cachedBitmapsMap.clear(),v(this,Ss,Td).call(this)}_scaleImage(e,t){const s=e.width??e.displayWidth,i=e.height??e.displayHeight;let n=Math.max(Math.hypot(t[0],t[1]),1),a=Math.max(Math.hypot(t[2],t[3]),1),o=s,l=i,c="prescale1",d,u;for(;n>2&&o>1||a>2&&l>1;){let f=o,g=l;n>2&&o>1&&(f=o>=16384?Math.floor(o/2)-1||1:Math.ceil(o/2),n/=o/f),a>2&&l>1&&(g=l>=16384?Math.floor(l/2)-1||1:Math.ceil(l)/2,a/=l/g),d=this.cachedCanvases.getCanvas(c,f,g),u=d.context,u.clearRect(0,0,f,g),u.drawImage(e,0,0,o,l,0,0,f,g),e=d.canvas,o=f,l=g,c=c==="prescale1"?"prescale2":"prescale1"}return{img:e,paintWidth:o,paintHeight:l}}_createMaskCanvas(e){const t=this.ctx,{width:s,height:i}=e,n=this.current.fillColor,a=this.current.patternFill,o=vt(t);let l,c,d,u;if((e.bitmap||e.data)&&e.count>1){const D=e.bitmap||e.data.buffer;c=JSON.stringify(a?o:[o.slice(0,4),n]),l=this._cachedBitmapsMap.get(D),l||(l=new Map,this._cachedBitmapsMap.set(D,l));const O=l.get(c);if(O&&!a){const K=Math.round(Math.min(o[0],o[2])+o[4]),B=Math.round(Math.min(o[1],o[3])+o[5]);return{canvas:O,offsetX:K,offsetY:B}}d=O}d||(u=this.cachedCanvases.getCanvas("maskCanvas",s,i),rf(u.context,e));let f=$.transform(o,[1/s,0,0,-1/i,0,0]);f=$.transform(f,[1,0,0,1,0,-i]);const[g,m,y,w]=$.getAxialAlignedBoundingBox([0,0,s,i],f),x=Math.round(y-g)||1,S=Math.round(w-m)||1,_=this.cachedCanvases.getCanvas("fillCanvas",x,S),C=_.context,k=g,T=m;C.translate(-k,-T),C.transform(...f),d||(d=this._scaleImage(u.canvas,Cs(C)),d=d.img,l&&a&&l.set(c,d)),C.imageSmoothingEnabled=af(vt(C),e.interpolate),Sc(C,d,0,0,d.width,d.height,0,0,s,i),C.globalCompositeOperation="source-in";const P=$.transform(Cs(C),[1,0,0,1,-k,-T]);return C.fillStyle=a?n.getPattern(t,this,P,le.FILL):n,C.fillRect(0,0,s,i),l&&!a&&(this.cachedCanvases.delete("fillCanvas"),l.set(c,_.canvas)),{canvas:_.canvas,offsetX:Math.round(k),offsetY:Math.round(T)}}setLineWidth(e){e!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=e,this.ctx.lineWidth=e}setLineCap(e){this.ctx.lineCap=lb[e]}setLineJoin(e){this.ctx.lineJoin=cb[e]}setMiterLimit(e){this.ctx.miterLimit=e}setDash(e,t){const s=this.ctx;s.setLineDash!==void 0&&(s.setLineDash(e),s.lineDashOffset=t)}setRenderingIntent(e){}setFlatness(e){}setGState(e){for(const[t,s]of e)switch(t){case"LW":this.setLineWidth(s);break;case"LC":this.setLineCap(s);break;case"LJ":this.setLineJoin(s);break;case"ML":this.setMiterLimit(s);break;case"D":this.setDash(s[0],s[1]);break;case"RI":this.setRenderingIntent(s);break;case"FL":this.setFlatness(s);break;case"Font":this.setFont(s[0],s[1]);break;case"CA":this.current.strokeAlpha=s;break;case"ca":this.current.fillAlpha=s,this.ctx.globalAlpha=s;break;case"BM":this.ctx.globalCompositeOperation=s;break;case"SMask":this.current.activeSMask=s?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(s);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const e=this.inSMaskMode;this.current.activeSMask&&!e?this.beginSMaskMode():!this.current.activeSMask&&e&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const e=this.ctx.canvas.width,t=this.ctx.canvas.height,s="smaskGroupAt"+this.groupLevel,i=this.cachedCanvases.getCanvas(s,e,t);this.suspendedCtx=this.ctx,this.ctx=i.context;const n=this.ctx;n.setTransform(...vt(this.suspendedCtx)),lo(this.suspendedCtx,n),rb(n,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),lo(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(e){if(!this.current.activeSMask)return;e?(e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.ceil(e[2]),e[3]=Math.ceil(e[3])):e=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const t=this.current.activeSMask,s=this.suspendedCtx;this.composeSMask(s,t,this.ctx,e),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(e,t,s,i){const n=i[0],a=i[1],o=i[2]-n,l=i[3]-a;o===0||l===0||(this.genericComposeSMask(t.context,s,o,l,t.subtype,t.backdrop,t.transferMap,n,a,t.offsetX,t.offsetY),e.save(),e.globalAlpha=1,e.globalCompositeOperation="source-over",e.setTransform(1,0,0,1,0,0),e.drawImage(s.canvas,0,0),e.restore())}genericComposeSMask(e,t,s,i,n,a,o,l,c,d,u){let f=e.canvas,g=l-d,m=c-u;if(a){const w=$.makeHexColor(...a);if(g<0||m<0||g+s>f.width||m+i>f.height){const x=this.cachedCanvases.getCanvas("maskExtension",s,i),S=x.context;S.drawImage(f,-g,-m),S.globalCompositeOperation="destination-atop",S.fillStyle=w,S.fillRect(0,0,s,i),S.globalCompositeOperation="source-over",f=x.canvas,g=m=0}else{e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0);const x=new Path2D;x.rect(g,m,s,i),e.clip(x),e.globalCompositeOperation="destination-atop",e.fillStyle=w,e.fillRect(g,m,s,i),e.restore()}}t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0),n==="Alpha"&&o?t.filter=this.filterFactory.addAlphaFilter(o):n==="Luminosity"&&(t.filter=this.filterFactory.addLuminosityFilter(o));const y=new Path2D;y.rect(l,c,s,i),t.clip(y),t.globalCompositeOperation="destination-in",t.drawImage(f,g,m,s,i,l,c,s,i),t.restore()}save(){this.inSMaskMode?(lo(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();const e=this.current;this.stateStack.push(e),this.current=e.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),lo(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(e,t,s,i,n,a){this.ctx.transform(e,t,s,i,n,a),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(e,t,s){const i=this.ctx,n=this.current;let a=n.x,o=n.y,l,c;const d=vt(i),u=d[0]===0&&d[3]===0||d[1]===0&&d[2]===0,f=u?s.slice(0):null;for(let g=0,m=0,y=e.length;g<y;g++)switch(e[g]|0){case os.rectangle:a=t[m++],o=t[m++];const w=t[m++],x=t[m++],S=a+w,_=o+x;i.moveTo(a,o),w===0||x===0?i.lineTo(S,_):(i.lineTo(S,o),i.lineTo(S,_),i.lineTo(a,_)),u||n.updateRectMinMax(d,[a,o,S,_]),i.closePath();break;case os.moveTo:a=t[m++],o=t[m++],i.moveTo(a,o),u||n.updatePathMinMax(d,a,o);break;case os.lineTo:a=t[m++],o=t[m++],i.lineTo(a,o),u||n.updatePathMinMax(d,a,o);break;case os.curveTo:l=a,c=o,a=t[m+4],o=t[m+5],i.bezierCurveTo(t[m],t[m+1],t[m+2],t[m+3],a,o),n.updateCurvePathMinMax(d,l,c,t[m],t[m+1],t[m+2],t[m+3],a,o,f),m+=6;break;case os.curveTo2:l=a,c=o,i.bezierCurveTo(a,o,t[m],t[m+1],t[m+2],t[m+3]),n.updateCurvePathMinMax(d,l,c,a,o,t[m],t[m+1],t[m+2],t[m+3],f),a=t[m+2],o=t[m+3],m+=4;break;case os.curveTo3:l=a,c=o,a=t[m+2],o=t[m+3],i.bezierCurveTo(t[m],t[m+1],a,o,a,o),n.updateCurvePathMinMax(d,l,c,t[m],t[m+1],a,o,a,o,f),m+=4;break;case os.closePath:i.closePath();break}u&&n.updateScalingPathMinMax(d,f),n.setCurrentPoint(a,o)}closePath(){this.ctx.closePath()}stroke(e=!0){const t=this.ctx,s=this.current.strokeColor;t.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof s=="object"&&(s!=null&&s.getPattern)?(t.save(),t.strokeStyle=s.getPattern(t,this,Cs(t),le.STROKE),this.rescaleAndStroke(!1),t.restore()):this.rescaleAndStroke(!0)),e&&this.consumePath(this.current.getClippedPathBoundingBox()),t.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(e=!0){const t=this.ctx,s=this.current.fillColor,i=this.current.patternFill;let n=!1;i&&(t.save(),t.fillStyle=s.getPattern(t,this,Cs(t),le.FILL),n=!0);const a=this.current.getClippedPathBoundingBox();this.contentVisible&&a!==null&&(this.pendingEOFill?(t.fill("evenodd"),this.pendingEOFill=!1):t.fill()),n&&t.restore(),e&&this.consumePath(a)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=hb}eoClip(){this.pendingClip=of}beginText(){this.current.textMatrix=wf,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const e=this.pendingTextPaths,t=this.ctx;if(e===void 0){t.beginPath();return}const s=new Path2D,i=t.getTransform().invertSelf();for(const{transform:n,x:a,y:o,fontSize:l,path:c}of e)s.addPath(c,new DOMMatrix(n).preMultiplySelf(i).translate(a,o).scale(l,-l));t.clip(s),t.beginPath(),delete this.pendingTextPaths}setCharSpacing(e){this.current.charSpacing=e}setWordSpacing(e){this.current.wordSpacing=e}setHScale(e){this.current.textHScale=e/100}setLeading(e){this.current.leading=-e}setFont(e,t){var d;const s=this.commonObjs.get(e),i=this.current;if(!s)throw new Error(`Can't find font for ${e}`);if(i.fontMatrix=s.fontMatrix||td,(i.fontMatrix[0]===0||i.fontMatrix[3]===0)&&Y("Invalid font matrix for font "+e),t<0?(t=-t,i.fontDirection=-1):i.fontDirection=1,this.current.font=s,this.current.fontSize=t,s.isType3Font)return;const n=s.loadedName||"sans-serif",a=((d=s.systemFontInfo)==null?void 0:d.css)||`"${n}", ${s.fallbackName}`;let o="normal";s.black?o="900":s.bold&&(o="bold");const l=s.italic?"italic":"normal";let c=t;t<Ju?c=Ju:t>Qu&&(c=Qu),this.current.fontSizeScale=t/c,this.ctx.font=`${l} ${o} ${c}px ${a}`}setTextRenderingMode(e){this.current.textRenderingMode=e}setTextRise(e){this.current.textRise=e}moveText(e,t){this.current.x=this.current.lineX+=e,this.current.y=this.current.lineY+=t}setLeadingMoveText(e,t){this.setLeading(-t),this.moveText(e,t)}setTextMatrix(e,t,s,i,n,a){this.current.textMatrix=[e,t,s,i,n,a],this.current.textMatrixScale=Math.hypot(e,t),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(e,t,s,i,n){const a=this.ctx,o=this.current,l=o.font,c=o.textRenderingMode,d=o.fontSize/o.fontSizeScale,u=c&ee.FILL_STROKE_MASK,f=!!(c&ee.ADD_TO_PATH_FLAG),g=o.patternFill&&!l.missingFile,m=o.patternStroke&&!l.missingFile;let y;if((l.disableFontFace||f||g||m)&&(y=l.getPathGenerator(this.commonObjs,e)),l.disableFontFace||g||m){if(a.save(),a.translate(t,s),a.scale(d,-d),u===ee.FILL||u===ee.FILL_STROKE)if(i){const w=a.getTransform();a.setTransform(...i),a.fill(v(this,Ss,Pd).call(this,y,w,i))}else a.fill(y);if(u===ee.STROKE||u===ee.FILL_STROKE)if(n){const w=a.getTransform();a.setTransform(...n),a.stroke(v(this,Ss,Pd).call(this,y,w,n))}else a.lineWidth/=d,a.stroke(y);a.restore()}else(u===ee.FILL||u===ee.FILL_STROKE)&&a.fillText(e,t,s),(u===ee.STROKE||u===ee.FILL_STROKE)&&a.strokeText(e,t,s);f&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:vt(a),x:t,y:s,fontSize:d,path:y})}get isFontSubpixelAAEnabled(){const{context:e}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);e.scale(1.5,1),e.fillText("I",0,10);const t=e.getImageData(0,0,10,10).data;let s=!1;for(let i=3;i<t.length;i+=4)if(t[i]>0&&t[i]<255){s=!0;break}return tt(this,"isFontSubpixelAAEnabled",s)}showText(e){const t=this.current,s=t.font;if(s.isType3Font)return this.showType3Text(e);const i=t.fontSize;if(i===0)return;const n=this.ctx,a=t.fontSizeScale,o=t.charSpacing,l=t.wordSpacing,c=t.fontDirection,d=t.textHScale*c,u=e.length,f=s.vertical,g=f?1:-1,m=s.defaultVMetrics,y=i*t.fontMatrix[0],w=t.textRenderingMode===ee.FILL&&!s.disableFontFace&&!t.patternFill;n.save(),n.transform(...t.textMatrix),n.translate(t.x,t.y+t.textRise),c>0?n.scale(d,-1):n.scale(d,1);let x,S;if(t.patternFill){n.save();const P=t.fillColor.getPattern(n,this,Cs(n),le.FILL);x=vt(n),n.restore(),n.fillStyle=P}if(t.patternStroke){n.save();const P=t.strokeColor.getPattern(n,this,Cs(n),le.STROKE);S=vt(n),n.restore(),n.strokeStyle=P}let _=t.lineWidth;const C=t.textMatrixScale;if(C===0||_===0){const P=t.textRenderingMode&ee.FILL_STROKE_MASK;(P===ee.STROKE||P===ee.FILL_STROKE)&&(_=this.getSinglePixelWidth())}else _/=C;if(a!==1&&(n.scale(a,a),_/=a),n.lineWidth=_,s.isInvalidPDFjsFont){const P=[];let D=0;for(const O of e)P.push(O.unicode),D+=O.width;n.fillText(P.join(""),0,0),t.x+=D*y*d,n.restore(),this.compose();return}let k=0,T;for(T=0;T<u;++T){const P=e[T];if(typeof P=="number"){k+=g*P*i/1e3;continue}let D=!1;const O=(P.isSpace?l:0)+o,K=P.fontChar,B=P.accent;let lt,gt,it=P.width;if(f){const R=P.vmetric||m,H=-(P.vmetric?R[1]:it*.5)*y,te=R[2]*y;it=R?-R[0]:it,lt=H/a,gt=(k+te)/a}else lt=k/a,gt=0;if(s.remeasure&&it>0){const R=n.measureText(K).width*1e3/i*a;if(it<R&&this.isFontSubpixelAAEnabled){const H=it/R;D=!0,n.save(),n.scale(H,1),lt/=H}else it!==R&&(lt+=(it-R)/2e3*i/a)}if(this.contentVisible&&(P.isInFont||s.missingFile)){if(w&&!B)n.fillText(K,lt,gt);else if(this.paintChar(K,lt,gt,x,S),B){const R=lt+i*B.offset.x/a,H=gt-i*B.offset.y/a;this.paintChar(B.fontChar,R,H,x,S)}}const xt=f?it*y-O*c:it*y+O*c;k+=xt,D&&n.restore()}f?t.y-=k:t.x+=k*d,n.restore(),this.compose()}showType3Text(e){const t=this.ctx,s=this.current,i=s.font,n=s.fontSize,a=s.fontDirection,o=i.vertical?1:-1,l=s.charSpacing,c=s.wordSpacing,d=s.textHScale*a,u=s.fontMatrix||td,f=e.length,g=s.textRenderingMode===ee.INVISIBLE;let m,y,w,x;if(!(g||n===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,t.save(),t.transform(...s.textMatrix),t.translate(s.x,s.y),t.scale(d,a),m=0;m<f;++m){if(y=e[m],typeof y=="number"){x=o*y*n/1e3,this.ctx.translate(x,0),s.x+=x*d;continue}const S=(y.isSpace?c:0)+l,_=i.charProcOperatorList[y.operatorListId];if(!_){Y(`Type3 character "${y.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=y,this.save(),t.scale(n,n),t.transform(...u),this.executeOperatorList(_),this.restore()),w=$.applyTransform([y.width,0],u)[0]*n+S,t.translate(w,0),s.x+=w*d}t.restore(),this.processingType3=null}}setCharWidth(e,t){}setCharWidthAndBounds(e,t,s,i,n,a){this.ctx.rect(s,i,n-s,a-i),this.ctx.clip(),this.endPath()}getColorN_Pattern(e){let t;if(e[0]==="TilingPattern"){const s=e[1],i=this.baseTransform||vt(this.ctx),n={createCanvasGraphics:a=>new Lu(a,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};t=new Cd(e,s,this.ctx,n,i)}else t=this._getPattern(e[1],e[2]);return t}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments),this.current.patternStroke=!0}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(e,t,s){this.ctx.strokeStyle=this.current.strokeColor=$.makeHexColor(e,t,s),this.current.patternStroke=!1}setStrokeTransparent(){this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(e,t,s){this.ctx.fillStyle=this.current.fillColor=$.makeHexColor(e,t,s),this.current.patternFill=!1}setFillTransparent(){this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(e,t=null){let s;return this.cachedPatterns.has(e)?s=this.cachedPatterns.get(e):(s=sb(this.getObject(e)),this.cachedPatterns.set(e,s)),t&&(s.matrix=t),s}shadingFill(e){if(!this.contentVisible)return;const t=this.ctx;this.save();const s=this._getPattern(e);t.fillStyle=s.getPattern(t,this,Cs(t),le.SHADING);const i=Cs(t);if(i){const{width:n,height:a}=t.canvas,[o,l,c,d]=$.getAxialAlignedBoundingBox([0,0,n,a],i);this.ctx.fillRect(o,l,c-o,d-l)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){pt("Should not call beginInlineImage")}beginImageData(){pt("Should not call beginImageData")}paintFormXObjectBegin(e,t){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),e&&this.transform(...e),this.baseTransform=vt(this.ctx),t)){const s=t[2]-t[0],i=t[3]-t[1];this.ctx.rect(t[0],t[1],s,i),this.current.updateRectMinMax(vt(this.ctx),t),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(e){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const t=this.ctx;e.isolated||Dh("TODO: Support non-isolated groups."),e.knockout&&Y("Knockout groups not supported.");const s=vt(t);if(e.matrix&&t.transform(...e.matrix),!e.bbox)throw new Error("Bounding box is required.");let i=$.getAxialAlignedBoundingBox(e.bbox,vt(t));const n=[0,0,t.canvas.width,t.canvas.height];i=$.intersect(i,n)||[0,0,0,0];const a=Math.floor(i[0]),o=Math.floor(i[1]),l=Math.max(Math.ceil(i[2])-a,1),c=Math.max(Math.ceil(i[3])-o,1);this.current.startNewPathAndClipBox([0,0,l,c]);let d="groupAt"+this.groupLevel;e.smask&&(d+="_smask_"+this.smaskCounter++%2);const u=this.cachedCanvases.getCanvas(d,l,c),f=u.context;f.translate(-a,-o),f.transform(...s),e.smask?this.smaskStack.push({canvas:u.canvas,context:f,offsetX:a,offsetY:o,subtype:e.smask.subtype,backdrop:e.smask.backdrop,transferMap:e.smask.transferMap||null,startTransformInverse:null}):(t.setTransform(1,0,0,1,0,0),t.translate(a,o),t.save()),lo(t,f),this.ctx=f,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(t),this.groupLevel++}endGroup(e){if(!this.contentVisible)return;this.groupLevel--;const t=this.ctx,s=this.groupStack.pop();if(this.ctx=s,this.ctx.imageSmoothingEnabled=!1,e.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const i=vt(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...i);const n=$.getAxialAlignedBoundingBox([0,0,t.canvas.width,t.canvas.height],i);this.ctx.drawImage(t.canvas,0,0),this.ctx.restore(),this.compose(n)}}beginAnnotation(e,t,s,i,n){if(v(this,Ss,kd).call(this),_c(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),t){const a=t[2]-t[0],o=t[3]-t[1];if(n&&this.annotationCanvasMap){s=s.slice(),s[4]-=t[0],s[5]-=t[1],t=t.slice(),t[0]=t[1]=0,t[2]=a,t[3]=o;const[l,c]=$.singularValueDecompose2dScale(vt(this.ctx)),{viewportScale:d}=this,u=Math.ceil(a*this.outputScaleX*d),f=Math.ceil(o*this.outputScaleY*d);this.annotationCanvas=this.canvasFactory.create(u,f);const{canvas:g,context:m}=this.annotationCanvas;this.annotationCanvasMap.set(e,g),this.annotationCanvas.savedCtx=this.ctx,this.ctx=m,this.ctx.save(),this.ctx.setTransform(l,0,0,-c,0,o*c),_c(this.ctx)}else _c(this.ctx),this.endPath(),this.ctx.rect(t[0],t[1],a,o),this.ctx.clip(),this.ctx.beginPath()}this.current=new sf(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...s),this.transform(...i)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),v(this,Ss,Td).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(e){if(!this.contentVisible)return;const t=e.count;e=this.getObject(e.data,e),e.count=t;const s=this.ctx,i=this.processingType3;if(i&&(i.compiled===void 0&&(i.compiled=ob(e)),i.compiled)){i.compiled(s);return}const n=this._createMaskCanvas(e),a=n.canvas;s.save(),s.setTransform(1,0,0,1,0,0),s.drawImage(a,n.offsetX,n.offsetY),s.restore(),this.compose()}paintImageMaskXObjectRepeat(e,t,s=0,i=0,n,a){if(!this.contentVisible)return;e=this.getObject(e.data,e);const o=this.ctx;o.save();const l=vt(o);o.transform(t,s,i,n,0,0);const c=this._createMaskCanvas(e);o.setTransform(1,0,0,1,c.offsetX-l[4],c.offsetY-l[5]);for(let d=0,u=a.length;d<u;d+=2){const f=$.transform(l,[t,s,i,n,a[d],a[d+1]]),[g,m]=$.applyTransform([0,0],f);o.drawImage(c.canvas,g,m)}o.restore(),this.compose()}paintImageMaskXObjectGroup(e){if(!this.contentVisible)return;const t=this.ctx,s=this.current.fillColor,i=this.current.patternFill;for(const n of e){const{data:a,width:o,height:l,transform:c}=n,d=this.cachedCanvases.getCanvas("maskCanvas",o,l),u=d.context;u.save();const f=this.getObject(a,n);rf(u,f),u.globalCompositeOperation="source-in",u.fillStyle=i?s.getPattern(u,this,Cs(t),le.FILL):s,u.fillRect(0,0,o,l),u.restore(),t.save(),t.transform(...c),t.scale(1,-1),Sc(t,d.canvas,0,0,o,l,0,-1,1,1),t.restore()}this.compose()}paintImageXObject(e){if(!this.contentVisible)return;const t=this.getObject(e);if(!t){Y("Dependent image isn't ready yet");return}this.paintInlineImageXObject(t)}paintImageXObjectRepeat(e,t,s,i){if(!this.contentVisible)return;const n=this.getObject(e);if(!n){Y("Dependent image isn't ready yet");return}const a=n.width,o=n.height,l=[];for(let c=0,d=i.length;c<d;c+=2)l.push({transform:[t,0,0,s,i[c],i[c+1]],x:0,y:0,w:a,h:o});this.paintInlineImageXObjectGroup(n,l)}applyTransferMapsToCanvas(e){return this.current.transferMaps!=="none"&&(e.filter=this.current.transferMaps,e.drawImage(e.canvas,0,0),e.filter="none"),e.canvas}applyTransferMapsToBitmap(e){if(this.current.transferMaps==="none")return e.bitmap;const{bitmap:t,width:s,height:i}=e,n=this.cachedCanvases.getCanvas("inlineImage",s,i),a=n.context;return a.filter=this.current.transferMaps,a.drawImage(t,0,0),a.filter="none",n.canvas}paintInlineImageXObject(e){if(!this.contentVisible)return;const t=e.width,s=e.height,i=this.ctx;if(this.save(),!ce){const{filter:o}=i;o!=="none"&&o!==""&&(i.filter="none")}i.scale(1/t,-1/s);let n;if(e.bitmap)n=this.applyTransferMapsToBitmap(e);else if(typeof HTMLElement=="function"&&e instanceof HTMLElement||!e.data)n=e;else{const l=this.cachedCanvases.getCanvas("inlineImage",t,s).context;nf(l,e),n=this.applyTransferMapsToCanvas(l)}const a=this._scaleImage(n,Cs(i));i.imageSmoothingEnabled=af(vt(i),e.interpolate),Sc(i,a.img,0,0,a.paintWidth,a.paintHeight,0,-s,t,s),this.compose(),this.restore()}paintInlineImageXObjectGroup(e,t){if(!this.contentVisible)return;const s=this.ctx;let i;if(e.bitmap)i=e.bitmap;else{const n=e.width,a=e.height,l=this.cachedCanvases.getCanvas("inlineImage",n,a).context;nf(l,e),i=this.applyTransferMapsToCanvas(l)}for(const n of t)s.save(),s.transform(...n.transform),s.scale(1,-1),Sc(s,i,n.x,n.y,n.w,n.h,0,-1,1,1),s.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(e){}markPointProps(e,t){}beginMarkedContent(e){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(e,t){e==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(t)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(e){const t=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(e);const s=this.ctx;this.pendingClip&&(t||(this.pendingClip===of?s.clip("evenodd"):s.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),s.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const e=vt(this.ctx);if(e[1]===0&&e[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(e[0]),Math.abs(e[3]));else{const t=Math.abs(e[0]*e[3]-e[2]*e[1]),s=Math.hypot(e[0],e[2]),i=Math.hypot(e[1],e[3]);this._cachedGetSinglePixelWidth=Math.max(s,i)/t}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:e}=this.current,{a:t,b:s,c:i,d:n}=this.ctx.getTransform();let a,o;if(s===0&&i===0){const l=Math.abs(t),c=Math.abs(n);if(l===c)if(e===0)a=o=1/l;else{const d=l*e;a=o=d<1?1/d:1}else if(e===0)a=1/l,o=1/c;else{const d=l*e,u=c*e;a=d<1?1/d:1,o=u<1?1/u:1}}else{const l=Math.abs(t*n-s*i),c=Math.hypot(t,s),d=Math.hypot(i,n);if(e===0)a=d/l,o=c/l;else{const u=e*l;a=d>u?d/u:1,o=c>u?c/u:1}}this._cachedScaleForStroking[0]=a,this._cachedScaleForStroking[1]=o}return this._cachedScaleForStroking}rescaleAndStroke(e){const{ctx:t}=this,{lineWidth:s}=this.current,[i,n]=this.getScaleForStroking();if(t.lineWidth=s||1,i===1&&n===1){t.stroke();return}const a=t.getLineDash();if(e&&t.save(),t.scale(i,n),a.length>0){const o=Math.max(i,n);t.setLineDash(a.map(l=>l/o)),t.lineDashOffset/=o}t.stroke(),e&&t.restore()}isContentVisible(){for(let e=this.markedContentStack.length-1;e>=0;e--)if(!this.markedContentStack[e].visible)return!1;return!0}};Ss=new WeakSet,kd=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},Td=function(){if(this.pageColors){const e=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(e!=="none"){const t=this.ctx.filter;this.ctx.filter=e,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=t}}},Pd=function(e,t,s){const i=new Path2D;return i.addPath(e,new DOMMatrix(s).invertSelf().multiplySelf(t)),i};let Xr=Lu;for(const h in os)Xr.prototype[h]!==void 0&&(Xr.prototype[os[h]]=Xr.prototype[h]);var ul,fl;class Si{static get workerPort(){return r(this,ul)}static set workerPort(e){if(!(typeof Worker<"u"&&e instanceof Worker)&&e!==null)throw new Error("Invalid `workerPort` type.");p(this,ul,e)}static get workerSrc(){return r(this,fl)}static set workerSrc(e){if(typeof e!="string")throw new Error("Invalid `workerSrc` type.");p(this,fl,e)}}ul=new WeakMap,fl=new WeakMap,A(Si,ul,null),A(Si,fl,"");var Yn,pl;class db{constructor({parsedData:e,rawData:t}){A(this,Yn);A(this,pl);p(this,Yn,e),p(this,pl,t)}getRaw(){return r(this,pl)}get(e){return r(this,Yn).get(e)??null}getAll(){return bu(r(this,Yn))}has(e){return r(this,Yn).has(e)}}Yn=new WeakMap,pl=new WeakMap;const Hr=Symbol("INTERNAL");var gl,ml,bl,fa;class ub{constructor(e,{name:t,intent:s,usage:i,rbGroups:n}){A(this,gl,!1);A(this,ml,!1);A(this,bl,!1);A(this,fa,!0);p(this,gl,!!(e&He.DISPLAY)),p(this,ml,!!(e&He.PRINT)),this.name=t,this.intent=s,this.usage=i,this.rbGroups=n}get visible(){if(r(this,bl))return r(this,fa);if(!r(this,fa))return!1;const{print:e,view:t}=this.usage;return r(this,gl)?(t==null?void 0:t.viewState)!=="OFF":r(this,ml)?(e==null?void 0:e.printState)!=="OFF":!0}_setVisible(e,t,s=!1){e!==Hr&&pt("Internal method `_setVisible` called."),p(this,bl,s),p(this,fa,t)}}gl=new WeakMap,ml=new WeakMap,bl=new WeakMap,fa=new WeakMap;var Wi,ht,pa,ga,yl,Ld;class fb{constructor(e,t=He.DISPLAY){A(this,yl);A(this,Wi,null);A(this,ht,new Map);A(this,pa,null);A(this,ga,null);if(this.renderingIntent=t,this.name=null,this.creator=null,e!==null){this.name=e.name,this.creator=e.creator,p(this,ga,e.order);for(const s of e.groups)r(this,ht).set(s.id,new ub(t,s));if(e.baseState==="OFF")for(const s of r(this,ht).values())s._setVisible(Hr,!1);for(const s of e.on)r(this,ht).get(s)._setVisible(Hr,!0);for(const s of e.off)r(this,ht).get(s)._setVisible(Hr,!1);p(this,pa,this.getHash())}}isVisible(e){if(r(this,ht).size===0)return!0;if(!e)return Dh("Optional content group not defined."),!0;if(e.type==="OCG")return r(this,ht).has(e.id)?r(this,ht).get(e.id).visible:(Y(`Optional content group not found: ${e.id}`),!0);if(e.type==="OCMD"){if(e.expression)return v(this,yl,Ld).call(this,e.expression);if(!e.policy||e.policy==="AnyOn"){for(const t of e.ids){if(!r(this,ht).has(t))return Y(`Optional content group not found: ${t}`),!0;if(r(this,ht).get(t).visible)return!0}return!1}else if(e.policy==="AllOn"){for(const t of e.ids){if(!r(this,ht).has(t))return Y(`Optional content group not found: ${t}`),!0;if(!r(this,ht).get(t).visible)return!1}return!0}else if(e.policy==="AnyOff"){for(const t of e.ids){if(!r(this,ht).has(t))return Y(`Optional content group not found: ${t}`),!0;if(!r(this,ht).get(t).visible)return!0}return!1}else if(e.policy==="AllOff"){for(const t of e.ids){if(!r(this,ht).has(t))return Y(`Optional content group not found: ${t}`),!0;if(r(this,ht).get(t).visible)return!1}return!0}return Y(`Unknown optional content policy ${e.policy}.`),!0}return Y(`Unknown group type ${e.type}.`),!0}setVisibility(e,t=!0,s=!0){var n;const i=r(this,ht).get(e);if(!i){Y(`Optional content group not found: ${e}`);return}if(s&&t&&i.rbGroups.length)for(const a of i.rbGroups)for(const o of a)o!==e&&((n=r(this,ht).get(o))==null||n._setVisible(Hr,!1,!0));i._setVisible(Hr,!!t,!0),p(this,Wi,null)}setOCGState({state:e,preserveRB:t}){let s;for(const i of e){switch(i){case"ON":case"OFF":case"Toggle":s=i;continue}const n=r(this,ht).get(i);if(n)switch(s){case"ON":this.setVisibility(i,!0,t);break;case"OFF":this.setVisibility(i,!1,t);break;case"Toggle":this.setVisibility(i,!n.visible,t);break}}p(this,Wi,null)}get hasInitialVisibility(){return r(this,pa)===null||this.getHash()===r(this,pa)}getOrder(){return r(this,ht).size?r(this,ga)?r(this,ga).slice():[...r(this,ht).keys()]:null}getGroups(){return r(this,ht).size>0?bu(r(this,ht)):null}getGroup(e){return r(this,ht).get(e)||null}getHash(){if(r(this,Wi)!==null)return r(this,Wi);const e=new Jf;for(const[t,s]of r(this,ht))e.update(`${t}:${s.visible}`);return p(this,Wi,e.hexdigest())}}Wi=new WeakMap,ht=new WeakMap,pa=new WeakMap,ga=new WeakMap,yl=new WeakSet,Ld=function(e){const t=e.length;if(t<2)return!0;const s=e[0];for(let i=1;i<t;i++){const n=e[i];let a;if(Array.isArray(n))a=v(this,yl,Ld).call(this,n);else if(r(this,ht).has(n))a=r(this,ht).get(n).visible;else return Y(`Optional content group not found: ${n}`),!0;switch(s){case"And":if(!a)return!1;break;case"Or":if(a)return!0;break;case"Not":return!a;default:return!0}}return s==="And"};class pb{constructor(e,{disableRange:t=!1,disableStream:s=!1}){It(e,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:i,initialData:n,progressiveDone:a,contentDispositionFilename:o}=e;if(this._queuedChunks=[],this._progressiveDone=a,this._contentDispositionFilename=o,(n==null?void 0:n.length)>0){const l=n instanceof Uint8Array&&n.byteLength===n.buffer.byteLength?n.buffer:new Uint8Array(n).buffer;this._queuedChunks.push(l)}this._pdfDataRangeTransport=e,this._isStreamingSupported=!s,this._isRangeSupported=!t,this._contentLength=i,this._fullRequestReader=null,this._rangeReaders=[],e.addRangeListener((l,c)=>{this._onReceiveData({begin:l,chunk:c})}),e.addProgressListener((l,c)=>{this._onProgress({loaded:l,total:c})}),e.addProgressiveReadListener(l=>{this._onReceiveData({chunk:l})}),e.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),e.transportReady()}_onReceiveData({begin:e,chunk:t}){const s=t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength?t.buffer:new Uint8Array(t).buffer;if(e===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(s):this._queuedChunks.push(s);else{const i=this._rangeReaders.some(function(n){return n._begin!==e?!1:(n._enqueue(s),!0)});It(i,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}_onProgress(e){var t,s,i,n;e.total===void 0?(s=(t=this._rangeReaders[0])==null?void 0:t.onProgress)==null||s.call(t,{loaded:e.loaded}):(n=(i=this._fullRequestReader)==null?void 0:i.onProgress)==null||n.call(i,{loaded:e.loaded,total:e.total})}_onProgressiveDone(){var e;(e=this._fullRequestReader)==null||e.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(e){const t=this._rangeReaders.indexOf(e);t>=0&&this._rangeReaders.splice(t,1)}getFullReader(){It(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const e=this._queuedChunks;return this._queuedChunks=null,new gb(this,e,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const s=new mb(this,e,t);return this._pdfDataRangeTransport.requestDataRange(e,t),this._rangeReaders.push(s),s}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const s of this._rangeReaders.slice(0))s.cancel(e);this._pdfDataRangeTransport.abort()}}class gb{constructor(e,t,s=!1,i=null){this._stream=e,this._done=s||!1,this._filename=vu(i)?i:null,this._queuedChunks=t||[],this._loaded=0;for(const n of this._queuedChunks)this._loaded+=n.byteLength;this._requests=[],this._headersReady=Promise.resolve(),e._fullRequestReader=this,this.onProgress=null}_enqueue(e){this._done||(this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunks.push(e),this._loaded+=e.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class mb{constructor(e,t,s){this._stream=e,this._begin=t,this._end=s,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(e){if(!this._done){if(this._requests.length===0)this._queuedChunk=e;else{this._requests.shift().resolve({value:e,done:!1});for(const s of this._requests)s.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function bb(h){let e=!0,t=s("filename\\*","i").exec(h);if(t){t=t[1];let d=o(t);return d=unescape(d),d=l(d),d=c(d),n(d)}if(t=a(h),t){const d=c(t);return n(d)}if(t=s("filename","i").exec(h),t){t=t[1];let d=o(t);return d=c(d),n(d)}function s(d,u){return new RegExp("(?:^|;)\\s*"+d+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',u)}function i(d,u){if(d){if(!/^[\x00-\xFF]+$/.test(u))return u;try{const f=new TextDecoder(d,{fatal:!0}),g=Nh(u);u=f.decode(g),e=!1}catch{}}return u}function n(d){return e&&/[\x80-\xff]/.test(d)&&(d=i("utf-8",d),e&&(d=i("iso-8859-1",d))),d}function a(d){const u=[];let f;const g=s("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(f=g.exec(d))!==null;){let[,y,w,x]=f;if(y=parseInt(y,10),y in u){if(y===0)break;continue}u[y]=[w,x]}const m=[];for(let y=0;y<u.length&&y in u;++y){let[w,x]=u[y];x=o(x),w&&(x=unescape(x),y===0&&(x=l(x))),m.push(x)}return m.join("")}function o(d){if(d.startsWith('"')){const u=d.slice(1).split('\\"');for(let f=0;f<u.length;++f){const g=u[f].indexOf('"');g!==-1&&(u[f]=u[f].slice(0,g),u.length=f+1),u[f]=u[f].replaceAll(/\\(.)/g,"$1")}d=u.join('"')}return d}function l(d){const u=d.indexOf("'");if(u===-1)return d;const f=d.slice(0,u),m=d.slice(u+1).replace(/^[^']*'/,"");return i(f,m)}function c(d){return!d.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(d)?d:d.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(u,f,g,m){if(g==="q"||g==="Q")return m=m.replaceAll("_"," "),m=m.replaceAll(/=([0-9a-fA-F]{2})/g,function(y,w){return String.fromCharCode(parseInt(w,16))}),i(f,m);try{m=atob(m)}catch{}return i(f,m)})}return""}function up(h,e){const t=new Headers;if(!h||!e||typeof e!="object")return t;for(const s in e){const i=e[s];i!==void 0&&t.append(s,i)}return t}function Oh(h){try{return new URL(h).origin}catch{}return null}function fp({responseHeaders:h,isHttp:e,rangeChunkSize:t,disableRange:s}){const i={allowRangeRequests:!1,suggestedLength:void 0},n=parseInt(h.get("Content-Length"),10);return!Number.isInteger(n)||(i.suggestedLength=n,n<=2*t)||s||!e||h.get("Accept-Ranges")!=="bytes"||(h.get("Content-Encoding")||"identity")!=="identity"||(i.allowRangeRequests=!0),i}function pp(h){const e=h.get("Content-Disposition");if(e){let t=bb(e);if(t.includes("%"))try{t=decodeURIComponent(t)}catch{}if(vu(t))return t}return null}function zh(h,e){return h===404||h===0&&e.startsWith("file:")?new Io('Missing PDF "'+e+'".'):new rh(`Unexpected server response (${h}) while retrieving PDF "${e}".`,h)}function gp(h){return h===200||h===206}function mp(h,e,t){return{method:"GET",headers:h,signal:t.signal,mode:"cors",credentials:e?"include":"same-origin",redirect:"follow"}}function bp(h){return h instanceof Uint8Array?h.buffer:h instanceof ArrayBuffer?h:(Y(`getArrayBuffer - unexpected data format: ${h}`),new Uint8Array(h).buffer)}class lf{constructor(e){U(this,"_responseOrigin",null);this.source=e,this.isHttp=/^https?:/i.test(e.url),this.headers=up(this.isHttp,e.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}getFullReader(){return It(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new yb(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const s=new Ab(this,e,t);return this._rangeRequestReaders.push(s),s}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const s of this._rangeRequestReaders.slice(0))s.cancel(e)}}class yb{constructor(e){this._stream=e,this._reader=null,this._loaded=0,this._filename=null;const t=e.source;this._withCredentials=t.withCredentials||!1,this._contentLength=t.length,this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange;const s=new Headers(e.headers),i=t.url;fetch(i,mp(s,this._withCredentials,this._abortController)).then(n=>{if(e._responseOrigin=Oh(n.url),!gp(n.status))throw zh(n.status,i);this._reader=n.body.getReader(),this._headersCapability.resolve();const a=n.headers,{allowRangeRequests:o,suggestedLength:l}=fp({responseHeaders:a,isHttp:e.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=o,this._contentLength=l||this._contentLength,this._filename=pp(a),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new dn("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var s;await this._headersCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,(s=this.onProgress)==null||s.call(this,{loaded:this._loaded,total:this._contentLength}),{value:bp(e),done:!1})}cancel(e){var t;(t=this._reader)==null||t.cancel(e),this._abortController.abort()}}class Ab{constructor(e,t,s){this._stream=e,this._reader=null,this._loaded=0;const i=e.source;this._withCredentials=i.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!i.disableStream,this._abortController=new AbortController;const n=new Headers(e.headers);n.append("Range",`bytes=${t}-${s-1}`);const a=i.url;fetch(a,mp(n,this._withCredentials,this._abortController)).then(o=>{const l=Oh(o.url);if(l!==e._responseOrigin)throw new Error(`Expected range response-origin "${l}" to match "${e._responseOrigin}".`);if(!gp(o.status))throw zh(o.status,a);this._readCapability.resolve(),this._reader=o.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){var s;await this._readCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,(s=this.onProgress)==null||s.call(this,{loaded:this._loaded}),{value:bp(e),done:!1})}cancel(e){var t;(t=this._reader)==null||t.cancel(e),this._abortController.abort()}}const Jh=200,Qh=206;function vb(h){const e=h.response;return typeof e!="string"?e:Nh(e).buffer}class wb{constructor({url:e,httpHeaders:t,withCredentials:s}){U(this,"_responseOrigin",null);this.url=e,this.isHttp=/^https?:/i.test(e),this.headers=up(this.isHttp,t),this.withCredentials=s||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(e){const t=new XMLHttpRequest,s=this.currXhrId++,i=this.pendingRequests[s]={xhr:t};t.open("GET",this.url),t.withCredentials=this.withCredentials;for(const[n,a]of this.headers)t.setRequestHeader(n,a);return this.isHttp&&"begin"in e&&"end"in e?(t.setRequestHeader("Range",`bytes=${e.begin}-${e.end-1}`),i.expectedStatus=Qh):i.expectedStatus=Jh,t.responseType="arraybuffer",It(e.onError,"Expected `onError` callback to be provided."),t.onerror=()=>{e.onError(t.status)},t.onreadystatechange=this.onStateChange.bind(this,s),t.onprogress=this.onProgress.bind(this,s),i.onHeadersReceived=e.onHeadersReceived,i.onDone=e.onDone,i.onError=e.onError,i.onProgress=e.onProgress,t.send(null),s}onProgress(e,t){var i;const s=this.pendingRequests[e];s&&((i=s.onProgress)==null||i.call(s,t))}onStateChange(e,t){const s=this.pendingRequests[e];if(!s)return;const i=s.xhr;if(i.readyState>=2&&s.onHeadersReceived&&(s.onHeadersReceived(),delete s.onHeadersReceived),i.readyState!==4||!(e in this.pendingRequests))return;if(delete this.pendingRequests[e],i.status===0&&this.isHttp){s.onError(i.status);return}const n=i.status||Jh;if(!(n===Jh&&s.expectedStatus===Qh)&&n!==s.expectedStatus){s.onError(i.status);return}const o=vb(i);if(n===Qh){const l=i.getResponseHeader("Content-Range"),c=/bytes (\d+)-(\d+)\/(\d+)/.exec(l);c?s.onDone({begin:parseInt(c[1],10),chunk:o}):(Y('Missing or invalid "Content-Range" header.'),s.onError(0))}else o?s.onDone({begin:0,chunk:o}):s.onError(i.status)}getRequestXhr(e){return this.pendingRequests[e].xhr}isPendingRequest(e){return e in this.pendingRequests}abortRequest(e){const t=this.pendingRequests[e].xhr;delete this.pendingRequests[e],t.abort()}}class xb{constructor(e){this._source=e,this._manager=new wb(e),this._rangeChunkSize=e.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(e){const t=this._rangeRequestReaders.indexOf(e);t>=0&&this._rangeRequestReaders.splice(t,1)}getFullReader(){return It(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new Sb(this._manager,this._source),this._fullRequestReader}getRangeReader(e,t){const s=new _b(this._manager,e,t);return s.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(s),s}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const s of this._rangeRequestReaders.slice(0))s.cancel(e)}}class Sb{constructor(e,t){this._manager=e,this._url=t.url,this._fullRequestId=e.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._contentLength=t.length,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const e=this._fullRequestId,t=this._manager.getRequestXhr(e);this._manager._responseOrigin=Oh(t.responseURL);const s=t.getAllResponseHeaders(),i=new Headers(s?s.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(o=>{const[l,...c]=o.split(": ");return[l,c.join(": ")]}):[]),{allowRangeRequests:n,suggestedLength:a}=fp({responseHeaders:i,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});n&&(this._isRangeSupported=!0),this._contentLength=a||this._contentLength,this._filename=pp(i),this._isRangeSupported&&this._manager.abortRequest(e),this._headersCapability.resolve()}_onDone(e){if(e&&(this._requests.length>0?this._requests.shift().resolve({value:e.chunk,done:!1}):this._cachedChunks.push(e.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(e){this._storedError=zh(e,this._url),this._headersCapability.reject(this._storedError);for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(e){var t;(t=this.onProgress)==null||t.call(this,{loaded:e.loaded,total:e.lengthComputable?e.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0,this._headersCapability.reject(e);for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class _b{constructor(e,t,s){this._manager=e,this._url=e.url,this._requestId=e.request({begin:t,end:s,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){var t;const e=Oh((t=this._manager.getRequestXhr(this._requestId))==null?void 0:t.responseURL);e!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${e}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){var e;(e=this.onClosed)==null||e.call(this,this)}_onDone(e){const t=e.chunk;this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunk=t,this._done=!0;for(const s of this._requests)s.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(e){this._storedError??(this._storedError=zh(e,this._url));for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(e){var t;this.isStreamingSupported||(t=this.onProgress)==null||t.call(this,{loaded:e.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const Eb=/^[a-z][a-z0-9\-+.]+:/i;function Cb(h){if(Eb.test(h))return new URL(h);const e=process.getBuiltinModule("url");return new URL(e.pathToFileURL(h))}class kb{constructor(e){this.source=e,this.url=Cb(e.url),It(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}getFullReader(){return It(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new Tb(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const s=new Pb(this,e,t);return this._rangeRequestReaders.push(s),s}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const s of this._rangeRequestReaders.slice(0))s.cancel(e)}}class Tb{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null;const t=e.source;this._contentLength=t.length,this._loaded=0,this._filename=null,this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();const s=process.getBuiltinModule("fs");s.promises.lstat(this._url).then(i=>{this._contentLength=i.size,this._setReadableStream(s.createReadStream(this._url)),this._headersCapability.resolve()},i=>{i.code==="ENOENT"&&(i=new Io(`Missing PDF "${this._url}".`)),this._storedError=i,this._headersCapability.reject(i)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var s;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,(s=this.onProgress)==null||s.call(this,{loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new dn("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class Pb{constructor(e,t,s){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const i=e.source;this._isStreamingSupported=!i.disableStream;const n=process.getBuiltinModule("fs");this._setReadableStream(n.createReadStream(this._url,{start:t,end:s-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){var s;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,(s=this.onProgress)==null||s.call(this,{loaded:this._loaded}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),this._storedError&&this._readableStream.destroy(this._storedError)}}const Lb=1e5,we=30,Mb=.8;var vf,Vi,Ee,Al,vl,Kn,oi,wl,xl,Zn,ma,ba,qi,ya,Sl,Aa,Jn,_l,El,Qn,tr,Cl,Xi,va,Ti,yp,Ap,Md,We,zc,Rd,vp,wp;const jt=class jt{constructor({textContentSource:e,container:t,viewport:s}){A(this,Ti);A(this,Vi,Promise.withResolvers());A(this,Ee,null);A(this,Al,!1);A(this,vl,!!((vf=globalThis.FontInspector)!=null&&vf.enabled));A(this,Kn,null);A(this,oi,null);A(this,wl,0);A(this,xl,0);A(this,Zn,null);A(this,ma,null);A(this,ba,0);A(this,qi,0);A(this,ya,Object.create(null));A(this,Sl,[]);A(this,Aa,null);A(this,Jn,[]);A(this,_l,new WeakMap);A(this,El,null);var l;if(e instanceof ReadableStream)p(this,Aa,e);else if(typeof e=="object")p(this,Aa,new ReadableStream({start(c){c.enqueue(e),c.close()}}));else throw new Error('No "textContentSource" parameter specified.');p(this,Ee,p(this,ma,t)),p(this,qi,s.scale*(globalThis.devicePixelRatio||1)),p(this,ba,s.rotation),p(this,oi,{div:null,properties:null,ctx:null});const{pageWidth:i,pageHeight:n,pageX:a,pageY:o}=s.rawDims;p(this,El,[1,0,0,-1,-a,o+n]),p(this,xl,i),p(this,wl,n),v(l=jt,We,vp).call(l),Lr(t,s),r(this,Vi).promise.finally(()=>{r(jt,va).delete(this),p(this,oi,null),p(this,ya,null)}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:e,isFirefox:t}=ye.platform;return tt(this,"fontFamilyMap",new Map([["sans-serif",`${e&&t?"Calibri, ":""}sans-serif`],["monospace",`${e&&t?"Lucida Console, ":""}monospace`]]))}render(){const e=()=>{r(this,Zn).read().then(({value:t,done:s})=>{if(s){r(this,Vi).resolve();return}r(this,Kn)??p(this,Kn,t.lang),Object.assign(r(this,ya),t.styles),v(this,Ti,yp).call(this,t.items),e()},r(this,Vi).reject)};return p(this,Zn,r(this,Aa).getReader()),r(jt,va).add(this),e(),r(this,Vi).promise}update({viewport:e,onBefore:t=null}){var n;const s=e.scale*(globalThis.devicePixelRatio||1),i=e.rotation;if(i!==r(this,ba)&&(t==null||t(),p(this,ba,i),Lr(r(this,ma),{rotation:i})),s!==r(this,qi)){t==null||t(),p(this,qi,s);const a={div:null,properties:null,ctx:v(n=jt,We,zc).call(n,r(this,Kn))};for(const o of r(this,Jn))a.properties=r(this,_l).get(o),a.div=o,v(this,Ti,Md).call(this,a)}}cancel(){var t;const e=new dn("TextLayer task cancelled.");(t=r(this,Zn))==null||t.cancel(e).catch(()=>{}),p(this,Zn,null),r(this,Vi).reject(e)}get textDivs(){return r(this,Jn)}get textContentItemsStr(){return r(this,Sl)}static cleanup(){if(!(r(this,va).size>0)){r(this,Qn).clear();for(const{canvas:e}of r(this,tr).values())e.remove();r(this,tr).clear()}}};Vi=new WeakMap,Ee=new WeakMap,Al=new WeakMap,vl=new WeakMap,Kn=new WeakMap,oi=new WeakMap,wl=new WeakMap,xl=new WeakMap,Zn=new WeakMap,ma=new WeakMap,ba=new WeakMap,qi=new WeakMap,ya=new WeakMap,Sl=new WeakMap,Aa=new WeakMap,Jn=new WeakMap,_l=new WeakMap,El=new WeakMap,Qn=new WeakMap,tr=new WeakMap,Cl=new WeakMap,Xi=new WeakMap,va=new WeakMap,Ti=new WeakSet,yp=function(e){var i,n;if(r(this,Al))return;(n=r(this,oi)).ctx??(n.ctx=v(i=jt,We,zc).call(i,r(this,Kn)));const t=r(this,Jn),s=r(this,Sl);for(const a of e){if(t.length>Lb){Y("Ignoring additional textDivs for performance reasons."),p(this,Al,!0);return}if(a.str===void 0){if(a.type==="beginMarkedContentProps"||a.type==="beginMarkedContent"){const o=r(this,Ee);p(this,Ee,document.createElement("span")),r(this,Ee).classList.add("markedContent"),a.id!==null&&r(this,Ee).setAttribute("id",`${a.id}`),o.append(r(this,Ee))}else a.type==="endMarkedContent"&&p(this,Ee,r(this,Ee).parentNode);continue}s.push(a.str),v(this,Ti,Ap).call(this,a)}},Ap=function(e){var y;const t=document.createElement("span"),s={angle:0,canvasWidth:0,hasText:e.str!=="",hasEOL:e.hasEOL,fontSize:0};r(this,Jn).push(t);const i=$.transform(r(this,El),e.transform);let n=Math.atan2(i[1],i[0]);const a=r(this,ya)[e.fontName];a.vertical&&(n+=Math.PI/2);let o=r(this,vl)&&a.fontSubstitution||a.fontFamily;o=jt.fontFamilyMap.get(o)||o;const l=Math.hypot(i[2],i[3]),c=l*v(y=jt,We,wp).call(y,o,r(this,Kn));let d,u;n===0?(d=i[4],u=i[5]-c):(d=i[4]+c*Math.sin(n),u=i[5]-c*Math.cos(n));const f="calc(var(--scale-factor)*",g=t.style;r(this,Ee)===r(this,ma)?(g.left=`${(100*d/r(this,xl)).toFixed(2)}%`,g.top=`${(100*u/r(this,wl)).toFixed(2)}%`):(g.left=`${f}${d.toFixed(2)}px)`,g.top=`${f}${u.toFixed(2)}px)`),g.fontSize=`${f}${(r(jt,Xi)*l).toFixed(2)}px)`,g.fontFamily=o,s.fontSize=l,t.setAttribute("role","presentation"),t.textContent=e.str,t.dir=e.dir,r(this,vl)&&(t.dataset.fontName=a.fontSubstitutionLoadedName||e.fontName),n!==0&&(s.angle=n*(180/Math.PI));let m=!1;if(e.str.length>1)m=!0;else if(e.str!==" "&&e.transform[0]!==e.transform[3]){const w=Math.abs(e.transform[0]),x=Math.abs(e.transform[3]);w!==x&&Math.max(w,x)/Math.min(w,x)>1.5&&(m=!0)}if(m&&(s.canvasWidth=a.vertical?e.height:e.width),r(this,_l).set(t,s),r(this,oi).div=t,r(this,oi).properties=s,v(this,Ti,Md).call(this,r(this,oi)),s.hasText&&r(this,Ee).append(t),s.hasEOL){const w=document.createElement("br");w.setAttribute("role","presentation"),r(this,Ee).append(w)}},Md=function(e){var o;const{div:t,properties:s,ctx:i}=e,{style:n}=t;let a="";if(r(jt,Xi)>1&&(a=`scale(${1/r(jt,Xi)})`),s.canvasWidth!==0&&s.hasText){const{fontFamily:l}=n,{canvasWidth:c,fontSize:d}=s;v(o=jt,We,Rd).call(o,i,d*r(this,qi),l);const{width:u}=i.measureText(t.textContent);u>0&&(a=`scaleX(${c*r(this,qi)/u}) ${a}`)}s.angle!==0&&(a=`rotate(${s.angle}deg) ${a}`),a.length>0&&(n.transform=a)},We=new WeakSet,zc=function(e=null){let t=r(this,tr).get(e||(e=""));if(!t){const s=document.createElement("canvas");s.className="hiddenCanvasElement",s.lang=e,document.body.append(s),t=s.getContext("2d",{alpha:!1,willReadFrequently:!0}),r(this,tr).set(e,t),r(this,Cl).set(t,{size:0,family:""})}return t},Rd=function(e,t,s){const i=r(this,Cl).get(e);t===i.size&&s===i.family||(e.font=`${t}px ${s}`,i.size=t,i.family=s)},vp=function(){if(r(this,Xi)!==null)return;const e=document.createElement("div");e.style.opacity=0,e.style.lineHeight=1,e.style.fontSize="1px",e.style.position="absolute",e.textContent="X",document.body.append(e),p(this,Xi,e.getBoundingClientRect().height),e.remove()},wp=function(e,t){const s=r(this,Qn).get(e);if(s)return s;const i=v(this,We,zc).call(this,t);i.canvas.width=i.canvas.height=we,v(this,We,Rd).call(this,i,we,e);const n=i.measureText("");let a=n.fontBoundingBoxAscent,o=Math.abs(n.fontBoundingBoxDescent);if(a){const d=a/(a+o);return r(this,Qn).set(e,d),i.canvas.width=i.canvas.height=0,d}i.strokeStyle="red",i.clearRect(0,0,we,we),i.strokeText("g",0,0);let l=i.getImageData(0,0,we,we).data;o=0;for(let d=l.length-1-3;d>=0;d-=4)if(l[d]>0){o=Math.ceil(d/4/we);break}i.clearRect(0,0,we,we),i.strokeText("A",0,we),l=i.getImageData(0,0,we,we).data,a=0;for(let d=0,u=l.length;d<u;d+=4)if(l[d]>0){a=we-Math.floor(d/4/we);break}i.canvas.width=i.canvas.height=0;const c=a?a/(a+o):Mb;return r(this,Qn).set(e,c),c},A(jt,We),A(jt,Qn,new Map),A(jt,tr,new Map),A(jt,Cl,new WeakMap),A(jt,Xi,null),A(jt,va,new Set);let Do=jt;class No{static textContent(e){const t=[],s={items:t,styles:Object.create(null)};function i(n){var l;if(!n)return;let a=null;const o=n.name;if(o==="#text")a=n.value;else if(No.shouldBuildText(o))(l=n==null?void 0:n.attributes)!=null&&l.textContent?a=n.attributes.textContent:n.value&&(a=n.value);else return;if(a!==null&&t.push({str:a}),!!n.children)for(const c of n.children)i(c)}return i(e),s}static shouldBuildText(e){return!(e==="textarea"||e==="input"||e==="option"||e==="select")}}const Rb=65536,Ib=100,Db=5e3,Nb=ce?Ym:Vm,Fb=ce?Km:ap,jb=ce?Xm:qm,Ob=ce?Zm:hp;function zb(h={}){typeof h=="string"||h instanceof URL?h={url:h}:(h instanceof ArrayBuffer||ArrayBuffer.isView(h))&&(h={data:h});const e=new Id,{docId:t}=e,s=h.url?$b(h.url):null,i=h.data?Bb(h.data):null,n=h.httpHeaders||null,a=h.withCredentials===!0,o=h.password??null,l=h.range instanceof xp?h.range:null,c=Number.isInteger(h.rangeChunkSize)&&h.rangeChunkSize>0?h.rangeChunkSize:Rb;let d=h.worker instanceof Yr?h.worker:null;const u=h.verbosity,f=typeof h.docBaseUrl=="string"&&!jh(h.docBaseUrl)?h.docBaseUrl:null,g=typeof h.cMapUrl=="string"?h.cMapUrl:null,m=h.cMapPacked!==!1,y=h.CMapReaderFactory||Fb,w=typeof h.standardFontDataUrl=="string"?h.standardFontDataUrl:null,x=h.StandardFontDataFactory||Ob,S=h.stopAtErrors!==!0,_=Number.isInteger(h.maxImageSize)&&h.maxImageSize>-1?h.maxImageSize:-1,C=h.isEvalSupported!==!1,k=typeof h.isOffscreenCanvasSupported=="boolean"?h.isOffscreenCanvasSupported:!ce,T=typeof h.isImageDecoderSupported=="boolean"?h.isImageDecoderSupported:!ce&&(ye.platform.isFirefox||!globalThis.chrome),P=Number.isInteger(h.canvasMaxAreaInBytes)?h.canvasMaxAreaInBytes:-1,D=typeof h.disableFontFace=="boolean"?h.disableFontFace:ce,O=h.fontExtraProperties===!0,K=h.enableXfa===!0,B=h.ownerDocument||globalThis.document,lt=h.disableRange===!0,gt=h.disableStream===!0,it=h.disableAutoFetch===!0,xt=h.pdfBug===!0,R=h.CanvasFactory||Nb,H=h.FilterFactory||jb,te=h.enableHWA===!0,Te=l?l.length:h.length??NaN,Ve=typeof h.useSystemFonts=="boolean"?h.useSystemFonts:!ce&&!D,he=typeof h.useWorkerFetch=="boolean"?h.useWorkerFetch:y===ap&&x===hp&&g&&w&&fo(g,document.baseURI)&&fo(w,document.baseURI),Nt=null;_m(u);const Ct={canvasFactory:new R({ownerDocument:B,enableHWA:te}),filterFactory:new H({docId:t,ownerDocument:B}),cMapReaderFactory:he?null:new y({baseUrl:g,isCompressed:m}),standardFontDataFactory:he?null:new x({baseUrl:w})};if(!d){const Mt={verbosity:u,port:Si.workerPort};d=Mt.port?Yr.fromPort(Mt):new Yr(Mt),e._worker=d}const mt={docId:t,apiVersion:"4.10.38",data:i,password:o,disableAutoFetch:it,rangeChunkSize:c,length:Te,docBaseUrl:f,enableXfa:K,evaluatorOptions:{maxImageSize:_,disableFontFace:D,ignoreErrors:S,isEvalSupported:C,isOffscreenCanvasSupported:k,isImageDecoderSupported:T,canvasMaxAreaInBytes:P,fontExtraProperties:O,useSystemFonts:Ve,cMapUrl:he?g:null,standardFontDataUrl:he?w:null}},Pi={disableFontFace:D,fontExtraProperties:O,ownerDocument:B,pdfBug:xt,styleElement:Nt,loadingParams:{disableAutoFetch:it,enableXfa:K}};return d.promise.then(function(){if(e.destroyed)throw new Error("Loading aborted");if(d.destroyed)throw new Error("Worker was destroyed");const Mt=d.messageHandler.sendWithPromise("GetDocRequest",mt,i?[i.buffer]:null);let dt;if(l)dt=new pb(l,{disableRange:lt,disableStream:gt});else if(!i){if(!s)throw new Error("getDocument - no `url` parameter provided.");let _s;if(ce)if(fo(s)){if(typeof fetch>"u"||typeof Response>"u"||!("body"in Response.prototype))throw new Error("getDocument - the Fetch API was disabled in Node.js, see `--no-experimental-fetch`.");_s=lf}else _s=kb;else _s=fo(s)?lf:xb;dt=new _s({url:s,length:Te,httpHeaders:n,withCredentials:a,rangeChunkSize:c,disableRange:lt,disableStream:gt})}return Mt.then(_s=>{if(e.destroyed)throw new Error("Loading aborted");if(d.destroyed)throw new Error("Worker was destroyed");const so=new bo(t,_s,d.port),gc=new Wb(so,e,dt,Pi,Ct);e._transport=gc,so.send("Ready",null)})}).catch(e._capability.reject),e}function $b(h){if(h instanceof URL)return h.href;try{return new URL(h,window.location).href}catch{if(ce&&typeof h=="string")return h}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function Bb(h){if(ce&&typeof Buffer<"u"&&h instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(h instanceof Uint8Array&&h.byteLength===h.buffer.byteLength)return h;if(typeof h=="string")return Nh(h);if(h instanceof ArrayBuffer||ArrayBuffer.isView(h)||typeof h=="object"&&!isNaN(h==null?void 0:h.length))return new Uint8Array(h);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function cf(h){return typeof h=="object"&&Number.isInteger(h==null?void 0:h.num)&&h.num>=0&&Number.isInteger(h==null?void 0:h.gen)&&h.gen>=0}var wh;const xh=class xh{constructor(){this._capability=Promise.withResolvers(),this._transport=null,this._worker=null,this.docId=`d${de(xh,wh)._++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){var e,t,s,i;this.destroyed=!0;try{(e=this._worker)!=null&&e.port&&(this._worker._pendingDestroy=!0),await((t=this._transport)==null?void 0:t.destroy())}catch(n){throw(s=this._worker)!=null&&s.port&&delete this._worker._pendingDestroy,n}this._transport=null,(i=this._worker)==null||i.destroy(),this._worker=null}};wh=new WeakMap,A(xh,wh,0);let Id=xh;class xp{constructor(e,t,s=!1,i=null){this.length=e,this.initialData=t,this.progressiveDone=s,this.contentDispositionFilename=i,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=Promise.withResolvers()}addRangeListener(e){this._rangeListeners.push(e)}addProgressListener(e){this._progressListeners.push(e)}addProgressiveReadListener(e){this._progressiveReadListeners.push(e)}addProgressiveDoneListener(e){this._progressiveDoneListeners.push(e)}onDataRange(e,t){for(const s of this._rangeListeners)s(e,t)}onDataProgress(e,t){this._readyCapability.promise.then(()=>{for(const s of this._progressListeners)s(e,t)})}onDataProgressiveRead(e){this._readyCapability.promise.then(()=>{for(const t of this._progressiveReadListeners)t(e)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(const e of this._progressiveDoneListeners)e()})}transportReady(){this._readyCapability.resolve()}requestDataRange(e,t){pt("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}class Hb{constructor(e,t){this._pdfInfo=e,this._transport=t}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return tt(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(e){return this._transport.getPage(e)}getPageIndex(e){return this._transport.getPageIndex(e)}getDestinations(){return this._transport.getDestinations()}getDestination(e){return this._transport.getDestination(e)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getOptionalContentConfig(t)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(e=!1){return this._transport.startCleanup(e||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(e){return this._transport.cachedPageNumber(e)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}var Yi,li,ss,Ur,$c;class Ub{constructor(e,t,s,i=!1){A(this,ss);A(this,Yi,null);A(this,li,!1);this._pageIndex=e,this._pageInfo=t,this._transport=s,this._stats=i?new Xu:null,this._pdfBug=i,this.commonObjs=s.commonObjs,this.objs=new Sp,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:e,rotation:t=this.rotate,offsetX:s=0,offsetY:i=0,dontFlip:n=!1}={}){return new cc({viewBox:this.view,userUnit:this.userUnit,scale:e,rotation:t,offsetX:s,offsetY:i,dontFlip:n})}getAnnotations({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getAnnotations(this._pageIndex,t)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return tt(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){var e;return((e=this._transport._htmlForXfa)==null?void 0:e.children[this._pageIndex])||null}render({canvasContext:e,viewport:t,intent:s="display",annotationMode:i=Ri.ENABLE,transform:n=null,background:a=null,optionalContentConfigPromise:o=null,annotationCanvasMap:l=null,pageColors:c=null,printAnnotationStorage:d=null,isEditing:u=!1}){var C,k;(C=this._stats)==null||C.time("Overall");const f=this._transport.getRenderingIntent(s,i,d,u),{renderingIntent:g,cacheKey:m}=f;p(this,li,!1),v(this,ss,$c).call(this),o||(o=this._transport.getOptionalContentConfig(g));let y=this._intentStates.get(m);y||(y=Object.create(null),this._intentStates.set(m,y)),y.streamReaderCancelTimeout&&(clearTimeout(y.streamReaderCancelTimeout),y.streamReaderCancelTimeout=null);const w=!!(g&He.PRINT);y.displayReadyCapability||(y.displayReadyCapability=Promise.withResolvers(),y.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(k=this._stats)==null||k.time("Page Request"),this._pumpOperatorList(f));const x=T=>{var P;y.renderTasks.delete(S),(this._maybeCleanupAfterRender||w)&&p(this,li,!0),v(this,ss,Ur).call(this,!w),T?(S.capability.reject(T),this._abortOperatorList({intentState:y,reason:T instanceof Error?T:new Error(T)})):S.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),(P=globalThis.Stats)!=null&&P.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},S=new Nd({callback:x,params:{canvasContext:e,viewport:t,transform:n,background:a},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:l,operatorList:y.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!w,pdfBug:this._pdfBug,pageColors:c});(y.renderTasks||(y.renderTasks=new Set)).add(S);const _=S.task;return Promise.all([y.displayReadyCapability.promise,o]).then(([T,P])=>{var D;if(this.destroyed){x();return}if((D=this._stats)==null||D.time("Rendering"),!(P.renderingIntent&g))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");S.initializeGraphics({transparency:T,optionalContentConfig:P}),S.operatorListChanged()}).catch(x),_}getOperatorList({intent:e="display",annotationMode:t=Ri.ENABLE,printAnnotationStorage:s=null,isEditing:i=!1}={}){var c;function n(){o.operatorList.lastChunk&&(o.opListReadCapability.resolve(o.operatorList),o.renderTasks.delete(l))}const a=this._transport.getRenderingIntent(e,t,s,i,!0);let o=this._intentStates.get(a.cacheKey);o||(o=Object.create(null),this._intentStates.set(a.cacheKey,o));let l;return o.opListReadCapability||(l=Object.create(null),l.operatorListChanged=n,o.opListReadCapability=Promise.withResolvers(),(o.renderTasks||(o.renderTasks=new Set)).add(l),o.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(c=this._stats)==null||c.time("Page Request"),this._pumpOperatorList(a)),o.opListReadCapability.promise}streamTextContent({includeMarkedContent:e=!1,disableNormalization:t=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:e===!0,disableNormalization:t===!0},{highWaterMark:100,size(i){return i.items.length}})}getTextContent(e={}){if(this._transport._htmlForXfa)return this.getXfa().then(s=>No.textContent(s));const t=this.streamTextContent(e);return new Promise(function(s,i){function n(){a.read().then(function({value:l,done:c}){if(c){s(o);return}o.lang??(o.lang=l.lang),Object.assign(o.styles,l.styles),o.items.push(...l.items),n()},i)}const a=t.getReader(),o={items:[],styles:Object.create(null),lang:null};n()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const e=[];for(const t of this._intentStates.values())if(this._abortOperatorList({intentState:t,reason:new Error("Page was destroyed."),force:!0}),!t.opListReadCapability)for(const s of t.renderTasks)e.push(s.completed),s.cancel();return this.objs.clear(),p(this,li,!1),v(this,ss,$c).call(this),Promise.all(e)}cleanup(e=!1){p(this,li,!0);const t=v(this,ss,Ur).call(this,!1);return e&&t&&this._stats&&(this._stats=new Xu),t}_startRenderPage(e,t){var i,n;const s=this._intentStates.get(t);s&&((i=this._stats)==null||i.timeEnd("Page Request"),(n=s.displayReadyCapability)==null||n.resolve(e))}_renderPageChunk(e,t){for(let s=0,i=e.length;s<i;s++)t.operatorList.fnArray.push(e.fnArray[s]),t.operatorList.argsArray.push(e.argsArray[s]);t.operatorList.lastChunk=e.lastChunk,t.operatorList.separateAnnots=e.separateAnnots;for(const s of t.renderTasks)s.operatorListChanged();e.lastChunk&&v(this,ss,Ur).call(this,!0)}_pumpOperatorList({renderingIntent:e,cacheKey:t,annotationStorageSerializable:s,modifiedIds:i}){const{map:n,transfer:a}=s,l=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:e,cacheKey:t,annotationStorage:n,modifiedIds:i},a).getReader(),c=this._intentStates.get(t);c.streamReader=l;const d=()=>{l.read().then(({value:u,done:f})=>{if(f){c.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(u,c),d())},u=>{if(c.streamReader=null,!this._transport.destroyed){if(c.operatorList){c.operatorList.lastChunk=!0;for(const f of c.renderTasks)f.operatorListChanged();v(this,ss,Ur).call(this,!0)}if(c.displayReadyCapability)c.displayReadyCapability.reject(u);else if(c.opListReadCapability)c.opListReadCapability.reject(u);else throw u}})};d()}_abortOperatorList({intentState:e,reason:t,force:s=!1}){if(e.streamReader){if(e.streamReaderCancelTimeout&&(clearTimeout(e.streamReaderCancelTimeout),e.streamReaderCancelTimeout=null),!s){if(e.renderTasks.size>0)return;if(t instanceof Au){let i=Ib;t.extraDelay>0&&t.extraDelay<1e3&&(i+=t.extraDelay),e.streamReaderCancelTimeout=setTimeout(()=>{e.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:e,reason:t,force:!0})},i);return}}if(e.streamReader.cancel(new dn(t.message)).catch(()=>{}),e.streamReader=null,!this._transport.destroyed){for(const[i,n]of this._intentStates)if(n===e){this._intentStates.delete(i);break}this.cleanup()}}}get stats(){return this._stats}}Yi=new WeakMap,li=new WeakMap,ss=new WeakSet,Ur=function(e=!1){if(v(this,ss,$c).call(this),!r(this,li)||this.destroyed)return!1;if(e)return p(this,Yi,setTimeout(()=>{p(this,Yi,null),v(this,ss,Ur).call(this,!1)},Db)),!1;for(const{renderTasks:t,operatorList:s}of this._intentStates.values())if(t.size>0||!s.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),p(this,li,!1),!0},$c=function(){r(this,Yi)&&(clearTimeout(r(this,Yi)),p(this,Yi,null))};var ci,Sh;class Gb{constructor(){A(this,ci,new Map);A(this,Sh,Promise.resolve())}postMessage(e,t){const s={data:structuredClone(e,t?{transfer:t}:null)};r(this,Sh).then(()=>{for(const[i]of r(this,ci))i.call(this,s)})}addEventListener(e,t,s=null){let i=null;if((s==null?void 0:s.signal)instanceof AbortSignal){const{signal:n}=s;if(n.aborted){Y("LoopbackPort - cannot use an `aborted` signal.");return}const a=()=>this.removeEventListener(e,t);i=()=>n.removeEventListener("abort",a),n.addEventListener("abort",a)}r(this,ci).set(t,i)}removeEventListener(e,t){const s=r(this,ci).get(t);s==null||s(),r(this,ci).delete(t)}terminate(){for(const[,e]of r(this,ci))e==null||e();r(this,ci).clear()}}ci=new WeakMap,Sh=new WeakMap;var _h,er,sr,wa,Bc,xa,Hc;const At=class At{constructor({name:e=null,port:t=null,verbosity:s=Em()}={}){A(this,wa);var i;if(this.name=e,this.destroyed=!1,this.verbosity=s,this._readyCapability=Promise.withResolvers(),this._port=null,this._webWorker=null,this._messageHandler=null,t){if((i=r(At,sr))!=null&&i.has(t))throw new Error("Cannot use more than one PDFWorker per port.");(r(At,sr)||p(At,sr,new WeakMap)).set(t,this),this._initializeFromPort(t);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(e){this._port=e,this._messageHandler=new bo("main","worker",e),this._messageHandler.on("ready",function(){}),v(this,wa,Bc).call(this)}_initialize(){if(r(At,er)||r(At,xa,Hc)){this._setupFakeWorker();return}let{workerSrc:e}=At;try{At._isSameOrigin(window.location.href,e)||(e=At._createCDNWrapper(new URL(e,window.location).href));const t=new Worker(e,{type:"module"}),s=new bo("main","worker",t),i=()=>{n.abort(),s.destroy(),t.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},n=new AbortController;t.addEventListener("error",()=>{this._webWorker||i()},{signal:n.signal}),s.on("test",o=>{if(n.abort(),this.destroyed||!o){i();return}this._messageHandler=s,this._port=t,this._webWorker=t,v(this,wa,Bc).call(this)}),s.on("ready",o=>{if(n.abort(),this.destroyed){i();return}try{a()}catch{this._setupFakeWorker()}});const a=()=>{const o=new Uint8Array;s.send("test",o,[o.buffer])};a();return}catch{Dh("The worker has been disabled.")}this._setupFakeWorker()}_setupFakeWorker(){r(At,er)||(Y("Setting up fake worker."),p(At,er,!0)),At._setupFakeWorkerGlobal.then(e=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}const t=new Gb;this._port=t;const s=`fake${de(At,_h)._++}`,i=new bo(s+"_worker",s,t);e.setup(i,t),this._messageHandler=new bo(s,s+"_worker",t),v(this,wa,Bc).call(this)}).catch(e=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${e.message}".`))})}destroy(){var e,t,s;this.destroyed=!0,(e=this._webWorker)==null||e.terminate(),this._webWorker=null,(t=r(At,sr))==null||t.delete(this._port),this._port=null,(s=this._messageHandler)==null||s.destroy(),this._messageHandler=null}static fromPort(e){var s;if(!(e!=null&&e.port))throw new Error("PDFWorker.fromPort - invalid method signature.");const t=(s=r(this,sr))==null?void 0:s.get(e.port);if(t){if(t._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return t}return new At(e)}static get workerSrc(){if(Si.workerSrc)return Si.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return tt(this,"_setupFakeWorkerGlobal",(async()=>r(this,xa,Hc)?r(this,xa,Hc):(await import(this.workerSrc)).WorkerMessageHandler)())}};_h=new WeakMap,er=new WeakMap,sr=new WeakMap,wa=new WeakSet,Bc=function(){this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})},xa=new WeakSet,Hc=function(){var e;try{return((e=globalThis.pdfjsWorker)==null?void 0:e.WorkerMessageHandler)||null}catch{return null}},A(At,xa),A(At,_h,0),A(At,er,!1),A(At,sr),ce&&(p(At,er,!0),Si.workerSrc||(Si.workerSrc="./pdf.worker.mjs")),At._isSameOrigin=(e,t)=>{let s;try{if(s=new URL(e),!s.origin||s.origin==="null")return!1}catch{return!1}const i=new URL(t,s);return s.origin===i.origin},At._createCDNWrapper=e=>{const t=`await import("${e}");`;return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))};let Yr=At;var hi,Os,Sa,_a,di,ir,xo;class Wb{constructor(e,t,s,i,n){A(this,ir);A(this,hi,new Map);A(this,Os,new Map);A(this,Sa,new Map);A(this,_a,new Map);A(this,di,null);this.messageHandler=e,this.loadingTask=t,this.commonObjs=new Sp,this.fontLoader=new Gm({ownerDocument:i.ownerDocument,styleElement:i.styleElement}),this.loadingParams=i.loadingParams,this._params=i,this.canvasFactory=n.canvasFactory,this.filterFactory=n.filterFactory,this.cMapReaderFactory=n.cMapReaderFactory,this.standardFontDataFactory=n.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=s,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.setupMessageHandler()}get annotationStorage(){return tt(this,"annotationStorage",new Su)}getRenderingIntent(e,t=Ri.ENABLE,s=null,i=!1,n=!1){let a=He.DISPLAY,o=xd;switch(e){case"any":a=He.ANY;break;case"display":break;case"print":a=He.PRINT;break;default:Y(`getRenderingIntent - invalid intent: ${e}`)}const l=a&He.PRINT&&s instanceof tp?s:this.annotationStorage;switch(t){case Ri.DISABLE:a+=He.ANNOTATIONS_DISABLE;break;case Ri.ENABLE:break;case Ri.ENABLE_FORMS:a+=He.ANNOTATIONS_FORMS;break;case Ri.ENABLE_STORAGE:a+=He.ANNOTATIONS_STORAGE,o=l.serializable;break;default:Y(`getRenderingIntent - invalid annotationMode: ${t}`)}i&&(a+=He.IS_EDITING),n&&(a+=He.OPLIST);const{ids:c,hash:d}=l.modifiedIds,u=[a,o.hash,d];return{renderingIntent:a,cacheKey:u.join("_"),annotationStorageSerializable:o,modifiedIds:c}}destroy(){var s;if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),(s=r(this,di))==null||s.reject(new Error("Worker was destroyed during onPassword callback"));const e=[];for(const i of r(this,Os).values())e.push(i._destroy());r(this,Os).clear(),r(this,Sa).clear(),r(this,_a).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const t=this.messageHandler.sendWithPromise("Terminate",null);return e.push(t),Promise.all(e).then(()=>{var i,n;this.commonObjs.clear(),this.fontLoader.clear(),r(this,hi).clear(),this.filterFactory.destroy(),Do.cleanup(),(i=this._networkStream)==null||i.cancelAllRequests(new dn("Worker was terminated.")),(n=this.messageHandler)==null||n.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:e,loadingTask:t}=this;e.on("GetReader",(s,i)=>{It(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=n=>{this._lastProgress={loaded:n.loaded,total:n.total}},i.onPull=()=>{this._fullReader.read().then(function({value:n,done:a}){if(a){i.close();return}It(n instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(n),1,[n])}).catch(n=>{i.error(n)})},i.onCancel=n=>{this._fullReader.cancel(n),i.ready.catch(a=>{if(!this.destroyed)throw a})}}),e.on("ReaderHeadersReady",async s=>{var o;await this._fullReader.headersReady;const{isStreamingSupported:i,isRangeSupported:n,contentLength:a}=this._fullReader;return(!i||!n)&&(this._lastProgress&&((o=t.onProgress)==null||o.call(t,this._lastProgress)),this._fullReader.onProgress=l=>{var c;(c=t.onProgress)==null||c.call(t,{loaded:l.loaded,total:l.total})}),{isStreamingSupported:i,isRangeSupported:n,contentLength:a}}),e.on("GetRangeReader",(s,i)=>{It(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const n=this._networkStream.getRangeReader(s.begin,s.end);if(!n){i.close();return}i.onPull=()=>{n.read().then(function({value:a,done:o}){if(o){i.close();return}It(a instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(a),1,[a])}).catch(a=>{i.error(a)})},i.onCancel=a=>{n.cancel(a),i.ready.catch(o=>{if(!this.destroyed)throw o})}}),e.on("GetDoc",({pdfInfo:s})=>{this._numPages=s.numPages,this._htmlForXfa=s.htmlForXfa,delete s.htmlForXfa,t._capability.resolve(new Hb(s,this))}),e.on("DocException",s=>{t._capability.reject(xe(s))}),e.on("PasswordRequest",s=>{p(this,di,Promise.withResolvers());try{if(!t.onPassword)throw xe(s);const i=n=>{n instanceof Error?r(this,di).reject(n):r(this,di).resolve({password:n})};t.onPassword(i,s.code)}catch(i){r(this,di).reject(i)}return r(this,di).promise}),e.on("DataLoaded",s=>{var i;(i=t.onProgress)==null||i.call(t,{loaded:s.length,total:s.length}),this.downloadInfoCapability.resolve(s)}),e.on("StartRenderPage",s=>{if(this.destroyed)return;r(this,Os).get(s.pageIndex)._startRenderPage(s.transparency,s.cacheKey)}),e.on("commonobj",([s,i,n])=>{var a;if(this.destroyed||this.commonObjs.has(s))return null;switch(i){case"Font":const{disableFontFace:o,fontExtraProperties:l,pdfBug:c}=this._params;if("error"in n){const g=n.error;Y(`Error during font loading: ${g}`),this.commonObjs.resolve(s,g);break}const d=c&&((a=globalThis.FontInspector)!=null&&a.enabled)?(g,m)=>globalThis.FontInspector.fontAdded(g,m):null,u=new Wm(n,{disableFontFace:o,fontExtraProperties:l,inspectFont:d});this.fontLoader.bind(u).catch(()=>e.sendWithPromise("FontFallback",{id:s})).finally(()=>{!l&&u.data&&(u.data=null),this.commonObjs.resolve(s,u)});break;case"CopyLocalImage":const{imageRef:f}=n;It(f,"The imageRef must be defined.");for(const g of r(this,Os).values())for(const[,m]of g.objs)if((m==null?void 0:m.ref)===f)return m.dataLen?(this.commonObjs.resolve(s,structuredClone(m)),m.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(s,n);break;default:throw new Error(`Got unknown common object type ${i}`)}return null}),e.on("obj",([s,i,n,a])=>{var l;if(this.destroyed)return;const o=r(this,Os).get(i);if(!o.objs.has(s)){if(o._intentStates.size===0){(l=a==null?void 0:a.bitmap)==null||l.close();return}switch(n){case"Image":o.objs.resolve(s,a),(a==null?void 0:a.dataLen)>vm&&(o._maybeCleanupAfterRender=!0);break;case"Pattern":o.objs.resolve(s,a);break;default:throw new Error(`Got unknown object type ${n}`)}}}),e.on("DocProgress",s=>{var i;this.destroyed||(i=t.onProgress)==null||i.call(t,{loaded:s.loaded,total:s.total})}),e.on("FetchBuiltInCMap",async s=>{if(this.destroyed)throw new Error("Worker was destroyed.");if(!this.cMapReaderFactory)throw new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter.");return this.cMapReaderFactory.fetch(s)}),e.on("FetchStandardFontData",async s=>{if(this.destroyed)throw new Error("Worker was destroyed.");if(!this.standardFontDataFactory)throw new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.");return this.standardFontDataFactory.fetch(s)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var s;this.annotationStorage.size<=0&&Y("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:e,transfer:t}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:e,filename:((s=this._fullReader)==null?void 0:s.filename)??null},t).finally(()=>{this.annotationStorage.resetModified()})}getPage(e){if(!Number.isInteger(e)||e<=0||e>this._numPages)return Promise.reject(new Error("Invalid page request."));const t=e-1,s=r(this,Sa).get(t);if(s)return s;const i=this.messageHandler.sendWithPromise("GetPage",{pageIndex:t}).then(n=>{if(this.destroyed)throw new Error("Transport destroyed");n.refStr&&r(this,_a).set(n.refStr,e);const a=new Ub(t,n,this,this._params.pdfBug);return r(this,Os).set(t,a),a});return r(this,Sa).set(t,i),i}getPageIndex(e){return cf(e)?this.messageHandler.sendWithPromise("GetPageIndex",{num:e.num,gen:e.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(e,t){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:e,intent:t})}getFieldObjects(){return v(this,ir,xo).call(this,"GetFieldObjects")}hasJSActions(){return v(this,ir,xo).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(e){return typeof e!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:e})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return v(this,ir,xo).call(this,"GetDocJSActions")}getPageJSActions(e){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:e})}getStructTree(e){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:e})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(e){return v(this,ir,xo).call(this,"GetOptionalContentConfig").then(t=>new fb(t,e))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const e="GetMetadata",t=r(this,hi).get(e);if(t)return t;const s=this.messageHandler.sendWithPromise(e,null).then(i=>{var n,a;return{info:i[0],metadata:i[1]?new db(i[1]):null,contentDispositionFilename:((n=this._fullReader)==null?void 0:n.filename)??null,contentLength:((a=this._fullReader)==null?void 0:a.contentLength)??null}});return r(this,hi).set(e,s),s}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(e=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const t of r(this,Os).values())if(!t.cleanup())throw new Error(`startCleanup: Page ${t.pageNumber} is currently rendering.`);this.commonObjs.clear(),e||this.fontLoader.clear(),r(this,hi).clear(),this.filterFactory.destroy(!0),Do.cleanup()}}cachedPageNumber(e){if(!cf(e))return null;const t=e.gen===0?`${e.num}R`:`${e.num}R${e.gen}`;return r(this,_a).get(t)??null}}hi=new WeakMap,Os=new WeakMap,Sa=new WeakMap,_a=new WeakMap,di=new WeakMap,ir=new WeakSet,xo=function(e,t=null){const s=r(this,hi).get(e);if(s)return s;const i=this.messageHandler.sendWithPromise(e,t);return r(this,hi).set(e,i),i};const co=Symbol("INITIAL_DATA");var Ie,kl,Dd;class Sp{constructor(){A(this,kl);A(this,Ie,Object.create(null))}get(e,t=null){if(t){const i=v(this,kl,Dd).call(this,e);return i.promise.then(()=>t(i.data)),null}const s=r(this,Ie)[e];if(!s||s.data===co)throw new Error(`Requesting object that isn't resolved yet ${e}.`);return s.data}has(e){const t=r(this,Ie)[e];return!!t&&t.data!==co}delete(e){const t=r(this,Ie)[e];return!t||t.data===co?!1:(delete r(this,Ie)[e],!0)}resolve(e,t=null){const s=v(this,kl,Dd).call(this,e);s.data=t,s.resolve()}clear(){var e;for(const t in r(this,Ie)){const{data:s}=r(this,Ie)[t];(e=s==null?void 0:s.bitmap)==null||e.close()}p(this,Ie,Object.create(null))}*[Symbol.iterator](){for(const e in r(this,Ie)){const{data:t}=r(this,Ie)[e];t!==co&&(yield[e,t])}}}Ie=new WeakMap,kl=new WeakSet,Dd=function(e){var t;return(t=r(this,Ie))[e]||(t[e]={...Promise.withResolvers(),data:co})};var Ki;class Vb{constructor(e){A(this,Ki,null);p(this,Ki,e),this.onContinue=null}get promise(){return r(this,Ki).capability.promise}cancel(e=0){r(this,Ki).cancel(null,e)}get separateAnnots(){const{separateAnnots:e}=r(this,Ki).operatorList;if(!e)return!1;const{annotationCanvasMap:t}=r(this,Ki);return e.form||e.canvas&&(t==null?void 0:t.size)>0}}Ki=new WeakMap;var Zi,nr;const En=class En{constructor({callback:e,params:t,objs:s,commonObjs:i,annotationCanvasMap:n,operatorList:a,pageIndex:o,canvasFactory:l,filterFactory:c,useRequestAnimationFrame:d=!1,pdfBug:u=!1,pageColors:f=null}){A(this,Zi,null);this.callback=e,this.params=t,this.objs=s,this.commonObjs=i,this.annotationCanvasMap=n,this.operatorListIdx=null,this.operatorList=a,this._pageIndex=o,this.canvasFactory=l,this.filterFactory=c,this._pdfBug=u,this.pageColors=f,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=d===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new Vb(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=t.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:e=!1,optionalContentConfig:t}){var o,l;if(this.cancelled)return;if(this._canvas){if(r(En,nr).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");r(En,nr).add(this._canvas)}this._pdfBug&&((o=globalThis.StepperManager)!=null&&o.enabled)&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:s,viewport:i,transform:n,background:a}=this.params;this.gfx=new Xr(s,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:t},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:n,viewport:i,transparency:e,background:a}),this.operatorListIdx=0,this.graphicsReady=!0,(l=this.graphicsReadyCallback)==null||l.call(this)}cancel(e=null,t=0){var s;this.running=!1,this.cancelled=!0,(s=this.gfx)==null||s.endDrawing(),r(this,Zi)&&(window.cancelAnimationFrame(r(this,Zi)),p(this,Zi,null)),r(En,nr).delete(this._canvas),this.callback(e||new Au(`Rendering cancelled, page ${this._pageIndex+1}`,t))}operatorListChanged(){var e;if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}(e=this.stepper)==null||e.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?p(this,Zi,window.requestAnimationFrame(()=>{p(this,Zi,null),this._nextBound().catch(this._cancelBound)})):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),r(En,nr).delete(this._canvas),this.callback())))}};Zi=new WeakMap,nr=new WeakMap,A(En,nr,new WeakSet);let Nd=En;const qb="4.10.38",Xb="f9bea397f";function hf(h){return Math.floor(Math.max(0,Math.min(1,h))*255).toString(16).padStart(2,"0")}function ho(h){return Math.max(0,Math.min(255,255*h))}class df{static CMYK_G([e,t,s,i]){return["G",1-Math.min(1,.3*e+.59*s+.11*t+i)]}static G_CMYK([e]){return["CMYK",0,0,0,1-e]}static G_RGB([e]){return["RGB",e,e,e]}static G_rgb([e]){return e=ho(e),[e,e,e]}static G_HTML([e]){const t=hf(e);return`#${t}${t}${t}`}static RGB_G([e,t,s]){return["G",.3*e+.59*t+.11*s]}static RGB_rgb(e){return e.map(ho)}static RGB_HTML(e){return`#${e.map(hf).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([e,t,s,i]){return["RGB",1-Math.min(1,e+i),1-Math.min(1,s+i),1-Math.min(1,t+i)]}static CMYK_rgb([e,t,s,i]){return[ho(1-Math.min(1,e+i)),ho(1-Math.min(1,s+i)),ho(1-Math.min(1,t+i))]}static CMYK_HTML(e){const t=this.CMYK_RGB(e).slice(1);return this.RGB_HTML(t)}static RGB_CMYK([e,t,s]){const i=1-e,n=1-t,a=1-s,o=Math.min(i,n,a);return["CMYK",i,n,a,o]}}class Yb{create(e,t,s=!1){if(e<=0||t<=0)throw new Error("Invalid SVG dimensions");const i=this._createSVG("svg:svg");return i.setAttribute("version","1.1"),s||(i.setAttribute("width",`${e}px`),i.setAttribute("height",`${t}px`)),i.setAttribute("preserveAspectRatio","none"),i.setAttribute("viewBox",`0 0 ${e} ${t}`),i}createElement(e){if(typeof e!="string")throw new Error("Invalid SVG element type");return this._createSVG(e)}_createSVG(e){pt("Abstract method `_createSVG` called.")}}class Eu extends Yb{_createSVG(e){return document.createElementNS(qs,e)}}class _p{static setupStorage(e,t,s,i,n){const a=i.getValue(t,{value:null});switch(s.name){case"textarea":if(a.value!==null&&(e.textContent=a.value),n==="print")break;e.addEventListener("input",o=>{i.setValue(t,{value:o.target.value})});break;case"input":if(s.attributes.type==="radio"||s.attributes.type==="checkbox"){if(a.value===s.attributes.xfaOn?e.setAttribute("checked",!0):a.value===s.attributes.xfaOff&&e.removeAttribute("checked"),n==="print")break;e.addEventListener("change",o=>{i.setValue(t,{value:o.target.checked?o.target.getAttribute("xfaOn"):o.target.getAttribute("xfaOff")})})}else{if(a.value!==null&&e.setAttribute("value",a.value),n==="print")break;e.addEventListener("input",o=>{i.setValue(t,{value:o.target.value})})}break;case"select":if(a.value!==null){e.setAttribute("value",a.value);for(const o of s.children)o.attributes.value===a.value?o.attributes.selected=!0:o.attributes.hasOwnProperty("selected")&&delete o.attributes.selected}e.addEventListener("input",o=>{const l=o.target.options,c=l.selectedIndex===-1?"":l[l.selectedIndex].value;i.setValue(t,{value:c})});break}}static setAttributes({html:e,element:t,storage:s=null,intent:i,linkService:n}){const{attributes:a}=t,o=e instanceof HTMLAnchorElement;a.type==="radio"&&(a.name=`${a.name}-${i}`);for(const[l,c]of Object.entries(a))if(c!=null)switch(l){case"class":c.length&&e.setAttribute(l,c.join(" "));break;case"dataId":break;case"id":e.setAttribute("data-element-id",c);break;case"style":Object.assign(e.style,c);break;case"textContent":e.textContent=c;break;default:(!o||l!=="href"&&l!=="newWindow")&&e.setAttribute(l,c)}o&&n.addLinkAttributes(e,a.href,a.newWindow),s&&a.dataId&&this.setupStorage(e,a.dataId,t,s)}static render(e){var u,f;const t=e.annotationStorage,s=e.linkService,i=e.xfaHtml,n=e.intent||"display",a=document.createElement(i.name);i.attributes&&this.setAttributes({html:a,element:i,intent:n,linkService:s});const o=n!=="richText",l=e.div;if(l.append(a),e.viewport){const g=`matrix(${e.viewport.transform.join(",")})`;l.style.transform=g}o&&l.setAttribute("class","xfaLayer xfaFont");const c=[];if(i.children.length===0){if(i.value){const g=document.createTextNode(i.value);a.append(g),o&&No.shouldBuildText(i.name)&&c.push(g)}return{textDivs:c}}const d=[[i,-1,a]];for(;d.length>0;){const[g,m,y]=d.at(-1);if(m+1===g.children.length){d.pop();continue}const w=g.children[++d.at(-1)[1]];if(w===null)continue;const{name:x}=w;if(x==="#text"){const _=document.createTextNode(w.value);c.push(_),y.append(_);continue}const S=(u=w==null?void 0:w.attributes)!=null&&u.xmlns?document.createElementNS(w.attributes.xmlns,x):document.createElement(x);if(y.append(S),w.attributes&&this.setAttributes({html:S,element:w,storage:t,intent:n,linkService:s}),((f=w.children)==null?void 0:f.length)>0)d.push([w,-1,S]);else if(w.value){const _=document.createTextNode(w.value);o&&No.shouldBuildText(x)&&c.push(_),S.append(_)}}for(const g of l.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))g.setAttribute("readOnly",!0);return{textDivs:c}}static update(e){const t=`matrix(${e.viewport.transform.join(",")})`;e.div.style.transform=t,e.div.hidden=!1}}const dc=1e3,Kb=9,Rr=new WeakSet;function hn(h){return{width:h[2]-h[0],height:h[3]-h[1]}}class Zb{static create(e){switch(e.data.annotationType){case Ft.LINK:return new Ep(e);case Ft.TEXT:return new Jb(e);case Ft.WIDGET:switch(e.data.fieldType){case"Tx":return new Qb(e);case"Btn":return e.data.radioButton?new Tp(e):e.data.checkBox?new ey(e):new sy(e);case"Ch":return new iy(e);case"Sig":return new ty(e)}return new Dr(e);case Ft.POPUP:return new jd(e);case Ft.FREETEXT:return new Ip(e);case Ft.LINE:return new ry(e);case Ft.SQUARE:return new ay(e);case Ft.CIRCLE:return new oy(e);case Ft.POLYLINE:return new Dp(e);case Ft.CARET:return new cy(e);case Ft.INK:return new Cu(e);case Ft.POLYGON:return new ly(e);case Ft.HIGHLIGHT:return new Np(e);case Ft.UNDERLINE:return new hy(e);case Ft.SQUIGGLY:return new dy(e);case Ft.STRIKEOUT:return new uy(e);case Ft.STAMP:return new Fp(e);case Ft.FILEATTACHMENT:return new fy(e);default:return new Lt(e)}}}var rr,Ea,Ca,Tl,Fd;const Mu=class Mu{constructor(e,{isRenderable:t=!1,ignoreBorder:s=!1,createQuadrilaterals:i=!1}={}){A(this,Tl);A(this,rr,null);A(this,Ea,!1);A(this,Ca,null);this.isRenderable=t,this.data=e.data,this.layer=e.layer,this.linkService=e.linkService,this.downloadManager=e.downloadManager,this.imageResourcesPath=e.imageResourcesPath,this.renderForms=e.renderForms,this.svgFactory=e.svgFactory,this.annotationStorage=e.annotationStorage,this.enableScripting=e.enableScripting,this.hasJSActions=e.hasJSActions,this._fieldObjects=e.fieldObjects,this.parent=e.parent,t&&(this.container=this._createContainer(s)),i&&this._createQuadrilaterals()}static _hasPopupData({titleObj:e,contentsObj:t,richText:s}){return!!(e!=null&&e.str||t!=null&&t.str||s!=null&&s.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return Mu._hasPopupData(this.data)}updateEdited(e){var s;if(!this.container)return;r(this,rr)||p(this,rr,{rect:this.data.rect.slice(0)});const{rect:t}=e;t&&v(this,Tl,Fd).call(this,t),(s=r(this,Ca))==null||s.popup.updateEdited(e)}resetEdited(){var e;r(this,rr)&&(v(this,Tl,Fd).call(this,r(this,rr).rect),(e=r(this,Ca))==null||e.popup.resetEdited(),p(this,rr,null))}_createContainer(e){const{data:t,parent:{page:s,viewport:i}}=this,n=document.createElement("section");n.setAttribute("data-annotation-id",t.id),this instanceof Dr||(n.tabIndex=dc);const{style:a}=n;if(a.zIndex=this.parent.zIndex++,t.alternativeText&&(n.title=t.alternativeText),t.noRotate&&n.classList.add("norotate"),!t.rect||this instanceof jd){const{rotation:y}=t;return!t.hasOwnCanvas&&y!==0&&this.setRotation(y,n),n}const{width:o,height:l}=hn(t.rect);if(!e&&t.borderStyle.width>0){a.borderWidth=`${t.borderStyle.width}px`;const y=t.borderStyle.horizontalCornerRadius,w=t.borderStyle.verticalCornerRadius;if(y>0||w>0){const S=`calc(${y}px * var(--scale-factor)) / calc(${w}px * var(--scale-factor))`;a.borderRadius=S}else if(this instanceof Tp){const S=`calc(${o}px * var(--scale-factor)) / calc(${l}px * var(--scale-factor))`;a.borderRadius=S}switch(t.borderStyle.style){case oo.SOLID:a.borderStyle="solid";break;case oo.DASHED:a.borderStyle="dashed";break;case oo.BEVELED:Y("Unimplemented border style: beveled");break;case oo.INSET:Y("Unimplemented border style: inset");break;case oo.UNDERLINE:a.borderBottomStyle="solid";break}const x=t.borderColor||null;x?(p(this,Ea,!0),a.borderColor=$.makeHexColor(x[0]|0,x[1]|0,x[2]|0)):a.borderWidth=0}const c=$.normalizeRect([t.rect[0],s.view[3]-t.rect[1]+s.view[1],t.rect[2],s.view[3]-t.rect[3]+s.view[1]]),{pageWidth:d,pageHeight:u,pageX:f,pageY:g}=i.rawDims;a.left=`${100*(c[0]-f)/d}%`,a.top=`${100*(c[1]-g)/u}%`;const{rotation:m}=t;return t.hasOwnCanvas||m===0?(a.width=`${100*o/d}%`,a.height=`${100*l/u}%`):this.setRotation(m,n),n}setRotation(e,t=this.container){if(!this.data.rect)return;const{pageWidth:s,pageHeight:i}=this.parent.viewport.rawDims,{width:n,height:a}=hn(this.data.rect);let o,l;e%180===0?(o=100*n/s,l=100*a/i):(o=100*a/s,l=100*n/i),t.style.width=`${o}%`,t.style.height=`${l}%`,t.setAttribute("data-main-rotation",(360-e)%360)}get _commonActions(){const e=(t,s,i)=>{const n=i.detail[t],a=n[0],o=n.slice(1);i.target.style[s]=df[`${a}_HTML`](o),this.annotationStorage.setValue(this.data.id,{[s]:df[`${a}_rgb`](o)})};return tt(this,"_commonActions",{display:t=>{const{display:s}=t.detail,i=s%2===1;this.container.style.visibility=i?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:i,noPrint:s===1||s===2})},print:t=>{this.annotationStorage.setValue(this.data.id,{noPrint:!t.detail.print})},hidden:t=>{const{hidden:s}=t.detail;this.container.style.visibility=s?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:s,noView:s})},focus:t=>{setTimeout(()=>t.target.focus({preventScroll:!1}),0)},userName:t=>{t.target.title=t.detail.userName},readonly:t=>{t.target.disabled=t.detail.readonly},required:t=>{this._setRequired(t.target,t.detail.required)},bgColor:t=>{e("bgColor","backgroundColor",t)},fillColor:t=>{e("fillColor","backgroundColor",t)},fgColor:t=>{e("fgColor","color",t)},textColor:t=>{e("textColor","color",t)},borderColor:t=>{e("borderColor","borderColor",t)},strokeColor:t=>{e("strokeColor","borderColor",t)},rotation:t=>{const s=t.detail.rotation;this.setRotation(s),this.annotationStorage.setValue(this.data.id,{rotation:s})}})}_dispatchEventFromSandbox(e,t){const s=this._commonActions;for(const i of Object.keys(t.detail)){const n=e[i]||s[i];n==null||n(t)}}_setDefaultPropertiesFromJS(e){if(!this.enableScripting)return;const t=this.annotationStorage.getRawValue(this.data.id);if(!t)return;const s=this._commonActions;for(const[i,n]of Object.entries(t)){const a=s[i];if(a){const o={detail:{[i]:n},target:e};a(o),delete t[i]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:e}=this.data;if(!e)return;const[t,s,i,n]=this.data.rect.map(y=>Math.fround(y));if(e.length===8){const[y,w,x,S]=e.subarray(2,6);if(i===y&&n===w&&t===x&&s===S)return}const{style:a}=this.container;let o;if(r(this,Ea)){const{borderColor:y,borderWidth:w}=a;a.borderWidth=0,o=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${y}" stroke-width="${w}">`],this.container.classList.add("hasBorder")}const l=i-t,c=n-s,{svgFactory:d}=this,u=d.createElement("svg");u.classList.add("quadrilateralsContainer"),u.setAttribute("width",0),u.setAttribute("height",0);const f=d.createElement("defs");u.append(f);const g=d.createElement("clipPath"),m=`clippath_${this.data.id}`;g.setAttribute("id",m),g.setAttribute("clipPathUnits","objectBoundingBox"),f.append(g);for(let y=2,w=e.length;y<w;y+=8){const x=e[y],S=e[y+1],_=e[y+2],C=e[y+3],k=d.createElement("rect"),T=(_-t)/l,P=(n-S)/c,D=(x-_)/l,O=(S-C)/c;k.setAttribute("x",T),k.setAttribute("y",P),k.setAttribute("width",D),k.setAttribute("height",O),g.append(k),o==null||o.push(`<rect vector-effect="non-scaling-stroke" x="${T}" y="${P}" width="${D}" height="${O}"/>`)}r(this,Ea)&&(o.push("</g></svg>')"),a.backgroundImage=o.join("")),this.container.append(u),this.container.style.clipPath=`url(#${m})`}_createPopup(){const{data:e}=this,t=p(this,Ca,new jd({data:{color:e.color,titleObj:e.titleObj,modificationDate:e.modificationDate,contentsObj:e.contentsObj,richText:e.richText,parentRect:e.rect,borderStyle:0,id:`popup_${e.id}`,rotation:e.rotation},parent:this.parent,elements:[this]}));this.parent.div.append(t.render())}render(){pt("Abstract method `AnnotationElement.render` called")}_getElementsByName(e,t=null){const s=[];if(this._fieldObjects){const i=this._fieldObjects[e];if(i)for(const{page:n,id:a,exportValues:o}of i){if(n===-1||a===t)continue;const l=typeof o=="string"?o:null,c=document.querySelector(`[data-element-id="${a}"]`);if(c&&!Rr.has(c)){Y(`_getElementsByName - element not allowed: ${a}`);continue}s.push({id:a,exportValue:l,domElement:c})}return s}for(const i of document.getElementsByName(e)){const{exportValue:n}=i,a=i.getAttribute("data-element-id");a!==t&&Rr.has(i)&&s.push({id:a,exportValue:n,domElement:i})}return s}show(){var e;this.container&&(this.container.hidden=!1),(e=this.popup)==null||e.maybeShow()}hide(){var e;this.container&&(this.container.hidden=!0),(e=this.popup)==null||e.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const e=this.getElementsToTriggerPopup();if(Array.isArray(e))for(const t of e)t.classList.add("highlightArea");else e.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:e,data:{id:t}}=this;this.container.addEventListener("dblclick",()=>{var s;(s=this.linkService.eventBus)==null||s.dispatch("switchannotationeditormode",{source:this,mode:e,editId:t})})}};rr=new WeakMap,Ea=new WeakMap,Ca=new WeakMap,Tl=new WeakSet,Fd=function(e){const{container:{style:t},data:{rect:s,rotation:i},parent:{viewport:{rawDims:{pageWidth:n,pageHeight:a,pageX:o,pageY:l}}}}=this;s==null||s.splice(0,4,...e);const{width:c,height:d}=hn(e);t.left=`${100*(e[0]-o)/n}%`,t.top=`${100*(a-e[3]+l)/a}%`,i===0?(t.width=`${100*c/n}%`,t.height=`${100*d/a}%`):this.setRotation(i)};let Lt=Mu;var Ue,wn,Cp,kp;class Ep extends Lt{constructor(t,s=null){super(t,{isRenderable:!0,ignoreBorder:!!(s!=null&&s.ignoreBorder),createQuadrilaterals:!0});A(this,Ue);this.isTooltipOnly=t.data.isTooltipOnly}render(){const{data:t,linkService:s}=this,i=document.createElement("a");i.setAttribute("data-element-id",t.id);let n=!1;return t.url?(s.addLinkAttributes(i,t.url,t.newWindow),n=!0):t.action?(this._bindNamedAction(i,t.action),n=!0):t.attachment?(v(this,Ue,Cp).call(this,i,t.attachment,t.attachmentDest),n=!0):t.setOCGState?(v(this,Ue,kp).call(this,i,t.setOCGState),n=!0):t.dest?(this._bindLink(i,t.dest),n=!0):(t.actions&&(t.actions.Action||t.actions["Mouse Up"]||t.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(i,t),n=!0),t.resetForm?(this._bindResetFormAction(i,t.resetForm),n=!0):this.isTooltipOnly&&!n&&(this._bindLink(i,""),n=!0)),this.container.classList.add("linkAnnotation"),n&&this.container.append(i),this.container}_bindLink(t,s){t.href=this.linkService.getDestinationHash(s),t.onclick=()=>(s&&this.linkService.goToDestination(s),!1),(s||s==="")&&v(this,Ue,wn).call(this)}_bindNamedAction(t,s){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeNamedAction(s),!1),v(this,Ue,wn).call(this)}_bindJSAction(t,s){t.href=this.linkService.getAnchorUrl("");const i=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const n of Object.keys(s.actions)){const a=i.get(n);a&&(t[a]=()=>{var o;return(o=this.linkService.eventBus)==null||o.dispatch("dispatcheventinsandbox",{source:this,detail:{id:s.id,name:n}}),!1})}t.onclick||(t.onclick=()=>!1),v(this,Ue,wn).call(this)}_bindResetFormAction(t,s){const i=t.onclick;if(i||(t.href=this.linkService.getAnchorUrl("")),v(this,Ue,wn).call(this),!this._fieldObjects){Y('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),i||(t.onclick=()=>!1);return}t.onclick=()=>{var u;i==null||i();const{fields:n,refs:a,include:o}=s,l=[];if(n.length!==0||a.length!==0){const f=new Set(a);for(const g of n){const m=this._fieldObjects[g]||[];for(const{id:y}of m)f.add(y)}for(const g of Object.values(this._fieldObjects))for(const m of g)f.has(m.id)===o&&l.push(m)}else for(const f of Object.values(this._fieldObjects))l.push(...f);const c=this.annotationStorage,d=[];for(const f of l){const{id:g}=f;switch(d.push(g),f.type){case"text":{const y=f.defaultValue||"";c.setValue(g,{value:y});break}case"checkbox":case"radiobutton":{const y=f.defaultValue===f.exportValues;c.setValue(g,{value:y});break}case"combobox":case"listbox":{const y=f.defaultValue||"";c.setValue(g,{value:y});break}default:continue}const m=document.querySelector(`[data-element-id="${g}"]`);if(m){if(!Rr.has(m)){Y(`_bindResetFormAction - element not allowed: ${g}`);continue}}else continue;m.dispatchEvent(new Event("resetform"))}return this.enableScripting&&((u=this.linkService.eventBus)==null||u.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:d,name:"ResetForm"}})),!1}}}Ue=new WeakSet,wn=function(){this.container.setAttribute("data-internal-link","")},Cp=function(t,s,i=null){t.href=this.linkService.getAnchorUrl(""),s.description&&(t.title=s.description),t.onclick=()=>{var n;return(n=this.downloadManager)==null||n.openOrDownloadData(s.content,s.filename,i),!1},v(this,Ue,wn).call(this)},kp=function(t,s){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeSetOCGState(s),!1),v(this,Ue,wn).call(this)};class Jb extends Lt{constructor(e){super(e,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const e=document.createElement("img");return e.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",e.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),e.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(e),this.container}}class Dr extends Lt{render(){return this.container}showElementAndHideCanvas(e){var t;this.data.hasOwnCanvas&&(((t=e.previousSibling)==null?void 0:t.nodeName)==="CANVAS"&&(e.previousSibling.hidden=!0),e.hidden=!1)}_getKeyModifier(e){return ye.platform.isMac?e.metaKey:e.ctrlKey}_setEventListener(e,t,s,i,n){s.includes("mouse")?e.addEventListener(s,a=>{var o;(o=this.linkService.eventBus)==null||o.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:n(a),shift:a.shiftKey,modifier:this._getKeyModifier(a)}})}):e.addEventListener(s,a=>{var o;if(s==="blur"){if(!t.focused||!a.relatedTarget)return;t.focused=!1}else if(s==="focus"){if(t.focused)return;t.focused=!0}n&&((o=this.linkService.eventBus)==null||o.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:n(a)}}))})}_setEventListeners(e,t,s,i){var n,a,o;for(const[l,c]of s)(c==="Action"||(n=this.data.actions)!=null&&n[c])&&((c==="Focus"||c==="Blur")&&(t||(t={focused:!1})),this._setEventListener(e,t,l,c,i),c==="Focus"&&!((a=this.data.actions)!=null&&a.Blur)?this._setEventListener(e,t,"blur","Blur",null):c==="Blur"&&!((o=this.data.actions)!=null&&o.Focus)&&this._setEventListener(e,t,"focus","Focus",null))}_setBackgroundColor(e){const t=this.data.backgroundColor||null;e.style.backgroundColor=t===null?"transparent":$.makeHexColor(t[0],t[1],t[2])}_setTextStyle(e){const t=["left","center","right"],{fontColor:s}=this.data.defaultAppearanceData,i=this.data.defaultAppearanceData.fontSize||Kb,n=e.style;let a;const o=2,l=c=>Math.round(10*c)/10;if(this.data.multiLine){const c=Math.abs(this.data.rect[3]-this.data.rect[1]-o),d=Math.round(c/(qh*i))||1,u=c/d;a=Math.min(i,l(u/qh))}else{const c=Math.abs(this.data.rect[3]-this.data.rect[1]-o);a=Math.min(i,l(c/qh))}n.fontSize=`calc(${a}px * var(--scale-factor))`,n.color=$.makeHexColor(s[0],s[1],s[2]),this.data.textAlignment!==null&&(n.textAlign=t[this.data.textAlignment])}_setRequired(e,t){t?e.setAttribute("required",!0):e.removeAttribute("required"),e.setAttribute("aria-required",t)}}class Qb extends Dr{constructor(e){const t=e.renderForms||e.data.hasOwnCanvas||!e.data.hasAppearance&&!!e.data.fieldValue;super(e,{isRenderable:t})}setPropertyOnSiblings(e,t,s,i){const n=this.annotationStorage;for(const a of this._getElementsByName(e.name,e.id))a.domElement&&(a.domElement[t]=s),n.setValue(a.id,{[i]:s})}render(){var i,n;const e=this.annotationStorage,t=this.data.id;this.container.classList.add("textWidgetAnnotation");let s=null;if(this.renderForms){const a=e.getValue(t,{value:this.data.fieldValue});let o=a.value||"";const l=e.getValue(t,{charLimit:this.data.maxLen}).charLimit;l&&o.length>l&&(o=o.slice(0,l));let c=a.formattedValue||((i=this.data.textContent)==null?void 0:i.join(`
`))||null;c&&this.data.comb&&(c=c.replaceAll(/\s+/g,""));const d={userValue:o,formattedValue:c,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(s=document.createElement("textarea"),s.textContent=c??o,this.data.doNotScroll&&(s.style.overflowY="hidden")):(s=document.createElement("input"),s.type="text",s.setAttribute("value",c??o),this.data.doNotScroll&&(s.style.overflowX="hidden")),this.data.hasOwnCanvas&&(s.hidden=!0),Rr.add(s),s.setAttribute("data-element-id",t),s.disabled=this.data.readOnly,s.name=this.data.fieldName,s.tabIndex=dc,this._setRequired(s,this.data.required),l&&(s.maxLength=l),s.addEventListener("input",f=>{e.setValue(t,{value:f.target.value}),this.setPropertyOnSiblings(s,"value",f.target.value,"value"),d.formattedValue=null}),s.addEventListener("resetform",f=>{const g=this.data.defaultFieldValue??"";s.value=d.userValue=g,d.formattedValue=null});let u=f=>{const{formattedValue:g}=d;g!=null&&(f.target.value=g),f.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){s.addEventListener("focus",g=>{var y;if(d.focused)return;const{target:m}=g;d.userValue&&(m.value=d.userValue),d.lastCommittedValue=m.value,d.commitKey=1,(y=this.data.actions)!=null&&y.Focus||(d.focused=!0)}),s.addEventListener("updatefromsandbox",g=>{this.showElementAndHideCanvas(g.target);const m={value(y){d.userValue=y.detail.value??"",e.setValue(t,{value:d.userValue.toString()}),y.target.value=d.userValue},formattedValue(y){const{formattedValue:w}=y.detail;d.formattedValue=w,w!=null&&y.target!==document.activeElement&&(y.target.value=w),e.setValue(t,{formattedValue:w})},selRange(y){y.target.setSelectionRange(...y.detail.selRange)},charLimit:y=>{var _;const{charLimit:w}=y.detail,{target:x}=y;if(w===0){x.removeAttribute("maxLength");return}x.setAttribute("maxLength",w);let S=d.userValue;!S||S.length<=w||(S=S.slice(0,w),x.value=d.userValue=S,e.setValue(t,{value:S}),(_=this.linkService.eventBus)==null||_.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:S,willCommit:!0,commitKey:1,selStart:x.selectionStart,selEnd:x.selectionEnd}}))}};this._dispatchEventFromSandbox(m,g)}),s.addEventListener("keydown",g=>{var w;d.commitKey=1;let m=-1;if(g.key==="Escape"?m=0:g.key==="Enter"&&!this.data.multiLine?m=2:g.key==="Tab"&&(d.commitKey=3),m===-1)return;const{value:y}=g.target;d.lastCommittedValue!==y&&(d.lastCommittedValue=y,d.userValue=y,(w=this.linkService.eventBus)==null||w.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:y,willCommit:!0,commitKey:m,selStart:g.target.selectionStart,selEnd:g.target.selectionEnd}}))});const f=u;u=null,s.addEventListener("blur",g=>{var y,w;if(!d.focused||!g.relatedTarget)return;(y=this.data.actions)!=null&&y.Blur||(d.focused=!1);const{value:m}=g.target;d.userValue=m,d.lastCommittedValue!==m&&((w=this.linkService.eventBus)==null||w.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:m,willCommit:!0,commitKey:d.commitKey,selStart:g.target.selectionStart,selEnd:g.target.selectionEnd}})),f(g)}),(n=this.data.actions)!=null&&n.Keystroke&&s.addEventListener("beforeinput",g=>{var k;d.lastCommittedValue=null;const{data:m,target:y}=g,{value:w,selectionStart:x,selectionEnd:S}=y;let _=x,C=S;switch(g.inputType){case"deleteWordBackward":{const T=w.substring(0,x).match(/\w*[^\w]*$/);T&&(_-=T[0].length);break}case"deleteWordForward":{const T=w.substring(x).match(/^[^\w]*\w*/);T&&(C+=T[0].length);break}case"deleteContentBackward":x===S&&(_-=1);break;case"deleteContentForward":x===S&&(C+=1);break}g.preventDefault(),(k=this.linkService.eventBus)==null||k.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:w,change:m||"",willCommit:!1,selStart:_,selEnd:C}})}),this._setEventListeners(s,d,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],g=>g.target.value)}if(u&&s.addEventListener("blur",u),this.data.comb){const g=(this.data.rect[2]-this.data.rect[0])/l;s.classList.add("comb"),s.style.letterSpacing=`calc(${g}px * var(--scale-factor) - 1ch)`}}else s=document.createElement("div"),s.textContent=this.data.fieldValue,s.style.verticalAlign="middle",s.style.display="table-cell",this.data.hasOwnCanvas&&(s.hidden=!0);return this._setTextStyle(s),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class ty extends Dr{constructor(e){super(e,{isRenderable:!!e.data.hasOwnCanvas})}}class ey extends Dr{constructor(e){super(e,{isRenderable:e.renderForms})}render(){const e=this.annotationStorage,t=this.data,s=t.id;let i=e.getValue(s,{value:t.exportValue===t.fieldValue}).value;typeof i=="string"&&(i=i!=="Off",e.setValue(s,{value:i})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const n=document.createElement("input");return Rr.add(n),n.setAttribute("data-element-id",s),n.disabled=t.readOnly,this._setRequired(n,this.data.required),n.type="checkbox",n.name=t.fieldName,i&&n.setAttribute("checked",!0),n.setAttribute("exportValue",t.exportValue),n.tabIndex=dc,n.addEventListener("change",a=>{const{name:o,checked:l}=a.target;for(const c of this._getElementsByName(o,s)){const d=l&&c.exportValue===t.exportValue;c.domElement&&(c.domElement.checked=d),e.setValue(c.id,{value:d})}e.setValue(s,{value:l})}),n.addEventListener("resetform",a=>{const o=t.defaultFieldValue||"Off";a.target.checked=o===t.exportValue}),this.enableScripting&&this.hasJSActions&&(n.addEventListener("updatefromsandbox",a=>{const o={value(l){l.target.checked=l.detail.value!=="Off",e.setValue(s,{value:l.target.checked})}};this._dispatchEventFromSandbox(o,a)}),this._setEventListeners(n,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],a=>a.target.checked)),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class Tp extends Dr{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const e=this.annotationStorage,t=this.data,s=t.id;let i=e.getValue(s,{value:t.fieldValue===t.buttonValue}).value;if(typeof i=="string"&&(i=i!==t.buttonValue,e.setValue(s,{value:i})),i)for(const a of this._getElementsByName(t.fieldName,s))e.setValue(a.id,{value:!1});const n=document.createElement("input");if(Rr.add(n),n.setAttribute("data-element-id",s),n.disabled=t.readOnly,this._setRequired(n,this.data.required),n.type="radio",n.name=t.fieldName,i&&n.setAttribute("checked",!0),n.tabIndex=dc,n.addEventListener("change",a=>{const{name:o,checked:l}=a.target;for(const c of this._getElementsByName(o,s))e.setValue(c.id,{value:!1});e.setValue(s,{value:l})}),n.addEventListener("resetform",a=>{const o=t.defaultFieldValue;a.target.checked=o!=null&&o===t.buttonValue}),this.enableScripting&&this.hasJSActions){const a=t.buttonValue;n.addEventListener("updatefromsandbox",o=>{const l={value:c=>{const d=a===c.detail.value;for(const u of this._getElementsByName(c.target.name)){const f=d&&u.id===s;u.domElement&&(u.domElement.checked=f),e.setValue(u.id,{value:f})}}};this._dispatchEventFromSandbox(l,o)}),this._setEventListeners(n,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],o=>o.target.checked)}return this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class sy extends Ep{constructor(e){super(e,{ignoreBorder:e.data.hasAppearance})}render(){const e=super.render();e.classList.add("buttonWidgetAnnotation","pushButton");const t=e.lastChild;return this.enableScripting&&this.hasJSActions&&t&&(this._setDefaultPropertiesFromJS(t),t.addEventListener("updatefromsandbox",s=>{this._dispatchEventFromSandbox({},s)})),e}}class iy extends Dr{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const e=this.annotationStorage,t=this.data.id,s=e.getValue(t,{value:this.data.fieldValue}),i=document.createElement("select");Rr.add(i),i.setAttribute("data-element-id",t),i.disabled=this.data.readOnly,this._setRequired(i,this.data.required),i.name=this.data.fieldName,i.tabIndex=dc;let n=this.data.combo&&this.data.options.length>0;this.data.combo||(i.size=this.data.options.length,this.data.multiSelect&&(i.multiple=!0)),i.addEventListener("resetform",d=>{const u=this.data.defaultFieldValue;for(const f of i.options)f.selected=f.value===u});for(const d of this.data.options){const u=document.createElement("option");u.textContent=d.displayValue,u.value=d.exportValue,s.value.includes(d.exportValue)&&(u.setAttribute("selected",!0),n=!1),i.append(u)}let a=null;if(n){const d=document.createElement("option");d.value=" ",d.setAttribute("hidden",!0),d.setAttribute("selected",!0),i.prepend(d),a=()=>{d.remove(),i.removeEventListener("input",a),a=null},i.addEventListener("input",a)}const o=d=>{const u=d?"value":"textContent",{options:f,multiple:g}=i;return g?Array.prototype.filter.call(f,m=>m.selected).map(m=>m[u]):f.selectedIndex===-1?null:f[f.selectedIndex][u]};let l=o(!1);const c=d=>{const u=d.target.options;return Array.prototype.map.call(u,f=>({displayValue:f.textContent,exportValue:f.value}))};return this.enableScripting&&this.hasJSActions?(i.addEventListener("updatefromsandbox",d=>{const u={value(f){a==null||a();const g=f.detail.value,m=new Set(Array.isArray(g)?g:[g]);for(const y of i.options)y.selected=m.has(y.value);e.setValue(t,{value:o(!0)}),l=o(!1)},multipleSelection(f){i.multiple=!0},remove(f){const g=i.options,m=f.detail.remove;g[m].selected=!1,i.remove(m),g.length>0&&Array.prototype.findIndex.call(g,w=>w.selected)===-1&&(g[0].selected=!0),e.setValue(t,{value:o(!0),items:c(f)}),l=o(!1)},clear(f){for(;i.length!==0;)i.remove(0);e.setValue(t,{value:null,items:[]}),l=o(!1)},insert(f){const{index:g,displayValue:m,exportValue:y}=f.detail.insert,w=i.children[g],x=document.createElement("option");x.textContent=m,x.value=y,w?w.before(x):i.append(x),e.setValue(t,{value:o(!0),items:c(f)}),l=o(!1)},items(f){const{items:g}=f.detail;for(;i.length!==0;)i.remove(0);for(const m of g){const{displayValue:y,exportValue:w}=m,x=document.createElement("option");x.textContent=y,x.value=w,i.append(x)}i.options.length>0&&(i.options[0].selected=!0),e.setValue(t,{value:o(!0),items:c(f)}),l=o(!1)},indices(f){const g=new Set(f.detail.indices);for(const m of f.target.options)m.selected=g.has(m.index);e.setValue(t,{value:o(!0)}),l=o(!1)},editable(f){f.target.disabled=!f.detail.editable}};this._dispatchEventFromSandbox(u,d)}),i.addEventListener("input",d=>{var g;const u=o(!0),f=o(!1);e.setValue(t,{value:u}),d.preventDefault(),(g=this.linkService.eventBus)==null||g.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:l,change:f,changeEx:u,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(i,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],d=>d.target.value)):i.addEventListener("input",function(d){e.setValue(t,{value:o(!0)})}),this.data.combo&&this._setTextStyle(i),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}class jd extends Lt{constructor(e){const{data:t,elements:s}=e;super(e,{isRenderable:Lt._hasPopupData(t)}),this.elements=s,this.popup=null}render(){this.container.classList.add("popupAnnotation");const e=this.popup=new ny({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),t=[];for(const s of this.elements)s.popup=e,s.container.ariaHasPopup="dialog",t.push(s.data.id),s.addHighlightArea();return this.container.setAttribute("aria-controls",t.map(s=>`${yu}${s}`).join(",")),this.container}}var ka,Eh,Ch,Ta,ar,kt,ui,Pa,Pl,Ll,La,fi,us,pi,Ml,gi,Rl,or,lr,ft,Uc,Od,Pp,Lp,Mp,Rp,Gc,Wc,zd;class ny{constructor({container:e,color:t,elements:s,titleObj:i,modificationDate:n,contentsObj:a,richText:o,parent:l,rect:c,parentRect:d,open:u}){A(this,ft);A(this,ka,v(this,ft,Mp).bind(this));A(this,Eh,v(this,ft,zd).bind(this));A(this,Ch,v(this,ft,Wc).bind(this));A(this,Ta,v(this,ft,Gc).bind(this));A(this,ar,null);A(this,kt,null);A(this,ui,null);A(this,Pa,null);A(this,Pl,null);A(this,Ll,null);A(this,La,null);A(this,fi,!1);A(this,us,null);A(this,pi,null);A(this,Ml,null);A(this,gi,null);A(this,Rl,null);A(this,or,null);A(this,lr,!1);var f;p(this,kt,e),p(this,Rl,i),p(this,ui,a),p(this,gi,o),p(this,Ll,l),p(this,ar,t),p(this,Ml,c),p(this,La,d),p(this,Pl,s),p(this,Pa,wu.toDateObject(n)),this.trigger=s.flatMap(g=>g.getElementsToTriggerPopup());for(const g of this.trigger)g.addEventListener("click",r(this,Ta)),g.addEventListener("mouseenter",r(this,Ch)),g.addEventListener("mouseleave",r(this,Eh)),g.classList.add("popupTriggerArea");for(const g of s)(f=g.container)==null||f.addEventListener("keydown",r(this,ka));r(this,kt).hidden=!0,u&&v(this,ft,Gc).call(this)}render(){if(r(this,us))return;const e=p(this,us,document.createElement("div"));if(e.className="popup",r(this,ar)){const n=e.style.outlineColor=$.makeHexColor(...r(this,ar));CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?e.style.backgroundColor=`color-mix(in srgb, ${n} 30%, white)`:e.style.backgroundColor=$.makeHexColor(...r(this,ar).map(o=>Math.floor(.7*(255-o)+o)))}const t=document.createElement("span");t.className="header";const s=document.createElement("h1");if(t.append(s),{dir:s.dir,str:s.textContent}=r(this,Rl),e.append(t),r(this,Pa)){const n=document.createElement("span");n.classList.add("popupDate"),n.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),n.setAttribute("data-l10n-args",JSON.stringify({dateObj:r(this,Pa).valueOf()})),t.append(n)}const i=r(this,ft,Uc);if(i)_p.render({xfaHtml:i,intent:"richText",div:e}),e.lastChild.classList.add("richText","popupContent");else{const n=this._formatContents(r(this,ui));e.append(n)}r(this,kt).append(e)}_formatContents({str:e,dir:t}){const s=document.createElement("p");s.classList.add("popupContent"),s.dir=t;const i=e.split(/(?:\r\n?|\n)/);for(let n=0,a=i.length;n<a;++n){const o=i[n];s.append(document.createTextNode(o)),n<a-1&&s.append(document.createElement("br"))}return s}updateEdited({rect:e,popupContent:t}){var s;r(this,or)||p(this,or,{contentsObj:r(this,ui),richText:r(this,gi)}),e&&p(this,pi,null),t&&(p(this,gi,v(this,ft,Lp).call(this,t)),p(this,ui,null)),(s=r(this,us))==null||s.remove(),p(this,us,null)}resetEdited(){var e;r(this,or)&&({contentsObj:de(this,ui)._,richText:de(this,gi)._}=r(this,or),p(this,or,null),(e=r(this,us))==null||e.remove(),p(this,us,null),p(this,pi,null))}forceHide(){p(this,lr,this.isVisible),r(this,lr)&&(r(this,kt).hidden=!0)}maybeShow(){r(this,lr)&&(r(this,us)||v(this,ft,Wc).call(this),p(this,lr,!1),r(this,kt).hidden=!1)}get isVisible(){return r(this,kt).hidden===!1}}ka=new WeakMap,Eh=new WeakMap,Ch=new WeakMap,Ta=new WeakMap,ar=new WeakMap,kt=new WeakMap,ui=new WeakMap,Pa=new WeakMap,Pl=new WeakMap,Ll=new WeakMap,La=new WeakMap,fi=new WeakMap,us=new WeakMap,pi=new WeakMap,Ml=new WeakMap,gi=new WeakMap,Rl=new WeakMap,or=new WeakMap,lr=new WeakMap,ft=new WeakSet,Uc=function(){const e=r(this,gi),t=r(this,ui);return e!=null&&e.str&&(!(t!=null&&t.str)||t.str===e.str)&&r(this,gi).html||null},Od=function(){var e,t,s;return((s=(t=(e=r(this,ft,Uc))==null?void 0:e.attributes)==null?void 0:t.style)==null?void 0:s.fontSize)||0},Pp=function(){var e,t,s;return((s=(t=(e=r(this,ft,Uc))==null?void 0:e.attributes)==null?void 0:t.style)==null?void 0:s.color)||null},Lp=function(e){const t=[],s={str:e,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:t}]}},i={style:{color:r(this,ft,Pp),fontSize:r(this,ft,Od)?`calc(${r(this,ft,Od)}px * var(--scale-factor))`:""}};for(const n of e.split(`
`))t.push({name:"span",value:n,attributes:i});return s},Mp=function(e){e.altKey||e.shiftKey||e.ctrlKey||e.metaKey||(e.key==="Enter"||e.key==="Escape"&&r(this,fi))&&v(this,ft,Gc).call(this)},Rp=function(){if(r(this,pi)!==null)return;const{page:{view:e},viewport:{rawDims:{pageWidth:t,pageHeight:s,pageX:i,pageY:n}}}=r(this,Ll);let a=!!r(this,La),o=a?r(this,La):r(this,Ml);for(const m of r(this,Pl))if(!o||$.intersect(m.data.rect,o)!==null){o=m.data.rect,a=!0;break}const l=$.normalizeRect([o[0],e[3]-o[1]+e[1],o[2],e[3]-o[3]+e[1]]),d=a?o[2]-o[0]+5:0,u=l[0]+d,f=l[1];p(this,pi,[100*(u-i)/t,100*(f-n)/s]);const{style:g}=r(this,kt);g.left=`${r(this,pi)[0]}%`,g.top=`${r(this,pi)[1]}%`},Gc=function(){p(this,fi,!r(this,fi)),r(this,fi)?(v(this,ft,Wc).call(this),r(this,kt).addEventListener("click",r(this,Ta)),r(this,kt).addEventListener("keydown",r(this,ka))):(v(this,ft,zd).call(this),r(this,kt).removeEventListener("click",r(this,Ta)),r(this,kt).removeEventListener("keydown",r(this,ka)))},Wc=function(){r(this,us)||this.render(),this.isVisible?r(this,fi)&&r(this,kt).classList.add("focused"):(v(this,ft,Rp).call(this),r(this,kt).hidden=!1,r(this,kt).style.zIndex=parseInt(r(this,kt).style.zIndex)+1e3)},zd=function(){r(this,kt).classList.remove("focused"),!(r(this,fi)||!this.isVisible)&&(r(this,kt).hidden=!0,r(this,kt).style.zIndex=parseInt(r(this,kt).style.zIndex)-1e3)};class Ip extends Lt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.textContent=e.data.textContent,this.textPosition=e.data.textPosition,this.annotationEditorType=X.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const e=document.createElement("div");e.classList.add("annotationTextContent"),e.setAttribute("role","comment");for(const t of this.textContent){const s=document.createElement("span");s.textContent=t,e.append(s)}this.container.append(e)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}var Il;class ry extends Lt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});A(this,Il,null)}render(){this.container.classList.add("lineAnnotation");const t=this.data,{width:s,height:i}=hn(t.rect),n=this.svgFactory.create(s,i,!0),a=p(this,Il,this.svgFactory.createElement("svg:line"));return a.setAttribute("x1",t.rect[2]-t.lineCoordinates[0]),a.setAttribute("y1",t.rect[3]-t.lineCoordinates[1]),a.setAttribute("x2",t.rect[2]-t.lineCoordinates[2]),a.setAttribute("y2",t.rect[3]-t.lineCoordinates[3]),a.setAttribute("stroke-width",t.borderStyle.width||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),n.append(a),this.container.append(n),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return r(this,Il)}addHighlightArea(){this.container.classList.add("highlightArea")}}Il=new WeakMap;var Dl;class ay extends Lt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});A(this,Dl,null)}render(){this.container.classList.add("squareAnnotation");const t=this.data,{width:s,height:i}=hn(t.rect),n=this.svgFactory.create(s,i,!0),a=t.borderStyle.width,o=p(this,Dl,this.svgFactory.createElement("svg:rect"));return o.setAttribute("x",a/2),o.setAttribute("y",a/2),o.setAttribute("width",s-a),o.setAttribute("height",i-a),o.setAttribute("stroke-width",a||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),n.append(o),this.container.append(n),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return r(this,Dl)}addHighlightArea(){this.container.classList.add("highlightArea")}}Dl=new WeakMap;var Nl;class oy extends Lt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});A(this,Nl,null)}render(){this.container.classList.add("circleAnnotation");const t=this.data,{width:s,height:i}=hn(t.rect),n=this.svgFactory.create(s,i,!0),a=t.borderStyle.width,o=p(this,Nl,this.svgFactory.createElement("svg:ellipse"));return o.setAttribute("cx",s/2),o.setAttribute("cy",i/2),o.setAttribute("rx",s/2-a/2),o.setAttribute("ry",i/2-a/2),o.setAttribute("stroke-width",a||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),n.append(o),this.container.append(n),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return r(this,Nl)}addHighlightArea(){this.container.classList.add("highlightArea")}}Nl=new WeakMap;var Fl;class Dp extends Lt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});A(this,Fl,null);this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,vertices:s,borderStyle:i,popupRef:n}}=this;if(!s)return this.container;const{width:a,height:o}=hn(t),l=this.svgFactory.create(a,o,!0);let c=[];for(let u=0,f=s.length;u<f;u+=2){const g=s[u]-t[0],m=t[3]-s[u+1];c.push(`${g},${m}`)}c=c.join(" ");const d=p(this,Fl,this.svgFactory.createElement(this.svgElementName));return d.setAttribute("points",c),d.setAttribute("stroke-width",i.width||1),d.setAttribute("stroke","transparent"),d.setAttribute("fill","transparent"),l.append(d),this.container.append(l),!n&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return r(this,Fl)}addHighlightArea(){this.container.classList.add("highlightArea")}}Fl=new WeakMap;class ly extends Dp{constructor(e){super(e),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class cy extends Lt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}var jl,cr,Ol,$d;class Cu extends Lt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});A(this,Ol);A(this,jl,null);A(this,cr,[]);this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?X.HIGHLIGHT:X.INK}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,rotation:s,inkLists:i,borderStyle:n,popupRef:a}}=this,{transform:o,width:l,height:c}=v(this,Ol,$d).call(this,s,t),d=this.svgFactory.create(l,c,!0),u=p(this,jl,this.svgFactory.createElement("svg:g"));d.append(u),u.setAttribute("stroke-width",n.width||1),u.setAttribute("stroke-linecap","round"),u.setAttribute("stroke-linejoin","round"),u.setAttribute("stroke-miterlimit",10),u.setAttribute("stroke","transparent"),u.setAttribute("fill","transparent"),u.setAttribute("transform",o);for(let f=0,g=i.length;f<g;f++){const m=this.svgFactory.createElement(this.svgElementName);r(this,cr).push(m),m.setAttribute("points",i[f].join(",")),u.append(m)}return!a&&this.hasPopupData&&this._createPopup(),this.container.append(d),this._editOnDoubleClick(),this.container}updateEdited(t){super.updateEdited(t);const{thickness:s,points:i,rect:n}=t,a=r(this,jl);if(s>=0&&a.setAttribute("stroke-width",s||1),i)for(let o=0,l=r(this,cr).length;o<l;o++)r(this,cr)[o].setAttribute("points",i[o].join(","));if(n){const{transform:o,width:l,height:c}=v(this,Ol,$d).call(this,this.data.rotation,n);a.parentElement.setAttribute("viewBox",`0 0 ${l} ${c}`),a.setAttribute("transform",o)}}getElementsToTriggerPopup(){return r(this,cr)}addHighlightArea(){this.container.classList.add("highlightArea")}}jl=new WeakMap,cr=new WeakMap,Ol=new WeakSet,$d=function(t,s){switch(t){case 90:return{transform:`rotate(90) translate(${-s[0]},${s[1]}) scale(1,-1)`,width:s[3]-s[1],height:s[2]-s[0]};case 180:return{transform:`rotate(180) translate(${-s[2]},${s[1]}) scale(1,-1)`,width:s[2]-s[0],height:s[3]-s[1]};case 270:return{transform:`rotate(270) translate(${-s[2]},${s[3]}) scale(1,-1)`,width:s[3]-s[1],height:s[2]-s[0]};default:return{transform:`translate(${-s[0]},${s[3]}) scale(1,-1)`,width:s[2]-s[0],height:s[3]-s[1]}}};class Np extends Lt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=X.HIGHLIGHT}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),this.container}}class hy extends Lt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}}class dy extends Lt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}}class uy extends Lt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}}class Fp extends Lt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=X.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}var zl,$l,Bd;class fy extends Lt{constructor(t){var i;super(t,{isRenderable:!0});A(this,$l);A(this,zl,null);const{file:s}=this.data;this.filename=s.filename,this.content=s.content,(i=this.linkService.eventBus)==null||i.dispatch("fileattachmentannotation",{source:this,...s})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:t,data:s}=this;let i;s.hasAppearance||s.fillAlpha===0?i=document.createElement("div"):(i=document.createElement("img"),i.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(s.name)?"paperclip":"pushpin"}.svg`,s.fillAlpha&&s.fillAlpha<1&&(i.style=`filter: opacity(${Math.round(s.fillAlpha*100)}%);`)),i.addEventListener("dblclick",v(this,$l,Bd).bind(this)),p(this,zl,i);const{isMac:n}=ye.platform;return t.addEventListener("keydown",a=>{a.key==="Enter"&&(n?a.metaKey:a.ctrlKey)&&v(this,$l,Bd).call(this)}),!s.popupRef&&this.hasPopupData?this._createPopup():i.classList.add("popupTriggerArea"),t.append(i),t}getElementsToTriggerPopup(){return r(this,zl)}addHighlightArea(){this.container.classList.add("highlightArea")}}zl=new WeakMap,$l=new WeakSet,Bd=function(){var t;(t=this.downloadManager)==null||t.openOrDownloadData(this.content,this.filename)};var Bl,hr,dr,Hl,Ir,jp,Hd;class py{constructor({div:e,accessibilityManager:t,annotationCanvasMap:s,annotationEditorUIManager:i,page:n,viewport:a,structTreeLayer:o}){A(this,Ir);A(this,Bl,null);A(this,hr,null);A(this,dr,new Map);A(this,Hl,null);this.div=e,p(this,Bl,t),p(this,hr,s),p(this,Hl,o||null),this.page=n,this.viewport=a,this.zIndex=0,this._annotationEditorUIManager=i}hasEditableAnnotations(){return r(this,dr).size>0}async render(e){var a;const{annotations:t}=e,s=this.div;Lr(s,this.viewport);const i=new Map,n={data:null,layer:s,linkService:e.linkService,downloadManager:e.downloadManager,imageResourcesPath:e.imageResourcesPath||"",renderForms:e.renderForms!==!1,svgFactory:new Eu,annotationStorage:e.annotationStorage||new Su,enableScripting:e.enableScripting===!0,hasJSActions:e.hasJSActions,fieldObjects:e.fieldObjects,parent:this,elements:null};for(const o of t){if(o.noHTML)continue;const l=o.annotationType===Ft.POPUP;if(l){const u=i.get(o.id);if(!u)continue;n.elements=u}else{const{width:u,height:f}=hn(o.rect);if(u<=0||f<=0)continue}n.data=o;const c=Zb.create(n);if(!c.isRenderable)continue;if(!l&&o.popupRef){const u=i.get(o.popupRef);u?u.push(c):i.set(o.popupRef,[c])}const d=c.render();o.hidden&&(d.style.visibility="hidden"),await v(this,Ir,jp).call(this,d,o.id),c._isEditable&&(r(this,dr).set(c.data.id,c),(a=this._annotationEditorUIManager)==null||a.renderAnnotationElement(c))}v(this,Ir,Hd).call(this)}update({viewport:e}){const t=this.div;this.viewport=e,Lr(t,{rotation:e.rotation}),v(this,Ir,Hd).call(this),t.hidden=!1}getEditableAnnotations(){return Array.from(r(this,dr).values())}getEditableAnnotation(e){return r(this,dr).get(e)}}Bl=new WeakMap,hr=new WeakMap,dr=new WeakMap,Hl=new WeakMap,Ir=new WeakSet,jp=async function(e,t){var a,o;const s=e.firstChild||e,i=s.id=`${yu}${t}`,n=await((a=r(this,Hl))==null?void 0:a.getAriaAttributes(i));if(n)for(const[l,c]of n)s.setAttribute(l,c);this.div.append(e),(o=r(this,Bl))==null||o.moveElementInDOM(this.div,e,s,!1)},Hd=function(){if(!r(this,hr))return;const e=this.div;for(const[t,s]of r(this,hr)){const i=e.querySelector(`[data-annotation-id="${t}"]`);if(!i)continue;s.className="annotationContent";const{firstChild:n}=i;n?n.nodeName==="CANVAS"?n.replaceWith(s):n.classList.contains("annotationContent")?n.after(s):n.before(s):i.append(s)}r(this,hr).clear()};const Ec=/\r\n?|\n/g;var fs,De,Ul,ur,Ne,Dt,Op,zp,$p,Vc,Ei,qc,Xc,Bp,Gd,Hp;const bt=class bt extends Et{constructor(t){super({...t,name:"freeTextEditor"});A(this,Dt);A(this,fs);A(this,De,"");A(this,Ul,`${this.id}-editor`);A(this,ur,null);A(this,Ne);p(this,fs,t.color||bt._defaultColor||Et._defaultLineColor),p(this,Ne,t.fontSize||bt._defaultFontSize)}static get _keyboardManager(){const t=bt.prototype,s=a=>a.isEmpty(),i=Mr.TRANSLATE_SMALL,n=Mr.TRANSLATE_BIG;return tt(this,"_keyboardManager",new hc([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],t.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],t.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],t._translateEmpty,{args:[-i,0],checker:s}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t._translateEmpty,{args:[-n,0],checker:s}],[["ArrowRight","mac+ArrowRight"],t._translateEmpty,{args:[i,0],checker:s}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t._translateEmpty,{args:[n,0],checker:s}],[["ArrowUp","mac+ArrowUp"],t._translateEmpty,{args:[0,-i],checker:s}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t._translateEmpty,{args:[0,-n],checker:s}],[["ArrowDown","mac+ArrowDown"],t._translateEmpty,{args:[0,i],checker:s}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t._translateEmpty,{args:[0,n],checker:s}]]))}static initialize(t,s){Et.initialize(t,s);const i=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(i.getPropertyValue("--freetext-padding"))}static updateDefaultParams(t,s){switch(t){case et.FREETEXT_SIZE:bt._defaultFontSize=s;break;case et.FREETEXT_COLOR:bt._defaultColor=s;break}}updateParams(t,s){switch(t){case et.FREETEXT_SIZE:v(this,Dt,Op).call(this,s);break;case et.FREETEXT_COLOR:v(this,Dt,zp).call(this,s);break}}static get defaultPropertiesToUpdate(){return[[et.FREETEXT_SIZE,bt._defaultFontSize],[et.FREETEXT_COLOR,bt._defaultColor||Et._defaultLineColor]]}get propertiesToUpdate(){return[[et.FREETEXT_SIZE,r(this,Ne)],[et.FREETEXT_COLOR,r(this,fs)]]}_translateEmpty(t,s){this._uiManager.translateSelectedEditors(t,s,!0)}getInitialTranslation(){const t=this.parentScale;return[-bt._internalPadding*t,-(bt._internalPadding+r(this,Ne))*t]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(this.isInEditMode())return;this.parent.setEditingState(!1),this.parent.updateToolbar(X.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),p(this,ur,new AbortController);const t=this._uiManager.combinedSignal(r(this,ur));this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:t}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:t}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:t}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:t}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:t})}disableEditMode(){var t;this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",r(this,Ul)),this._isDraggable=!0,(t=r(this,ur))==null||t.abort(),p(this,ur,null),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"))}focusin(t){this._focusEventsAllowed&&(super.focusin(t),t.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(t){var s;this.width||(this.enableEditMode(),t&&this.editorDiv.focus(),(s=this._initialOptions)!=null&&s.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const t=r(this,De),s=p(this,De,v(this,Dt,$p).call(this).trimEnd());if(t===s)return;const i=n=>{if(p(this,De,n),!n){this.remove();return}v(this,Dt,Xc).call(this),this._uiManager.rebuild(this),v(this,Dt,Vc).call(this)};this.addCommands({cmd:()=>{i(s)},undo:()=>{i(t)},mustExec:!1}),v(this,Dt,Vc).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(t){this.enterInEditMode()}keydown(t){t.target===this.div&&t.key==="Enter"&&(this.enterInEditMode(),t.preventDefault())}editorDivKeydown(t){bt._keyboardManager.exec(this,t)}editorDivFocus(t){this.isEditing=!0}editorDivBlur(t){this.isEditing=!1}editorDivInput(t){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let t,s;this.width&&(t=this.x,s=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",r(this,Ul)),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:i}=this.editorDiv;if(i.fontSize=`calc(${r(this,Ne)}px * var(--scale-factor))`,i.color=r(this,fs),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),ah(this,this.div,["dblclick","keydown"]),this.width){const[n,a]=this.parentDimensions;if(this.annotationElementId){const{position:o}=this._initialData;let[l,c]=this.getInitialTranslation();[l,c]=this.pageTranslationToScreen(l,c);const[d,u]=this.pageDimensions,[f,g]=this.pageTranslation;let m,y;switch(this.rotation){case 0:m=t+(o[0]-f)/d,y=s+this.height-(o[1]-g)/u;break;case 90:m=t+(o[0]-f)/d,y=s-(o[1]-g)/u,[l,c]=[c,-l];break;case 180:m=t-this.width+(o[0]-f)/d,y=s-(o[1]-g)/u,[l,c]=[-l,-c];break;case 270:m=t+(o[0]-f-this.height*u)/d,y=s+(o[1]-g-this.width*d)/u,[l,c]=[-c,l];break}this.setAt(m*n,y*a,l,c)}else this.setAt(t*n,s*a,this.width*n,this.height*a);v(this,Dt,Xc).call(this),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}editorDivPaste(t){var m,y,w;const s=t.clipboardData||window.clipboardData,{types:i}=s;if(i.length===1&&i[0]==="text/plain")return;t.preventDefault();const n=v(m=bt,Ei,Gd).call(m,s.getData("text")||"").replaceAll(Ec,`
`);if(!n)return;const a=window.getSelection();if(!a.rangeCount)return;this.editorDiv.normalize(),a.deleteFromDocument();const o=a.getRangeAt(0);if(!n.includes(`
`)){o.insertNode(document.createTextNode(n)),this.editorDiv.normalize(),a.collapseToStart();return}const{startContainer:l,startOffset:c}=o,d=[],u=[];if(l.nodeType===Node.TEXT_NODE){const x=l.parentElement;if(u.push(l.nodeValue.slice(c).replaceAll(Ec,"")),x!==this.editorDiv){let S=d;for(const _ of this.editorDiv.childNodes){if(_===x){S=u;continue}S.push(v(y=bt,Ei,qc).call(y,_))}}d.push(l.nodeValue.slice(0,c).replaceAll(Ec,""))}else if(l===this.editorDiv){let x=d,S=0;for(const _ of this.editorDiv.childNodes)S++===c&&(x=u),x.push(v(w=bt,Ei,qc).call(w,_))}p(this,De,`${d.join(`
`)}${n}${u.join(`
`)}`),v(this,Dt,Xc).call(this);const f=new Range;let g=d.reduce((x,S)=>x+S.length,0);for(const{firstChild:x}of this.editorDiv.childNodes)if(x.nodeType===Node.TEXT_NODE){const S=x.nodeValue.length;if(g<=S){f.setStart(x,g),f.setEnd(x,g);break}g-=S}a.removeAllRanges(),a.addRange(f)}get contentDiv(){return this.editorDiv}static async deserialize(t,s,i){var o;let n=null;if(t instanceof Ip){const{data:{defaultAppearanceData:{fontSize:l,fontColor:c},rect:d,rotation:u,id:f,popupRef:g},textContent:m,textPosition:y,parent:{page:{pageNumber:w}}}=t;if(!m||m.length===0)return null;n=t={annotationType:X.FREETEXT,color:Array.from(c),fontSize:l,value:m.join(`
`),position:y,pageIndex:w-1,rect:d.slice(0),rotation:u,id:f,deleted:!1,popupRef:g}}const a=await super.deserialize(t,s,i);return p(a,Ne,t.fontSize),p(a,fs,$.makeHexColor(...t.color)),p(a,De,v(o=bt,Ei,Gd).call(o,t.value)),a.annotationElementId=t.id||null,a._initialData=n,a}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const s=bt._internalPadding*this.parentScale,i=this.getRect(s,s),n=Et._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:r(this,fs)),a={annotationType:X.FREETEXT,color:n,fontSize:r(this,Ne),value:v(this,Dt,Bp).call(this),pageIndex:this.pageIndex,rect:i,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return t?a:this.annotationElementId&&!v(this,Dt,Hp).call(this,a)?null:(a.id=this.annotationElementId,a)}renderAnnotationElement(t){const s=super.renderAnnotationElement(t);if(this.deleted)return s;const{style:i}=s;i.fontSize=`calc(${r(this,Ne)}px * var(--scale-factor))`,i.color=r(this,fs),s.replaceChildren();for(const a of r(this,De).split(`
`)){const o=document.createElement("div");o.append(a?document.createTextNode(a):document.createElement("br")),s.append(o)}const n=bt._internalPadding*this.parentScale;return t.updateEdited({rect:this.getRect(n,n),popupContent:r(this,De)}),s}resetAnnotationElement(t){super.resetAnnotationElement(t),t.resetEdited()}};fs=new WeakMap,De=new WeakMap,Ul=new WeakMap,ur=new WeakMap,Ne=new WeakMap,Dt=new WeakSet,Op=function(t){const s=n=>{this.editorDiv.style.fontSize=`calc(${n}px * var(--scale-factor))`,this.translate(0,-(n-r(this,Ne))*this.parentScale),p(this,Ne,n),v(this,Dt,Vc).call(this)},i=r(this,Ne);this.addCommands({cmd:s.bind(this,t),undo:s.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:et.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},zp=function(t){const s=n=>{p(this,fs,this.editorDiv.style.color=n)},i=r(this,fs);this.addCommands({cmd:s.bind(this,t),undo:s.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:et.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},$p=function(){var i;const t=[];this.editorDiv.normalize();let s=null;for(const n of this.editorDiv.childNodes)(s==null?void 0:s.nodeType)===Node.TEXT_NODE&&n.nodeName==="BR"||(t.push(v(i=bt,Ei,qc).call(i,n)),s=n);return t.join(`
`)},Vc=function(){const[t,s]=this.parentDimensions;let i;if(this.isAttachedToDOM)i=this.div.getBoundingClientRect();else{const{currentLayer:n,div:a}=this,o=a.style.display,l=a.classList.contains("hidden");a.classList.remove("hidden"),a.style.display="hidden",n.div.append(this.div),i=a.getBoundingClientRect(),a.remove(),a.style.display=o,a.classList.toggle("hidden",l)}this.rotation%180===this.parentRotation%180?(this.width=i.width/t,this.height=i.height/s):(this.width=i.height/t,this.height=i.width/s),this.fixAndSetPosition()},Ei=new WeakSet,qc=function(t){return(t.nodeType===Node.TEXT_NODE?t.nodeValue:t.innerText).replaceAll(Ec,"")},Xc=function(){if(this.editorDiv.replaceChildren(),!!r(this,De))for(const t of r(this,De).split(`
`)){const s=document.createElement("div");s.append(t?document.createTextNode(t):document.createElement("br")),this.editorDiv.append(s)}},Bp=function(){return r(this,De).replaceAll(" "," ")},Gd=function(t){return t.replaceAll(" "," ")},Hp=function(t){const{value:s,fontSize:i,color:n,pageIndex:a}=this._initialData;return this._hasBeenMoved||t.value!==s||t.fontSize!==i||t.color.some((o,l)=>o!==n[l])||t.pageIndex!==a},A(bt,Ei),U(bt,"_freeTextDefaultContent",""),U(bt,"_internalPadding",0),U(bt,"_defaultColor",null),U(bt,"_defaultFontSize",10),U(bt,"_type","freetext"),U(bt,"_editorType",X.FREETEXT);let Ud=bt;class N{toSVGPath(){pt("Abstract method `toSVGPath` must be implemented.")}get box(){pt("Abstract getter `box` must be implemented.")}serialize(e,t){pt("Abstract method `serialize` must be implemented.")}static _rescale(e,t,s,i,n,a){a||(a=new Float32Array(e.length));for(let o=0,l=e.length;o<l;o+=2)a[o]=t+e[o]*i,a[o+1]=s+e[o+1]*n;return a}static _rescaleAndSwap(e,t,s,i,n,a){a||(a=new Float32Array(e.length));for(let o=0,l=e.length;o<l;o+=2)a[o]=t+e[o+1]*i,a[o+1]=s+e[o]*n;return a}static _translate(e,t,s,i){i||(i=new Float32Array(e.length));for(let n=0,a=e.length;n<a;n+=2)i[n]=t+e[n],i[n+1]=s+e[n+1];return i}static svgRound(e){return Math.round(e*1e4)}static _normalizePoint(e,t,s,i,n){switch(n){case 90:return[1-t/s,e/i];case 180:return[1-e/s,1-t/i];case 270:return[t/s,1-e/i];default:return[e/s,t/i]}}static _normalizePagePoint(e,t,s){switch(s){case 90:return[1-t,e];case 180:return[1-e,1-t];case 270:return[t,1-e];default:return[e,t]}}static createBezierPoints(e,t,s,i,n,a){return[(e+5*s)/6,(t+5*i)/6,(5*s+n)/6,(5*i+a)/6,(s+n)/2,(i+a)/2]}}U(N,"PRECISION",1e-4);var Fe,ps,Ma,Ra,zs,Q,fr,pr,Gl,Wl,Ia,Da,Ji,Vl,kh,Th,$t,So,Up,Gp,Wp,Vp,qp,Xp;const Zs=class Zs{constructor({x:e,y:t},s,i,n,a,o=0){A(this,$t);A(this,Fe);A(this,ps,[]);A(this,Ma);A(this,Ra);A(this,zs,[]);A(this,Q,new Float32Array(18));A(this,fr);A(this,pr);A(this,Gl);A(this,Wl);A(this,Ia);A(this,Da);A(this,Ji,[]);p(this,Fe,s),p(this,Da,n*i),p(this,Ra,a),r(this,Q).set([NaN,NaN,NaN,NaN,e,t],6),p(this,Ma,o),p(this,Wl,r(Zs,Vl)*i),p(this,Gl,r(Zs,Th)*i),p(this,Ia,i),r(this,Ji).push(e,t)}isEmpty(){return isNaN(r(this,Q)[8])}add({x:e,y:t}){var O;p(this,fr,e),p(this,pr,t);const[s,i,n,a]=r(this,Fe);let[o,l,c,d]=r(this,Q).subarray(8,12);const u=e-c,f=t-d,g=Math.hypot(u,f);if(g<r(this,Gl))return!1;const m=g-r(this,Wl),y=m/g,w=y*u,x=y*f;let S=o,_=l;o=c,l=d,c+=w,d+=x,(O=r(this,Ji))==null||O.push(e,t);const C=-x/m,k=w/m,T=C*r(this,Da),P=k*r(this,Da);return r(this,Q).set(r(this,Q).subarray(2,8),0),r(this,Q).set([c+T,d+P],4),r(this,Q).set(r(this,Q).subarray(14,18),12),r(this,Q).set([c-T,d-P],16),isNaN(r(this,Q)[6])?(r(this,zs).length===0&&(r(this,Q).set([o+T,l+P],2),r(this,zs).push(NaN,NaN,NaN,NaN,(o+T-s)/n,(l+P-i)/a),r(this,Q).set([o-T,l-P],14),r(this,ps).push(NaN,NaN,NaN,NaN,(o-T-s)/n,(l-P-i)/a)),r(this,Q).set([S,_,o,l,c,d],6),!this.isEmpty()):(r(this,Q).set([S,_,o,l,c,d],6),Math.abs(Math.atan2(_-l,S-o)-Math.atan2(x,w))<Math.PI/2?([o,l,c,d]=r(this,Q).subarray(2,6),r(this,zs).push(NaN,NaN,NaN,NaN,((o+c)/2-s)/n,((l+d)/2-i)/a),[o,l,S,_]=r(this,Q).subarray(14,18),r(this,ps).push(NaN,NaN,NaN,NaN,((S+o)/2-s)/n,((_+l)/2-i)/a),!0):([S,_,o,l,c,d]=r(this,Q).subarray(0,6),r(this,zs).push(((S+5*o)/6-s)/n,((_+5*l)/6-i)/a,((5*o+c)/6-s)/n,((5*l+d)/6-i)/a,((o+c)/2-s)/n,((l+d)/2-i)/a),[c,d,o,l,S,_]=r(this,Q).subarray(12,18),r(this,ps).push(((S+5*o)/6-s)/n,((_+5*l)/6-i)/a,((5*o+c)/6-s)/n,((5*l+d)/6-i)/a,((o+c)/2-s)/n,((l+d)/2-i)/a),!0))}toSVGPath(){if(this.isEmpty())return"";const e=r(this,zs),t=r(this,ps);if(isNaN(r(this,Q)[6])&&!this.isEmpty())return v(this,$t,Up).call(this);const s=[];s.push(`M${e[4]} ${e[5]}`);for(let i=6;i<e.length;i+=6)isNaN(e[i])?s.push(`L${e[i+4]} ${e[i+5]}`):s.push(`C${e[i]} ${e[i+1]} ${e[i+2]} ${e[i+3]} ${e[i+4]} ${e[i+5]}`);v(this,$t,Wp).call(this,s);for(let i=t.length-6;i>=6;i-=6)isNaN(t[i])?s.push(`L${t[i+4]} ${t[i+5]}`):s.push(`C${t[i]} ${t[i+1]} ${t[i+2]} ${t[i+3]} ${t[i+4]} ${t[i+5]}`);return v(this,$t,Gp).call(this,s),s.join(" ")}newFreeDrawOutline(e,t,s,i,n,a){return new Yp(e,t,s,i,n,a)}getOutlines(){var u;const e=r(this,zs),t=r(this,ps),s=r(this,Q),[i,n,a,o]=r(this,Fe),l=new Float32Array((((u=r(this,Ji))==null?void 0:u.length)??0)+2);for(let f=0,g=l.length-2;f<g;f+=2)l[f]=(r(this,Ji)[f]-i)/a,l[f+1]=(r(this,Ji)[f+1]-n)/o;if(l[l.length-2]=(r(this,fr)-i)/a,l[l.length-1]=(r(this,pr)-n)/o,isNaN(s[6])&&!this.isEmpty())return v(this,$t,Vp).call(this,l);const c=new Float32Array(r(this,zs).length+24+r(this,ps).length);let d=e.length;for(let f=0;f<d;f+=2){if(isNaN(e[f])){c[f]=c[f+1]=NaN;continue}c[f]=e[f],c[f+1]=e[f+1]}d=v(this,$t,Xp).call(this,c,d);for(let f=t.length-6;f>=6;f-=6)for(let g=0;g<6;g+=2){if(isNaN(t[f+g])){c[d]=c[d+1]=NaN,d+=2;continue}c[d]=t[f+g],c[d+1]=t[f+g+1],d+=2}return v(this,$t,qp).call(this,c,d),this.newFreeDrawOutline(c,l,r(this,Fe),r(this,Ia),r(this,Ma),r(this,Ra))}};Fe=new WeakMap,ps=new WeakMap,Ma=new WeakMap,Ra=new WeakMap,zs=new WeakMap,Q=new WeakMap,fr=new WeakMap,pr=new WeakMap,Gl=new WeakMap,Wl=new WeakMap,Ia=new WeakMap,Da=new WeakMap,Ji=new WeakMap,Vl=new WeakMap,kh=new WeakMap,Th=new WeakMap,$t=new WeakSet,So=function(){const e=r(this,Q).subarray(4,6),t=r(this,Q).subarray(16,18),[s,i,n,a]=r(this,Fe);return[(r(this,fr)+(e[0]-t[0])/2-s)/n,(r(this,pr)+(e[1]-t[1])/2-i)/a,(r(this,fr)+(t[0]-e[0])/2-s)/n,(r(this,pr)+(t[1]-e[1])/2-i)/a]},Up=function(){const[e,t,s,i]=r(this,Fe),[n,a,o,l]=v(this,$t,So).call(this);return`M${(r(this,Q)[2]-e)/s} ${(r(this,Q)[3]-t)/i} L${(r(this,Q)[4]-e)/s} ${(r(this,Q)[5]-t)/i} L${n} ${a} L${o} ${l} L${(r(this,Q)[16]-e)/s} ${(r(this,Q)[17]-t)/i} L${(r(this,Q)[14]-e)/s} ${(r(this,Q)[15]-t)/i} Z`},Gp=function(e){const t=r(this,ps);e.push(`L${t[4]} ${t[5]} Z`)},Wp=function(e){const[t,s,i,n]=r(this,Fe),a=r(this,Q).subarray(4,6),o=r(this,Q).subarray(16,18),[l,c,d,u]=v(this,$t,So).call(this);e.push(`L${(a[0]-t)/i} ${(a[1]-s)/n} L${l} ${c} L${d} ${u} L${(o[0]-t)/i} ${(o[1]-s)/n}`)},Vp=function(e){const t=r(this,Q),[s,i,n,a]=r(this,Fe),[o,l,c,d]=v(this,$t,So).call(this),u=new Float32Array(36);return u.set([NaN,NaN,NaN,NaN,(t[2]-s)/n,(t[3]-i)/a,NaN,NaN,NaN,NaN,(t[4]-s)/n,(t[5]-i)/a,NaN,NaN,NaN,NaN,o,l,NaN,NaN,NaN,NaN,c,d,NaN,NaN,NaN,NaN,(t[16]-s)/n,(t[17]-i)/a,NaN,NaN,NaN,NaN,(t[14]-s)/n,(t[15]-i)/a],0),this.newFreeDrawOutline(u,e,r(this,Fe),r(this,Ia),r(this,Ma),r(this,Ra))},qp=function(e,t){const s=r(this,ps);return e.set([NaN,NaN,NaN,NaN,s[4],s[5]],t),t+=6},Xp=function(e,t){const s=r(this,Q).subarray(4,6),i=r(this,Q).subarray(16,18),[n,a,o,l]=r(this,Fe),[c,d,u,f]=v(this,$t,So).call(this);return e.set([NaN,NaN,NaN,NaN,(s[0]-n)/o,(s[1]-a)/l,NaN,NaN,NaN,NaN,c,d,NaN,NaN,NaN,NaN,u,f,NaN,NaN,NaN,NaN,(i[0]-n)/o,(i[1]-a)/l],t),t+=24},A(Zs,Vl,8),A(Zs,kh,2),A(Zs,Th,r(Zs,Vl)+r(Zs,kh));let ch=Zs;var Na,gr,mi,ql,je,Xl,Pt,Ph,Kp;class Yp extends N{constructor(t,s,i,n,a,o){super();A(this,Ph);A(this,Na);A(this,gr,new Float32Array(4));A(this,mi);A(this,ql);A(this,je);A(this,Xl);A(this,Pt);p(this,Pt,t),p(this,je,s),p(this,Na,i),p(this,Xl,n),p(this,mi,a),p(this,ql,o),this.lastPoint=[NaN,NaN],v(this,Ph,Kp).call(this,o);const[l,c,d,u]=r(this,gr);for(let f=0,g=t.length;f<g;f+=2)t[f]=(t[f]-l)/d,t[f+1]=(t[f+1]-c)/u;for(let f=0,g=s.length;f<g;f+=2)s[f]=(s[f]-l)/d,s[f+1]=(s[f+1]-c)/u}toSVGPath(){const t=[`M${r(this,Pt)[4]} ${r(this,Pt)[5]}`];for(let s=6,i=r(this,Pt).length;s<i;s+=6){if(isNaN(r(this,Pt)[s])){t.push(`L${r(this,Pt)[s+4]} ${r(this,Pt)[s+5]}`);continue}t.push(`C${r(this,Pt)[s]} ${r(this,Pt)[s+1]} ${r(this,Pt)[s+2]} ${r(this,Pt)[s+3]} ${r(this,Pt)[s+4]} ${r(this,Pt)[s+5]}`)}return t.push("Z"),t.join(" ")}serialize([t,s,i,n],a){const o=i-t,l=n-s;let c,d;switch(a){case 0:c=N._rescale(r(this,Pt),t,n,o,-l),d=N._rescale(r(this,je),t,n,o,-l);break;case 90:c=N._rescaleAndSwap(r(this,Pt),t,s,o,l),d=N._rescaleAndSwap(r(this,je),t,s,o,l);break;case 180:c=N._rescale(r(this,Pt),i,s,-o,l),d=N._rescale(r(this,je),i,s,-o,l);break;case 270:c=N._rescaleAndSwap(r(this,Pt),i,n,-o,-l),d=N._rescaleAndSwap(r(this,je),i,n,-o,-l);break}return{outline:Array.from(c),points:[Array.from(d)]}}get box(){return r(this,gr)}newOutliner(t,s,i,n,a,o=0){return new ch(t,s,i,n,a,o)}getNewOutline(t,s){const[i,n,a,o]=r(this,gr),[l,c,d,u]=r(this,Na),f=a*d,g=o*u,m=i*d+l,y=n*u+c,w=this.newOutliner({x:r(this,je)[0]*f+m,y:r(this,je)[1]*g+y},r(this,Na),r(this,Xl),t,r(this,ql),s??r(this,mi));for(let x=2;x<r(this,je).length;x+=2)w.add({x:r(this,je)[x]*f+m,y:r(this,je)[x+1]*g+y});return w.getOutlines()}}Na=new WeakMap,gr=new WeakMap,mi=new WeakMap,ql=new WeakMap,je=new WeakMap,Xl=new WeakMap,Pt=new WeakMap,Ph=new WeakSet,Kp=function(t){const s=r(this,Pt);let i=s[4],n=s[5],a=i,o=n,l=i,c=n,d=i,u=n;const f=t?Math.max:Math.min;for(let m=6,y=s.length;m<y;m+=6){if(isNaN(s[m]))a=Math.min(a,s[m+4]),o=Math.min(o,s[m+5]),l=Math.max(l,s[m+4]),c=Math.max(c,s[m+5]),u<s[m+5]?(d=s[m+4],u=s[m+5]):u===s[m+5]&&(d=f(d,s[m+4]));else{const w=$.bezierBoundingBox(i,n,...s.slice(m,m+6));a=Math.min(a,w[0]),o=Math.min(o,w[1]),l=Math.max(l,w[2]),c=Math.max(c,w[3]),u<w[3]?(d=w[2],u=w[3]):u===w[3]&&(d=f(d,w[2]))}i=s[m+4],n=s[m+5]}const g=r(this,gr);g[0]=a-r(this,mi),g[1]=o-r(this,mi),g[2]=l-a+2*r(this,mi),g[3]=c-o+2*r(this,mi),this.lastPoint=[d,u]};var Yl,Kl,Qi,gs,ve,Zp,Yc,Jp,Qp,Vd;class Wd{constructor(e,t=0,s=0,i=!0){A(this,ve);A(this,Yl);A(this,Kl);A(this,Qi,[]);A(this,gs,[]);let n=1/0,a=-1/0,o=1/0,l=-1/0;const c=10**-4;for(const{x:w,y:x,width:S,height:_}of e){const C=Math.floor((w-t)/c)*c,k=Math.ceil((w+S+t)/c)*c,T=Math.floor((x-t)/c)*c,P=Math.ceil((x+_+t)/c)*c,D=[C,T,P,!0],O=[k,T,P,!1];r(this,Qi).push(D,O),n=Math.min(n,C),a=Math.max(a,k),o=Math.min(o,T),l=Math.max(l,P)}const d=a-n+2*s,u=l-o+2*s,f=n-s,g=o-s,m=r(this,Qi).at(i?-1:-2),y=[m[0],m[2]];for(const w of r(this,Qi)){const[x,S,_]=w;w[0]=(x-f)/d,w[1]=(S-g)/u,w[2]=(_-g)/u}p(this,Yl,new Float32Array([f,g,d,u])),p(this,Kl,y)}getOutlines(){r(this,Qi).sort((t,s)=>t[0]-s[0]||t[1]-s[1]||t[2]-s[2]);const e=[];for(const t of r(this,Qi))t[3]?(e.push(...v(this,ve,Vd).call(this,t)),v(this,ve,Jp).call(this,t)):(v(this,ve,Qp).call(this,t),e.push(...v(this,ve,Vd).call(this,t)));return v(this,ve,Zp).call(this,e)}}Yl=new WeakMap,Kl=new WeakMap,Qi=new WeakMap,gs=new WeakMap,ve=new WeakSet,Zp=function(e){const t=[],s=new Set;for(const a of e){const[o,l,c]=a;t.push([o,l,a],[o,c,a])}t.sort((a,o)=>a[1]-o[1]||a[0]-o[0]);for(let a=0,o=t.length;a<o;a+=2){const l=t[a][2],c=t[a+1][2];l.push(c),c.push(l),s.add(l),s.add(c)}const i=[];let n;for(;s.size>0;){const a=s.values().next().value;let[o,l,c,d,u]=a;s.delete(a);let f=o,g=l;for(n=[o,c],i.push(n);;){let m;if(s.has(d))m=d;else if(s.has(u))m=u;else break;s.delete(m),[o,l,c,d,u]=m,f!==o&&(n.push(f,g,o,g===l?l:c),f=o),g=g===l?c:l}n.push(f,g)}return new gy(i,r(this,Yl),r(this,Kl))},Yc=function(e){const t=r(this,gs);let s=0,i=t.length-1;for(;s<=i;){const n=s+i>>1,a=t[n][0];if(a===e)return n;a<e?s=n+1:i=n-1}return i+1},Jp=function([,e,t]){const s=v(this,ve,Yc).call(this,e);r(this,gs).splice(s,0,[e,t])},Qp=function([,e,t]){const s=v(this,ve,Yc).call(this,e);for(let i=s;i<r(this,gs).length;i++){const[n,a]=r(this,gs)[i];if(n!==e)break;if(n===e&&a===t){r(this,gs).splice(i,1);return}}for(let i=s-1;i>=0;i--){const[n,a]=r(this,gs)[i];if(n!==e)break;if(n===e&&a===t){r(this,gs).splice(i,1);return}}},Vd=function(e){const[t,s,i]=e,n=[[t,s,i]],a=v(this,ve,Yc).call(this,i);for(let o=0;o<a;o++){const[l,c]=r(this,gs)[o];for(let d=0,u=n.length;d<u;d++){const[,f,g]=n[d];if(!(c<=f||g<=l)){if(f>=l){if(g>c)n[d][1]=c;else{if(u===1)return[];n.splice(d,1),d--,u--}continue}n[d][2]=l,g>c&&n.push([t,c,g])}}}return n};var Zl,Fa;class gy extends N{constructor(t,s,i){super();A(this,Zl);A(this,Fa);p(this,Fa,t),p(this,Zl,s),this.lastPoint=i}toSVGPath(){const t=[];for(const s of r(this,Fa)){let[i,n]=s;t.push(`M${i} ${n}`);for(let a=2;a<s.length;a+=2){const o=s[a],l=s[a+1];o===i?(t.push(`V${l}`),n=l):l===n&&(t.push(`H${o}`),i=o)}t.push("Z")}return t.join(" ")}serialize([t,s,i,n],a){const o=[],l=i-t,c=n-s;for(const d of r(this,Fa)){const u=new Array(d.length);for(let f=0;f<d.length;f+=2)u[f]=t+d[f]*l,u[f+1]=n-d[f+1]*c;o.push(u)}return o}get box(){return r(this,Zl)}get classNamesForOutlining(){return["highlightOutline"]}}Zl=new WeakMap,Fa=new WeakMap;class qd extends ch{newFreeDrawOutline(e,t,s,i,n,a){return new my(e,t,s,i,n,a)}}class my extends Yp{newOutliner(e,t,s,i,n,a=0){return new qd(e,t,s,i,n,a)}}var ms,mr,ja,zt,Jl,Oa,Ql,tc,tn,bs,za,ec,ut,Xd,Yd,Kd,xn,tg,Li;const Se=class Se{constructor({editor:e=null,uiManager:t=null}){A(this,ut);A(this,ms,null);A(this,mr,null);A(this,ja);A(this,zt,null);A(this,Jl,!1);A(this,Oa,!1);A(this,Ql,null);A(this,tc);A(this,tn,null);A(this,bs,null);A(this,za);var s;e?(p(this,Oa,!1),p(this,za,et.HIGHLIGHT_COLOR),p(this,Ql,e)):(p(this,Oa,!0),p(this,za,et.HIGHLIGHT_DEFAULT_COLOR)),p(this,bs,(e==null?void 0:e._uiManager)||t),p(this,tc,r(this,bs)._eventBus),p(this,ja,(e==null?void 0:e.color)||((s=r(this,bs))==null?void 0:s.highlightColors.values().next().value)||"#FFFF98"),r(Se,ec)||p(Se,ec,Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"}))}static get _keyboardManager(){return tt(this,"_keyboardManager",new hc([[["Escape","mac+Escape"],Se.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],Se.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],Se.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],Se.prototype._moveToPrevious],[["Home","mac+Home"],Se.prototype._moveToBeginning],[["End","mac+End"],Se.prototype._moveToEnd]]))}renderButton(){const e=p(this,ms,document.createElement("button"));e.className="colorPicker",e.tabIndex="0",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),e.setAttribute("aria-haspopup",!0);const t=r(this,bs)._signal;e.addEventListener("click",v(this,ut,xn).bind(this),{signal:t}),e.addEventListener("keydown",v(this,ut,Kd).bind(this),{signal:t});const s=p(this,mr,document.createElement("span"));return s.className="swatch",s.setAttribute("aria-hidden",!0),s.style.backgroundColor=r(this,ja),e.append(s),e}renderMainDropdown(){const e=p(this,zt,v(this,ut,Xd).call(this));return e.setAttribute("aria-orientation","horizontal"),e.setAttribute("aria-labelledby","highlightColorPickerLabel"),e}_colorSelectFromKeyboard(e){if(e.target===r(this,ms)){v(this,ut,xn).call(this,e);return}const t=e.target.getAttribute("data-color");t&&v(this,ut,Yd).call(this,t,e)}_moveToNext(e){var t,s;if(!r(this,ut,Li)){v(this,ut,xn).call(this,e);return}if(e.target===r(this,ms)){(t=r(this,zt).firstChild)==null||t.focus();return}(s=e.target.nextSibling)==null||s.focus()}_moveToPrevious(e){var t,s;if(e.target===((t=r(this,zt))==null?void 0:t.firstChild)||e.target===r(this,ms)){r(this,ut,Li)&&this._hideDropdownFromKeyboard();return}r(this,ut,Li)||v(this,ut,xn).call(this,e),(s=e.target.previousSibling)==null||s.focus()}_moveToBeginning(e){var t;if(!r(this,ut,Li)){v(this,ut,xn).call(this,e);return}(t=r(this,zt).firstChild)==null||t.focus()}_moveToEnd(e){var t;if(!r(this,ut,Li)){v(this,ut,xn).call(this,e);return}(t=r(this,zt).lastChild)==null||t.focus()}hideDropdown(){var e,t;(e=r(this,zt))==null||e.classList.add("hidden"),(t=r(this,tn))==null||t.abort(),p(this,tn,null)}_hideDropdownFromKeyboard(){var e;if(!r(this,Oa)){if(!r(this,ut,Li)){(e=r(this,Ql))==null||e.unselect();return}this.hideDropdown(),r(this,ms).focus({preventScroll:!0,focusVisible:r(this,Jl)})}}updateColor(e){if(r(this,mr)&&(r(this,mr).style.backgroundColor=e),!r(this,zt))return;const t=r(this,bs).highlightColors.values();for(const s of r(this,zt).children)s.setAttribute("aria-selected",t.next().value===e)}destroy(){var e,t;(e=r(this,ms))==null||e.remove(),p(this,ms,null),p(this,mr,null),(t=r(this,zt))==null||t.remove(),p(this,zt,null)}};ms=new WeakMap,mr=new WeakMap,ja=new WeakMap,zt=new WeakMap,Jl=new WeakMap,Oa=new WeakMap,Ql=new WeakMap,tc=new WeakMap,tn=new WeakMap,bs=new WeakMap,za=new WeakMap,ec=new WeakMap,ut=new WeakSet,Xd=function(){const e=document.createElement("div"),t=r(this,bs)._signal;e.addEventListener("contextmenu",xs,{signal:t}),e.className="dropdown",e.role="listbox",e.setAttribute("aria-multiselectable",!1),e.setAttribute("aria-orientation","vertical"),e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown");for(const[s,i]of r(this,bs).highlightColors){const n=document.createElement("button");n.tabIndex="0",n.role="option",n.setAttribute("data-color",i),n.title=s,n.setAttribute("data-l10n-id",r(Se,ec)[s]);const a=document.createElement("span");n.append(a),a.className="swatch",a.style.backgroundColor=i,n.setAttribute("aria-selected",i===r(this,ja)),n.addEventListener("click",v(this,ut,Yd).bind(this,i),{signal:t}),e.append(n)}return e.addEventListener("keydown",v(this,ut,Kd).bind(this),{signal:t}),e},Yd=function(e,t){t.stopPropagation(),r(this,tc).dispatch("switchannotationeditorparams",{source:this,type:r(this,za),value:e})},Kd=function(e){Se._keyboardManager.exec(this,e)},xn=function(e){if(r(this,ut,Li)){this.hideDropdown();return}if(p(this,Jl,e.detail===0),r(this,tn)||(p(this,tn,new AbortController),window.addEventListener("pointerdown",v(this,ut,tg).bind(this),{signal:r(this,bs).combinedSignal(r(this,tn))})),r(this,zt)){r(this,zt).classList.remove("hidden");return}const t=p(this,zt,v(this,ut,Xd).call(this));r(this,ms).append(t)},tg=function(e){var t;(t=r(this,zt))!=null&&t.contains(e.target)||this.hideDropdown()},Li=function(){return r(this,zt)&&!r(this,zt).classList.contains("hidden")},A(Se,ec,null);let hh=Se;var $a,sc,bi,br,Ba,Ce,ic,nc,yr,Je,Oe,Kt,Ha,yi,ae,Ua,Qe,rc,q,Zd,Kc,eg,sg,ig,Jd,Sn,is,Gr,ng,Zc,_o,rg,ag,og,lg,cg;const at=class at extends Et{constructor(t){super({...t,name:"highlightEditor"});A(this,q);A(this,$a,null);A(this,sc,0);A(this,bi);A(this,br,null);A(this,Ba,null);A(this,Ce,null);A(this,ic,null);A(this,nc,0);A(this,yr,null);A(this,Je,null);A(this,Oe,null);A(this,Kt,!1);A(this,Ha,null);A(this,yi);A(this,ae,null);A(this,Ua,"");A(this,Qe);A(this,rc,"");this.color=t.color||at._defaultColor,p(this,Qe,t.thickness||at._defaultThickness),p(this,yi,t.opacity||at._defaultOpacity),p(this,bi,t.boxes||null),p(this,rc,t.methodOfCreation||""),p(this,Ua,t.text||""),this._isDraggable=!1,t.highlightId>-1?(p(this,Kt,!0),v(this,q,Kc).call(this,t),v(this,q,Sn).call(this)):r(this,bi)&&(p(this,$a,t.anchorNode),p(this,sc,t.anchorOffset),p(this,ic,t.focusNode),p(this,nc,t.focusOffset),v(this,q,Zd).call(this),v(this,q,Sn).call(this),this.rotate(this.rotation))}static get _keyboardManager(){const t=at.prototype;return tt(this,"_keyboardManager",new hc([[["ArrowLeft","mac+ArrowLeft"],t._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],t._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],t._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],t._moveCaret,{args:[3]}]]))}get telemetryInitialData(){return{action:"added",type:r(this,Kt)?"free_highlight":"highlight",color:this._uiManager.highlightColorNames.get(this.color),thickness:r(this,Qe),methodOfCreation:r(this,rc)}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.highlightColorNames.get(this.color)}}static computeTelemetryFinalData(t){return{numberOfColors:t.get("color").size}}static initialize(t,s){var i;Et.initialize(t,s),at._defaultColor||(at._defaultColor=((i=s.highlightColors)==null?void 0:i.values().next().value)||"#fff066")}static updateDefaultParams(t,s){switch(t){case et.HIGHLIGHT_DEFAULT_COLOR:at._defaultColor=s;break;case et.HIGHLIGHT_THICKNESS:at._defaultThickness=s;break}}translateInPage(t,s){}get toolbarPosition(){return r(this,Ha)}updateParams(t,s){switch(t){case et.HIGHLIGHT_COLOR:v(this,q,eg).call(this,s);break;case et.HIGHLIGHT_THICKNESS:v(this,q,sg).call(this,s);break}}static get defaultPropertiesToUpdate(){return[[et.HIGHLIGHT_DEFAULT_COLOR,at._defaultColor],[et.HIGHLIGHT_THICKNESS,at._defaultThickness]]}get propertiesToUpdate(){return[[et.HIGHLIGHT_COLOR,this.color||at._defaultColor],[et.HIGHLIGHT_THICKNESS,r(this,Qe)||at._defaultThickness],[et.HIGHLIGHT_FREE,r(this,Kt)]]}async addEditToolbar(){const t=await super.addEditToolbar();return t?(this._uiManager.highlightColors&&(p(this,Ba,new hh({editor:this})),t.addColorPicker(r(this,Ba))),t):null}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(v(this,q,_o).call(this))}getBaseTranslation(){return[0,0]}getRect(t,s){return super.getRect(t,s,v(this,q,_o).call(this))}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),t&&this.div.focus()}remove(){v(this,q,Jd).call(this),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(v(this,q,Sn).call(this),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){var i;let s=!1;this.parent&&!t?v(this,q,Jd).call(this):t&&(v(this,q,Sn).call(this,t),s=!this.parent&&((i=this.div)==null?void 0:i.classList.contains("selectedEditor"))),super.setParent(t),this.show(this._isVisible),s&&this.select()}rotate(t){var n,a,o;const{drawLayer:s}=this.parent;let i;r(this,Kt)?(t=(t-this.rotation+360)%360,i=v(n=at,is,Gr).call(n,r(this,Je).box,t)):i=v(a=at,is,Gr).call(a,[this.x,this.y,this.width,this.height],t),s.updateProperties(r(this,Oe),{bbox:i,root:{"data-main-rotation":t}}),s.updateProperties(r(this,ae),{bbox:v(o=at,is,Gr).call(o,r(this,Ce).box,t),root:{"data-main-rotation":t}})}render(){if(this.div)return this.div;const t=super.render();r(this,Ua)&&(t.setAttribute("aria-label",r(this,Ua)),t.setAttribute("role","mark")),r(this,Kt)?t.classList.add("free"):this.div.addEventListener("keydown",v(this,q,ng).bind(this),{signal:this._uiManager._signal});const s=p(this,yr,document.createElement("div"));t.append(s),s.setAttribute("aria-hidden","true"),s.className="internal",s.style.clipPath=r(this,br);const[i,n]=this.parentDimensions;return this.setDims(this.width*i,this.height*n),ah(this,r(this,yr),["pointerover","pointerleave"]),this.enableEditing(),t}pointerover(){var t;this.isSelected||(t=this.parent)==null||t.drawLayer.updateProperties(r(this,ae),{rootClass:{hovered:!0}})}pointerleave(){var t;this.isSelected||(t=this.parent)==null||t.drawLayer.updateProperties(r(this,ae),{rootClass:{hovered:!1}})}_moveCaret(t){switch(this.parent.unselect(this),t){case 0:case 2:v(this,q,Zc).call(this,!0);break;case 1:case 3:v(this,q,Zc).call(this,!1);break}}select(){var t;super.select(),r(this,ae)&&((t=this.parent)==null||t.drawLayer.updateProperties(r(this,ae),{rootClass:{hovered:!1,selected:!0}}))}unselect(){var t;super.unselect(),r(this,ae)&&((t=this.parent)==null||t.drawLayer.updateProperties(r(this,ae),{rootClass:{selected:!1}}),r(this,Kt)||v(this,q,Zc).call(this,!1))}get _mustFixPosition(){return!r(this,Kt)}show(t=this._isVisible){super.show(t),this.parent&&(this.parent.drawLayer.updateProperties(r(this,Oe),{rootClass:{hidden:!t}}),this.parent.drawLayer.updateProperties(r(this,ae),{rootClass:{hidden:!t}}))}static startHighlighting(t,s,{target:i,x:n,y:a}){const{x:o,y:l,width:c,height:d}=i.getBoundingClientRect(),u=new AbortController,f=t.combinedSignal(u),g=m=>{u.abort(),v(this,is,lg).call(this,t,m)};window.addEventListener("blur",g,{signal:f}),window.addEventListener("pointerup",g,{signal:f}),window.addEventListener("pointerdown",Ge,{capture:!0,passive:!1,signal:f}),window.addEventListener("contextmenu",xs,{signal:f}),i.addEventListener("pointermove",v(this,is,og).bind(this,t),{signal:f}),this._freeHighlight=new qd({x:n,y:a},[o,l,c,d],t.scale,this._defaultThickness/2,s,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static async deserialize(t,s,i){var y,w,x,S;let n=null;if(t instanceof Np){const{data:{quadPoints:_,rect:C,rotation:k,id:T,color:P,opacity:D,popupRef:O},parent:{page:{pageNumber:K}}}=t;n=t={annotationType:X.HIGHLIGHT,color:Array.from(P),opacity:D,quadPoints:_,boxes:null,pageIndex:K-1,rect:C.slice(0),rotation:k,id:T,deleted:!1,popupRef:O}}else if(t instanceof Cu){const{data:{inkLists:_,rect:C,rotation:k,id:T,color:P,borderStyle:{rawWidth:D},popupRef:O},parent:{page:{pageNumber:K}}}=t;n=t={annotationType:X.HIGHLIGHT,color:Array.from(P),thickness:D,inkLists:_,boxes:null,pageIndex:K-1,rect:C.slice(0),rotation:k,id:T,deleted:!1,popupRef:O}}const{color:a,quadPoints:o,inkLists:l,opacity:c}=t,d=await super.deserialize(t,s,i);d.color=$.makeHexColor(...a),p(d,yi,c||1),l&&p(d,Qe,t.thickness),d.annotationElementId=t.id||null,d._initialData=n;const[u,f]=d.pageDimensions,[g,m]=d.pageTranslation;if(o){const _=p(d,bi,[]);for(let C=0;C<o.length;C+=8)_.push({x:(o[C]-g)/u,y:1-(o[C+1]-m)/f,width:(o[C+2]-o[C])/u,height:(o[C+1]-o[C+5])/f});v(y=d,q,Zd).call(y),v(w=d,q,Sn).call(w),d.rotate(d.rotation)}else if(l){p(d,Kt,!0);const _=l[0],C={x:_[0]-g,y:f-(_[1]-m)},k=new qd(C,[0,0,u,f],1,r(d,Qe)/2,!0,.001);for(let D=0,O=_.length;D<O;D+=2)C.x=_[D]-g,C.y=f-(_[D+1]-m),k.add(C);const{id:T,clipPathId:P}=s.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:d.color,"fill-opacity":d._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:k.toSVGPath()}},!0,!0);v(x=d,q,Kc).call(x,{highlightOutlines:k.getOutlines(),highlightId:T,clipPathId:P}),v(S=d,q,Sn).call(S)}return d}serialize(t=!1){if(this.isEmpty()||t)return null;if(this.deleted)return this.serializeDeleted();const s=this.getRect(0,0),i=Et._colorManager.convert(this.color),n={annotationType:X.HIGHLIGHT,color:i,opacity:r(this,yi),thickness:r(this,Qe),quadPoints:v(this,q,rg).call(this),outlines:v(this,q,ag).call(this,s),pageIndex:this.pageIndex,rect:s,rotation:v(this,q,_o).call(this),structTreeParentId:this._structTreeParentId};return this.annotationElementId&&!v(this,q,cg).call(this,n)?null:(n.id=this.annotationElementId,n)}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}};$a=new WeakMap,sc=new WeakMap,bi=new WeakMap,br=new WeakMap,Ba=new WeakMap,Ce=new WeakMap,ic=new WeakMap,nc=new WeakMap,yr=new WeakMap,Je=new WeakMap,Oe=new WeakMap,Kt=new WeakMap,Ha=new WeakMap,yi=new WeakMap,ae=new WeakMap,Ua=new WeakMap,Qe=new WeakMap,rc=new WeakMap,q=new WeakSet,Zd=function(){const t=new Wd(r(this,bi),.001);p(this,Je,t.getOutlines()),[this.x,this.y,this.width,this.height]=r(this,Je).box;const s=new Wd(r(this,bi),.0025,.001,this._uiManager.direction==="ltr");p(this,Ce,s.getOutlines());const{lastPoint:i}=r(this,Ce);p(this,Ha,[(i[0]-this.x)/this.width,(i[1]-this.y)/this.height])},Kc=function({highlightOutlines:t,highlightId:s,clipPathId:i}){var u,f;if(p(this,Je,t),p(this,Ce,t.getNewOutline(r(this,Qe)/2+1.5,.0025)),s>=0)p(this,Oe,s),p(this,br,i),this.parent.drawLayer.finalizeDraw(s,{bbox:t.box,path:{d:t.toSVGPath()}}),p(this,ae,this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:r(this,Ce).box,path:{d:r(this,Ce).toSVGPath()}},!0));else if(this.parent){const g=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(r(this,Oe),{bbox:v(u=at,is,Gr).call(u,r(this,Je).box,(g-this.rotation+360)%360),path:{d:t.toSVGPath()}}),this.parent.drawLayer.updateProperties(r(this,ae),{bbox:v(f=at,is,Gr).call(f,r(this,Ce).box,g),path:{d:r(this,Ce).toSVGPath()}})}const[a,o,l,c]=t.box;switch(this.rotation){case 0:this.x=a,this.y=o,this.width=l,this.height=c;break;case 90:{const[g,m]=this.parentDimensions;this.x=o,this.y=1-a,this.width=l*m/g,this.height=c*g/m;break}case 180:this.x=1-a,this.y=1-o,this.width=l,this.height=c;break;case 270:{const[g,m]=this.parentDimensions;this.x=1-o,this.y=a,this.width=l*m/g,this.height=c*g/m;break}}const{lastPoint:d}=r(this,Ce);p(this,Ha,[(d[0]-a)/l,(d[1]-o)/c])},eg=function(t){const s=(a,o)=>{var l,c;this.color=a,p(this,yi,o),(l=this.parent)==null||l.drawLayer.updateProperties(r(this,Oe),{root:{fill:a,"fill-opacity":o}}),(c=r(this,Ba))==null||c.updateColor(a)},i=this.color,n=r(this,yi);this.addCommands({cmd:s.bind(this,t,at._defaultOpacity),undo:s.bind(this,i,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:et.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.highlightColorNames.get(t)},!0)},sg=function(t){const s=r(this,Qe),i=n=>{p(this,Qe,n),v(this,q,ig).call(this,n)};this.addCommands({cmd:i.bind(this,t),undo:i.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:et.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:t},!0)},ig=function(t){if(!r(this,Kt))return;v(this,q,Kc).call(this,{highlightOutlines:r(this,Je).getNewOutline(t/2)}),this.fixAndSetPosition();const[s,i]=this.parentDimensions;this.setDims(this.width*s,this.height*i)},Jd=function(){r(this,Oe)===null||!this.parent||(this.parent.drawLayer.remove(r(this,Oe)),p(this,Oe,null),this.parent.drawLayer.remove(r(this,ae)),p(this,ae,null))},Sn=function(t=this.parent){r(this,Oe)===null&&({id:de(this,Oe)._,clipPathId:de(this,br)._}=t.drawLayer.draw({bbox:r(this,Je).box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":r(this,yi)},rootClass:{highlight:!0,free:r(this,Kt)},path:{d:r(this,Je).toSVGPath()}},!1,!0),p(this,ae,t.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:r(this,Kt)},bbox:r(this,Ce).box,path:{d:r(this,Ce).toSVGPath()}},r(this,Kt))),r(this,yr)&&(r(this,yr).style.clipPath=r(this,br)))},is=new WeakSet,Gr=function([t,s,i,n],a){switch(a){case 90:return[1-s-n,t,n,i];case 180:return[1-t-i,1-s-n,i,n];case 270:return[s,1-t-i,n,i]}return[t,s,i,n]},ng=function(t){at._keyboardManager.exec(this,t)},Zc=function(t){if(!r(this,$a))return;const s=window.getSelection();t?s.setPosition(r(this,$a),r(this,sc)):s.setPosition(r(this,ic),r(this,nc))},_o=function(){return r(this,Kt)?this.rotation:0},rg=function(){if(r(this,Kt))return null;const[t,s]=this.pageDimensions,[i,n]=this.pageTranslation,a=r(this,bi),o=new Float32Array(a.length*8);let l=0;for(const{x:c,y:d,width:u,height:f}of a){const g=c*t+i,m=(1-d)*s+n;o[l]=o[l+4]=g,o[l+1]=o[l+3]=m,o[l+2]=o[l+6]=g+u*t,o[l+5]=o[l+7]=m-f*s,l+=8}return o},ag=function(t){return r(this,Je).serialize(t,v(this,q,_o).call(this))},og=function(t,s){this._freeHighlight.add(s)&&t.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})},lg=function(t,s){this._freeHighlight.isEmpty()?t.drawLayer.remove(this._freeHighlightId):t.createAndAddNewEditor(s,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""},cg=function(t){const{color:s}=this._initialData;return t.color.some((i,n)=>i!==s[n])},A(at,is),U(at,"_defaultColor",null),U(at,"_defaultOpacity",1),U(at,"_defaultThickness",12),U(at,"_type","highlight"),U(at,"_editorType",X.HIGHLIGHT),U(at,"_freeHighlightId",-1),U(at,"_freeHighlight",null),U(at,"_freeHighlightClipId","");let dh=at;var Ar;class by{constructor(){A(this,Ar,Object.create(null))}updateProperty(e,t){this[e]=t,this.updateSVGProperty(e,t)}updateProperties(e){if(e)for(const[t,s]of Object.entries(e))this.updateProperty(t,s)}updateSVGProperty(e,t){r(this,Ar)[e]=t}toSVGProperties(){const e=r(this,Ar);return p(this,Ar,Object.create(null)),{root:e}}reset(){p(this,Ar,Object.create(null))}updateAll(e=this){this.updateProperties(e)}clone(){pt("Not implemented")}}Ar=new WeakMap;var ze,Ga,Gt,vr,wr,en,sn,nn,xr,nt,tu,eu,su,Eo,hg,Jc,Co,Wr;const F=class F extends Et{constructor(t){super(t);A(this,nt);A(this,ze,null);A(this,Ga);U(this,"_drawId",null);p(this,Ga,t.mustBeCommitted||!1),t.drawOutlines&&(v(this,nt,tu).call(this,t),v(this,nt,Eo).call(this))}static _mergeSVGProperties(t,s){const i=new Set(Object.keys(t));for(const[n,a]of Object.entries(s))i.has(n)?Object.assign(t[n],a):t[n]=a;return t}static getDefaultDrawingOptions(t){pt("Not implemented")}static get typesMap(){pt("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(t,s){const i=this.typesMap.get(t);i&&this._defaultDrawingOptions.updateProperty(i,s),this._currentParent&&(r(F,Gt).updateProperty(i,s),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(t,s){const i=this.constructor.typesMap.get(t);i&&this._updateProperty(t,i,s)}static get defaultPropertiesToUpdate(){const t=[],s=this._defaultDrawingOptions;for(const[i,n]of this.typesMap)t.push([i,s[n]]);return t}get propertiesToUpdate(){const t=[],{_drawingOptions:s}=this;for(const[i,n]of this.constructor.typesMap)t.push([i,s[n]]);return t}_updateProperty(t,s,i){const n=this._drawingOptions,a=n[s],o=l=>{var d;n.updateProperty(s,l);const c=r(this,ze).updateProperty(s,l);c&&v(this,nt,Co).call(this,c),(d=this.parent)==null||d.drawLayer.updateProperties(this._drawId,n.toSVGProperties())};this.addCommands({cmd:o.bind(this,i),undo:o.bind(this,a),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:t,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,F._mergeSVGProperties(r(this,ze).getPathResizingSVGProperties(v(this,nt,Jc).call(this)),{bbox:v(this,nt,Wr).call(this)}))}_onResized(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,F._mergeSVGProperties(r(this,ze).getPathResizedSVGProperties(v(this,nt,Jc).call(this)),{bbox:v(this,nt,Wr).call(this)}))}_onTranslating(t,s){var i;(i=this.parent)==null||i.drawLayer.updateProperties(this._drawId,{bbox:v(this,nt,Wr).call(this,t,s)})}_onTranslated(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,F._mergeSVGProperties(r(this,ze).getPathTranslatedSVGProperties(v(this,nt,Jc).call(this),this.parentDimensions),{bbox:v(this,nt,Wr).call(this)}))}_onStartDragging(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,r(this,Ga)&&(p(this,Ga,!1),this.commit(),this.parent.setSelected(this),t&&this.isOnScreen&&this.div.focus())}remove(){v(this,nt,su).call(this),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(v(this,nt,Eo).call(this),v(this,nt,Co).call(this,r(this,ze).box),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){var i;let s=!1;this.parent&&!t?(this._uiManager.removeShouldRescale(this),v(this,nt,su).call(this)):t&&(this._uiManager.addShouldRescale(this),v(this,nt,Eo).call(this,t),s=!this.parent&&((i=this.div)==null?void 0:i.classList.contains("selectedEditor"))),super.setParent(t),s&&this.select()}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,F._mergeSVGProperties({bbox:v(this,nt,Wr).call(this)},r(this,ze).updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&v(this,nt,Co).call(this,r(this,ze).updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;const t=super.render();t.classList.add("draw");const s=document.createElement("div");t.append(s),s.setAttribute("aria-hidden","true"),s.className="internal";const[i,n]=this.parentDimensions;return this.setDims(this.width*i,this.height*n),this._uiManager.addShouldRescale(this),this.disableEditing(),t}static createDrawerInstance(t,s,i,n,a){pt("Not implemented")}static startDrawing(t,s,i,n){var w;const{target:a,offsetX:o,offsetY:l,pointerId:c,pointerType:d}=n;if(r(F,sn)&&r(F,sn)!==d)return;const{viewport:{rotation:u}}=t,{width:f,height:g}=a.getBoundingClientRect(),m=p(F,vr,new AbortController),y=t.combinedSignal(m);if(r(F,en)||p(F,en,c),r(F,sn)??p(F,sn,d),window.addEventListener("pointerup",x=>{var S;r(F,en)===x.pointerId?this._endDraw(x):(S=r(F,nn))==null||S.delete(x.pointerId)},{signal:y}),window.addEventListener("pointercancel",x=>{var S;r(F,en)===x.pointerId?this._currentParent.endDrawingSession():(S=r(F,nn))==null||S.delete(x.pointerId)},{signal:y}),window.addEventListener("pointerdown",x=>{r(F,sn)===x.pointerType&&((r(F,nn)||p(F,nn,new Set)).add(x.pointerId),r(F,Gt).isCancellable()&&(r(F,Gt).removeLastElement(),r(F,Gt).isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:y}),window.addEventListener("contextmenu",xs,{signal:y}),a.addEventListener("pointermove",this._drawMove.bind(this),{signal:y}),a.addEventListener("touchmove",x=>{x.timeStamp===r(F,xr)&&Ge(x)},{signal:y}),t.toggleDrawing(),(w=s._editorUndoBar)==null||w.hide(),r(F,Gt)){t.drawLayer.updateProperties(this._currentDrawId,r(F,Gt).startNew(o,l,f,g,u));return}s.updateUIForDefaultProperties(this),p(F,Gt,this.createDrawerInstance(o,l,f,g,u)),p(F,wr,this.getDefaultDrawingOptions()),this._currentParent=t,{id:this._currentDrawId}=t.drawLayer.draw(this._mergeSVGProperties(r(F,wr).toSVGProperties(),r(F,Gt).defaultSVGProperties),!0,!1)}static _drawMove(t){var a;if(p(F,xr,-1),!r(F,Gt))return;const{offsetX:s,offsetY:i,pointerId:n}=t;if(r(F,en)===n){if(((a=r(F,nn))==null?void 0:a.size)>=1){this._endDraw(t);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,r(F,Gt).add(s,i)),p(F,xr,t.timeStamp),Ge(t)}}static _cleanup(t){t&&(this._currentDrawId=-1,this._currentParent=null,p(F,Gt,null),p(F,wr,null),p(F,sn,null),p(F,xr,NaN)),r(F,vr)&&(r(F,vr).abort(),p(F,vr,null),p(F,en,NaN),p(F,nn,null))}static _endDraw(t){const s=this._currentParent;if(s){if(s.toggleDrawing(!0),this._cleanup(!1),t&&s.drawLayer.updateProperties(this._currentDrawId,r(F,Gt).end(t.offsetX,t.offsetY)),this.supportMultipleDrawings){const i=r(F,Gt),n=this._currentDrawId,a=i.getLastElement();s.addCommands({cmd:()=>{s.drawLayer.updateProperties(n,i.setLastElement(a))},undo:()=>{s.drawLayer.updateProperties(n,i.removeLastElement())},mustExec:!1,type:et.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(t){const s=this._currentParent;if(!s)return null;if(s.toggleDrawing(!0),s.cleanUndoStack(et.DRAW_STEP),!r(F,Gt).isEmpty()){const{pageDimensions:[i,n],scale:a}=s,o=s.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:r(F,Gt).getOutlines(i*a,n*a,a,this._INNER_MARGIN),drawingOptions:r(F,wr),mustBeCommitted:!t});return this._cleanup(!0),o}return s.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(t){}static deserializeDraw(t,s,i,n,a,o){pt("Not implemented")}static async deserialize(t,s,i){var u,f;const{rawDims:{pageWidth:n,pageHeight:a,pageX:o,pageY:l}}=s.viewport,c=this.deserializeDraw(o,l,n,a,this._INNER_MARGIN,t),d=await super.deserialize(t,s,i);return d.createDrawingOptions(t),v(u=d,nt,tu).call(u,{drawOutlines:c}),v(f=d,nt,Eo).call(f),d.onScaleChanging(),d.rotate(),d}serializeDraw(t){const[s,i]=this.pageTranslation,[n,a]=this.pageDimensions;return r(this,ze).serialize([s,i,n,a],t)}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}};ze=new WeakMap,Ga=new WeakMap,Gt=new WeakMap,vr=new WeakMap,wr=new WeakMap,en=new WeakMap,sn=new WeakMap,nn=new WeakMap,xr=new WeakMap,nt=new WeakSet,tu=function({drawOutlines:t,drawId:s,drawingOptions:i}){p(this,ze,t),this._drawingOptions||(this._drawingOptions=i),s>=0?(this._drawId=s,this.parent.drawLayer.finalizeDraw(s,t.defaultProperties)):this._drawId=v(this,nt,eu).call(this,t,this.parent),v(this,nt,Co).call(this,t.box)},eu=function(t,s){const{id:i}=s.drawLayer.draw(F._mergeSVGProperties(this._drawingOptions.toSVGProperties(),t.defaultSVGProperties),!1,!1);return i},su=function(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())},Eo=function(t=this.parent){if(!(this._drawId!==null&&this.parent===t)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,t.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=v(this,nt,eu).call(this,r(this,ze),t)}},hg=function([t,s,i,n]){const{parentDimensions:[a,o],rotation:l}=this;switch(l){case 90:return[s,1-t,i*(o/a),n*(a/o)];case 180:return[1-t,1-s,i,n];case 270:return[1-s,t,i*(o/a),n*(a/o)];default:return[t,s,i,n]}},Jc=function(){const{x:t,y:s,width:i,height:n,parentDimensions:[a,o],rotation:l}=this;switch(l){case 90:return[1-s,t,i*(a/o),n*(o/a)];case 180:return[1-t,1-s,i,n];case 270:return[s,1-t,i*(a/o),n*(o/a)];default:return[t,s,i,n]}},Co=function(t){if([this.x,this.y,this.width,this.height]=v(this,nt,hg).call(this,t),this.div){this.fixAndSetPosition();const[s,i]=this.parentDimensions;this.setDims(this.width*s,this.height*i)}this._onResized()},Wr=function(){const{x:t,y:s,width:i,height:n,rotation:a,parentRotation:o,parentDimensions:[l,c]}=this;switch((a*4+o)/90){case 1:return[1-s-n,t,n,i];case 2:return[1-t-i,1-s-n,i,n];case 3:return[s,1-t-i,n,i];case 4:return[t,s-i*(l/c),n*(c/l),i*(l/c)];case 5:return[1-s,t,i*(l/c),n*(c/l)];case 6:return[1-t-n*(c/l),1-s,n*(c/l),i*(l/c)];case 7:return[s-i*(l/c),1-t-n*(c/l),i*(l/c),n*(c/l)];case 8:return[t-i,s-n,i,n];case 9:return[1-s,t-i,n,i];case 10:return[1-t,1-s,i,n];case 11:return[s-n,1-t,n,i];case 12:return[t-n*(c/l),s,n*(c/l),i*(l/c)];case 13:return[1-s-i*(l/c),t-n*(c/l),i*(l/c),n*(c/l)];case 14:return[1-t,1-s-i*(l/c),n*(c/l),i*(l/c)];case 15:return[s,1-t,i*(l/c),n*(c/l)];default:return[t,s,i,n]}},U(F,"_currentDrawId",-1),U(F,"_currentParent",null),A(F,Gt,null),A(F,vr,null),A(F,wr,null),A(F,en,NaN),A(F,sn,null),A(F,nn,null),A(F,xr,NaN),U(F,"_INNER_MARGIN",3);let Qd=F;var $s,Wt,Vt,Sr,Wa,ge,Zt,ts,_r,Er,Cr,Va,Qc;class yy{constructor(e,t,s,i,n,a){A(this,Va);A(this,$s,new Float64Array(6));A(this,Wt);A(this,Vt);A(this,Sr);A(this,Wa);A(this,ge);A(this,Zt,"");A(this,ts,0);A(this,_r,new uh);A(this,Er);A(this,Cr);p(this,Er,s),p(this,Cr,i),p(this,Sr,n),p(this,Wa,a),[e,t]=v(this,Va,Qc).call(this,e,t);const o=p(this,Wt,[NaN,NaN,NaN,NaN,e,t]);p(this,ge,[e,t]),p(this,Vt,[{line:o,points:r(this,ge)}]),r(this,$s).set(o,0)}updateProperty(e,t){e==="stroke-width"&&p(this,Wa,t)}isEmpty(){return!r(this,Vt)||r(this,Vt).length===0}isCancellable(){return r(this,ge).length<=10}add(e,t){[e,t]=v(this,Va,Qc).call(this,e,t);const[s,i,n,a]=r(this,$s).subarray(2,6),o=e-n,l=t-a;return Math.hypot(r(this,Er)*o,r(this,Cr)*l)<=2?null:(r(this,ge).push(e,t),isNaN(s)?(r(this,$s).set([n,a,e,t],2),r(this,Wt).push(NaN,NaN,NaN,NaN,e,t),{path:{d:this.toSVGPath()}}):(isNaN(r(this,$s)[0])&&r(this,Wt).splice(6,6),r(this,$s).set([s,i,n,a,e,t],0),r(this,Wt).push(...N.createBezierPoints(s,i,n,a,e,t)),{path:{d:this.toSVGPath()}}))}end(e,t){const s=this.add(e,t);return s||(r(this,ge).length===2?{path:{d:this.toSVGPath()}}:null)}startNew(e,t,s,i,n){p(this,Er,s),p(this,Cr,i),p(this,Sr,n),[e,t]=v(this,Va,Qc).call(this,e,t);const a=p(this,Wt,[NaN,NaN,NaN,NaN,e,t]);p(this,ge,[e,t]);const o=r(this,Vt).at(-1);return o&&(o.line=new Float32Array(o.line),o.points=new Float32Array(o.points)),r(this,Vt).push({line:a,points:r(this,ge)}),r(this,$s).set(a,0),p(this,ts,0),this.toSVGPath(),null}getLastElement(){return r(this,Vt).at(-1)}setLastElement(e){return r(this,Vt)?(r(this,Vt).push(e),p(this,Wt,e.line),p(this,ge,e.points),p(this,ts,0),{path:{d:this.toSVGPath()}}):r(this,_r).setLastElement(e)}removeLastElement(){if(!r(this,Vt))return r(this,_r).removeLastElement();r(this,Vt).pop(),p(this,Zt,"");for(let e=0,t=r(this,Vt).length;e<t;e++){const{line:s,points:i}=r(this,Vt)[e];p(this,Wt,s),p(this,ge,i),p(this,ts,0),this.toSVGPath()}return{path:{d:r(this,Zt)}}}toSVGPath(){const e=N.svgRound(r(this,Wt)[4]),t=N.svgRound(r(this,Wt)[5]);if(r(this,ge).length===2)return p(this,Zt,`${r(this,Zt)} M ${e} ${t} Z`),r(this,Zt);if(r(this,ge).length<=6){const i=r(this,Zt).lastIndexOf("M");p(this,Zt,`${r(this,Zt).slice(0,i)} M ${e} ${t}`),p(this,ts,6)}if(r(this,ge).length===4){const i=N.svgRound(r(this,Wt)[10]),n=N.svgRound(r(this,Wt)[11]);return p(this,Zt,`${r(this,Zt)} L ${i} ${n}`),p(this,ts,12),r(this,Zt)}const s=[];r(this,ts)===0&&(s.push(`M ${e} ${t}`),p(this,ts,6));for(let i=r(this,ts),n=r(this,Wt).length;i<n;i+=6){const[a,o,l,c,d,u]=r(this,Wt).slice(i,i+6).map(N.svgRound);s.push(`C${a} ${o} ${l} ${c} ${d} ${u}`)}return p(this,Zt,r(this,Zt)+s.join(" ")),p(this,ts,r(this,Wt).length),r(this,Zt)}getOutlines(e,t,s,i){const n=r(this,Vt).at(-1);return n.line=new Float32Array(n.line),n.points=new Float32Array(n.points),r(this,_r).build(r(this,Vt),e,t,s,r(this,Sr),r(this,Wa),i),p(this,$s,null),p(this,Wt,null),p(this,Vt,null),p(this,Zt,null),r(this,_r)}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}$s=new WeakMap,Wt=new WeakMap,Vt=new WeakMap,Sr=new WeakMap,Wa=new WeakMap,ge=new WeakMap,Zt=new WeakMap,ts=new WeakMap,_r=new WeakMap,Er=new WeakMap,Cr=new WeakMap,Va=new WeakSet,Qc=function(e,t){return N._normalizePoint(e,t,r(this,Er),r(this,Cr),r(this,Sr))};var me,ac,oc,$e,Bs,Hs,qa,Xa,Ya,Qt,Ys,dg,ug,fg;const Ru=class Ru extends N{constructor(){super(...arguments);A(this,Qt);A(this,me);A(this,ac,0);A(this,oc);A(this,$e);A(this,Bs);A(this,Hs);A(this,qa);A(this,Xa);A(this,Ya)}build(t,s,i,n,a,o,l){p(this,Bs,s),p(this,Hs,i),p(this,qa,n),p(this,Xa,a),p(this,Ya,o),p(this,oc,l??0),p(this,$e,t),v(this,Qt,ug).call(this)}setLastElement(t){return r(this,$e).push(t),{path:{d:this.toSVGPath()}}}removeLastElement(){return r(this,$e).pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){const t=[];for(const{line:s}of r(this,$e)){if(t.push(`M${N.svgRound(s[4])} ${N.svgRound(s[5])}`),s.length===6){t.push("Z");continue}if(s.length===12){t.push(`L${N.svgRound(s[10])} ${N.svgRound(s[11])}`);continue}for(let i=6,n=s.length;i<n;i+=6){const[a,o,l,c,d,u]=s.subarray(i,i+6).map(N.svgRound);t.push(`C${a} ${o} ${l} ${c} ${d} ${u}`)}}return t.join("")}serialize([t,s,i,n],a){const o=[],l=[],[c,d,u,f]=v(this,Qt,dg).call(this);let g,m,y,w,x,S,_,C,k;switch(r(this,Xa)){case 0:k=N._rescale,g=t,m=s+n,y=i,w=-n,x=t+c*i,S=s+(1-d-f)*n,_=t+(c+u)*i,C=s+(1-d)*n;break;case 90:k=N._rescaleAndSwap,g=t,m=s,y=i,w=n,x=t+d*i,S=s+c*n,_=t+(d+f)*i,C=s+(c+u)*n;break;case 180:k=N._rescale,g=t+i,m=s,y=-i,w=n,x=t+(1-c-u)*i,S=s+d*n,_=t+(1-c)*i,C=s+(d+f)*n;break;case 270:k=N._rescaleAndSwap,g=t+i,m=s+n,y=-i,w=-n,x=t+(1-d-f)*i,S=s+(1-c-u)*n,_=t+(1-d)*i,C=s+(1-c)*n;break}for(const{line:T,points:P}of r(this,$e))o.push(k(T,g,m,y,w,a?new Array(T.length):null)),l.push(k(P,g,m,y,w,a?new Array(P.length):null));return{lines:o,points:l,rect:[x,S,_,C]}}static deserialize(t,s,i,n,a,{paths:{lines:o,points:l},rotation:c,thickness:d}){const u=[];let f,g,m,y,w;switch(c){case 0:w=N._rescale,f=-t/i,g=s/n+1,m=1/i,y=-1/n;break;case 90:w=N._rescaleAndSwap,f=-s/n,g=-t/i,m=1/n,y=1/i;break;case 180:w=N._rescale,f=t/i+1,g=-s/n,m=-1/i,y=1/n;break;case 270:w=N._rescaleAndSwap,f=s/n+1,g=t/i+1,m=-1/n,y=-1/i;break}if(!o){o=[];for(const S of l){const _=S.length;if(_===2){o.push(new Float32Array([NaN,NaN,NaN,NaN,S[0],S[1]]));continue}if(_===4){o.push(new Float32Array([NaN,NaN,NaN,NaN,S[0],S[1],NaN,NaN,NaN,NaN,S[2],S[3]]));continue}const C=new Float32Array(3*(_-2));o.push(C);let[k,T,P,D]=S.subarray(0,4);C.set([NaN,NaN,NaN,NaN,k,T],0);for(let O=4;O<_;O+=2){const K=S[O],B=S[O+1];C.set(N.createBezierPoints(k,T,P,D,K,B),(O-2)*3),[k,T,P,D]=[P,D,K,B]}}}for(let S=0,_=o.length;S<_;S++)u.push({line:w(o[S].map(C=>C??NaN),f,g,m,y),points:w(l[S].map(C=>C??NaN),f,g,m,y)});const x=new Ru;return x.build(u,i,n,1,c,d,a),x}get box(){return r(this,me)}updateProperty(t,s){return t==="stroke-width"?v(this,Qt,fg).call(this,s):null}updateParentDimensions([t,s],i){const[n,a]=v(this,Qt,Ys).call(this);p(this,Bs,t),p(this,Hs,s),p(this,qa,i);const[o,l]=v(this,Qt,Ys).call(this),c=o-n,d=l-a,u=r(this,me);return u[0]-=c,u[1]-=d,u[2]+=2*c,u[3]+=2*d,u}updateRotation(t){return p(this,ac,t),{path:{transform:this.rotationTransform}}}get viewBox(){return r(this,me).map(N.svgRound).join(" ")}get defaultProperties(){const[t,s]=r(this,me);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${N.svgRound(t)} ${N.svgRound(s)}`}}}get rotationTransform(){const[,,t,s]=r(this,me);let i=0,n=0,a=0,o=0,l=0,c=0;switch(r(this,ac)){case 90:n=s/t,a=-t/s,l=t;break;case 180:i=-1,o=-1,l=t,c=s;break;case 270:n=-s/t,a=t/s,c=s;break;default:return""}return`matrix(${i} ${n} ${a} ${o} ${N.svgRound(l)} ${N.svgRound(c)})`}getPathResizingSVGProperties([t,s,i,n]){const[a,o]=v(this,Qt,Ys).call(this),[l,c,d,u]=r(this,me);if(Math.abs(d-a)<=N.PRECISION||Math.abs(u-o)<=N.PRECISION){const w=t+i/2-(l+d/2),x=s+n/2-(c+u/2);return{path:{"transform-origin":`${N.svgRound(t)} ${N.svgRound(s)}`,transform:`${this.rotationTransform} translate(${w} ${x})`}}}const f=(i-2*a)/(d-2*a),g=(n-2*o)/(u-2*o),m=d/i,y=u/n;return{path:{"transform-origin":`${N.svgRound(l)} ${N.svgRound(c)}`,transform:`${this.rotationTransform} scale(${m} ${y}) translate(${N.svgRound(a)} ${N.svgRound(o)}) scale(${f} ${g}) translate(${N.svgRound(-a)} ${N.svgRound(-o)})`}}}getPathResizedSVGProperties([t,s,i,n]){const[a,o]=v(this,Qt,Ys).call(this),l=r(this,me),[c,d,u,f]=l;if(l[0]=t,l[1]=s,l[2]=i,l[3]=n,Math.abs(u-a)<=N.PRECISION||Math.abs(f-o)<=N.PRECISION){const x=t+i/2-(c+u/2),S=s+n/2-(d+f/2);for(const{line:_,points:C}of r(this,$e))N._translate(_,x,S,_),N._translate(C,x,S,C);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${N.svgRound(t)} ${N.svgRound(s)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}const g=(i-2*a)/(u-2*a),m=(n-2*o)/(f-2*o),y=-g*(c+a)+t+a,w=-m*(d+o)+s+o;if(g!==1||m!==1||y!==0||w!==0)for(const{line:x,points:S}of r(this,$e))N._rescale(x,y,w,g,m,x),N._rescale(S,y,w,g,m,S);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${N.svgRound(t)} ${N.svgRound(s)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([t,s],i){const[n,a]=i,o=r(this,me),l=t-o[0],c=s-o[1];if(r(this,Bs)===n&&r(this,Hs)===a)for(const{line:d,points:u}of r(this,$e))N._translate(d,l,c,d),N._translate(u,l,c,u);else{const d=r(this,Bs)/n,u=r(this,Hs)/a;p(this,Bs,n),p(this,Hs,a);for(const{line:f,points:g}of r(this,$e))N._rescale(f,l,c,d,u,f),N._rescale(g,l,c,d,u,g);o[2]*=d,o[3]*=u}return o[0]=t,o[1]=s,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${N.svgRound(t)} ${N.svgRound(s)}`}}}get defaultSVGProperties(){const t=r(this,me);return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${N.svgRound(t[0])} ${N.svgRound(t[1])}`,transform:this.rotationTransform||null},bbox:t}}};me=new WeakMap,ac=new WeakMap,oc=new WeakMap,$e=new WeakMap,Bs=new WeakMap,Hs=new WeakMap,qa=new WeakMap,Xa=new WeakMap,Ya=new WeakMap,Qt=new WeakSet,Ys=function(t=r(this,Ya)){const s=r(this,oc)+t/2*r(this,qa);return r(this,Xa)%180===0?[s/r(this,Bs),s/r(this,Hs)]:[s/r(this,Hs),s/r(this,Bs)]},dg=function(){const[t,s,i,n]=r(this,me),[a,o]=v(this,Qt,Ys).call(this,0);return[t+a,s+o,i-2*a,n-2*o]},ug=function(){const t=p(this,me,new Float32Array([1/0,1/0,-1/0,-1/0]));for(const{line:n}of r(this,$e)){if(n.length<=12){for(let l=4,c=n.length;l<c;l+=6){const[d,u]=n.subarray(l,l+2);t[0]=Math.min(t[0],d),t[1]=Math.min(t[1],u),t[2]=Math.max(t[2],d),t[3]=Math.max(t[3],u)}continue}let a=n[4],o=n[5];for(let l=6,c=n.length;l<c;l+=6){const[d,u,f,g,m,y]=n.subarray(l,l+6);$.bezierBoundingBox(a,o,d,u,f,g,m,y,t),a=m,o=y}}const[s,i]=v(this,Qt,Ys).call(this);t[0]=Math.min(1,Math.max(0,t[0]-s)),t[1]=Math.min(1,Math.max(0,t[1]-i)),t[2]=Math.min(1,Math.max(0,t[2]+s)),t[3]=Math.min(1,Math.max(0,t[3]+i)),t[2]-=t[0],t[3]-=t[1]},fg=function(t){const[s,i]=v(this,Qt,Ys).call(this);p(this,Ya,t);const[n,a]=v(this,Qt,Ys).call(this),[o,l]=[n-s,a-i],c=r(this,me);return c[0]-=o,c[1]-=l,c[2]+=2*o,c[3]+=2*l,c};let uh=Ru;var Ka;const Iu=class Iu extends by{constructor(t){super();A(this,Ka);p(this,Ka,t),super.updateProperties({fill:"none",stroke:Et._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(t,s){t==="stroke-width"&&(s??(s=this["stroke-width"]),s*=r(this,Ka).realScale),super.updateSVGProperty(t,s)}clone(){const t=new Iu(r(this,Ka));return t.updateAll(this),t}};Ka=new WeakMap;let iu=Iu;var Lh,pg;const qr=class qr extends Qd{constructor(t){super({...t,name:"inkEditor"});A(this,Lh);this._willKeepAspectRatio=!0}static initialize(t,s){Et.initialize(t,s),this._defaultDrawingOptions=new iu(s.viewParameters)}static getDefaultDrawingOptions(t){const s=this._defaultDrawingOptions.clone();return s.updateProperties(t),s}static get supportMultipleDrawings(){return!0}static get typesMap(){return tt(this,"typesMap",new Map([[et.INK_THICKNESS,"stroke-width"],[et.INK_COLOR,"stroke"],[et.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(t,s,i,n,a){return new yy(t,s,i,n,a,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(t,s,i,n,a,o){return uh.deserialize(t,s,i,n,a,o)}static async deserialize(t,s,i){let n=null;if(t instanceof Cu){const{data:{inkLists:o,rect:l,rotation:c,id:d,color:u,opacity:f,borderStyle:{rawWidth:g},popupRef:m},parent:{page:{pageNumber:y}}}=t;n=t={annotationType:X.INK,color:Array.from(u),thickness:g,opacity:f,paths:{points:o},boxes:null,pageIndex:y-1,rect:l.slice(0),rotation:c,id:d,deleted:!1,popupRef:m}}const a=await super.deserialize(t,s,i);return a.annotationElementId=t.id||null,a._initialData=n,a}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();const{_drawId:t,_drawingOptions:s,parent:i}=this;s.updateSVGProperty("stroke-width"),i.drawLayer.updateProperties(t,s.toSVGProperties())}static onScaleChangingWhenDrawing(){const t=this._currentParent;t&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),t.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:t,thickness:s,opacity:i}){this._drawingOptions=qr.getDefaultDrawingOptions({stroke:$.makeHexColor(...t),"stroke-width":s,"stroke-opacity":i})}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const{lines:s,points:i,rect:n}=this.serializeDraw(t),{_drawingOptions:{stroke:a,"stroke-opacity":o,"stroke-width":l}}=this,c={annotationType:X.INK,color:Et._colorManager.convert(a),opacity:o,thickness:l,paths:{lines:s,points:i},pageIndex:this.pageIndex,rect:n,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return t?c:this.annotationElementId&&!v(this,Lh,pg).call(this,c)?null:(c.id=this.annotationElementId,c)}renderAnnotationElement(t){const{points:s,rect:i}=this.serializeDraw(!1);return t.updateEdited({rect:i,thickness:this._drawingOptions["stroke-width"],points:s}),null}};Lh=new WeakSet,pg=function(t){const{color:s,thickness:i,opacity:n,pageIndex:a}=this._initialData;return this._hasBeenMoved||this._hasBeenResized||t.color.some((o,l)=>o!==s[l])||t.thickness!==i||t.opacity!==n||t.pageIndex!==a},U(qr,"_type","ink"),U(qr,"_editorType",X.INK),U(qr,"_defaultDrawingOptions",null);let nu=qr;var _t,Jt,rn,Ai,an,Za,Us,Gs,Be,Ja,rt,ko,To,th,au,eh,ou,sh,gg;const Ro=class Ro extends Et{constructor(t){super({...t,name:"stampEditor"});A(this,rt);A(this,_t,null);A(this,Jt,null);A(this,rn,null);A(this,Ai,null);A(this,an,null);A(this,Za,"");A(this,Us,null);A(this,Gs,null);A(this,Be,!1);A(this,Ja,!1);p(this,Ai,t.bitmapUrl),p(this,an,t.bitmapFile)}static initialize(t,s){Et.initialize(t,s)}static get supportedTypes(){return tt(this,"supportedTypes",["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"].map(s=>`image/${s}`))}static get supportedTypesStr(){return tt(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(t){return this.supportedTypes.includes(t)}static paste(t,s){s.pasteEditor(X.STAMP,{bitmapFile:t.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){var t;return{type:"stamp",hasAltText:!!((t=this.altTextData)!=null&&t.altText)}}static computeTelemetryFinalData(t){const s=t.get("hasAltText");return{hasAltText:s.get(!0)??0,hasNoAltText:s.get(!1)??0}}async mlGuessAltText(t=null,s=!0){if(this.hasAltTextData())return null;const{mlManager:i}=this._uiManager;if(!i)throw new Error("No ML.");if(!await i.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:n,width:a,height:o}=t||this.copyCanvas(null,null,!0).imageData,l=await i.guess({name:"altText",request:{data:n,width:a,height:o,channels:n.length/(a*o)}});if(!l)throw new Error("No response from the AI service.");if(l.error)throw new Error("Error from the AI service.");if(l.cancel)return null;if(!l.output)throw new Error("No valid response from the AI service.");const c=l.output;return await this.setGuessedAltText(c),s&&!this.hasAltTextData()&&(this.altTextData={alt:c,decorative:!1}),c}remove(){var t;r(this,Jt)&&(p(this,_t,null),this._uiManager.imageManager.deleteId(r(this,Jt)),(t=r(this,Us))==null||t.remove(),p(this,Us,null),r(this,Gs)&&(clearTimeout(r(this,Gs)),p(this,Gs,null))),super.remove()}rebuild(){if(!this.parent){r(this,Jt)&&v(this,rt,th).call(this);return}super.rebuild(),this.div!==null&&(r(this,Jt)&&r(this,Us)===null&&v(this,rt,th).call(this),this.isAttachedToDOM||this.parent.add(this))}onceAdded(t){this._isDraggable=!0,t&&this.div.focus()}isEmpty(){return!(r(this,rn)||r(this,_t)||r(this,Ai)||r(this,an)||r(this,Jt))}get isResizable(){return!0}render(){if(this.div)return this.div;let t,s;if(this.width&&(t=this.x,s=this.y),super.render(),this.div.hidden=!0,this.div.setAttribute("role","figure"),this.addAltTextButton(),r(this,_t)?v(this,rt,au).call(this):v(this,rt,th).call(this),this.width&&!this.annotationElementId){const[i,n]=this.parentDimensions;this.setAt(t*i,s*n,this.width*i,this.height*n)}return this._uiManager.addShouldRescale(this),this.div}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;r(this,Gs)!==null&&clearTimeout(r(this,Gs)),p(this,Gs,setTimeout(()=>{p(this,Gs,null),v(this,rt,ou).call(this)},200))}copyCanvas(t,s,i=!1){var g;t||(t=224);const{width:n,height:a}=r(this,_t),o=new id;let l=r(this,_t),c=n,d=a,u=null;if(s){if(n>s||a>s){const D=Math.min(s/n,s/a);c=Math.floor(n*D),d=Math.floor(a*D)}u=document.createElement("canvas");const m=u.width=Math.ceil(c*o.sx),y=u.height=Math.ceil(d*o.sy);r(this,Be)||(l=v(this,rt,eh).call(this,m,y));const w=u.getContext("2d");w.filter=this._uiManager.hcmFilter;let x="white",S="#cfcfd8";this._uiManager.hcmFilter!=="none"?S="black":(g=window.matchMedia)!=null&&g.call(window,"(prefers-color-scheme: dark)").matches&&(x="#8f8f9d",S="#42414d");const _=15,C=_*o.sx,k=_*o.sy,T=new OffscreenCanvas(C*2,k*2),P=T.getContext("2d");P.fillStyle=x,P.fillRect(0,0,C*2,k*2),P.fillStyle=S,P.fillRect(0,0,C,k),P.fillRect(C,k,C,k),w.fillStyle=w.createPattern(T,"repeat"),w.fillRect(0,0,m,y),w.drawImage(l,0,0,l.width,l.height,0,0,m,y)}let f=null;if(i){let m,y;if(o.symmetric&&l.width<t&&l.height<t)m=l.width,y=l.height;else if(l=r(this,_t),n>t||a>t){const S=Math.min(t/n,t/a);m=Math.floor(n*S),y=Math.floor(a*S),r(this,Be)||(l=v(this,rt,eh).call(this,m,y))}const x=new OffscreenCanvas(m,y).getContext("2d",{willReadFrequently:!0});x.drawImage(l,0,0,l.width,l.height,0,0,m,y),f={width:m,height:y,data:x.getImageData(0,0,m,y).data}}return{canvas:u,width:c,height:d,imageData:f}}getImageForAltText(){return r(this,Us)}static async deserialize(t,s,i){var y;let n=null;if(t instanceof Fp){const{data:{rect:w,rotation:x,id:S,structParent:_,popupRef:C},container:k,parent:{page:{pageNumber:T}}}=t,P=k.querySelector("canvas"),D=i.imageManager.getFromCanvas(k.id,P);P.remove();const O=((y=await s._structTree.getAriaAttributes(`${yu}${S}`))==null?void 0:y.get("aria-label"))||"";n=t={annotationType:X.STAMP,bitmapId:D.id,bitmap:D.bitmap,pageIndex:T-1,rect:w.slice(0),rotation:x,id:S,deleted:!1,accessibilityData:{decorative:!1,altText:O},isSvg:!1,structParent:_,popupRef:C}}const a=await super.deserialize(t,s,i),{rect:o,bitmap:l,bitmapUrl:c,bitmapId:d,isSvg:u,accessibilityData:f}=t;d&&i.imageManager.isValidId(d)?(p(a,Jt,d),l&&p(a,_t,l)):p(a,Ai,c),p(a,Be,u);const[g,m]=a.pageDimensions;return a.width=(o[2]-o[0])/g,a.height=(o[3]-o[1])/m,a.annotationElementId=t.id||null,f&&(a.altTextData=f),a._initialData=n,p(a,Ja,!!n),a}serialize(t=!1,s=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const i={annotationType:X.STAMP,bitmapId:r(this,Jt),pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:r(this,Be),structTreeParentId:this._structTreeParentId};if(t)return i.bitmapUrl=v(this,rt,sh).call(this,!0),i.accessibilityData=this.serializeAltText(!0),i;const{decorative:n,altText:a}=this.serializeAltText(!1);if(!n&&a&&(i.accessibilityData={type:"Figure",alt:a}),this.annotationElementId){const l=v(this,rt,gg).call(this,i);if(l.isSame)return null;l.isSameAltText?delete i.accessibilityData:i.accessibilityData.structParent=this._initialData.structParent??-1}if(i.id=this.annotationElementId,s===null)return i;s.stamps||(s.stamps=new Map);const o=r(this,Be)?(i.rect[2]-i.rect[0])*(i.rect[3]-i.rect[1]):null;if(!s.stamps.has(r(this,Jt)))s.stamps.set(r(this,Jt),{area:o,serialized:i}),i.bitmap=v(this,rt,sh).call(this,!1);else if(r(this,Be)){const l=s.stamps.get(r(this,Jt));o>l.area&&(l.area=o,l.serialized.bitmap.close(),l.serialized.bitmap=v(this,rt,sh).call(this,!1))}return i}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}};_t=new WeakMap,Jt=new WeakMap,rn=new WeakMap,Ai=new WeakMap,an=new WeakMap,Za=new WeakMap,Us=new WeakMap,Gs=new WeakMap,Be=new WeakMap,Ja=new WeakMap,rt=new WeakSet,ko=function(t,s=!1){if(!t){this.remove();return}p(this,_t,t.bitmap),s||(p(this,Jt,t.id),p(this,Be,t.isSvg)),t.file&&p(this,Za,t.file.name),v(this,rt,au).call(this)},To=function(){if(p(this,rn,null),this._uiManager.enableWaiting(!1),!!r(this,Us)){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&r(this,_t)){this._editToolbar.hide(),this._uiManager.editAltText(this,!0);return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&r(this,_t)){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}},th=function(){if(r(this,Jt)){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(r(this,Jt)).then(i=>v(this,rt,ko).call(this,i,!0)).finally(()=>v(this,rt,To).call(this));return}if(r(this,Ai)){const i=r(this,Ai);p(this,Ai,null),this._uiManager.enableWaiting(!0),p(this,rn,this._uiManager.imageManager.getFromUrl(i).then(n=>v(this,rt,ko).call(this,n)).finally(()=>v(this,rt,To).call(this)));return}if(r(this,an)){const i=r(this,an);p(this,an,null),this._uiManager.enableWaiting(!0),p(this,rn,this._uiManager.imageManager.getFromFile(i).then(n=>v(this,rt,ko).call(this,n)).finally(()=>v(this,rt,To).call(this)));return}const t=document.createElement("input");t.type="file",t.accept=Ro.supportedTypesStr;const s=this._uiManager._signal;p(this,rn,new Promise(i=>{t.addEventListener("change",async()=>{if(!t.files||t.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const n=await this._uiManager.imageManager.getFromFile(t.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),v(this,rt,ko).call(this,n)}i()},{signal:s}),t.addEventListener("cancel",()=>{this.remove(),i()},{signal:s})}).finally(()=>v(this,rt,To).call(this))),t.click()},au=function(){var u;const{div:t}=this;let{width:s,height:i}=r(this,_t);const[n,a]=this.pageDimensions,o=.75;if(this.width)s=this.width*n,i=this.height*a;else if(s>o*n||i>o*a){const f=Math.min(o*n/s,o*a/i);s*=f,i*=f}const[l,c]=this.parentDimensions;this.setDims(s*l/n,i*c/a),this._uiManager.enableWaiting(!1);const d=p(this,Us,document.createElement("canvas"));d.setAttribute("role","img"),this.addContainer(d),this.width=s/n,this.height=i/a,(u=this._initialOptions)!=null&&u.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(t.hidden=!1),v(this,rt,ou).call(this),r(this,Ja)||(this.parent.addUndoableEditor(this),p(this,Ja,!0)),this._reportTelemetry({action:"inserted_image"}),r(this,Za)&&d.setAttribute("aria-label",r(this,Za))},eh=function(t,s){const{width:i,height:n}=r(this,_t);let a=i,o=n,l=r(this,_t);for(;a>2*t||o>2*s;){const c=a,d=o;a>2*t&&(a=a>=16384?Math.floor(a/2)-1:Math.ceil(a/2)),o>2*s&&(o=o>=16384?Math.floor(o/2)-1:Math.ceil(o/2));const u=new OffscreenCanvas(a,o);u.getContext("2d").drawImage(l,0,0,c,d,0,0,a,o),l=u.transferToImageBitmap()}return l},ou=function(){const[t,s]=this.parentDimensions,{width:i,height:n}=this,a=new id,o=Math.ceil(i*t*a.sx),l=Math.ceil(n*s*a.sy),c=r(this,Us);if(!c||c.width===o&&c.height===l)return;c.width=o,c.height=l;const d=r(this,Be)?r(this,_t):v(this,rt,eh).call(this,o,l),u=c.getContext("2d");u.filter=this._uiManager.hcmFilter,u.drawImage(d,0,0,d.width,d.height,0,0,o,l)},sh=function(t){if(t){if(r(this,Be)){const n=this._uiManager.imageManager.getSvgUrl(r(this,Jt));if(n)return n}const s=document.createElement("canvas");return{width:s.width,height:s.height}=r(this,_t),s.getContext("2d").drawImage(r(this,_t),0,0),s.toDataURL()}if(r(this,Be)){const[s,i]=this.pageDimensions,n=Math.round(this.width*s*un.PDF_TO_CSS_UNITS),a=Math.round(this.height*i*un.PDF_TO_CSS_UNITS),o=new OffscreenCanvas(n,a);return o.getContext("2d").drawImage(r(this,_t),0,0,r(this,_t).width,r(this,_t).height,0,0,n,a),o.transferToImageBitmap()}return structuredClone(r(this,_t))},gg=function(t){var o;const{pageIndex:s,accessibilityData:{altText:i}}=this._initialData,n=t.pageIndex===s,a=(((o=t.accessibilityData)==null?void 0:o.alt)||"")===i;return{isSame:!this._hasBeenMoved&&!this._hasBeenResized&&n&&a,isSameAltText:a}},U(Ro,"_type","stamp"),U(Ro,"_editorType",X.STAMP);let ru=Ro;var kr,Qa,Ws,on,vi,es,ln,to,Tr,ys,wi,oe,xi,j,cn,wt,mg,Ts,cu,hu,ih;const as=class as{constructor({uiManager:e,pageIndex:t,div:s,structTreeLayer:i,accessibilityManager:n,annotationLayer:a,drawLayer:o,textLayer:l,viewport:c,l10n:d}){A(this,wt);A(this,kr);A(this,Qa,!1);A(this,Ws,null);A(this,on,null);A(this,vi,null);A(this,es,new Map);A(this,ln,!1);A(this,to,!1);A(this,Tr,!1);A(this,ys,null);A(this,wi,null);A(this,oe,null);A(this,xi,null);A(this,j);const u=[...r(as,cn).values()];if(!as._initialized){as._initialized=!0;for(const f of u)f.initialize(d,e)}e.registerEditorTypes(u),p(this,j,e),this.pageIndex=t,this.div=s,p(this,kr,n),p(this,Ws,a),this.viewport=c,p(this,oe,l),this.drawLayer=o,this._structTree=i,r(this,j).addLayer(this)}get isEmpty(){return r(this,es).size===0}get isInvisible(){return this.isEmpty&&r(this,j).getMode()===X.NONE}updateToolbar(e){r(this,j).updateToolbar(e)}updateMode(e=r(this,j).getMode()){switch(v(this,wt,ih).call(this),e){case X.NONE:this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case X.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case X.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:t}=this.div;for(const s of r(as,cn).values())t.toggle(`${s._type}Editing`,e===s._editorType);this.div.hidden=!1}hasTextLayer(e){var t;return e===((t=r(this,oe))==null?void 0:t.div)}setEditingState(e){r(this,j).setEditingState(e)}addCommands(e){r(this,j).addCommands(e)}cleanUndoStack(e){r(this,j).cleanUndoStack(e)}toggleDrawing(e=!1){this.div.classList.toggle("drawing",!e)}togglePointerEvents(e=!1){this.div.classList.toggle("disabled",!e)}toggleAnnotationLayerPointerEvents(e=!1){var t;(t=r(this,Ws))==null||t.div.classList.toggle("disabled",!e)}async enable(){p(this,Tr,!0),this.div.tabIndex=0,this.togglePointerEvents(!0);const e=new Set;for(const s of r(this,es).values())s.enableEditing(),s.show(!0),s.annotationElementId&&(r(this,j).removeChangedExistingAnnotation(s),e.add(s.annotationElementId));if(!r(this,Ws)){p(this,Tr,!1);return}const t=r(this,Ws).getEditableAnnotations();for(const s of t){if(s.hide(),r(this,j).isDeletedAnnotationElement(s.data.id)||e.has(s.data.id))continue;const i=await this.deserialize(s);i&&(this.addOrRebuild(i),i.enableEditing())}p(this,Tr,!1)}disable(){var i;p(this,to,!0),this.div.tabIndex=-1,this.togglePointerEvents(!1);const e=new Map,t=new Map;for(const n of r(this,es).values())if(n.disableEditing(),!!n.annotationElementId){if(n.serialize()!==null){e.set(n.annotationElementId,n);continue}else t.set(n.annotationElementId,n);(i=this.getEditableAnnotation(n.annotationElementId))==null||i.show(),n.remove()}if(r(this,Ws)){const n=r(this,Ws).getEditableAnnotations();for(const a of n){const{id:o}=a.data;if(r(this,j).isDeletedAnnotationElement(o))continue;let l=t.get(o);if(l){l.resetAnnotationElement(a),l.show(!1),a.show();continue}l=e.get(o),l&&(r(this,j).addChangedExistingAnnotation(l),l.renderAnnotationElement(a)&&l.show(!1)),a.show()}}v(this,wt,ih).call(this),this.isEmpty&&(this.div.hidden=!0);const{classList:s}=this.div;for(const n of r(as,cn).values())s.remove(`${n._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),p(this,to,!1)}getEditableAnnotation(e){var t;return((t=r(this,Ws))==null?void 0:t.getEditableAnnotation(e))||null}setActiveEditor(e){r(this,j).getActive()!==e&&r(this,j).setActiveEditor(e)}enableTextSelection(){var e;if(this.div.tabIndex=-1,(e=r(this,oe))!=null&&e.div&&!r(this,xi)){p(this,xi,new AbortController);const t=r(this,j).combinedSignal(r(this,xi));r(this,oe).div.addEventListener("pointerdown",v(this,wt,mg).bind(this),{signal:t}),r(this,oe).div.classList.add("highlighting")}}disableTextSelection(){var e;this.div.tabIndex=0,(e=r(this,oe))!=null&&e.div&&r(this,xi)&&(r(this,xi).abort(),p(this,xi,null),r(this,oe).div.classList.remove("highlighting"))}enableClick(){if(r(this,on))return;p(this,on,new AbortController);const e=r(this,j).combinedSignal(r(this,on));this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:e});const t=this.pointerup.bind(this);this.div.addEventListener("pointerup",t,{signal:e}),this.div.addEventListener("pointercancel",t,{signal:e})}disableClick(){var e;(e=r(this,on))==null||e.abort(),p(this,on,null)}attach(e){r(this,es).set(e.id,e);const{annotationElementId:t}=e;t&&r(this,j).isDeletedAnnotationElement(t)&&r(this,j).removeDeletedAnnotationElement(e)}detach(e){var t;r(this,es).delete(e.id),(t=r(this,kr))==null||t.removePointerInTextLayer(e.contentDiv),!r(this,to)&&e.annotationElementId&&r(this,j).addDeletedAnnotationElement(e)}remove(e){this.detach(e),r(this,j).removeEditor(e),e.div.remove(),e.isAttachedToDOM=!1}changeParent(e){var t;e.parent!==this&&(e.parent&&e.annotationElementId&&(r(this,j).addDeletedAnnotationElement(e.annotationElementId),Et.deleteAnnotationElement(e),e.annotationElementId=null),this.attach(e),(t=e.parent)==null||t.detach(e),e.setParent(this),e.div&&e.isAttachedToDOM&&(e.div.remove(),this.div.append(e.div)))}add(e){if(!(e.parent===this&&e.isAttachedToDOM)){if(this.changeParent(e),r(this,j).addEditor(e),this.attach(e),!e.isAttachedToDOM){const t=e.render();this.div.append(t),e.isAttachedToDOM=!0}e.fixAndSetPosition(),e.onceAdded(!r(this,Tr)),r(this,j).addToAnnotationStorage(e),e._reportTelemetry(e.telemetryInitialData)}}moveEditorInDOM(e){var s;if(!e.isAttachedToDOM)return;const{activeElement:t}=document;e.div.contains(t)&&!r(this,vi)&&(e._focusEventsAllowed=!1,p(this,vi,setTimeout(()=>{p(this,vi,null),e.div.contains(document.activeElement)?e._focusEventsAllowed=!0:(e.div.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:r(this,j)._signal}),t.focus())},0))),e._structTreeParentId=(s=r(this,kr))==null?void 0:s.moveElementInDOM(this.div,e.div,e.contentDiv,!0)}addOrRebuild(e){e.needsToBeRebuilt()?(e.parent||(e.parent=this),e.rebuild(),e.show()):this.add(e)}addUndoableEditor(e){const t=()=>e._uiManager.rebuild(e),s=()=>{e.remove()};this.addCommands({cmd:t,undo:s,mustExec:!1})}getNextId(){return r(this,j).getId()}combinedSignal(e){return r(this,j).combinedSignal(e)}canCreateNewEmptyEditor(){var e;return(e=r(this,wt,Ts))==null?void 0:e.canCreateNewEmptyEditor()}pasteEditor(e,t){r(this,j).updateToolbar(e),r(this,j).updateMode(e);const{offsetX:s,offsetY:i}=v(this,wt,hu).call(this),n=this.getNextId(),a=v(this,wt,cu).call(this,{parent:this,id:n,x:s,y:i,uiManager:r(this,j),isCentered:!0,...t});a&&this.add(a)}async deserialize(e){var t;return await((t=r(as,cn).get(e.annotationType??e.annotationEditorType))==null?void 0:t.deserialize(e,this,r(this,j)))||null}createAndAddNewEditor(e,t,s={}){const i=this.getNextId(),n=v(this,wt,cu).call(this,{parent:this,id:i,x:e.offsetX,y:e.offsetY,uiManager:r(this,j),isCentered:t,...s});return n&&this.add(n),n}addNewEditor(){this.createAndAddNewEditor(v(this,wt,hu).call(this),!0)}setSelected(e){r(this,j).setSelected(e)}toggleSelected(e){r(this,j).toggleSelected(e)}unselect(e){r(this,j).unselect(e)}pointerup(e){var s;const{isMac:t}=ye.platform;if(!(e.button!==0||e.ctrlKey&&t)&&e.target===this.div&&r(this,ln)&&(p(this,ln,!1),!((s=r(this,wt,Ts))!=null&&s.isDrawer&&r(this,wt,Ts).supportMultipleDrawings))){if(!r(this,Qa)){p(this,Qa,!0);return}if(r(this,j).getMode()===X.STAMP){r(this,j).unselectAll();return}this.createAndAddNewEditor(e,!1)}}pointerdown(e){var i;if(r(this,j).getMode()===X.HIGHLIGHT&&this.enableTextSelection(),r(this,ln)){p(this,ln,!1);return}const{isMac:t}=ye.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div)return;if(p(this,ln,!0),(i=r(this,wt,Ts))!=null&&i.isDrawer){this.startDrawingSession(e);return}const s=r(this,j).getActive();p(this,Qa,!s||s.isEmpty())}startDrawingSession(e){if(this.div.focus(),r(this,ys)){r(this,wt,Ts).startDrawing(this,r(this,j),!1,e);return}r(this,j).setCurrentDrawingSession(this),p(this,ys,new AbortController);const t=r(this,j).combinedSignal(r(this,ys));this.div.addEventListener("blur",({relatedTarget:s})=>{s&&!this.div.contains(s)&&(p(this,wi,null),this.commitOrRemove())},{signal:t}),r(this,wt,Ts).startDrawing(this,r(this,j),!1,e)}pause(e){if(e){const{activeElement:t}=document;this.div.contains(t)&&p(this,wi,t);return}r(this,wi)&&setTimeout(()=>{var t;(t=r(this,wi))==null||t.focus(),p(this,wi,null)},0)}endDrawingSession(e=!1){return r(this,ys)?(r(this,j).setCurrentDrawingSession(null),r(this,ys).abort(),p(this,ys,null),p(this,wi,null),r(this,wt,Ts).endDrawing(e)):null}findNewParent(e,t,s){const i=r(this,j).findParent(t,s);return i===null||i===this?!1:(i.changeParent(e),!0)}commitOrRemove(){return r(this,ys)?(this.endDrawingSession(),!0):!1}onScaleChanging(){r(this,ys)&&r(this,wt,Ts).onScaleChangingWhenDrawing(this)}destroy(){var e,t;this.commitOrRemove(),((e=r(this,j).getActive())==null?void 0:e.parent)===this&&(r(this,j).commitOrRemove(),r(this,j).setActiveEditor(null)),r(this,vi)&&(clearTimeout(r(this,vi)),p(this,vi,null));for(const s of r(this,es).values())(t=r(this,kr))==null||t.removePointerInTextLayer(s.contentDiv),s.setParent(null),s.isAttachedToDOM=!1,s.div.remove();this.div=null,r(this,es).clear(),r(this,j).removeLayer(this)}render({viewport:e}){this.viewport=e,Lr(this.div,e);for(const t of r(this,j).getEditors(this.pageIndex))this.add(t),t.rebuild();this.updateMode()}update({viewport:e}){r(this,j).commitOrRemove(),v(this,wt,ih).call(this);const t=this.viewport.rotation,s=e.rotation;if(this.viewport=e,Lr(this.div,{rotation:s}),t!==s)for(const i of r(this,es).values())i.rotate(s)}get pageDimensions(){const{pageWidth:e,pageHeight:t}=this.viewport.rawDims;return[e,t]}get scale(){return r(this,j).viewParameters.realScale}};kr=new WeakMap,Qa=new WeakMap,Ws=new WeakMap,on=new WeakMap,vi=new WeakMap,es=new WeakMap,ln=new WeakMap,to=new WeakMap,Tr=new WeakMap,ys=new WeakMap,wi=new WeakMap,oe=new WeakMap,xi=new WeakMap,j=new WeakMap,cn=new WeakMap,wt=new WeakSet,mg=function(e){r(this,j).unselectAll();const{target:t}=e;if(t===r(this,oe).div||(t.getAttribute("role")==="img"||t.classList.contains("endOfContent"))&&r(this,oe).div.contains(t)){const{isMac:s}=ye.platform;if(e.button!==0||e.ctrlKey&&s)return;r(this,j).showAllEditors("highlight",!0,!0),r(this,oe).div.classList.add("free"),this.toggleDrawing(),dh.startHighlighting(this,r(this,j).direction==="ltr",{target:r(this,oe).div,x:e.x,y:e.y}),r(this,oe).div.addEventListener("pointerup",()=>{r(this,oe).div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:r(this,j)._signal}),e.preventDefault()}},Ts=function(){return r(as,cn).get(r(this,j).getMode())},cu=function(e){const t=r(this,wt,Ts);return t?new t.prototype.constructor(e):null},hu=function(){const{x:e,y:t,width:s,height:i}=this.div.getBoundingClientRect(),n=Math.max(0,e),a=Math.max(0,t),o=Math.min(window.innerWidth,e+s),l=Math.min(window.innerHeight,t+i),c=(n+o)/2-e,d=(a+l)/2-t,[u,f]=this.viewport.rotation%180===0?[c,d]:[d,c];return{offsetX:u,offsetY:f}},ih=function(){for(const e of r(this,es).values())e.isEmpty()&&e.remove()},U(as,"_initialized",!1),A(as,cn,new Map([Ud,nu,ru,dh].map(e=>[e._editorType,e])));let lu=as;var As,lc,be,Pr,Mh,bg,Vs,uu,yg,fu;const ie=class ie{constructor({pageIndex:e}){A(this,Vs);A(this,As,null);A(this,lc,0);A(this,be,new Map);A(this,Pr,new Map);this.pageIndex=e}setParent(e){if(!r(this,As)){p(this,As,e);return}if(r(this,As)!==e){if(r(this,be).size>0)for(const t of r(this,be).values())t.remove(),e.append(t);p(this,As,e)}}static get _svgFactory(){return tt(this,"_svgFactory",new Eu)}draw(e,t=!1,s=!1){const i=de(this,lc)._++,n=v(this,Vs,uu).call(this),a=ie._svgFactory.createElement("defs");n.append(a);const o=ie._svgFactory.createElement("path");a.append(o);const l=`path_p${this.pageIndex}_${i}`;o.setAttribute("id",l),o.setAttribute("vector-effect","non-scaling-stroke"),t&&r(this,Pr).set(i,o);const c=s?v(this,Vs,yg).call(this,a,l):null,d=ie._svgFactory.createElement("use");return n.append(d),d.setAttribute("href",`#${l}`),this.updateProperties(n,e),r(this,be).set(i,n),{id:i,clipPathId:`url(#${c})`}}drawOutline(e,t){const s=de(this,lc)._++,i=v(this,Vs,uu).call(this),n=ie._svgFactory.createElement("defs");i.append(n);const a=ie._svgFactory.createElement("path");n.append(a);const o=`path_p${this.pageIndex}_${s}`;a.setAttribute("id",o),a.setAttribute("vector-effect","non-scaling-stroke");let l;if(t){const u=ie._svgFactory.createElement("mask");n.append(u),l=`mask_p${this.pageIndex}_${s}`,u.setAttribute("id",l),u.setAttribute("maskUnits","objectBoundingBox");const f=ie._svgFactory.createElement("rect");u.append(f),f.setAttribute("width","1"),f.setAttribute("height","1"),f.setAttribute("fill","white");const g=ie._svgFactory.createElement("use");u.append(g),g.setAttribute("href",`#${o}`),g.setAttribute("stroke","none"),g.setAttribute("fill","black"),g.setAttribute("fill-rule","nonzero"),g.classList.add("mask")}const c=ie._svgFactory.createElement("use");i.append(c),c.setAttribute("href",`#${o}`),l&&c.setAttribute("mask",`url(#${l})`);const d=c.cloneNode();return i.append(d),c.classList.add("mainOutline"),d.classList.add("secondaryOutline"),this.updateProperties(i,e),r(this,be).set(s,i),s}finalizeDraw(e,t){r(this,Pr).delete(e),this.updateProperties(e,t)}updateProperties(e,t){var l;if(!t)return;const{root:s,bbox:i,rootClass:n,path:a}=t,o=typeof e=="number"?r(this,be).get(e):e;if(o){if(s&&v(this,Vs,fu).call(this,o,s),i&&v(l=ie,Mh,bg).call(l,o,i),n){const{classList:c}=o;for(const[d,u]of Object.entries(n))c.toggle(d,u)}if(a){const d=o.firstChild.firstChild;v(this,Vs,fu).call(this,d,a)}}}updateParent(e,t){if(t===this)return;const s=r(this,be).get(e);s&&(r(t,As).append(s),r(this,be).delete(e),r(t,be).set(e,s))}remove(e){r(this,Pr).delete(e),r(this,As)!==null&&(r(this,be).get(e).remove(),r(this,be).delete(e))}destroy(){p(this,As,null);for(const e of r(this,be).values())e.remove();r(this,be).clear(),r(this,Pr).clear()}};As=new WeakMap,lc=new WeakMap,be=new WeakMap,Pr=new WeakMap,Mh=new WeakSet,bg=function(e,[t,s,i,n]){const{style:a}=e;a.top=`${100*s}%`,a.left=`${100*t}%`,a.width=`${100*i}%`,a.height=`${100*n}%`},Vs=new WeakSet,uu=function(){const e=ie._svgFactory.create(1,1,!0);return r(this,As).append(e),e.setAttribute("aria-hidden",!0),e},yg=function(e,t){const s=ie._svgFactory.createElement("clipPath");e.append(s);const i=`clip_${t}`;s.setAttribute("id",i),s.setAttribute("clipPathUnits","objectBoundingBox");const n=ie._svgFactory.createElement("use");return s.append(n),n.setAttribute("href",`#${t}`),n.classList.add("clip"),i},fu=function(e,t){for(const[s,i]of Object.entries(t))i===null?e.removeAttribute(s):e.setAttribute(s,i)},A(ie,Mh);let du=ie;globalThis.pdfjsTestingUtils={HighlightOutliner:Wd};W.AbortException;W.AnnotationEditorLayer;W.AnnotationEditorParamsType;W.AnnotationEditorType;W.AnnotationEditorUIManager;W.AnnotationLayer;W.AnnotationMode;W.ColorPicker;W.DOMSVGFactory;W.DrawLayer;W.FeatureTest;var Ay=W.GlobalWorkerOptions;W.ImageKind;W.InvalidPDFException;W.MissingPDFException;W.OPS;W.OutputScale;W.PDFDataRangeTransport;W.PDFDateString;W.PDFWorker;W.PasswordResponses;W.PermissionFlag;W.PixelsPerInch;W.RenderingCancelledException;W.TextLayer;W.TouchManager;W.UnexpectedResponseException;W.Util;W.VerbosityLevel;W.XfaLayer;W.build;W.createValidAbsoluteUrl;W.fetchData;var vy=W.getDocument;W.getFilenameFromUrl;W.getPdfFilenameFromUrl;W.getXfaPageViewport;W.isDataScheme;W.isPdfFile;W.noContextMenu;W.normalizeUnicode;W.setLayerDimensions;W.shadow;W.stopEvent;W.version;Ay.workerSrc=chrome.runtime.getURL("pdf.worker.min.mjs");const uf=["professional","experience","education","university","bachelor","master","development","management","engineering","technology","computer","science","business","administration","associate","certificate","leadership","volunteer","organization","achievement","accomplishment","publication","presentation","conference","responsible","communication","collaboration","implementation","international","department","foundation","scholarship","fellowship","research","analysis","analytical","strategic","operations","performance","excellent","expertise","proficiency","environment","application","architecture","software"];function Ci(h){let e=h;return e=e.replace(/\b([A-Za-z])\s+([a-z]{2,})\b/g,(t,s,i)=>{const n=(s+i).toLowerCase();for(const a of uf)if(a===n||a.startsWith(n))return s+i;return t}),e=e.replace(/\b([A-Za-z]{2,3})\s+([a-z]{3,})\b/g,(t,s,i)=>{const n=(s+i).toLowerCase();for(const a of uf)if(a===n)return s+i;return t}),e=e.replace(/\s{2,}/g," "),e=e.replace(/\s+([.,;:!?])/g,"$1"),e=e.replace(/\b([A-Z])\s(?=[a-z]{4,})/g,"$1"),e}function st(h,e){let t=Ci(h).trim();switch(e){case"name":t=t.replace(/[^A-Za-z\s\-']/g,"").trim(),t=t.split(" ").map(i=>i.charAt(0).toUpperCase()+i.slice(1).toLowerCase()).join(" ");break;case"email":t=t.replace(/\s/g,"").toLowerCase();break;case"phone":const s=t.replace(/\D/g,"");s.length===10?t=`(${s.slice(0,3)}) ${s.slice(3,6)}-${s.slice(6)}`:s.length===11&&s.startsWith("1")&&(t=`+1 (${s.slice(1,4)}) ${s.slice(4,7)}-${s.slice(7)}`);break;case"url":t&&!t.startsWith("http")&&(t="https://"+t);break;case"date":t=t.replace(/\b(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)\w*/gi,i=>i.charAt(0).toUpperCase()+i.slice(1).toLowerCase());break;default:t=Ci(t)}return t}const ff=async h=>{var s;const e=(s=h.name.split(".").pop())==null?void 0:s.toLowerCase();let t="";if(e==="pdf")t=await wy(h);else throw new Error("Only PDF files are supported. Please convert your document to PDF format.");return t=Ci(t),console.log("Cleaned text:",t),By(t)};async function wy(h){const e=await h.arrayBuffer(),t=await vy({data:e}).promise;let s="";for(let i=1;i<=t.numPages;i++){const o=(await(await t.getPage(i)).getTextContent()).items,l=new Map;o.forEach(u=>{const f=Math.round(u.transform[5]);l.has(f)||l.set(f,[]),l.get(f).push(u.str)});const d=[...l.keys()].sort((u,f)=>f-u).map(u=>l.get(u).join(" ").trim()).filter(u=>u);s+=d.join(`
`)+`
`}return s}const xy={experience:["experience","employment","work history","professional experience","career","job history"],education:["education","academic","degrees","qualifications","schooling"],skills:["skills","competencies","expertise","technologies","proficiencies","technical skills","core competencies"],leadership:["leadership","volunteer","extracurricular","activities","organizations","community"],awards:["awards","honors","achievements","recognition","accomplishments","scholarships","fellowships"],publications:["publications","papers","articles","research publications","journal","published works"],grants:["grants","funding","sponsored","fellowship"],teaching:["teaching","instruction","courses taught","academic experience"],conferences:["conferences","presentations","talks","posters","invited"],projects:["projects","portfolio","personal projects"],certifications:["certifications","licenses","credentials","training"],summary:["summary","objective","profile","about","overview","introduction"]};function Sy(h){const e=h.toLowerCase().replace(/[:\-–—•·_|]/g," ").trim();if(e.length>50||e.length<3)return null;const t=h===h.toUpperCase()&&/[A-Z]/.test(h),i=e.split(/\s+/).length<=4;for(const[n,a]of Object.entries(xy))for(const o of a){if(e===o)return console.log("Section header found (exact):",h,"->",n),n;if(e.startsWith(o+" ")||e.endsWith(" "+o))return console.log("Section header found (partial):",h,"->",n),n;if(t&&e.includes(o))return console.log("Section header found (caps):",h,"->",n),n;if(i&&e.includes(o))return console.log("Section header found (short):",h,"->",n),n}return null}function _y(h){const e=h.split(`
`).map(n=>n.trim()),t={header:[],experience:[],education:[],skills:[],leadership:[],awards:[],publications:[],grants:[],teaching:[],conferences:[],projects:[],other:[]};console.log("=== SECTION SPLITTING DEBUG ==="),console.log("Total lines:",e.length),console.log("First 20 lines:",e.slice(0,20));let s="header",i=!1;for(let n=0;n<e.length;n++){const a=e[n];if(!a)continue;const o=Sy(a);if(o){i=!0,s=o,console.log(`Line ${n}: Section header "${a}" -> ${o}`);continue}!i&&t.header.length<10?t.header.push(a):t[s]?t[s].push(a):t.other.push(a)}return console.log("Section counts:",Object.fromEntries(Object.entries(t).map(([n,a])=>[n,a.length]))),console.log("=== END SECTION SPLITTING ==="),t}function Ey(h){const e=[/https?:\/\/(?:www\.)?linkedin\.com\/in\/([a-zA-Z0-9_-]+)\/?/i,/linkedin\.com\/in\/([a-zA-Z0-9_-]+)\/?/i];for(const t of e){const s=h.match(t);if(s)return st(`https://linkedin.com/in/${s[1]}`,"url")}return""}function Cy(h){const e=[/https?:\/\/(?:www\.)?github\.com\/([a-zA-Z0-9_-]+)\/?/i,/github\.com\/([a-zA-Z0-9_-]+)\/?/i];for(const t of e){const s=h.match(t);if(s)return st(`https://github.com/${s[1]}`,"url")}return""}function ky(h){const e=/https?:\/\/(?!(?:www\.)?(?:linkedin|github)\.com)[^\s,)\]]+/gi,t=h.match(e);return t&&t.length>0?st(t[0],"url"):""}function Ty(h,e){const t=h.join(" "),s=e.match(/[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}/),i=s?st(s[0],"email"):"",n=[/\(?\d{3}\)?[-.\s]?\d{3}[-.\s]?\d{4}/,/\+1[-.\s]?\(?\d{3}\)?[-.\s]?\d{3}[-.\s]?\d{4}/];let a="";for(const m of n){const y=t.match(m)||e.match(m);if(y){a=st(y[0],"phone");break}}const o=Ey(e),l=Cy(e),c=ky(e),d=t.match(/([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*),?\s*([A-Z]{2})(?:\s+\d{5})?/),u=d?d[0]:"";let f="",g="";if(h[0]){const y=h[0].replace(i,"").replace(a,"").replace(/[|•·,]/g," ").trim().split(/\s+/).filter(w=>w.length>1&&/^[A-Za-z]/.test(w));f=st(y[0]||"","name"),g=st(y.slice(1).join(" ")||"","name")}return{firstName:f,lastName:g,email:i,phone:a,linkedin:o,website:c,github:l,address:u}}function Fo(h){const e=h.toLowerCase().trim();if(["present","current","now","ongoing","today"].includes(e)||/^(p|c|now)\.?$/.test(e))return{month:"",year:"Present"};let t="",s="";for(let o=0;o<12;o++){const l=Xe[o].toLowerCase(),c=l.slice(0,3),d=l.slice(0,2);if(e.includes(l)||e.includes(c)||d.length>=2&&e.includes(d)){t=Xe[o];break}}let i=h.match(/\b(19|20)\d{2}\b/);if(i){const o=parseInt(i[0]);o>=Po&&o<=Lo&&(s=i[0])}const n=h.match(/(\d{1,2})\/(\d{4})/);if(n){const o=parseInt(n[1])-1;o>=0&&o<12&&(t=Xe[o]);const l=parseInt(n[2]);l>=Po&&l<=Lo&&(s=n[2])}const a=h.match(/(\d{4})-(\d{1,2})/);if(a&&!s){const o=parseInt(a[1]);o>=Po&&o<=Lo&&(s=a[1]);const l=parseInt(a[2])-1;l>=0&&l<12&&(t=Xe[l])}return!t&&e.includes("spring")&&(t=Xe[2]),!t&&e.includes("summer")&&(t=Xe[5]),!t&&e.includes("fall")&&(t=Xe[8]),!t&&e.includes("autumn")&&(t=Xe[8]),!t&&e.includes("winter")&&(t=Xe[11]),{month:t,year:s}}function uc(h){const e=[/(\w+\.?\s*\d{4})\s*[-–—to]+\s*(\w+\.?\s*\d{4}|present|current|ongoing|today)/gi,/(\d{1,2}\/\d{4})\s*[-–—to]+\s*(\d{1,2}\/\d{4}|present|current|today)/gi,/\b(\d{4})\s*[-–—to]+\s*(\d{4}|present|current|today)\b/gi,/(\d{4})-(\d{1,2})\s*[-–—to]+\s*(\d{4})-(\d{1,2}|present|current)/gi];for(const s of e){const i=h.match(s);if(i){const n=i[0].split(/[-–—]|to/i).map(a=>a.trim());if(n.length>=2){const a=Fo(n[0]),o=Fo(n[1]);return{startMonth:a.month,startYear:a.year,endMonth:o.month,endYear:o.year}}}}const t=h.match(/\b(19|20)\d{2}\b/);return t?{startMonth:"",startYear:"",endMonth:"",endYear:t[0]}:eo()}function $h(h){const e=[];let t=[];for(let s=0;s<h.length;s++){const i=h[s],n=s>0?h[s-1]:"";if(!i)continue;const a=/\d{4}\s*[-–—to]/.test(i),o=n===""&&i.length>0,l=/^(senior|junior|lead|principal|staff|associate|intern|manager|director|engineer|developer|analyst|professor|instructor|president|chair)\b/i.test(i);(a||o||l)&&t.length>0?(e.push(t),t=[i]):t.push(i)}return t.length>0&&e.push(t),e}const Py=["inc","inc.","incorporated","corp","corp.","corporation","llc","l.l.c.","ltd","ltd.","limited","company","co","co.","technologies","tech","solutions","services","consulting","associates","partners","group","labs","laboratory","laboratories","systems","software","industries","enterprises","global","international","foundation","institute","center","agency","network","networks","studio","studios","media","digital"],Ly=["engineer","developer","manager","director","analyst","designer","scientist","consultant","specialist","coordinator","administrator","associate","assistant","executive","lead","senior","junior","staff","principal","architect","intern","fellow","researcher","professor","instructor","teacher","officer","president","vice president","vp","head","chief","ceo","cto","cfo","coo"];function pf(h){const e=h.toLowerCase();for(const s of Py)if(e.includes(s)){const i=[new RegExp(`[A-Z][a-zA-Z\\s&]*\\b${s}\\b`,"i"),new RegExp(`\\b${s}\\b[^,\\n]{0,20}`,"i")];for(const n of i){const a=h.match(n);if(a)return st(a[0],"text")}}const t=[/University\s+of\s+[A-Z][^,\n]+/i,/[A-Z][a-z]+(?:\s+[A-Z][a-z]+)*\s+University/i,/[A-Z][a-z]+(?:\s+[A-Z][a-z]+)*\s+College/i,/[A-Z][a-z]+(?:\s+[A-Z][a-z]+)*\s+Institute/i];for(const s of t){const i=h.match(s);if(i)return st(i[0],"text")}return""}function gf(h){const e=h.toLowerCase();for(const t of Ly)if(e.includes(t)){const s=[new RegExp(`(?:senior|junior|lead|principal|staff|chief|head|associate)?\\s*[A-Za-z\\s]*${t}[A-Za-z\\s]*`,"i")];for(const i of s){const n=h.match(i);if(n){const a=n[0].trim();if(a.length>3&&a.length<60)return st(a,"text")}}}return""}function My(h){if(h.length===0)return[];const e=$h(h),t=[];for(const s of e){if(s.length===0)continue;const i=s.join(" "),n=uc(i);let a="",o="",l="";const c=s[0].replace(/\d{4}\s*[-–—]\s*\d{4}|present|current/gi,"").trim();if(o=pf(i),a=gf(i),!a||!o){const g=[/\s+at\s+/i,/\s+@\s+/,/\s*[|–—]\s*/,/,\s+(?=[A-Z])/];for(const m of g){const y=c.split(m);if(y.length>=2){a||(a=st(y[0].trim(),"text")),o||(o=st(y[1].split(",")[0].trim(),"text"));break}}}if(!o&&s[1]){const g=s[1].replace(/\d{4}.*$/,"").trim();o=pf(g),!o&&g.length>3&&g.length<80&&(o=st(g.split(",")[0],"text"))}!a&&c.length>3&&(a=st(c.split(/[,|–—]/)[0].trim(),"text"));const d=i.match(/([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*),\s*([A-Z]{2})\b/);d&&(l=d[0]);const f=s.slice(1).filter(g=>g.length>15&&!g.includes(o.substring(0,10))&&!/^\d{4}/.test(g)&&!gf(g)).map(g=>Ci(g.replace(/^[•\-–]\s*/,""))).join(`
• `);(a||o)&&t.push({id:crypto.randomUUID(),title:a||"Position",company:o||"Company",location:l,dates:n,description:f?"• "+f:""})}return t}function Ry(h){if(h.length===0)return[];const e=[],t=["university","college","institute","school","academy","polytechnic"],s=["MIT","UCLA","USC","NYU","Stanford","Harvard","Yale","Princeton","Berkeley","Columbia","Cornell","Duke","Northwestern","Caltech","Georgia Tech","Purdue","Michigan","Virginia Tech","Texas A&M","Oxford","Cambridge","Carnegie Mellon","Brown","Penn","Dartmouth"],i=[/Doctor(?:ate)?(?:\s+of\s+[A-Za-z\s]+)?/i,/Ph\.?D\.?(?:\s+(?:in|of)\s+[A-Za-z\s&]+)?/i,/Master(?:'?s)?(?:\s+(?:of|in)\s+[A-Za-z\s&]+)?/i,/M\.?B\.?A\.?/i,/M\.?S\.?(?:\s+(?:in|of)\s+[A-Za-z\s&]+)?/i,/M\.?A\.?(?:\s+(?:in|of)\s+[A-Za-z\s&]+)?/i,/Bachelor(?:'?s)?(?:\s+(?:of|in)\s+[A-Za-z\s&]+)?/i,/B\.?S\.?(?:\s+(?:in|of)\s+[A-Za-z\s&]+)?/i,/B\.?A\.?(?:\s+(?:in|of)\s+[A-Za-z\s&]+)?/i,/Associate(?:'?s)?(?:\s+(?:of|in)\s+[A-Za-z\s&]+)?/i,/A\.?S\.?/i,/A\.?A\.?/i];let n=[];for(const a of h){if(!a||a.length<3)continue;const o=a.toLowerCase(),l=t.some(u=>o.includes(u))||s.some(u=>o.includes(u.toLowerCase())),c=i.some(u=>u.test(a)),d=/\b(19|20)\d{2}\b/.test(a);(l||c)&&n.length>0&&(d||n.length>2)?(e.push(mf(n,t,s,i)),n=[a]):n.push(a)}return n.length>0&&e.push(mf(n,t,s,i)),e}function mf(h,e,t,s){const i=h.join(" "),n=uc(i);let a="";const o=i.toLowerCase();for(const y of t)if(o.includes(y.toLowerCase())){const w=[new RegExp("University\\s+of\\s+[A-Z][^,\\n]{0,30}","i"),new RegExp("[A-Z][a-z]+(?:\\s+[A-Z][a-z]+){0,2}\\s+University","i"),new RegExp("[A-Z][a-z]+(?:\\s+[A-Z][a-z]+){0,2}\\s+College","i"),new RegExp(`${y}[^,\\n]{0,20}`,"i")];for(const x of w){const S=i.match(x);if(S){a=st(S[0],"text");break}}if(a)break;a=y;break}if(!a){for(const y of e)if(o.includes(y)){const w=[new RegExp("University\\s+of\\s+[A-Z][^,\\n]{0,30}","i"),new RegExp(`[A-Z][a-z]+(?:\\s+[A-Z][a-z]+){0,2}\\s+${y}`,"i")];for(const x of w){const S=i.match(x);if(S){a=st(S[0],"text");break}}if(a)break}}let l="",c="";for(const y of s){const w=i.match(y);if(w){l=st(w[0],"text");const S=i.substring(i.indexOf(w[0])+w[0].length).match(/^[,\s]*(in\s+)?([A-Z][a-z]+(?:\s+[A-Za-z&]+){0,4})/);S&&S[2]&&(c=st(S[2],"text"));break}}if(!c){const y=i.match(/(?:major(?:ing)?|concentration|in)\s+([A-Z][a-z]+(?:\s+[A-Za-z&]+){0,4})/i);y&&(c=st(y[1],"text"))}const d=i.match(/GPA[:\s]*([0-9]\.[0-9]{1,2})/i)||i.match(/([0-9]\.[0-9]{1,2})\s*\/\s*4\.0/),u=d?d[1]:"",f=i.match(/([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*),\s*([A-Z]{2})\b/),g=f?f[0]:"",m=h.filter(y=>y.length>15&&!a.includes(y.substring(0,10))).map(y=>Ci(y)).join(`
`);return{id:crypto.randomUUID(),school:a||st(h[0],"text"),degree:l,field:c,location:g,dates:n,gpa:u,description:m}}function Iy(h){if(!h||h.length<2)return[];console.log("=== AUTHOR PARSING DEBUG ==="),console.log("Input:",h);const e=[];let t=h.replace(/\s*\(\d{4}\)\s*/g,"").replace(/^[•\-–]\s*/,"").replace(/\s*;\s*$/,"").replace(/\s+/g," ").trim();t=t.replace(/\s*-\s*/g,"-"),console.log("Cleaned:",t);let s=[];if(t.includes(";"))s=t.split(/\s*;\s*/).filter(i=>i.length>1),console.log("Split by semicolon:",s);else if(/\band\b|\s&\s/.test(t))s=t.split(/\s+and\s+|\s*&\s*/).filter(i=>i.length>1),console.log("Split by and/&:",s);else{const i=/([^,;]+)\s*,\s*([A-Z]\.?\s*(?:[A-Z]\.?\s*)*|[A-Z][a-z]+)/g;let n;const a=[];for(;(n=i.exec(t))!==null;)a.push(`${n[1].trim()}, ${n[2].trim()}`),console.log("Found via pattern:",n[1],n[2]);if(a.length>0)s=a;else{const o=t.split(/\s*,\s*/).filter(l=>l.length>1);if(o.length>=2&&o.length%2===0){console.log("Using even-count comma splitting heuristic");for(let l=0;l<o.length;l+=2)s.push(`${o[l]}, ${o[l+1]}`)}else console.log("No patterns found, using simple comma split"),s=o}}console.log("Raw authors:",s);for(let i of s){if(i=i.trim().replace(/[.,]+$/,"").trim(),i.length<2)continue;let n="",a="";const o=i.match(/^([A-Za-z]+(?:-[A-Za-z]+)?)\s*,\s*(.+)$/);if(o)a=o[1],n=o[2].replace(/[.,]+$/,"").trim();else{const l=i.split(/\s+/);l.length>=2?(a=l[l.length-1],n=l.slice(0,-1).join(" ")):a=i}a=a.charAt(0).toUpperCase()+a.slice(1),(a||n)&&(console.log("Parsed:",{firstName:n,lastName:a}),e.push({firstName:n,lastName:a}))}return console.log("Final list:",e),console.log("=== END AUTHOR PARSING ==="),e}function bf(h){const e=Ci(h),t=Fo(e),s=t.month?`${t.month} ${t.year}`:t.year,i=e.match(/https?:\/\/[^\s\]]+|doi[:\s]+10\.[^\s]+/i),n=i?i[0].replace(/[.,;]+$/,""):"";let a="";const o=[/\.\s*["']/,/\.\s*(?=[A-Z][a-z])/,/\(\d{4}\)/];let l=0;for(const g of o){const m=e.match(g);if(m&&m.index&&m.index>5&&m.index<e.length/2){l=m.index;break}}if(l>5)a=e.substring(0,l).trim(),a=a.replace(/\.$/,"").replace(/\s+/g," ");else{const g=e.match(/^([A-Z][a-z]+(?:,?\s+[A-Z]\.?\s*)+(?:,?\s*(?:and|&)\s+[A-Z][a-z]+(?:,?\s+[A-Z]\.?\s*)+)*(?:\s*et\s+al\.?)?)/);g&&(a=g[1])}if(a){let g=a.split(/\s*;\s*|\s+and\s+|\s*&\s*/).flatMap(m=>/,[^,]*[A-Z][a-z]+\s+[A-Z][a-z]+/.test(m)?m.split(/,\s*(?=[A-Z][a-z]+\s+[A-Z])/):[m]).map(m=>m.trim()).filter(m=>m.length>2);g=g.map(m=>(m=m.replace(/\.$/,"").trim(),/^[A-Z][a-z]+,\s*[A-Z]/.test(m)?m:st(m,"text"))),a=g.join("; ")}let c="";const d=[/"([^"]{10,200})"/,/'([^']{10,200})'/,/\.\s+([A-Z][^.]{10,150})\./,/\(\d{4}\)\.\s*([^.]{10,150})\./];for(const g of d){const m=e.match(g);if(m&&m[1]){c=st(m[1],"text");break}}if(!c){let g=e.replace(a,"").replace(/\(\d{4}\)/,"").replace(/^\s*[.,]\s*/,"").trim();const m=/\s+(?:in|In|Journal|Proceedings|Conference|Trans\.|IEEE|ACM)\s+/,y=g.match(m);if(y&&y.index)c=g.substring(0,y.index);else{const w=g.match(/^[^.!?]{10,200}/);w&&(c=w[0])}c=st(c||g.substring(0,100),"text")}let u="";const f=[/(?:In|in)\s+([A-Z][^,.\d]{5,80})/,/(?:IEEE|ACM)\s+([A-Z][a-zA-Z\s]{5,60})/,/\.\s+([A-Z][a-zA-Z\s&]+?)(?:\s*,\s*\d|\s*\d{4}|\.\s*$)/,/Journal\s+of\s+([A-Za-z\s&]+)/i,/Proceedings\s+of\s+(?:the\s+)?([A-Za-z\s&]+)/i];for(const g of f){const m=e.match(g);if(m&&m[1]&&m[1].length>3&&m[1].length<100){u=st(m[1],"text");break}}return{id:crypto.randomUUID(),title:c||e.substring(0,100),authors:a,authorsList:Iy(a),journal:u,date:s,url:n,description:""}}function Dy(h){if(h.length===0)return[];const e=[];let t=[];const s=i=>/^\d+[.\)]\s/.test(i)||/^\[\d+\]\s/.test(i)||/^[A-Z][a-z]+,\s+[A-Z]\./.test(i)||/^[A-Z][a-z]+\s+[A-Z][a-z]+\s+and\s+/i.test(i)||/^•\s+/.test(i)||/^\*\s+/.test(i);for(const i of h)if(!(!i||i.length<5))if(s(i)&&t.length>0){const n=t.join(" ");n.length>20&&e.push(bf(n)),t=[i.replace(/^[\d\[\].\)*•\s]+/,"")]}else t.push(i);if(t.length>0){const i=t.join(" ");i.length>20&&e.push(bf(i))}return e}function Ny(h){if(h.length===0)return[];const e=[];let t=[];for(const s of h)/^[•\-–]/.test(s)||/^\d{4}/.test(s)||/\d{4}$/.test(s)?(t.length>0&&e.push(yf(t)),t=[s.replace(/^[•\-–]\s*/,"")]):(t.length>0,t.push(s));return t.length>0&&e.push(yf(t)),e}function yf(h){const e=h.join(" "),t=Fo(e),s=t.month?`${t.month} ${t.year}`:t.year;let i=st(h[0].replace(/\b\d{4}\b/g,"").replace(/[,\-–]$/,""),"text");const n=e.match(/(?:from|by|,)\s+(.+?)(?:\d{4}|$)/i),a=n?st(n[1],"text"):"",o=h.slice(1).map(l=>Ci(l)).join(" ");return{id:crypto.randomUUID(),title:i||"Award",issuer:a,date:s,description:o}}function Fy(h){var s,i;if(h.length===0)return[];const e=$h(h),t=[];for(const n of e){if(n.length===0)continue;const a=n.join(" "),o=uc(a),c=n[0].replace(/\d{4}\s*[-–—]\s*\d{4}|present|current/gi,"").trim().split(/\s+[-–—,]\s+|\s+at\s+|\s+@\s+/i),d=st(((s=c[0])==null?void 0:s.trim())||"","text"),u=st(((i=c[1])==null?void 0:i.trim())||"","text"),f=a.match(/([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*),\s*([A-Z]{2})\b/),g=f?f[0]:"",y=n.slice(1).filter(w=>w.length>10).map(w=>Ci(w.replace(/^[•\-–]\s*/,""))).join(`
• `);(d||u)&&t.push({id:crypto.randomUUID(),role:d||"Role",organization:u||"Organization",location:g,dates:o,description:y?"• "+y:""})}return t}function jy(h){if(h.length===0)return[];const e=$h(h),t=[];for(const s of e){const i=s.join(" "),n=uc(i),a=i.match(/\$[\d,]+(?:\.\d{2})?|\d+[kK]/),o=a?a[0]:"",l=i.match(/(?:from|by|funded by)\s+([^,\n]+)/i),c=l?st(l[1],"text"):"",d=st(s[0].replace(/\$[\d,]+/,"").replace(/\d{4}.*$/,""),"text");d&&t.push({id:crypto.randomUUID(),title:d,funder:c,amount:o,dates:n,description:""})}return t}function Oy(h){if(h.length===0)return[];const e=$h(h),t=[];for(const s of e){const i=s.join(" "),n=uc(i),a=i.match(/(instructor|ta|teaching assistant|lecturer|professor|adjunct|graduate assistant)/i),o=a?a[1]:"";let l=st(s[0].replace(/\d{4}.*$/,""),"text");const c=i.match(/"([^"]+)"|([A-Z]{2,4}\s*\d{3,4})/);c&&(l=c[1]||c[2]);let d="";const u=[/University\s+of\s+[A-Z][^\n,]+/i,/[A-Z][a-z]+(?:\s+[A-Z][a-z]+)*\s+University/i,/[A-Z][a-z]+(?:\s+[A-Z][a-z]+)*\s+College/i,/[A-Z][a-z]+(?:\s+[A-Z][a-z]+)*\s+Institute/i];for(const m of u){const y=i.match(m);if(y){d=y[0];break}}const g=s.slice(1).filter(m=>m.length>10).map(m=>Ci(m)).join(`
`);l&&t.push({id:crypto.randomUUID(),course:l,institution:d,role:o,dates:n,description:g})}return t}function zy(h){if(h.length===0)return[];const e=[];for(const t of h){if(t.length<10)continue;const s=Fo(t),i=s.month?`${s.month} ${s.year}`:s.year,n=st(t.replace(/\b\d{4}\b/g,"").replace(/^[•\-–]\s*/,""),"text"),a=t.match(/([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*),\s*([A-Z]{2})\b/),o=a?a[0]:"",l=t.match(/(?:at|,)\s+([A-Z][^\d,]+)/),c=l?st(l[1],"text"):"";n&&e.push({id:crypto.randomUUID(),title:n,conference:c,location:o,date:i,description:""})}return e}function $y(h){const e=h.join(" "),t=[],s=e.split(/[,•·|;\/]/).map(i=>i.trim()).filter(i=>i.length>1&&i.length<50);for(const i of s){const n=st(i.replace(/^[-–:]\s*/,""),"text");n&&!t.includes(n)&&!/^\d+$/.test(n)&&t.push(n)}return t}function By(h){const e=_y(h),t={personalInfo:Ty(e.header,h),workExperience:My(e.experience),education:Ry(e.education),leadershipExperience:Fy(e.leadership),awards:Ny(e.awards),publications:Dy(e.publications),grants:jy(e.grants),teachingExperience:Oy(e.teaching),conferences:zy(e.conferences),skills:$y(e.skills)};return console.log("Parsed resume:",t),t}async function Hy(h){let e;try{e=new URL(h)}catch{throw new Error("Invalid URL format")}const t=e.hostname.toLowerCase(),s=["https://api.allorigins.win/raw?url=","https://corsproxy.io/?","https://api.codetabs.com/v1/proxy?quest="],i=async(y,w)=>{const x=new AbortController,S=setTimeout(()=>x.abort(),w);try{const _=await fetch(y+encodeURIComponent(h),{signal:x.signal,headers:{Accept:"text/html,application/xhtml+xml"}});if(clearTimeout(S),!_.ok)throw new Error("Fetch failed");return await _.text()}catch(_){throw clearTimeout(S),_}};let n="";try{n=await Promise.any(s.map(y=>i(y,8e3)))}catch{throw new Error("Could not reach the page. Try pasting the job description manually.")}if(!n||n.length<100)throw new Error("Page returned empty content. Try pasting the job description manually.");const o=new DOMParser().parseFromString(n,"text/html");let l="";const c=y=>{const w=o.createElement("div");return w.innerHTML=y,w.textContent||w.innerText||""},d=y=>{const w=[/\bAbout\s+(the\s+)?Company\b/i,/\bAbout\s+S&P\s+Global\b/i,/\bAbout\s+Us\b/i,/\bWho\s+We\s+Are\b/i,/\bWhat'?s\s+In\s+It\s+For\s+You\b/i,/\bOur\s+Mission\b/i,/\bOur\s+Values\b/i,/\bOur\s+People\b/i,/\bOur\s+Culture\b/i,/\bBenefits\s*(:|We\s+Offer)\b/i,/\bPerks\s+(&|and)\s+Benefits\b/i,/\bEqual\s+Opportunity\s+Employer\b/i,/\bEEO\s+Statement\b/i,/\bDiversity\s+(&|and)\s+Inclusion\b/i,/\bWe\s+are\s+an\s+equal\b/i,/\bLearn\s+more\s+at\s+www\./i,/\bVisit\s+(us\s+at\s+)?www\./i,/\bFor\s+more\s+information\s+visit\b/i,/\bApply\s+Now\b/i,/\bHow\s+to\s+Apply\b/i,/\bApplication\s+Process\b/i,/\bSalary\s+Range\s*:/i,/\bCompensation\s*:/i];let x=y.length;for(const S of w){const _=y.match(S);_&&_.index!==void 0&&_.index>200&&_.index<x&&(x=_.index)}return x<y.length?y.substring(0,x).trim():y},u=y=>{const x=y.replace(/[\t\r]+/g," ").replace(/ +/g," ").split(/\n+/).map(T=>T.trim()).filter(T=>T.length>0),S=[],_=new Set;for(const T of x){const P=T.toLowerCase().substring(0,50);_.has(P)||(_.add(P),S.push(T))}const C=[/^(sign in|log in|sign up|register|menu|home|about us|contact|privacy|terms|cookies?|©|copyright)/i,/^(share|tweet|post|follow|subscribe|newsletter)/i,/^(facebook|twitter|linkedin|instagram|youtube)/i,/^(back to|go to|view all|see more|show more|load more)/i,/^(search|filter|sort by|page \d)/i,/^\d+\s*(days?|hours?|minutes?|seconds?)\s*ago/i,/^(apply now|save job|report|flag)/i,/^[\W\s]*$/,/^.{0,8}$/];return S.filter(T=>{for(const P of C)if(P.test(T))return!1;return!0}).join(`
`).trim()},f=o.querySelectorAll('script[type="application/ld+json"]');for(const y of f)try{const w=y.textContent||"";if(!w.includes("JobPosting"))continue;const x=JSON.parse(w),S=C=>{if(!C||typeof C!="object")return null;if(Array.isArray(C)){for(const T of C){const P=S(T);if(P)return P}return null}const k=C;if(k["@type"]==="JobPosting"){const T=k.description;if(typeof T=="string"&&T.length>50)return c(T)}for(const T of Object.values(k)){const P=S(T);if(P)return P}return null},_=S(x);if(_&&_.length>100){l=_.replace(/\s+/g," ").replace(/\n\s*\n/g,`

`).trim(),l=d(l);break}}catch{}if(l.length>100)return l.substring(0,6e3);["script","style","nav","footer","header","aside","iframe","noscript","svg",'[role="navigation"]','[role="banner"]','[role="contentinfo"]','[role="complementary"]',".nav",".navbar",".navigation",".menu",".footer",".header",".sidebar",".cookie",".cookies",".gdpr",".popup",".modal",".overlay",".ad",".ads",".advertisement",'[class*="cookie"]','[class*="nav-"]','[class*="menu-"]','[class*="footer"]','[class*="header"]','[class*="sidebar"]','[class*="social"]','[class*="share"]','[class*="related"]','[id*="cookie"]','[id*="nav"]','[id*="menu"]','[id*="footer"]','[id*="header"]'].forEach(y=>{try{o.querySelectorAll(y).forEach(w=>w.remove())}catch{}});const m=[{pattern:/linkedin\.com/i,selectors:[".show-more-less-html__markup",".description__text .show-more-less-html",".jobs-description__content",".jobs-box__html-content",'[class*="jobs-description"]']},{pattern:/greenhouse\.io|boards\.greenhouse/i,selectors:[".content","#content",".job-post",'[class*="job"]']},{pattern:/lever\.co/i,selectors:[".posting-page",".content",'[class*="posting"]']},{pattern:/workday\.com|myworkday/i,selectors:['[data-automation-id="jobPostingDescription"]',".job-description",'[class*="description"]']},{pattern:/indeed\.com/i,selectors:["#jobDescriptionText",".jobsearch-jobDescriptionText",'[class*="jobDescription"]']},{pattern:/glassdoor\.com/i,selectors:['[class*="JobDetails"]',".desc",".jobDescriptionContent"]},{pattern:/spglobal\.com|careers\./i,selectors:['[class*="job-description"]','[class*="jobDescription"]','[class*="description-content"]',".job-details-content",".posting-description",'[data-testid*="description"]',"article",".content-main",'[role="main"] > div']}];if(l.length<100){for(const{pattern:y,selectors:w}of m)if(y.test(t)||y.test(h)){for(const x of w)try{const S=o.querySelector(x);if(S){const _=u(S.textContent||"");if(_.length>100){l=_;break}}}catch{}if(l.length>100)break}}if(l.length<100){const y=['[class*="job-description"]','[class*="jobDescription"]','[class*="job_description"]','[class*="description-content"]','[class*="descriptionContent"]','[data-qa="job-description"]','[data-testid="job-description"]',".job-details",".posting-description",".job-content","article.job","section.job","article",'[role="main"]',"main"];for(const w of y)try{const x=o.querySelector(w);if(x){const S=u(x.textContent||"");if(S.length>100){l=S;break}}}catch{}}if(l.length<100){const y=[],w=o.querySelectorAll("div, section, article");for(const x of w){const S=u(x.textContent||"");if(S.length<200)continue;let _=0;const C=S.toLowerCase(),k=["responsibilities","requirements","qualifications","experience","skills","about the role","about you","what you","job description","we are looking","you will","you have","years of experience","bachelor","degree","salary"];for(const P of k)C.includes(P)&&(_+=10);const T=["sign in","log in","cookie","privacy policy","terms of"];for(const P of T)C.includes(P)&&(_-=20);_>0&&y.push({el:x,score:_,text:S})}y.sort((x,S)=>S.score-x.score),y.length>0&&y[0].score>20&&(l=y[0].text)}if(l=l.replace(/\n{3,}/g,`

`).trim(),l.length<50)throw new Error("Could not extract job description. Try pasting the job details manually.");return l.substring(0,6e3)}function Uy(h){const e=h.replace(/\s+/g," ").trim(),t=h.split(`
`).map(w=>w.trim()).filter(Boolean);let s="";const i=[[/\bGoogle\b/i,"Google"],[/\bMeta\b(?:\s+Platforms)?/i,"Meta"],[/\bAmazon\b/i,"Amazon"],[/\bMicrosoft\b/i,"Microsoft"],[/\bApple\b(?:\s+Inc)?/i,"Apple"],[/\bNetflix\b/i,"Netflix"],[/\bSalesforce\b/i,"Salesforce"],[/\bOracle\b/i,"Oracle"],[/\bIBM\b/i,"IBM"],[/\bCisco\b/i,"Cisco"],[/\bIntel\b/i,"Intel"],[/\bNVIDIA\b/i,"NVIDIA"],[/\bAMD\b/i,"AMD"],[/\bQualcomm\b/i,"Qualcomm"],[/\bAdobe\b/i,"Adobe"],[/\bVMware\b/i,"VMware"],[/\bSnowflake\b/i,"Snowflake"],[/\bDatadog\b/i,"Datadog"],[/\bStripe\b/i,"Stripe"],[/\bSquare\b|Block,?\s*Inc/i,"Block"],[/\bShopify\b/i,"Shopify"],[/\bUber\b/i,"Uber"],[/\bLyft\b/i,"Lyft"],[/\bAirbnb\b/i,"Airbnb"],[/\bDoorDash\b/i,"DoorDash"],[/\bInstacart\b/i,"Instacart"],[/\bTwitter\b|\bX\s+Corp/i,"X"],[/\bLinkedIn\b/i,"LinkedIn"],[/\bSpotify\b/i,"Spotify"],[/\bZoom\b/i,"Zoom"],[/\bSlack\b/i,"Slack"],[/\bAsana\b/i,"Asana"],[/\bNotion\b/i,"Notion"],[/\bFigma\b/i,"Figma"],[/\bCanva\b/i,"Canva"],[/\bPalantir\b/i,"Palantir"],[/\bOpenAI\b/i,"OpenAI"],[/\bAnthropic\b/i,"Anthropic"],[/Goldman\s*Sachs/i,"Goldman Sachs"],[/JP\s*Morgan|JPMorgan/i,"JPMorgan"],[/Morgan\s*Stanley/i,"Morgan Stanley"],[/Bank\s*of\s*America/i,"Bank of America"],[/\bCiti\b(?:bank|group)?/i,"Citi"],[/Wells\s*Fargo/i,"Wells Fargo"],[/\bBlackRock\b/i,"BlackRock"],[/\bFidelity\b/i,"Fidelity"],[/\bVanguard\b/i,"Vanguard"],[/\bCapital\s*One\b/i,"Capital One"],[/\bAmerican\s*Express\b|\bAmex\b/i,"American Express"],[/\bVisa\b/i,"Visa"],[/\bMastercard\b/i,"Mastercard"],[/\bPayPal\b/i,"PayPal"],[/\bRobinhood\b/i,"Robinhood"],[/\bCoinbase\b/i,"Coinbase"],[/\bMcKinsey\b/i,"McKinsey"],[/\bBCG\b|Boston\s*Consulting/i,"BCG"],[/\bBain\b(?:\s*&\s*Company)?/i,"Bain & Company"],[/\bDeloitte\b/i,"Deloitte"],[/\bPwC\b|PricewaterhouseCoopers/i,"PwC"],[/\bEY\b|Ernst\s*&?\s*Young/i,"EY"],[/\bKPMG\b/i,"KPMG"],[/\bAccenture\b/i,"Accenture"],[/\bBooz\s*Allen/i,"Booz Allen Hamilton"],[/Tokyo\s*Electron/i,"Tokyo Electron"],[/\bTEL\b(?:\s+(?:America|US|USA))?/i,"Tokyo Electron"],[/\bASML\b/i,"ASML"],[/\bLam\s*Research/i,"Lam Research"],[/Applied\s*Materials/i,"Applied Materials"],[/\bMicron\b/i,"Micron"],[/\bSamsung\b/i,"Samsung"],[/\bTSMC\b|Taiwan\s*Semiconductor/i,"TSMC"],[/\bBroadcom\b/i,"Broadcom"],[/\bTexas\s*Instruments\b|\bTI\b/i,"Texas Instruments"],[/\bAnalog\s*Devices\b/i,"Analog Devices"],[/\bPfizer\b/i,"Pfizer"],[/\bJohnson\s*&\s*Johnson\b|\bJ&J\b/i,"Johnson & Johnson"],[/\bMerck\b/i,"Merck"],[/\bAbbVie\b/i,"AbbVie"],[/\bBristol.?Myers/i,"Bristol-Myers Squibb"],[/\bNovartis\b/i,"Novartis"],[/\bRoche\b/i,"Roche"],[/\bGenentech\b/i,"Genentech"],[/\bGilead\b/i,"Gilead"],[/\bModerna\b/i,"Moderna"],[/\bAmgen\b/i,"Amgen"],[/United\s*Health/i,"UnitedHealth"],[/\bCVS\b/i,"CVS Health"],[/\bKaiser\b/i,"Kaiser Permanente"],[/\bWalmart\b/i,"Walmart"],[/\bTarget\b/i,"Target"],[/\bCostco\b/i,"Costco"],[/\bHome\s*Depot\b/i,"Home Depot"],[/\bLowe'?s\b/i,"Lowe's"],[/\bNike\b/i,"Nike"],[/\bStarbucks\b/i,"Starbucks"],[/\bMcDonald'?s\b/i,"McDonald's"],[/\bCoca.?Cola\b/i,"Coca-Cola"],[/\bPepsi\b(?:Co)?/i,"PepsiCo"],[/Procter\s*&?\s*Gamble|\bP&G\b/i,"Procter & Gamble"],[/\bUnilever\b/i,"Unilever"],[/\bNestl[eé]\b/i,"Nestlé"],[/S\s*&\s*P\s*Global/i,"S&P Global"],[/\bBloomberg\b/i,"Bloomberg"],[/\bReuters\b/i,"Reuters"],[/\bMoody'?s\b/i,"Moody's"],[/\bFitch\b/i,"Fitch Ratings"],[/\bBoeing\b/i,"Boeing"],[/\bLockheed\s*Martin\b/i,"Lockheed Martin"],[/\bNorthrop\s*Grumman\b/i,"Northrop Grumman"],[/\bRaytheon\b/i,"Raytheon"],[/\bGeneral\s*Dynamics\b/i,"General Dynamics"],[/\bSpaceX\b/i,"SpaceX"],[/\bBlue\s*Origin\b/i,"Blue Origin"],[/\bTesla\b/i,"Tesla"],[/\bFord\b/i,"Ford"],[/General\s*Motors|\bGM\b/i,"General Motors"],[/\bToyota\b/i,"Toyota"],[/\bHonda\b/i,"Honda"],[/\bBMW\b/i,"BMW"],[/\bMercedes/i,"Mercedes-Benz"],[/\bVolkswagen\b|\bVW\b/i,"Volkswagen"],[/\bRivian\b/i,"Rivian"],[/\bLucid\b/i,"Lucid Motors"],[/\bWaymo\b/i,"Waymo"],[/\bExxon\b/i,"ExxonMobil"],[/\bChevron\b/i,"Chevron"],[/\bShell\b/i,"Shell"],[/\bBP\b/i,"BP"],[/\bConocoPhillips\b/i,"ConocoPhillips"],[/\bNextEra\b/i,"NextEra Energy"]];for(const[w,x]of i)if(w.test(h)){s=x;break}if(!s){const w=[/([A-Z][A-Za-z0-9\s&\-]+),?\s*(?:Inc|LLC|Ltd|Corp|Corporation|Limited|Company|Co|LP|LLP|PLC|GmbH|AG|SA|NV|BV)\.?/i,/([A-Z][A-Za-z0-9&\s\-]{2,30})\s+(?:is\s+)?(?:seeking|hiring|looking\s+for|recruiting)/i,/(?:join|about)\s+([A-Z][A-Za-z0-9&\s\-]{2,30})(?:\s*[,.\n!]|\s+(?:is|are|we|and|as|in|to|,))/i];for(const x of w){const S=e.match(x);if(S&&S[1]){const _=S[1].trim(),C=["the","this","that","with","from","your","about","join","apply","position","role","job","we","our"];if(_.length>=3&&_.length<=50&&!C.includes(_.toLowerCase())){s=_;break}}}}let n="";const a=/\b(intern|engineer|developer|analyst|scientist|manager|director|specialist|coordinator|associate|consultant|designer|architect|lead|administrator|technician|representative|assistant|officer|executive|head|vp|vice\s*president|principal|staff)\b/i;if(t[0]&&a.test(t[0])&&t[0].length<100&&(n=t[0].replace(/\s*[\(\[][^\)\]]*[\)\]]/g,"").trim()),!n){const w=[/(?:job\s*title|position|role)\s*[:\-]\s*([^\n]{5,70})/i,/(?:^|\n)\s*([A-Za-z\s\-\/]+(?:Intern|Engineer|Developer|Analyst|Scientist|Manager|Director|Specialist)[^\n]{0,30})/i,/(?:seeking|hiring)\s+(?:a|an)\s+([A-Za-z\s\-\/]+(?:Intern|Engineer|Developer|Analyst|Scientist))/i];for(const x of w){const S=h.match(x);if(S&&S[1]){const _=S[1].trim();if(_.length>=5&&_.length<=80&&a.test(_)){n=_.replace(/\s*[\(\[][^\)\]]*[\)\]]/g,"").trim();break}}}}const o=[],l=[],c=[],d=["python","java","javascript","typescript","c++","c#","go","rust","swift","kotlin","react","angular","vue","node.js","django","flask","spring","express","sql","postgresql","mysql","mongodb","redis","elasticsearch","aws","azure","gcp","docker","kubernetes","terraform","machine learning","deep learning","data science","data analysis","tensorflow","pytorch","scikit-learn","pandas","numpy","git","ci/cd","agile","scrum","jira","excel","powerpoint","tableau","power bi","matlab","r","communication","leadership","teamwork","problem-solving","analytical"],u=h.toLowerCase();for(const w of d)u.includes(w)&&c.push(w);const f=h.match(/(?:^|\n)\s*[•\-\*]\s*([^\n]+)/g)||[];for(const w of f.slice(0,10)){const x=w.replace(/^[\s•\-\*]+/,"").trim();x.length>10&&x.length<200&&(/(?:experience|knowledge|ability|skill|proficien|familiar)/i.test(x)?o.push(x):/(?:will|responsible|develop|design|create|manage|support|work)/i.test(x)&&l.push(x))}const g=/\b(intern|internship|co-op|summer\s+\d{4})\b/i.test(h),m=/\b(remote|work\s+from\s+home|wfh|hybrid)\b/i.test(h);let y="mid";return g?y="intern":/\b(entry.?level|junior|new\s+grad|0-2\s+years?)\b/i.test(h)?y="entry":/\b(senior|sr\.?|5\+\s+years?|7\+\s+years?)\b/i.test(h)?y="senior":/\b(lead|principal|staff|architect)\b/i.test(h)?y="lead":/\b(director|vp|vice\s*president|head\s+of|c-level|chief)\b/i.test(h)&&(y="executive"),{companyName:s||"the company",jobTitle:n||"this position",requirements:o,responsibilities:l,skills:c.slice(0,15),isInternship:g,isRemote:m,seniority:y}}function Gy(h,e){const t=e.skills.map(o=>o.toLowerCase()),s=h.skills.map(o=>o.toLowerCase()),i=t.filter(o=>s.some(l=>o.includes(l)||l.includes(o))),n=[];for(const o of e.workExperience.slice(0,3)){const l=o.description.split(`
`).filter(c=>c.trim().length>10);n.push({title:o.title,company:o.company,bullets:l})}const a=[];for(const o of e.workExperience){const l=o.description.split(`
`);for(const c of l)if(/\d+%|\$[\d,]+|\d+x|\d+\s*(percent|million|thousand|users|customers)/i.test(c)){const d=c.replace(/^[\s•\-\*]+/,"").trim();d.length>15&&d.length<200&&a.push(d)}}return{job:h,resume:e,matchedSkills:i.slice(0,8),matchedExperiences:n,achievements:a.slice(0,5)}}const Wy={interest:["I am applying for","I am writing regarding","I am interested in","I would like to apply for","I am submitting my application for"]},Vy=["My experience includes","I have worked extensively with","My background includes","I have developed proficiency in","I bring experience in"],qy=["In my previous role,","At my current position,","During my time at","A notable accomplishment:","One achievement I am proud of:"],Af=["Thank you for considering my application. I look forward to discussing this opportunity.","I appreciate your time and would welcome the chance to discuss how I can contribute.","Thank you for your consideration. I am available for an interview at your convenience."];function jo(h){return h[Math.floor(Math.random()*h.length)]}function Ag(h,e=4){const t=h.slice(0,e);return t.length===0?"":t.length===1?t[0]:t.length===2?`${t[0]} and ${t[1]}`:t.slice(0,-1).join(", ")+", and "+t[t.length-1]}function rs(h){return h.replace(/[•·▪▸►◦‣⁃]/g,"").replace(/\b(\w+)\s+ed\b/g,"$1ed").replace(/\b(\w+)\s+ing\b/g,"$1ing").replace(/\s{2,}/g," ").replace(/\s+([.,;:!?])/g,"$1").trim()}function Xy(h,e){const{job:t,matchedSkills:s,resume:i}=h;let a=`${jo(Wy.interest)} the ${t.jobTitle} position at ${t.companyName}.`;if(s.length>0){const l=Ag(s,e==="short"?2:e==="long"?5:3);a+=` My background in ${l} aligns with what you are looking for.`}if(e!=="short"&&(t.seniority==="intern"?a+=" I am eager to apply my academic knowledge in a professional setting.":(t.seniority==="senior"||t.seniority==="lead")&&(a+=" With several years of industry experience, I am ready to contribute at a high level.")),e==="long"&&i.education.length>0){const o=i.education[0];o.degree&&o.school&&(a+=` I hold a ${rs(o.degree)} from ${rs(o.school)}, which has prepared me well for this opportunity.`)}return a}function Yy(h,e){const t=[],{matchedExperiences:s,achievements:i,matchedSkills:n,job:a,resume:o}=h,l=e==="short"?1:e==="long"?3:2,c=e==="short"?1:e==="long"?4:2,d=e==="short"?1:e==="long"?3:2,u=s.slice(0,l);for(let f=0;f<u.length;f++){const g=u[f];let m="";f===0?m=`In my role as ${rs(g.title)} at ${rs(g.company)}, I developed skills directly relevant to this position.`:m=`Previously, as ${rs(g.title)} at ${rs(g.company)}, I further honed my abilities.`;const y=g.bullets.slice(0,d);for(const w of y){const x=rs(w);if(x.length>20&&x.length<150){let S=x;S.match(/^[A-Z]/)||(S=S.charAt(0).toUpperCase()+S.slice(1)),S.endsWith(".")||(S+="."),m+=` ${S}`}}t.push(m)}if(i.length>0&&(e!=="short"||t.length===0)){const f=i.slice(0,c);let m=jo(qy);for(let y=0;y<f.length;y++){let w=rs(f[y]);w.match(/^[A-Z]/)||(w=w.charAt(0).toUpperCase()+w.slice(1)),w.endsWith(".")||(w+="."),y===0?m+=` ${w}`:y===1?m+=` Additionally, I ${w.charAt(0).toLowerCase()+w.slice(1)}`:m+=` ${w}`}t.push(m)}if(n.length>0&&(e!=="short"||t.length<2)){const f=jo(Vy),m=Ag(n,e==="short"?3:e==="long"?6:5);let y=`${f} ${m}.`;e!=="short"&&(a.seniority==="intern"||a.seniority==="entry"?y+=" I am committed to learning and growing in this role.":y+=" I am committed to delivering quality results for your team."),t.push(y)}if(e!=="short"&&a.companyName!=="the company"){let f=`I am drawn to ${a.companyName} because of the opportunity to work on impactful projects and contribute to a team focused on excellence.`;e==="long"&&(f+=` The mission and culture at ${a.companyName} resonate with my professional values, and I am excited about the possibility of making meaningful contributions.`),t.push(f)}if(e==="long"){if(o.leadershipExperience&&o.leadershipExperience.length>0){const f=o.leadershipExperience[0];f.role&&f.organization&&t.push(`Beyond my professional experience, I have demonstrated leadership as ${rs(f.role)} at ${rs(f.organization)}, where I developed collaboration and communication skills that translate directly to the workplace.`)}else if(o.education.length>0&&o.education[0].description){const f=o.education[0],g=rs(f.description);g.length>20&&t.push(`My academic background includes ${g}, which has given me a strong foundation for this role.`)}}return t.join(`

`)}function Ky(h){return h==="short"?"Thank you for your consideration.":h==="long"?`${jo(Af)} I am confident that my background and enthusiasm make me a strong candidate, and I am excited about the possibility of joining your team.`:jo(Af)}async function Zy(h,e,t="medium"){const s=Uy(h),i=Gy(s,e),n=Xy(i,t),a=Yy(i,t),o=Ky(t),{firstName:l,lastName:c,email:d,phone:u}=e.personalInfo;return{letter:`${new Date().toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}

Hiring Manager
${s.companyName}

Dear Hiring Manager,

${n}

${a}

${o}

Sincerely,
${l} ${c}
${u} | ${d}`,parsedJob:s}}const Jy=()=>{const[h,e]=V.useState([]),[t,s]=V.useState(null),[i,n]=V.useState(!1),[a,o]=V.useState(!1),[l,c]=V.useState({}),[d,u]=V.useState(!1),[f,g]=V.useState(!1),[m,y]=V.useState(!1),[w,x]=V.useState(!1),[S,_]=V.useState(new Set),C=V.useRef(null),[k,T]=V.useState("profile"),[P,D]=V.useState(null),[O,K]=V.useState(""),[B,lt]=V.useState(""),[gt,it]=V.useState(""),[xt,R]=V.useState(""),[H,te]=V.useState(!1),[Te,Ve]=V.useState(!1),[he,Nt]=V.useState(!1),[Ct,mt]=V.useState(""),[Pi,Mt]=V.useState(!1),[dt,_s]=V.useState("text"),so=V.useRef(null),gc=V.useRef(null),[io,mn]=V.useState(null),[Pe,mc]=V.useState([]),[Du,bc]=V.useState(""),[Bh,Nu]=V.useState("profiles"),[yc,Nr]=V.useState(!1),[Ac,Fr]=V.useState(""),[bn,Fu]=V.useState(!1),[Es,no]=V.useState(new Set),[ju,vc]=V.useState({}),[Hh,vg]=V.useState(null),[ro,wg]=V.useState("medium");V.useEffect(()=>{Sg()},[]);const xg=async()=>{const E=await ue.getCoverLetters();mc(E)};V.useEffect(()=>{mn(t?t.id:null)},[t]);const Sg=async()=>{const E=await ue.getProfiles(),L=await ue.getActiveProfileId();e(E),s(L?E.find(z=>z.id===L)||E[0]||null:E[0]||null),await xg()},Ou=async(E,L)=>{const z={id:crypto.randomUUID(),name:L,description:"Imported resume",resume:E,createdAt:Date.now(),updatedAt:Date.now()},J=[...h,z];return await ue.saveProfiles(J),e(J),z},Uh=async E=>{if(E){n(!0);try{const L=await ff(E),z=await Ou(L,E.name.replace(/\.[^/.]+$/,""));await ue.setActiveProfileId(z.id),s(z)}catch(L){alert("Failed to parse: "+L.message)}finally{n(!1),o(!1)}}},_g=async()=>{const E={id:crypto.randomUUID(),name:`New Profile ${h.length+1}`,description:"",resume:{personalInfo:{firstName:"",lastName:"",email:"",phone:"",linkedin:"",website:"",github:"",address:""},workExperience:[],education:[],leadershipExperience:[],awards:[],publications:[],grants:[],teachingExperience:[],conferences:[],skills:[]},createdAt:Date.now(),updatedAt:Date.now()},L=[...h,E];await ue.saveProfiles(L),await ue.setActiveProfileId(E.id),e(L),s(E),y(!0)},Eg=V.useCallback(E=>{E.preventDefault(),o(!1);const L=E.dataTransfer.files[0];L&&Uh(L)},[h]),Cg=()=>{var E;return(E=C.current)==null?void 0:E.click()},kg=async(E,L)=>{if(L.stopPropagation(),!confirm("Delete this profile?"))return;const z=h.filter(J=>J.id!==E);await ue.saveProfiles(z),e(z),(t==null?void 0:t.id)===E&&s(z[0]||null)},zu=(E,L)=>{L.stopPropagation(),_(z=>{const J=new Set(z);return J.has(E)?J.delete(E):J.add(E),J})},Tg=()=>{S.size===h.length?_(new Set):_(new Set(h.map(E=>E.id)))},Pg=async()=>{if(S.size===0||!confirm(`Delete ${S.size} profile(s)?`))return;const E=h.filter(L=>!S.has(L.id));await ue.saveProfiles(E),e(E),_(new Set),x(!1),t&&S.has(t.id)&&s(E[0]||null)},Lg=async()=>{if(S.size===0)return;const L=h.filter(J=>S.has(J.id)).map(J=>({...J,id:crypto.randomUUID(),name:`${J.name} (Copy)`,createdAt:Date.now(),updatedAt:Date.now()})),z=[...h,...L];await ue.saveProfiles(z),e(z),_(new Set),x(!1)},Mg=async E=>{d&&!confirm("Discard unsaved changes?")||(s(E),u(!1),await ue.setActiveProfileId(E.id))},Rg=(E,L)=>{E&&(navigator.clipboard.writeText(E),c({...l,[L]:!0}),setTimeout(()=>c(z=>({...z,[L]:!1})),1500))},Gh=E=>{t&&(s({...t,...E}),u(!0))},Ig=E=>{t!=null&&t.resume&&Gh({resume:{...t.resume,...E}})},Dg=()=>{var E;(E=gc.current)==null||E.scrollIntoView({behavior:"smooth",block:"start"})},Ng=async E=>{if(E){Nt(!0),mt("");try{const L=await ff(E);D(L),K(E.name.replace(/\.[^/.]+$/,"")),T("upload");const z=await Ou(L,`${E.name.replace(/\.[^/.]+$/,"")} (Cover Letter)`);mn(z.id)}catch(L){mt("Failed to parse resume: "+L.message)}finally{Nt(!1)}}},Fg=E=>{var L;Ng((L=E.target.files)==null?void 0:L[0]),E.target.value=""},jg=async()=>{if(!gt.trim()){mt("Please enter a valid URL");return}mt(""),Ve(!0);try{const E=await Hy(gt.trim());lt(E),_s("text"),R("")}catch(E){mt(E.message||"Failed to fetch job description")}finally{Ve(!1)}},ao=()=>yc?Ac:xt,Og=()=>{lt(""),it(""),R(""),D(null),K(""),T("profile"),mt(""),Mt(!1),Nr(!1),Fr(""),bc(""),t&&mn(t.id)},zg=()=>{xt&&(Fr(ao()),Nr(!0))},$g=()=>{R(Ac),Nr(!1),Mt(!1)},Bg=async()=>{const E=ao().trim();if(!E){mt("Generate a letter before saving it.");return}const{companyName:L,jobTitle:z}=Yg(B),J=io,Wh=Du.trim()||`${(jr==null?void 0:jr.name)||"Cover Letter"} • ${L}`,yn=[{id:crypto.randomUUID(),title:Wh,content:E,jobDescription:B,jobTitle:z,companyName:L,profileId:J,createdAt:Date.now(),updatedAt:Date.now()},...Pe];await ue.saveCoverLetters(yn),mc(yn),bc("")},Hg=E=>{lt(E.jobDescription),R(E.content),Fr(E.content),Nr(!1),bc(E.title),T("profile"),mt(""),E.profileId&&mn(E.profileId)},Ug=(E,L)=>{no(z=>{const J=new Set(z);return J.has(E)?J.delete(E):J.add(E),J})},Gg=()=>{Es.size===Pe.length?no(new Set):no(new Set(Pe.map(E=>E.id)))},Wg=async()=>{if(Es.size===0||!confirm(`Delete ${Es.size} cover letter(s)?`))return;const E=Pe.filter(L=>!Es.has(L.id));await ue.saveCoverLetters(E),mc(E),no(new Set),Fu(!1)},Vg=async()=>{if(Es.size===0)return;const E=Pe.filter(z=>Es.has(z.id)),L=E.map(z=>`--- ${z.title} ---

${z.content}`).join(`


`);await navigator.clipboard.writeText(L),E.forEach(z=>vc(J=>({...J,[z.id]:!0}))),setTimeout(()=>vc({}),2e3)},qg=async(E,L)=>{L&&L.stopPropagation(),await navigator.clipboard.writeText(E.content),vc(z=>({...z,[E.id]:!0})),setTimeout(()=>vc(z=>({...z,[E.id]:!1})),2e3)},Xg=async(E,L)=>{if(L&&L.stopPropagation(),!confirm("Delete this cover letter?"))return;const z=Pe.filter(J=>J.id!==E);await ue.saveCoverLetters(z),mc(z)},Yg=E=>{let L="",z="";const J=[/(?:^|\n)\s*(?:job\s*title|role|position)\s*[:\-]\s*([^\n]{5,60})/i,/(?:^|\n)\s*(?:the\s+role)\s*[:\-]?\s*([^\n]{5,60})/i,/looking\s+for\s+(?:a|an)\s+([^\n\.]{5,50})/i,/seeking\s+(?:a|an)?\s*([^\n\.]{5,50}?)\s+(?:to|for|who)/i,/hiring\s+(?:a|an)?\s*([^\n\.]{5,50})/i],Wh=[/(?:^|\n)\s*(?:company|employer)\s*[:\-]\s*([^\n]{3,40})/i,/(?:at|join)\s+([A-Z][A-Za-z0-9&\s]{2,30}?)(?:\s+(?:is|are|we|as|in|,|\.))/i,/([A-Z][A-Za-z0-9&]{2,20}(?:\s+[A-Z][A-Za-z0-9&]+){0,3})\s+is\s+(?:seeking|looking|hiring)/i,/About\s+([A-Z][A-Za-z0-9&\s]{3,30}?)(?:\n|$)/i];for(const Or of J){const An=E.match(Or);if(An&&An[1]){const vn=An[1].trim();if(vn.length<60&&/(?:intern|analyst|engineer|manager|developer|designer|scientist|specialist|coordinator|director|associate|consultant|lead)/i.test(vn)){z=vn.replace(/[\(\[].*$/,"").trim();break}}}for(const Or of Wh){const An=E.match(Or);if(An&&An[1]){const vn=An[1].trim();if(vn.length>=2&&vn.length<40){L=vn;break}}}const yn=E.split(`
`).slice(0,5).join(" ").match(/([A-Za-z\s]{5,40})\s+at\s+([A-Z][A-Za-z0-9&\s]{2,30})/i);yn&&(!z&&/(?:intern|analyst|engineer|manager|developer)/i.test(yn[1])&&(z=yn[1].trim()),L||(L=yn[2].trim()));const tm=["S&P Global","Google","Microsoft","Amazon","Meta","Apple","Netflix","Goldman Sachs","JP Morgan","McKinsey"];for(const Or of tm)if(E.includes(Or)){L=Or;break}return{companyName:L||"the company",jobTitle:z||"this position"}},$u=async(E=!1)=>{if(!B.trim()){mt("Please provide the job description");return}let L=null;if(k==="upload")L=P;else{const z=h.find(J=>J.id===io)||t;L=(z==null?void 0:z.resume)||null}if(!L){mt("Upload a resume or select a profile to continue");return}mt(""),te(!0),E&&(R(""),Fr(""),Nr(!1));try{const{letter:z,parsedJob:J}=await Zy(B,L,ro);vg({company:J.companyName,title:J.jobTitle}),R(z),Mt(!1),Fr(z),Nr(!1)}catch(z){mt(z.message||"Failed to generate cover letter")}finally{te(!1)}},Kg=()=>{const E=ao().trim();E&&(navigator.clipboard.writeText(E),Mt(!0),setTimeout(()=>Mt(!1),2e3))},Zg=()=>{const E=ao().trim();if(!E)return;const L=document.createElement("a"),z=new Blob([E],{type:"text/plain"});L.href=URL.createObjectURL(z),L.download=`cover-letter-${Date.now()}.txt`,document.body.appendChild(L),L.click(),document.body.removeChild(L)},Bu=async()=>{t&&(g(!0),await ue.updateProfile(t),e(h.map(E=>E.id===t.id?t:E)),u(!1),g(!1))},jr=h.find(E=>E.id===io)||t,Jg=!!ao().trim();return b.jsxs("div",{className:"flex",style:{minHeight:"100vh"},children:[b.jsxs("aside",{className:"sidebar",children:[b.jsx("div",{className:"sidebar-header",children:b.jsxs("div",{className:"flex items-center gap-md",children:[b.jsx("div",{style:{width:40,height:40,background:"var(--accent)",borderRadius:12,display:"flex",alignItems:"center",justifyContent:"center"},children:b.jsx(Uu,{size:20,color:"white"})}),b.jsxs("div",{children:[b.jsx("div",{style:{fontSize:16,fontWeight:700},children:"Applyly™"}),b.jsx("div",{style:{fontSize:11,color:"var(--text-muted)"},children:"Resume Manager"})]})]})}),b.jsxs("div",{className:"sidebar-content",children:[b.jsxs("div",{className:"sidebar-tab-bar",children:[b.jsx("button",{className:Bh==="profiles"?"active":"",onClick:()=>Nu("profiles"),children:"Resume Profiles"}),b.jsx("button",{className:Bh==="coverLetters"?"active":"",onClick:()=>Nu("coverLetters"),children:"Saved Letters"})]}),Bh==="profiles"?b.jsxs(b.Fragment,{children:[b.jsxs("div",{className:"sidebar-label",style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:16},children:[b.jsx("span",{style:{fontSize:11,letterSpacing:"0.05em",fontWeight:600,color:"var(--text-muted)"},children:"YOUR PROFILES"}),h.length>0&&b.jsx("button",{onClick:()=>{x(!w),_(new Set)},style:{padding:"5px 12px",fontSize:12,background:w?"var(--accent)":"var(--bg-app)",color:w?"white":"var(--text-main)",border:w?"none":"1px solid var(--border)",borderRadius:8,cursor:"pointer",fontWeight:600,transition:"all 0.2s cubic-bezier(0.4, 0, 0.2, 1)",boxShadow:w?"0 2px 8px rgba(255, 122, 69, 0.3)":"none"},children:w?"Done":"Select"})]}),w&&h.length>0&&b.jsxs("div",{style:{display:"flex",gap:8,padding:"12px",marginBottom:20,background:"var(--bg-app)",borderRadius:12,border:"1px solid var(--border)",boxShadow:"0 4px 12px rgba(0,0,0,0.03)"},children:[b.jsx("button",{onClick:Tg,style:{flex:"1.2",padding:"8px 4px",fontSize:11,background:"white",border:"1px solid var(--border)",borderRadius:6,cursor:"pointer",color:"var(--text-main)",fontWeight:500},children:S.size===h.length?"Deselect":"Select All"}),b.jsxs("button",{onClick:Lg,disabled:S.size===0,style:{flex:1,padding:"8px 4px",fontSize:11,background:"white",border:"1px solid var(--border)",borderRadius:6,cursor:S.size>0?"pointer":"not-allowed",color:S.size>0?"var(--accent)":"var(--text-muted)",fontWeight:600,display:"flex",alignItems:"center",justifyContent:"center",gap:4,opacity:S.size>0?1:.6},children:[b.jsx(Cc,{size:13}),"Copy ",S.size>0&&`(${S.size})`]}),b.jsxs("button",{onClick:Pg,disabled:S.size===0,style:{flex:1,padding:"8px 4px",fontSize:11,background:S.size>0?"#fff5f5":"white",border:`1px solid ${S.size>0?"#febcbc":"var(--border)"}`,borderRadius:6,cursor:S.size>0?"pointer":"not-allowed",color:S.size>0?"#e03131":"var(--text-muted)",fontWeight:600,display:"flex",alignItems:"center",justifyContent:"center",gap:4,opacity:S.size>0?1:.6},children:[b.jsx(uo,{size:13}),"Delete"]})]}),h.length===0?b.jsxs("div",{className:"sidebar-empty",style:{padding:"40px 20px"},children:[b.jsx("div",{style:{opacity:.5,marginBottom:12},children:b.jsx(Uu,{size:32})}),b.jsx("p",{style:{fontSize:13,color:"var(--text-muted)"},children:"Get started by uploading a PDF"})]}):b.jsx("div",{style:{display:"flex",flexDirection:"column",gap:4},children:h.map(E=>b.jsxs("div",{onClick:()=>w?null:Mg(E),className:`sidebar-item ${(t==null?void 0:t.id)===E.id&&!w?"active":""}`,style:{background:S.has(E.id)?"var(--accent-secondary)":void 0,cursor:w?"default":"pointer",transition:"all 0.2s ease",borderRadius:10,padding:"10px 12px",border:S.has(E.id)?"1px solid var(--accent-light)":"1px solid transparent"},children:[w?b.jsx("div",{onClick:L=>zu(E.id,L),style:{width:18,height:18,borderRadius:4,border:S.has(E.id)?"none":"2px solid var(--border)",background:S.has(E.id)?"var(--accent)":"white",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",transition:"all 0.15s ease",flexShrink:0,marginRight:12},children:S.has(E.id)&&b.jsx(Mi,{size:12,color:"white",strokeWidth:3})}):b.jsx("div",{className:"sidebar-item-icon",style:{background:(t==null?void 0:t.id)===E.id?"var(--accent)":"var(--bg-app)",color:(t==null?void 0:t.id)===E.id?"white":"var(--text-muted)"},children:b.jsx(nh,{size:14})}),b.jsxs("div",{className:"sidebar-item-content",onClick:w?L=>zu(E.id,L):void 0,children:[b.jsx("div",{className:"sidebar-item-name",style:{fontWeight:(t==null?void 0:t.id)===E.id||S.has(E.id)?600:500,color:S.has(E.id)?"var(--accent)":"var(--text-main)"},children:E.name}),E.description&&b.jsx("div",{className:"sidebar-item-desc",style:{fontSize:11},children:E.description})]}),!w&&b.jsx("button",{onClick:L=>kg(E.id,L),className:"btn-ghost item-delete",style:{padding:4,opacity:0},children:b.jsx(uo,{size:14})})]},E.id))}),b.jsxs("div",{className:"sidebar-actions",style:{display:"flex",flexDirection:"column",gap:10,marginTop:20},children:[b.jsxs("label",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:8,padding:"12px 16px",background:"var(--accent)",color:"white",borderRadius:10,fontWeight:600,fontSize:13,cursor:"pointer",boxShadow:"var(--shadow-accent)",transition:"all 0.15s ease",border:"none"},children:[b.jsx(wc,{size:16}),i?"Parsing...":"Upload Resume PDF",b.jsx("input",{type:"file",hidden:!0,accept:".pdf",onChange:E=>{var L;return((L=E.target.files)==null?void 0:L[0])&&Uh(E.target.files[0])},disabled:i})]}),b.jsxs("button",{onClick:_g,style:{width:"100%",padding:"10px 16px",background:"var(--bg-app)",border:"1px solid var(--border)",borderRadius:10,fontWeight:500,fontSize:13,display:"flex",alignItems:"center",justifyContent:"center",gap:8,color:"var(--text-secondary)",transition:"all 0.15s ease"},children:[b.jsx(ws,{size:16}),"New Blank Profile"]})]})]}):b.jsxs("div",{className:"saved-letters-container",children:[Pe.length>0&&b.jsxs("div",{className:"saved-letters-toolbar",children:[b.jsx("button",{onClick:()=>{Fu(!bn),no(new Set)},className:`toolbar-btn ${bn?"active":""}`,children:bn?"Done":"Select"}),bn&&b.jsxs(b.Fragment,{children:[b.jsx("button",{onClick:Gg,className:"toolbar-btn",children:Es.size===Pe.length?"Deselect":"All"}),b.jsxs("button",{onClick:Vg,disabled:Es.size===0,className:"toolbar-btn",children:[b.jsx(Cc,{size:12})," Copy"]}),b.jsxs("button",{onClick:Wg,disabled:Es.size===0,className:"toolbar-btn danger",children:[b.jsx(uo,{size:12})," Delete"]})]})]}),b.jsx("div",{className:"saved-letters-list",children:Pe.length===0?b.jsxs("div",{className:"sidebar-empty",children:[b.jsx("div",{className:"empty-icon",children:b.jsx(kc,{size:28})}),b.jsx("p",{className:"empty-title",children:"No saved letters"}),b.jsx("p",{className:"empty-desc",children:"Generate one from the lab to get started."})]}):Pe.map(E=>{const L=E.profileId?h.find(J=>J.id===E.profileId):null,z=Es.has(E.id);return b.jsxs("div",{className:`saved-letter-card ${z?"selected":""}`,onClick:bn?()=>Ug(E.id):void 0,children:[bn&&b.jsx("div",{className:`letter-checkbox ${z?"checked":""}`,children:z&&b.jsx(Mi,{size:10,strokeWidth:3})}),b.jsxs("div",{className:"letter-content",children:[b.jsx("div",{className:"letter-title",children:E.title}),b.jsxs("div",{className:"letter-meta",children:[b.jsx("span",{className:"letter-company",children:E.companyName}),b.jsx("span",{className:"letter-dot",children:"•"}),b.jsx("span",{className:"letter-date",children:new Date(E.createdAt).toLocaleDateString()})]}),L&&b.jsx("div",{className:"letter-profile",children:L.name})]}),!bn&&b.jsxs("div",{className:"letter-actions",children:[b.jsx("button",{onClick:J=>qg(E,J),className:ju[E.id]?"copied":"",title:"Copy",children:ju[E.id]?b.jsx(Mi,{size:14}):b.jsx(Cc,{size:14})}),b.jsx("button",{onClick:()=>Hg(E),title:"Open",children:"Open"}),b.jsx("button",{onClick:J=>Xg(E.id,J),className:"danger",title:"Delete",children:b.jsx(uo,{size:14})})]})]},E.id)})}),Pe.length>0&&b.jsx("div",{className:"saved-letters-footer",children:b.jsxs("span",{className:"letter-count",children:[Pe.length," letter",Pe.length!==1?"s":""]})})]})]}),b.jsxs("div",{className:"sidebar-cover-letter-section",children:[b.jsxs("div",{className:"cover-letter-lab-header",children:[b.jsx("div",{className:"cover-letter-lab-icon",children:b.jsx(ym,{size:18})}),b.jsxs("div",{children:[b.jsx("div",{className:"cover-letter-lab-title",children:"Cover Letter Lab"}),b.jsx("p",{className:"cover-letter-lab-desc",children:"Build tailored letters without leaving your workspace."})]})]}),b.jsxs("button",{onClick:Dg,style:{width:"100%",padding:"12px 14px",borderRadius:10,border:"none",background:"linear-gradient(135deg, #ff944d 0%, #ffc168 100%)",color:"white",fontWeight:600,display:"flex",justifyContent:"center",alignItems:"center",gap:8,boxShadow:"0 12px 32px rgba(255, 157, 49, 0.35)"},children:[b.jsx(kc,{size:16}),"Open Cover Letter Lab"]})]})]}),b.jsxs("main",{style:{flex:1,padding:32,maxWidth:900,overflow:"auto",position:"relative"},children:[t?b.jsxs("div",{className:"profile-section",children:[b.jsxs("div",{className:"profile-sticky-row",children:[b.jsx("div",{className:"profile-sticky-info",children:m?b.jsxs("div",{className:"flex flex-col gap-sm",style:{maxWidth:350},children:[b.jsx("input",{value:t.name,onChange:E=>Gh({name:E.target.value}),style:{fontSize:20,fontWeight:700},placeholder:"Profile Name"}),b.jsx("input",{value:t.description,onChange:E=>Gh({description:E.target.value}),placeholder:"Brief description..."}),b.jsxs("button",{onClick:()=>y(!1),className:"btn-small",style:{alignSelf:"flex-start"},children:[b.jsx(Mi,{size:14})," Done"]})]}):b.jsxs("div",{children:[b.jsxs("div",{className:"flex items-center gap-md",style:{marginBottom:4},children:[b.jsx("h1",{style:{fontSize:24},children:t.name}),b.jsx("span",{className:"badge badge-accent",children:"Active"}),b.jsx("button",{onClick:()=>y(!0),className:"btn-ghost",children:b.jsx(gm,{size:14})})]}),t.description&&b.jsx("p",{style:{color:"var(--text-secondary)",margin:0},children:t.description}),b.jsxs("p",{style:{color:"var(--text-muted)",fontSize:11,marginTop:4},children:["Updated ",new Date(t.updatedAt).toLocaleDateString()]}),d&&b.jsx("span",{className:"unsaved-pill",children:"Unsaved changes"})]})}),b.jsxs("div",{className:"profile-sticky-actions",children:[d&&b.jsx("button",{onClick:()=>u(!1),className:"btn-ghost",style:{marginRight:8,padding:"8px 14px"},children:"Discard"}),b.jsxs("button",{onClick:Bu,disabled:!d||f,className:"btn-primary",style:{display:"flex",alignItems:"center",gap:6,padding:"8px 16px"},children:[b.jsx(Mi,{size:14})," ",f?"Saving...":"Save Changes"]})]})]}),t.resume&&b.jsx("div",{className:"profile-content",children:b.jsx(Qy,{resume:t.resume,onUpdate:Ig,onCopy:Rg,copyStatus:l})}),d&&b.jsxs("div",{className:"floating-save-bar",children:[b.jsx("span",{className:"floating-save-text",children:"You have unsaved changes"}),b.jsxs("div",{className:"floating-save-actions",children:[b.jsxs("button",{onClick:()=>u(!1),className:"discard-btn",children:[b.jsx(mu,{size:14})," Discard"]}),b.jsxs("button",{onClick:Bu,disabled:f,className:"save-btn",children:[b.jsx(Mi,{size:14})," ",f?"Saving...":"Save Changes"]})]})]})]}):b.jsxs("div",{className:`upload-zone ${a?"dragging":""}`,onDragOver:E=>{E.preventDefault(),o(!0)},onDragLeave:()=>o(!1),onDrop:Eg,onClick:Cg,style:{maxWidth:500,margin:"60px auto"},children:[b.jsx("input",{ref:C,type:"file",hidden:!0,accept:".pdf,.docx",onChange:E=>{var L;return((L=E.target.files)==null?void 0:L[0])&&Uh(E.target.files[0])}}),b.jsx("div",{style:{width:64,height:64,background:"white",borderRadius:16,boxShadow:"var(--shadow-md)",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 20px"},children:b.jsx(wc,{size:28,color:"var(--accent)"})}),b.jsx("h2",{style:{fontSize:18,marginBottom:8},children:"Upload Your Resume"}),b.jsx("p",{style:{color:"var(--text-secondary)",maxWidth:280,margin:"0 auto 20px"},children:"Drag & drop a PDF or DOCX, or click anywhere to browse"}),b.jsx("span",{className:"badge",children:"PDF or DOCX"})]}),b.jsxs("div",{id:"cover-letter-panel",ref:gc,className:"cover-letter-panel",children:[b.jsxs("div",{className:"cover-letter-panel-heading",children:[b.jsxs("div",{children:[b.jsx("p",{className:"cover-letter-panel-subtitle",children:"Cover Letter Lab"}),b.jsx("h2",{children:"Write letters that feel human"}),b.jsx("p",{className:"cover-letter-panel-description",children:"Pick a resume, paste the job posting, or fetch it from any URL. Applyly handles the rest."})]}),b.jsxs("div",{className:"cover-letter-panel-meta",children:[b.jsx("span",{className:"meta-label",children:"Resume source"}),b.jsx("strong",{className:"meta-value",children:k==="upload"?O||"Uploaded resume":(jr==null?void 0:jr.name)||"Select a profile"}),k==="upload"&&!O&&b.jsx("span",{className:"meta-note",children:"Upload a PDF to enable this source."})]})]}),Hh&&xt&&b.jsxs("div",{className:"detected-job-info",children:[b.jsxs("div",{className:"detected-item",children:[b.jsx("span",{className:"detected-label",children:"Detected Company:"}),b.jsx("span",{className:"detected-value",children:Hh.company})]}),b.jsxs("div",{className:"detected-item",children:[b.jsx("span",{className:"detected-label",children:"Detected Position:"}),b.jsx("span",{className:"detected-value",children:Hh.title})]})]}),b.jsxs("div",{className:"cover-letter-source-toggle",children:[b.jsx("button",{onClick:()=>{T("profile"),mt(""),!io&&t&&mn(t.id)},disabled:!(t!=null&&t.resume),className:k==="profile"?"active":"",children:"Use Dashboard Profile"}),b.jsxs("button",{onClick:()=>{var E;mt(""),(E=so.current)==null||E.click()},className:k==="upload"?"active":"",disabled:he,children:[b.jsx(wc,{size:14}),he?"Parsing resume":"Upload Resume PDF"]})]}),b.jsx("input",{type:"file",ref:so,hidden:!0,accept:".pdf",onChange:Fg}),b.jsxs("div",{className:"cover-letter-profile-select",children:[b.jsx("label",{children:"Choose resume profile"}),b.jsxs("select",{value:io??"",onChange:E=>{mn(E.target.value||null),mt("")},disabled:k==="upload"||h.length===0,children:[b.jsx("option",{value:"",disabled:!0,children:"Select a profile"}),h.map(E=>b.jsxs("option",{value:E.id,children:[E.name,E.id===(t==null?void 0:t.id)?" (Active)":""]},E.id))]}),b.jsx("p",{className:"cover-letter-select-note",children:k==="upload"?"Switch to Dashboard Profile to select a saved resume.":"Selecting a profile lets you reuse any saved resume for every letter."})]}),b.jsxs("div",{className:"cover-letter-input-toggle",children:[b.jsx("button",{onClick:()=>{_s("text"),mt("")},className:dt==="text"?"active":"",children:"Paste Job Details"}),b.jsx("button",{onClick:()=>{_s("url"),mt("")},className:dt==="url"?"active":"",children:"From Link"})]}),dt==="url"&&b.jsxs("div",{className:"cover-letter-url",children:[b.jsx("label",{children:"Job Posting URL"}),b.jsxs("div",{className:"cover-letter-url-field",children:[b.jsx("input",{type:"url",value:gt,onChange:E=>{it(E.target.value),mt("")},placeholder:"https://example.com/job-posting"}),b.jsx("button",{onClick:jg,disabled:Te||!gt.trim(),children:Te?b.jsxs(b.Fragment,{children:[b.jsx(Wu,{size:14}),"Fetching"]}):b.jsxs(b.Fragment,{children:[b.jsx(wc,{size:14}),"Fetch"]})})]})]}),b.jsxs("div",{className:"cover-letter-description",children:[b.jsx("label",{children:"Job Description"}),b.jsx("textarea",{value:B,onChange:E=>{lt(E.target.value),R(""),mt("")},placeholder:"Paste the full job description here, including company details and role requirements."})]}),Ct&&b.jsx("div",{className:"cover-letter-error",children:Ct}),b.jsxs("div",{className:"letter-length-selector",children:[b.jsx("label",{children:"Letter Length"}),b.jsx("div",{className:"length-options",children:["short","medium","long"].map(E=>b.jsxs("button",{className:`length-btn ${ro===E?"active":""}`,onClick:()=>wg(E),children:[E==="short"&&"📝 Short",E==="medium"&&"📄 Medium",E==="long"&&"📑 Long"]},E))}),b.jsxs("span",{className:"length-hint",children:[ro==="short"&&"~150 words • Quick & focused",ro==="medium"&&"~250 words • Balanced coverage",ro==="long"&&"~400 words • Detailed & comprehensive"]})]}),b.jsxs("div",{className:"cover-letter-actions",children:[b.jsx("button",{className:"primary",onClick:()=>$u(),disabled:H||!B.trim(),children:H?b.jsxs(b.Fragment,{children:[b.jsx(Wu,{size:16}),"Generating Letter"]}):b.jsxs(b.Fragment,{children:[b.jsx(kc,{size:16}),"Generate Cover Letter"]})}),b.jsx("button",{className:"secondary",onClick:()=>$u(!0),disabled:H||!xt||!B.trim(),children:"Regenerate Letter"})]}),xt&&b.jsxs("div",{className:"cover-letter-result",children:[b.jsxs("div",{className:"ai-warning",children:[b.jsx("span",{className:"warning-icon",children:"⚠️"}),b.jsx("span",{children:"AI-generated content. Please review for accuracy, relevance, spelling, and grammar before use."})]}),b.jsxs("div",{className:"cover-letter-result-header",children:[b.jsx("h3",{children:"Your Cover Letter"}),b.jsxs("div",{className:"cover-letter-result-actions",children:[b.jsx("button",{onClick:Kg,className:Pi?"copied":void 0,children:Pi?"Copied":"Copy"}),b.jsx("button",{onClick:Zg,children:"Download"})]})]}),b.jsxs("div",{className:"cover-letter-result-tools",children:[b.jsx("div",{className:"cover-letter-result-title-input",children:b.jsx("input",{value:Du,onChange:E=>bc(E.target.value),placeholder:"Title for saved letter (optional)"})}),b.jsxs("div",{className:"cover-letter-result-control-row",children:[b.jsx("button",{onClick:Og,children:"Clear"}),b.jsx("button",{onClick:zg,disabled:!xt||yc,children:"Edit"}),yc&&b.jsx("button",{onClick:$g,disabled:!Ac.trim(),children:"Apply Edits"}),b.jsx("button",{onClick:Bg,disabled:!Jg,className:"primary",children:"Save Letter"})]})]}),yc?b.jsx("textarea",{className:"cover-letter-edit-area",value:Ac,onChange:E=>Fr(E.target.value)}):b.jsx("pre",{children:xt})]})]})]})]})},Qy=({resume:h,onUpdate:e,onCopy:t,copyStatus:s})=>{const[i,n]=V.useState({personal:!0}),a=l=>n(c=>({...c,[l]:!c[l]})),o=[{key:"personal",title:"Personal Information",icon:nh,count:Object.values(h.personalInfo).filter(l=>l).length},{key:"work",title:"Work Experience",icon:im,count:h.workExperience.length},{key:"education",title:"Education",icon:nm,count:h.education.length},{key:"leadership",title:"Leadership & Activities",icon:Am,count:h.leadershipExperience.length},{key:"awards",title:"Awards & Honors",icon:rm,count:h.awards.length},{key:"publications",title:"Publications",icon:Gu,count:h.publications.length},{key:"grants",title:"Grants & Funding",icon:lm,count:h.grants.length},{key:"teaching",title:"Teaching Experience",icon:Gu,count:h.teachingExperience.length},{key:"conferences",title:"Conferences & Presentations",icon:bm,count:h.conferences.length},{key:"skills",title:"Skills",icon:kc,count:h.skills.length}];return b.jsxs("div",{className:"flex flex-col gap-md",children:[o.map(l=>b.jsxs("div",{className:"section-accordion",children:[b.jsxs("div",{className:"section-header",onClick:()=>a(l.key),children:[b.jsx("div",{className:"section-icon",children:b.jsx(l.icon,{size:18})}),b.jsx("span",{className:"section-title",children:l.title}),b.jsx("span",{className:"section-count",children:l.count}),i[l.key]?b.jsx(pu,{size:18,color:"var(--text-muted)"}):b.jsx(gu,{size:18,color:"var(--text-muted)"})]}),i[l.key]&&b.jsxs("div",{className:"section-content",children:[l.key==="personal"&&b.jsx(sA,{info:h.personalInfo,onChange:c=>e({personalInfo:c}),onCopy:t,cs:s}),l.key==="work"&&b.jsx(iA,{items:h.workExperience,onChange:c=>e({workExperience:c}),onCopy:t,cs:s}),l.key==="education"&&b.jsx(nA,{items:h.education,onChange:c=>e({education:c}),onCopy:t,cs:s}),l.key==="leadership"&&b.jsx(rA,{items:h.leadershipExperience,onChange:c=>e({leadershipExperience:c}),onCopy:t,cs:s}),l.key==="awards"&&b.jsx(aA,{items:h.awards,onChange:c=>e({awards:c}),onCopy:t,cs:s}),l.key==="publications"&&b.jsx(oA,{items:h.publications,onChange:c=>e({publications:c}),onCopy:t,cs:s}),l.key==="grants"&&b.jsx(lA,{items:h.grants,onChange:c=>e({grants:c}),onCopy:t,cs:s}),l.key==="teaching"&&b.jsx(cA,{items:h.teachingExperience,onChange:c=>e({teachingExperience:c}),onCopy:t,cs:s}),l.key==="conferences"&&b.jsx(hA,{items:h.conferences,onChange:c=>e({conferences:c}),onCopy:t,cs:s}),l.key==="skills"&&b.jsx(dA,{skills:h.skills,onChange:c=>e({skills:c}),onCopy:t,cs:s})]})]},l.key)),b.jsxs("div",{className:"tip-card",children:[b.jsx("div",{className:"tip-icon",children:b.jsx(dm,{size:20,color:"white"})}),b.jsxs("div",{children:[b.jsx("strong",{children:"Pro Tip"}),b.jsx("p",{style:{margin:0,color:"var(--text-secondary)",fontSize:13},children:"Click the Applyly™ icon on any job page to autofill fields."})]})]})]})},fc=({text:h,id:e,onCopy:t,cs:s})=>b.jsx("button",{onClick:()=>t(h,e),className:"btn-ghost",style:{padding:4},children:s[e]?b.jsx(Mi,{size:12,color:"var(--accent)"}):b.jsx(Cc,{size:12})}),ot=({label:h,value:e,onChange:t,id:s,onCopy:i,cs:n,multi:a})=>b.jsxs("div",{className:"field-group",children:[b.jsxs("div",{className:"field-label",children:[b.jsx("span",{className:"field-label-text",children:h}),b.jsx(fc,{text:e,id:s,onCopy:i,cs:n})]}),a?b.jsx("textarea",{value:e,onChange:o=>t(o.target.value)}):b.jsx("input",{value:e,onChange:o=>t(o.target.value)})]}),ku=({label:h,value:e,onChange:t,id:s,onCopy:i,cs:n})=>{const a=e.split(" ");let o="",l="";a.length>=2?(o=a[0],l=a[1]):a.length===1&&(Xe.includes(a[0])?o=a[0]:/\d{4}/.test(a[0])&&(l=a[0]));const c=(d,u)=>{const f=[d,u].filter(g=>g).join(" ");t(f)};return b.jsxs("div",{className:"field-group",children:[b.jsxs("div",{className:"field-label",children:[b.jsx("span",{className:"field-label-text",children:h}),b.jsx(fc,{text:e,id:s,onCopy:i,cs:n})]}),b.jsxs("div",{className:"grid-2",children:[b.jsxs("select",{value:o,onChange:d=>c(d.target.value,l),style:{appearance:"auto",padding:"8px 10px"},children:[b.jsx("option",{value:"",children:"Month"}),Xe.map(d=>b.jsx("option",{value:d,children:d},d))]}),b.jsx("input",{type:"number",value:l,onChange:d=>c(o,d.target.value),placeholder:"YYYY",min:Po,max:Lo})]})]})},tA=["Bachelor's Degree","Master's Degree","PhD","Associate's Degree","Diploma","Certificate","High School","Vocational","Other"],eA=({label:h,value:e,onChange:t,id:s,options:i,onCopy:n,cs:a,placeholder:o})=>b.jsxs("div",{className:"field-group",children:[b.jsxs("div",{className:"field-label",children:[b.jsx("span",{className:"field-label-text",children:h}),b.jsx(fc,{text:e,id:s,onCopy:n,cs:a})]}),b.jsxs("select",{value:e,onChange:l=>t(l.target.value),style:{appearance:"auto",padding:"8px 10px"},children:[b.jsx("option",{value:"",children:o||`Select ${h.toLowerCase()}`}),i.map(l=>b.jsx("option",{value:l,children:l},l))]})]}),pc=({dates:h,onChange:e,prefix:t,onCopy:s,cs:i})=>b.jsx("div",{className:"grid-4",children:["startMonth","startYear","endMonth","endYear"].map(n=>{const a=n.includes("Month");return b.jsxs("div",{className:"field-group",children:[b.jsxs("div",{className:"field-label",children:[b.jsx("span",{className:"field-label-text",children:n.replace(/([A-Z])/g," $1")}),b.jsx(fc,{text:h[n],id:`${t}-${n}`,onCopy:s,cs:i})]}),a?b.jsxs("select",{value:h[n],onChange:o=>e({...h,[n]:o.target.value}),style:{appearance:"auto",padding:"8px 10px"},children:[b.jsx("option",{value:"",children:"Select Month"}),Xe.map(o=>b.jsx("option",{value:o,children:o},o))]}):b.jsx("input",{type:"number",value:h[n],onChange:o=>e({...h,[n]:o.target.value}),placeholder:"YYYY",min:Po,max:Lo})]},n)})}),gn=({title:h,subtitle:e,onDelete:t,children:s})=>{const[i,n]=V.useState(!1);return b.jsxs("div",{className:"entry-card",children:[b.jsxs("div",{className:"entry-header",onClick:()=>n(!i),children:[i?b.jsx(pu,{size:16,color:"var(--text-muted)"}):b.jsx(gu,{size:16,color:"var(--text-muted)"}),b.jsxs("div",{className:"entry-summary",children:[b.jsx("div",{className:"entry-title",children:h||"New Entry"}),e&&b.jsx("div",{className:"entry-subtitle",children:e})]}),b.jsx("button",{onClick:a=>{a.stopPropagation(),t()},className:"btn-ghost",children:b.jsx(uo,{size:14})})]}),i&&b.jsx("div",{className:"entry-content",children:s})]})},sA=({info:h,onChange:e,onCopy:t,cs:s})=>{const i=[{k:"firstName",l:"First Name",i:nh},{k:"lastName",l:"Last Name",i:nh},{k:"email",l:"Email",i:fm},{k:"phone",l:"Phone",i:mm},{k:"linkedin",l:"LinkedIn",i:um},{k:"website",l:"Website",i:hm},{k:"github",l:"GitHub",i:cm},{k:"address",l:"Address",i:pm}];return b.jsx("div",{className:"grid-2",children:i.map(n=>b.jsx(ot,{label:n.l,value:h[n.k]||"",onChange:a=>e({...h,[n.k]:a}),id:`p-${n.k}`,onCopy:t,cs:s},n.k))})},iA=({items:h,onChange:e,onCopy:t,cs:s})=>{const i=(o,l)=>{const c=[...h];c[o]={...c[o],...l},e(c)},n=o=>e(h.filter((l,c)=>c!==o)),a=()=>e([...h,{id:crypto.randomUUID(),title:"",company:"",location:"",dates:eo(),description:""}]);return b.jsxs("div",{children:[h.map((o,l)=>b.jsxs(gn,{title:o.title,subtitle:o.company,onDelete:()=>n(l),children:[b.jsxs("div",{className:"grid-2",children:[b.jsx(ot,{label:"Title",value:o.title,onChange:c=>i(l,{title:c}),id:`w${l}-t`,onCopy:t,cs:s}),b.jsx(ot,{label:"Company",value:o.company,onChange:c=>i(l,{company:c}),id:`w${l}-c`,onCopy:t,cs:s}),b.jsx(ot,{label:"Location",value:o.location,onChange:c=>i(l,{location:c}),id:`w${l}-l`,onCopy:t,cs:s})]}),b.jsxs("div",{style:{marginTop:12},children:[b.jsx("div",{className:"field-label-text",style:{marginBottom:8},children:"Date Range"}),b.jsx(pc,{dates:o.dates,onChange:c=>i(l,{dates:c}),prefix:`w${l}`,onCopy:t,cs:s})]}),b.jsx(ot,{label:"Description",value:o.description,onChange:c=>i(l,{description:c}),id:`w${l}-d`,onCopy:t,cs:s,multi:!0})]},o.id)),b.jsxs("button",{onClick:a,className:"btn-small",children:[b.jsx(ws,{size:14})," Add Experience"]})]})},nA=({items:h,onChange:e,onCopy:t,cs:s})=>{const i=(o,l)=>{const c=[...h];c[o]={...c[o],...l},e(c)},n=o=>e(h.filter((l,c)=>c!==o)),a=()=>e([...h,{id:crypto.randomUUID(),school:"",degree:"",field:"",location:"",dates:eo(),gpa:"",description:""}]);return b.jsxs("div",{children:[h.map((o,l)=>b.jsxs(gn,{title:o.school,subtitle:o.degree,onDelete:()=>n(l),children:[b.jsxs("div",{className:"grid-2",children:[b.jsx(ot,{label:"School",value:o.school,onChange:c=>i(l,{school:c}),id:`e${l}-s`,onCopy:t,cs:s}),b.jsx(eA,{label:"Degree",value:o.degree,onChange:c=>i(l,{degree:c}),id:`e${l}-d`,options:tA,onCopy:t,cs:s}),b.jsx(ot,{label:"Field",value:o.field,onChange:c=>i(l,{field:c}),id:`e${l}-f`,onCopy:t,cs:s}),b.jsx(ot,{label:"Location",value:o.location,onChange:c=>i(l,{location:c}),id:`e${l}-l`,onCopy:t,cs:s}),b.jsx(ot,{label:"GPA",value:o.gpa||"",onChange:c=>i(l,{gpa:c}),id:`e${l}-g`,onCopy:t,cs:s})]}),b.jsxs("div",{style:{marginTop:12},children:[b.jsx("div",{className:"field-label-text",style:{marginBottom:8},children:"Date Range"}),b.jsx(pc,{dates:o.dates,onChange:c=>i(l,{dates:c}),prefix:`e${l}`,onCopy:t,cs:s})]}),b.jsx(ot,{label:"Description",value:o.description,onChange:c=>i(l,{description:c}),id:`e${l}-desc`,onCopy:t,cs:s,multi:!0})]},o.id)),b.jsxs("button",{onClick:a,className:"btn-small",children:[b.jsx(ws,{size:14})," Add Education"]})]})},rA=({items:h,onChange:e,onCopy:t,cs:s})=>{const i=(o,l)=>{const c=[...h];c[o]={...c[o],...l},e(c)},n=o=>e(h.filter((l,c)=>c!==o)),a=()=>e([...h,{id:crypto.randomUUID(),role:"",organization:"",location:"",dates:eo(),description:""}]);return b.jsxs("div",{children:[h.map((o,l)=>b.jsxs(gn,{title:o.role,subtitle:o.organization,onDelete:()=>n(l),children:[b.jsxs("div",{className:"grid-2",children:[b.jsx(ot,{label:"Role",value:o.role,onChange:c=>i(l,{role:c}),id:`l${l}-r`,onCopy:t,cs:s}),b.jsx(ot,{label:"Organization",value:o.organization,onChange:c=>i(l,{organization:c}),id:`l${l}-o`,onCopy:t,cs:s}),b.jsx(ot,{label:"Location",value:o.location,onChange:c=>i(l,{location:c}),id:`l${l}-l`,onCopy:t,cs:s})]}),b.jsxs("div",{style:{marginTop:12},children:[b.jsx("div",{className:"field-label-text",style:{marginBottom:8},children:"Date Range"}),b.jsx(pc,{dates:o.dates,onChange:c=>i(l,{dates:c}),prefix:`l${l}`,onCopy:t,cs:s})]}),b.jsx(ot,{label:"Description",value:o.description,onChange:c=>i(l,{description:c}),id:`l${l}-d`,onCopy:t,cs:s,multi:!0})]},o.id)),b.jsxs("button",{onClick:a,className:"btn-small",children:[b.jsx(ws,{size:14})," Add Leadership"]})]})},aA=({items:h,onChange:e,onCopy:t,cs:s})=>{const i=(o,l)=>{const c=[...h];c[o]={...c[o],...l},e(c)},n=o=>e(h.filter((l,c)=>c!==o)),a=()=>e([...h,{id:crypto.randomUUID(),title:"",issuer:"",date:"",description:""}]);return b.jsxs("div",{children:[h.map((o,l)=>b.jsxs(gn,{title:o.title,subtitle:o.issuer||o.date,onDelete:()=>n(l),children:[b.jsxs("div",{className:"grid-2",children:[b.jsx(ot,{label:"Title",value:o.title,onChange:c=>i(l,{title:c}),id:`a${l}-t`,onCopy:t,cs:s}),b.jsx(ot,{label:"Issuer",value:o.issuer,onChange:c=>i(l,{issuer:c}),id:`a${l}-i`,onCopy:t,cs:s})]}),b.jsx(ku,{label:"Award Date",value:o.date,onChange:c=>i(l,{date:c}),id:`a${l}-d`,onCopy:t,cs:s}),b.jsx(ot,{label:"Description",value:o.description,onChange:c=>i(l,{description:c}),id:`a${l}-desc`,onCopy:t,cs:s,multi:!0})]},o.id)),b.jsxs("button",{onClick:a,className:"btn-small",children:[b.jsx(ws,{size:14})," Add Award"]})]})},oA=({items:h,onChange:e,onCopy:t,cs:s})=>{const i=(d,u)=>{const f=[...h];f[d]={...f[d],...u},e(f)},n=d=>e(h.filter((u,f)=>f!==d)),a=()=>e([...h,{id:crypto.randomUUID(),title:"",authors:"",authorsList:[],journal:"",date:"",url:"",description:""}]),[o,l]=V.useState({}),c=d=>l(u=>({...u,[d]:!u[d]}));return b.jsxs("div",{children:[h.map((d,u)=>{var f;return b.jsxs(gn,{title:d.title,subtitle:d.journal||d.date,onDelete:()=>n(u),children:[b.jsxs("div",{className:"grid-2",children:[b.jsx(ot,{label:"Title",value:d.title,onChange:g=>i(u,{title:g}),id:`pub${u}-t`,onCopy:t,cs:s}),b.jsx(ot,{label:"Journal",value:d.journal,onChange:g=>i(u,{journal:g}),id:`pub${u}-j`,onCopy:t,cs:s}),b.jsx(ku,{label:"Publication Date",value:d.date,onChange:g=>i(u,{date:g}),id:`pub${u}-d`,onCopy:t,cs:s}),b.jsx(ot,{label:"URL",value:d.url,onChange:g=>i(u,{url:g}),id:`pub${u}-u`,onCopy:t,cs:s})]}),b.jsxs("div",{style:{marginTop:12},children:[b.jsxs("div",{className:"field-label",style:{cursor:"pointer",marginBottom:8},onClick:()=>c(d.id),children:[b.jsxs("span",{className:"field-label-text",children:["Authors (",((f=d.authorsList)==null?void 0:f.length)||0,")"]}),o[d.id]?b.jsx(pu,{size:14}):b.jsx(gu,{size:14}),b.jsx(fc,{text:d.authors,id:`pub${u}-a`,onCopy:t,cs:s})]}),o[d.id]&&b.jsxs("div",{style:{marginTop:8,padding:"12px",background:"var(--bg-app)",borderRadius:8,border:"1px solid var(--border)"},children:[b.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:10},children:[(d.authorsList||[]).map((g,m)=>b.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[b.jsx("input",{value:g.firstName,onChange:y=>{const w=[...d.authorsList||[]];w[m]={...g,firstName:y.target.value},i(u,{authorsList:w,authors:w.map(x=>`${x.lastName}, ${x.firstName}`).join("; ")})},placeholder:"First Name",style:{flex:1}}),b.jsx("input",{value:g.lastName,onChange:y=>{const w=[...d.authorsList||[]];w[m]={...g,lastName:y.target.value},i(u,{authorsList:w,authors:w.map(x=>`${x.lastName}, ${x.firstName}`).join("; ")})},placeholder:"Last Name",style:{flex:1}}),b.jsx("button",{onClick:()=>{const y=(d.authorsList||[]).filter((w,x)=>x!==m);i(u,{authorsList:y,authors:y.map(w=>`${w.lastName}, ${w.firstName}`).join("; ")})},className:"btn-ghost",style:{padding:4,color:"#ef4444"},children:b.jsx(mu,{size:14})})]},m)),b.jsxs("button",{onClick:()=>{const g=[...d.authorsList||[],{firstName:"",lastName:""}];i(u,{authorsList:g})},className:"btn-small",style:{alignSelf:"flex-start",marginTop:4},children:[b.jsx(ws,{size:12})," Add Author"]})]}),b.jsx("div",{style:{marginTop:12,borderTop:"1px solid var(--border)",paddingTop:12},children:b.jsx(ot,{label:"Raw String (Fallback)",value:d.authors,onChange:g=>i(u,{authors:g}),id:`pub${u}-ar`,onCopy:t,cs:s,multi:!0})})]}),!o[d.id]&&d.authors&&b.jsxs("div",{style:{fontSize:12,color:"var(--text-muted)",marginTop:4},children:[d.authors.substring(0,60),d.authors.length>60?"...":""]})]})]},d.id)}),b.jsxs("button",{onClick:a,className:"btn-small",children:[b.jsx(ws,{size:14})," Add Publication"]})]})},lA=({items:h,onChange:e,onCopy:t,cs:s})=>{const i=(o,l)=>{const c=[...h];c[o]={...c[o],...l},e(c)},n=o=>e(h.filter((l,c)=>c!==o)),a=()=>e([...h,{id:crypto.randomUUID(),title:"",funder:"",amount:"",dates:eo(),description:""}]);return b.jsxs("div",{children:[h.map((o,l)=>b.jsxs(gn,{title:o.title,subtitle:o.amount||o.funder,onDelete:()=>n(l),children:[b.jsxs("div",{className:"grid-3",children:[b.jsx(ot,{label:"Title",value:o.title,onChange:c=>i(l,{title:c}),id:`g${l}-t`,onCopy:t,cs:s}),b.jsx(ot,{label:"Funder",value:o.funder,onChange:c=>i(l,{funder:c}),id:`g${l}-f`,onCopy:t,cs:s}),b.jsx(ot,{label:"Amount",value:o.amount,onChange:c=>i(l,{amount:c}),id:`g${l}-a`,onCopy:t,cs:s})]}),b.jsxs("div",{style:{marginTop:12},children:[b.jsx("div",{className:"field-label-text",style:{marginBottom:8},children:"Date Range"}),b.jsx(pc,{dates:o.dates,onChange:c=>i(l,{dates:c}),prefix:`g${l}`,onCopy:t,cs:s})]})]},o.id)),b.jsxs("button",{onClick:a,className:"btn-small",children:[b.jsx(ws,{size:14})," Add Grant"]})]})},cA=({items:h,onChange:e,onCopy:t,cs:s})=>{const i=(o,l)=>{const c=[...h];c[o]={...c[o],...l},e(c)},n=o=>e(h.filter((l,c)=>c!==o)),a=()=>e([...h,{id:crypto.randomUUID(),course:"",institution:"",role:"",dates:eo(),description:""}]);return b.jsxs("div",{children:[h.map((o,l)=>b.jsxs(gn,{title:o.course,subtitle:o.institution,onDelete:()=>n(l),children:[b.jsxs("div",{className:"grid-3",children:[b.jsx(ot,{label:"Course",value:o.course,onChange:c=>i(l,{course:c}),id:`t${l}-c`,onCopy:t,cs:s}),b.jsx(ot,{label:"Institution",value:o.institution,onChange:c=>i(l,{institution:c}),id:`t${l}-i`,onCopy:t,cs:s}),b.jsx(ot,{label:"Role",value:o.role,onChange:c=>i(l,{role:c}),id:`t${l}-r`,onCopy:t,cs:s})]}),b.jsxs("div",{style:{marginTop:12},children:[b.jsx("div",{className:"field-label-text",style:{marginBottom:8},children:"Date Range"}),b.jsx(pc,{dates:o.dates,onChange:c=>i(l,{dates:c}),prefix:`t${l}`,onCopy:t,cs:s})]}),b.jsx(ot,{label:"Description",value:o.description,onChange:c=>i(l,{description:c}),id:`t${l}-d`,onCopy:t,cs:s,multi:!0})]},o.id)),b.jsxs("button",{onClick:a,className:"btn-small",children:[b.jsx(ws,{size:14})," Add Teaching"]})]})},hA=({items:h,onChange:e,onCopy:t,cs:s})=>{const i=(o,l)=>{const c=[...h];c[o]={...c[o],...l},e(c)},n=o=>e(h.filter((l,c)=>c!==o)),a=()=>e([...h,{id:crypto.randomUUID(),title:"",conference:"",location:"",date:"",description:""}]);return b.jsxs("div",{children:[h.map((o,l)=>b.jsxs(gn,{title:o.title,subtitle:o.conference||o.date,onDelete:()=>n(l),children:[b.jsxs("div",{className:"grid-2",children:[b.jsx(ot,{label:"Title",value:o.title,onChange:c=>i(l,{title:c}),id:`c${l}-t`,onCopy:t,cs:s}),b.jsx(ot,{label:"Conference",value:o.conference,onChange:c=>i(l,{conference:c}),id:`c${l}-c`,onCopy:t,cs:s}),b.jsx(ot,{label:"Location",value:o.location,onChange:c=>i(l,{location:c}),id:`c${l}-l`,onCopy:t,cs:s})]}),b.jsx(ku,{label:"Date",value:o.date,onChange:c=>i(l,{date:c}),id:`c${l}-d`,onCopy:t,cs:s})]},o.id)),b.jsxs("button",{onClick:a,className:"btn-small",children:[b.jsx(ws,{size:14})," Add Conference"]})]})},dA=({skills:h,onChange:e,onCopy:t,cs:s})=>{const[i,n]=V.useState(""),a=()=>{i.trim()&&(e([...h,i.trim()]),n(""))},o=l=>e(h.filter((c,d)=>d!==l));return b.jsxs("div",{children:[b.jsx("div",{className:"skills-grid",style:{marginBottom:16},children:h.map((l,c)=>b.jsxs("div",{className:"skill-tag",onClick:()=>t(l,`sk${c}`),children:[s[`sk${c}`]&&b.jsx(Mi,{size:12}),l,b.jsx("button",{onClick:d=>{d.stopPropagation(),o(c)},style:{background:"none",border:"none",padding:0,cursor:"pointer",marginLeft:4},children:b.jsx(mu,{size:12})})]},c))}),b.jsxs("div",{className:"flex gap-sm",children:[b.jsx("input",{value:i,onChange:l=>n(l.target.value),onKeyDown:l=>l.key==="Enter"&&a(),placeholder:"Add skill...",style:{flex:1}}),b.jsx("button",{onClick:a,className:"btn-small",children:b.jsx(ws,{size:14})})]})]})};am.createRoot(document.getElementById("root")).render(b.jsx(om.StrictMode,{children:b.jsx(Jy,{})}));
